{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///AgoraRTC-production.js","webpack:///webpack/bootstrap 005f9966c106f9a0942b","webpack:///./src/utils/Logger.js","webpack:///./src/Config.js","webpack:///./src/utils/Browser.js","webpack:///./src/Helper.js","webpack:///./src/Events.js","webpack:///./src/Report2.js","webpack:///./src/views/View.js","webpack:///./src/Stream.js","webpack:///./src/utils/ErrorCodes.js","webpack:///./src/views/Bar.js","webpack:///./src/Connection.js","webpack:///./src/utils/Request.js","webpack:///./src/utils/AgoraCall.js","webpack:///./src/Server.js","webpack:///./src/GlobalName.js","webpack:///./src/utils/Time.js","webpack:///../node_modules/uuid/v4.js","webpack:///../node_modules/uuid/lib/rng-browser.js","webpack:///(webpack)/buildin/global.js","webpack:///../node_modules/uuid/lib/bytesToUuid.js","webpack:///./src/views/VideoPlayer.js","webpack:///./src/views/Speaker.js","webpack:///./node_modules/css-element-queries/src/ResizeSensor.js","webpack:///./src/vendor/adapter.js","webpack:///./src/views/AudioPlayer.js","webpack:///./src/webrtc-stacks/ChromeCanaryStack.js","webpack:///./src/webrtc-stacks/ChromeStableStack.js","webpack:///./src/webrtc-stacks/SafariStableStack.js","webpack:///./src/webrtc-stacks/FcStack.js","webpack:///./src/webrtc-stacks/FirefoxStack.js","webpack:///./src/Stats.js","webpack:///./src/Client.js","webpack:///./src/GatewayClient.js","webpack:///./src/Websocket.js","webpack:///./src/Signal.js","webpack:///./src/SimMap.js","webpack:///./src/Entry.production.js"],"names":["root","factory","exports","module","define","amd","this","modules","__webpack_require__","moduleId","installedModules","i","l","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","value","_Time","Logger","setLogLevel","log","debug","info","warning","error","logLevel","level","arguments","args","getTimestamp","console","apply","warn","length","push","DEBUG","INFO","WARNING","ERROR","NONE","default","WEBCS_DOMAIN","WEBCS_DOMAIN_BACKUP_LIST","SUPPORT_RESOLUTION_LIST","90p_1","120p_1","120p_3","120p_4","180p_1","180p_3","180p_4","240p_1","240p_3","240p_4","360p_1","360p_3","360p_4","360p_6","360p_7","360p_8","360p_9","360p_10","360p_11","480p_1","480p_2","480p_3","480p_4","480p_6","480p_8","480p_9","480p_10","720p_1","720p_2","720p_3","720p_5","720p_6","1080p_1","1080p_2","1080p_3","1080p_5","1440p_1","1440p_2","4k_1","4k_3","GIT_VERSION","VERSION","EVENT_REPORT_DOMAIN","EVENT_REPORT_BACKUP_DOMAIN","WEBCS_BACKUP_CONNECT_TIMEOUT","HTTP_CONNECT_TIMEOUT","isChrome","getBrowserInfo","isSafari","isFireFox","isOpera","isQQBrowser","isWeChatBrowser","isSupportedPC","os","getBrowserOS","indexOf","isSupportedMobile","getBrowserVersion","version","_getBrowserInfo","tem","ua","navigator","userAgent","M","match","test","exec","toLowerCase","undefined","clientStrings","r","id","cs","_interopRequireDefault","obj","generateSessionId","_v2","replace","toUpperCase","random","safeCall","is32Uint","vsResHack","CSCrashRecord","audioLevelHelper","isLiveTranscodingValid","checkSystemRequirements","_typeof","Symbol","iterator","constructor","_Browser","Browser","newObj","key","_Logger","_Logger2","_v","PC","window","RTCPeerConnection","mozRTCPeerConnection","webkitRTCPeerConnection","getUserMedia","webkitGetUserMedia","msGetUserMedia","mozGetUserMedia","mediaDevices","webSocket","WebSocket","isAPISupport","isVendorAndVersionSupport","callback","Array","slice","audioContext","AudioContext","webkitAudioContext","stream","sourceNode","otWebkitAudioSource","createMediaStreamSource","analyser","createAnalyser","timeDomainData","Uint8Array","frequencyBinCount","connect","getAudioLevel","getByteTimeDomainData","max","idx","Math","abs","shouldBlock","localStorage","record","JSON","parse","getItem","Date","getTime","date","setItem","stringify","onSuccess","onFailure","video","document","createElement","setAttribute","body","appendChild","addEventListener","ev","videoWidth","videoHeight","removeChild","srcObject","transcoding","specialAttr","isTranscodingUsersValid","Error","users","number","isNaN","seed","rnd","ceil","EventDispatcher","that","dispatcher","eventListeners","eventType","listener","on","removeEventListener","index","splice","dispatchEvent","event","type","dispatchSocketEvent","msg","LicodeEvent","spec","StreamEvent","reason","ClientEvent","uid","attr","MediaEvent","LiveStreamingEvent","url","SUBSCRIBE","PUBLISH","JOIN_GATEWAY","JOIN_CHOOSE_SERVER","SESSION_INIT","report","_Config","config","_Request","base","sid","lts","succ","cname","peerid","cid","elaps","extend","vid","list","shouldUseHttps","urlBackup","sessionInit","param","head","assign","startTime","si","appid","mode","ver","browser","send","joinChooseServer","coverHead","jcs","endTime","ev_elaps","serverList","joinGateway","jg","publish","pu","subscribe","sub","firstRemoteFrame","frf","streamSwitch","ss","isdual","audioSendingStopped","ass","videoSendingStopped","vss","data","post","e","timeout","_Events","View","getDevices","createStream","Stream","_VideoPlayer","_VideoPlayer2","_AudioPlayer","_Connection","_Stats","_Helper","_Report","isLegacyChrome","appVersion","isFirefox","getReso","w","h","width","ideal","height","deviceId","cameraId","exact","params","aux_stream","onClose","local","audio","screen","screenAttributes","maxFr","minFr","videoSize","player","attributes","videoEnabled","audioEnabled","lowStream","streamId","streamID","mirror","initialized","supportedVideoList","true","unspecified","unmuteAudio","muteAudio","unmuteVideo","muteVideo","setVideoResolution","resolution","setVideoFrameRate","framerate","minFrameRate","maxFrameRate","setVideoBitRate","bitrate","minVideoBW","maxVideoBW","setScreenProfile","profile","setVideoProfileCustom","setVideoProfileCustomPlus","setVideoProfile","getId","getAttributes","hasAudio","hasVideo","hasScreen","isVideoOn","isAudioOn","init","init_retry","videoOpt","constraints","extensionId","fake","mediaSource","frameRate","microphoneId","constraints_copy","GetUserMedia","getVideoTracks","onended","err","setTimeout","theConfig","message","close","tracks","getTracks","t","stop","enableAudio","getAudioTracks","enabled","disableAudio","enableVideo","disableVideo","play","elementID","assetsURL","showing","options","destroy","getStats","cb","pc","stats","isSubscriber","filterStats","subscribeStatsFilter","videoReceivedResolutionHeight","videoReceivedResolutionWidth","publishStatsFilter","videoSendResolutionHeight","videoSendResolutionWidth","uplinkStats","videoSendBandwidth","uplink_available_bandwidth","videoSendPacketsLost","uplink_cumulative_lost","enumerateDevices","then","devices","catch","ErrorCodes","FAILED","INVALID_KEY","INVALID_OPERATION","INVALID_PARAMETER","INVALID_LOCAL_STREAM","INVALID_REMOTE_STREAM","INVALID_DYNAMIC_KEY","DYNAMIC_KEY_TIMEOUT","NO_VOCS_AVAILABLE","NO_VOS_AVAILABLE","JOIN_CHANNEL_TIMEOUT","NO_AVAILABLE_CHANNEL","LOOKUP_CHANNEL_TIMEOUT","LOOKUP_CHANNEL_REJECTED","OPEN_CHANNEL_TIMEOUT","OPEN_CHANNEL_REJECTED","REQUEST_DEFERRED","SOCKET_ERROR","SOCKET_DISCONNECTED","PEERCONNECTION_FAILED","CONNECT_GATEWAY_ERROR","SERVICE_NOT_AVAILABLE","JOIN_CHANNEL_FAILED","PUBLISH_STREAM_FAILED","UNPUBLISH_STREAM_FAILED","SUBSCRIBE_STREAM_FAILED","UNSUBSCRIBE_STREAM_FAILED","NO_SUCH_REMOTE_STREAM","ERR_FAILED","ERR_INVALID_VENDOR_KEY","ERR_INVALID_CHANNEL_NAME","WARN_NO_AVAILABLE_CHANNEL","WARN_LOOKUP_CHANNEL_TIMEOUT","WARN_LOOKUP_CHANNEL_REJECTED","WARN_OPEN_CHANNEL_TIMEOUT","WARN_OPEN_CHANNEL_REJECTED","WARN_REQUEST_DEFERRED","ERR_DYNAMIC_KEY_TIMEOUT","ERR_INVALID_DYNAMIC_KEY","ERR_NO_VOCS_AVAILABLE","ERR_NO_VOS_AVAILABLE","ERR_JOIN_CHANNEL_TIMEOUT","IOS_NOT_SUPPORT","SHARING_SCREEN_NOT_SUPPORT","STILL_ON_PUBLISHING","ELECTRON_NOT_SUPPORT_SHARING_SCREEN","GatewayErrorCode","2000","2001","2002","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","2","3","4","5","6","7","8","9","10","14","15","16","_View","_View2","_Speaker","_Speaker2","Bar","waiting","show","div","bar","link","logo","displaying","clearTimeout","display","hide","getElementById","speaker","media","Connection","_ChromeCanaryStack","_ChromeCanaryStack2","_ChromeStableStack","_ChromeStableStack2","_SafariStableStack","_SafariStableStack2","_FcStack","_FcStack2","_FirefoxStack","_FirefoxStack2","_ErrorCodes","sessionId","session_id","electronUtil","selectSource","sources","dialog","map","source","item","span","innerHTML","imgContain","img","src","thumbnail","toDataURL","onclick","bottom","share","electron","desktopCapturer","getSources","types","sourceId","mWidth","mHeight","mandatory","chromeMediaSource","chromeMediaSourceId","maxHeight","maxWidth","getMedia","require","code","chrome","runtime","sendMessage","getStream","response","theId","theError","success","failure","xhr","XMLHttpRequest","open","setRequestHeader","onload","responseText","onerror","ontimeout","location","protocol","AgoraCall","getGatewayList","requestChooseServer","option","csOption","appId","res","csAddr","ec","requestGatewayList","joinInfo","connected","gateway_addr","st","failed","domainlist","csURL","backupList","isSuccess","timer","times","request","gatewayAddr","AUDIO_SAMPLE_RATE_32000","AUDIO_SAMPLE_RATE_44100","AUDIO_SAMPLE_RATE_48000","VIDEO_CODEC_PROFILE_BASELINE","VIDEO_CODEC_PROFILE_MAIN","VIDEO_CODEC_PROFILE_HIGH","REMOTE_VIDEO_STREAM_HIGH","REMOTE_VIDEO_STREAM_LOW","REMOTE_VIDEO_STREAM_MEDIUM","toTimeString","split","getMilliseconds","v4","buf","offset","rnds","rng","ii","bytesToUuid","global","crypto","msCrypto","getRandomValues","rnds8","g","Function","eval","bth","byteToHex","toString","substr","_Bar","_ResizeSensor","_ResizeSensor2","_adapter","VideoPlayer","pause","resizer","parentNode","resize","container","offsetWidth","offsetHeight","style","top","left","containerWidth","containerHeight","volume","evt","attachMediaStream","removeAttribute","audioStream","MediaStream","Speaker","mute","unmute","lastVolume","icon","muted","picker","min","step","oninput","onmouseover","onmouseout","__WEBPACK_AMD_DEFINE_FACTORY__","__WEBPACK_AMD_DEFINE_RESULT__","forEachElement","elements","elementsType","isCollectionTyped","jQuery","Elements","j","requestAnimationFrame","mozRequestAnimationFrame","webkitRequestAnimationFrame","fn","ResizeSensor","element","EventQueue","q","add","remove","newQueue","getComputedStyle","prop","currentStyle","getPropertyValue","attachResizeEvent","resized","resizedAttached","resizeSensor","className","styleChild","cssText","position","dirty","rafId","newWidth","newHeight","expand","childNodes","expandChild","shrink","lastWidth","lastHeight","reset","scrollLeft","scrollTop","onResized","onScroll","addEvent","el","attachEvent","elem","detach","contains","requestUserMedia","Promise","resolve","reject","reattachMediaStream","webrtcDetectedBrowser","webrtcDetectedVersion","webrtcMinimumVersion","webrtcUtils","extractVersion","uastring","expr","pos","parseInt","HTMLMediaElement","mozSrcObject","_srcObject","set","URL","createObjectURL","to","from","pcConfig","pcConstraints","iceServers","newIceServers","server","urls","newServer","username","credential","RTCSessionDescription","mozRTCSessionDescription","RTCIceCandidate","mozRTCIceCandidate","onError","constraintsToFF37","keys","forEach","advanced","oc","kind","label","groupId","orgEnumerateDevices","bind","iceTransportPolicy","iceTransports","origGetStats","selector","successCallback","errorCallback","self","fixChromeStats","standardReport","result","standardStats","timestamp","names","stat","successCallbackWrapper","method","nativeMethod","opts","constraintsToChrome","optional","cc","oldname","prefix","charAt","mix","concat","kinds","MediaStreamTrack","device","origGetUserMedia","webrtcTesting","_Bar2","AudioPlayer","myURL","webkitURL","stream_url","ChromeCanaryStack","WebkitRTCPeerConnection","pc_config","con","DtlsSrtpKeyAgreement","stunServerUrl","turnServer","turn","password","mediaConstraints","OfferToReceiveVideo","OfferToReceiveAudio","roapSessionId","peerConnection","onicecandidate","candidate","iceCandidateCount","iceGatheringState","ices","moreIceComing","markActionNeeded","setMaxBW","sdp","a","maxAudioBW","processSignalingMessage","msgstring","sd","incomingMessage","state","messageType","setRemoteDescription","sendOK","addStream","removeStream","actionNeeded","doLater","onstablestate","what","mySDP","createOffer","sessionDescription","prevOffer","setLocalDescription","localDescription","createAnswer","iceStarted","now","operation","roapMessage","offererSessionId","answererSessionId","otherSessionId","seq","sequenceNumber","tiebreaker","floor","onsignalingmessage","text","onopen","onaddstream","onremovestream","oniceconnectionstatechange","currentTarget","iceConnectionState","ChromeStableStack","localsdp","hassrflxcand","hashostcand","ice","filterSdp","getStatsRate","filterList","originList","timeStamp","connectedTime","ontrack","SafariStableStack","bundlePolicy","outbound_rtp_audio","mediaType","googCodecName","aecDivergentFilterFraction","audioInputLevel","bytesSent","packetsSent","googEchoCancellationReturnLoss","googEchoCancellationReturnLossEnhancement","outbound_rtp_video","codec","packetsLost","googAdaptationChanges","googAvgEncodeMs","googEncodeUsagePercent","googFirsReceived","googFrameHeightSent","googFrameHeightInput","googFrameRateInput","googFrameRateSent","googFrameWidthSent","googFrameWidthInput","googNacksReceived","googPlisReceived","googRtt","googFramesEncoded","inbound_rtp_audio","audioOutputLevel","bytesReceived","packetsReceived","googAccelerateRate","googCurrentDelayMs","googDecodingCNG","googDecodingCTN","googDecodingCTSG","googDecodingNormal","googDecodingPLC","googDecodingPLCCNG","googExpandRate","googJitterBufferMs","googJitterReceived","googPreemptiveExpandRate","googPreferredJitterBufferMs","googSecondaryDecodedRate","googSpeechExpandRate","inbound_rtp_video","googTargetDelayMs","googDecodeMs","googMaxDecodeMs","googRenderDelayMs","googFrameWidthReceived","googFrameHeightReceived","googFrameRateReceived","googFrameRateDecoded","googFrameRateOutput","googFramesDecoded","googFrameReceived","googMinPlayoutDelayMs","googNacksSent","googPlisSent","googFirsSent","bweforvideo","googAvailableSendBandwidth","googAvailableReceiveBandwidth","googActualEncBitrate","googRetransmitBitrate","googTargetEncBitrate","googBucketDelay","googTransmitBitrate","lastFramesEncoded","lastFramesDecoded","lastFramesReceived","pliCount","nackCount","firCount","framesEncoded","jitter","frameWidth","frameHeight","framesReceived","framesDecoded","audioLevel","availableIncomingBitrate","availableOutgoingBitrate","track","addTrack","audioReceiver","addTransceiver","videoReceiver","setDirection","FcStack","FirefoxStack","hasStream","offerToReceiveAudio","offerToReceiveVideo","mozDontOfferDataChannel","framerateMean","isRemote","detection","audioSendBytes","audioSendPackets","videoSendBytes","videoSendPackets","videoSendFrameRate","audioCodecName","videoCodecName","duration","audioReceiveBytes","audioReceivePackets","audioReceivePacketsLost","videoReceiveBytes","videoReceivePackets","videoReceivePacketsLost","videoReceiveFrameRate","videoReceiveDecodeFrameRate","videoReceiveBandwidth","LiveTranscoding","TranscodingUser","createLiveClient","createRtcClient","createClient","_GatewayClient","_GatewayClient2","_ErrorCodes2","_Server","_SimMap","_Stream","_GlobalName","Client","highStream","lowStreamParameter","isDualStream","highStreamState","lowStreamState","setLowStreamParameter","_getVideoCameraIdByLabel","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","next","done","return","configPublisher","gatewayClient","enableDualStream","_publishLowStream","disableDualStream","_unpublishLowStream","_createLowStream","videoTrack","parameter","sim","simMap","_getLowStream","unpublish","join","channelKey","channel","renewChannelKey","leave","_publish","_unpublish","unsubscribe","setRemoteVideoStreamType","streamType","startLiveStreaming","transcodingEnabled","stopLiveStreaming","setLiveTranscoding","preState","x","y","zOrder","alpha","videoBitrate","videoFramerate","lowLatency","audioSampleRate","audioBitrate","audioChannels","videoGop","videoCodecProfile","userCount","userConfigExtraInfo","backgroundColor","transcodingUsers","role","_Websocket","_Websocket2","_AgoraCall","_AgoraCall2","GatewayClient","removeRemoteStreams","remoteStreams","isBanned","Ping","_type","Join","Leave","Control","Token","Unpublish","Unsubscribe","SwitchVideoStream","Publish","p2pid","PublishStats","PublishStatsLow","Subscribe","SubscribeStats","StartLiveStreaming","StopLiveStreaming","SetLiveTranscoding","socket","timers","timer_counter","localStreams","attemps","p2p_attemps","activeSpeaker","p2ps","Map","firstFrameTimer","liveStreams","p2pCounter","generateP2PId","remoteVideoStreamTypes","addr","connectSocket","pingTimer","setInterval","getURL","clearInterval","publishLTS","p2pId","sendSimpleSdp","answer","getUserId","offer","localSDP","ok","action","delete","subscribeLTS","nop2p","streams","subscribeEvt","unsortedKeys","sortedUids","sort","uid1","uid2","generateInterval","k","pow","recover","size","time","disconnect","createSocket","host","reconnect","clear","arg","errcode","emitSimpleMessage","respType","respCallback","_Signal","_Signal2","Socket","signal","onEvent","creatConnection","sendSignalCommand","Signal","needReconnect","isTimeout","isInit","hostIndex","requestID","Reconnection","connection","timeoutCheck","onmessage","_id","onclose","readyState","OPEN","_result","_Client"],"mappings":"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,GtC+hRAN,GsCxhREkgC,gBtCwhRwB+K,EAAQ/K,gBAClClgC,EsCxhREigC,gBtCwhRwBgL,EAAQhL,gBAClCjgC,EsCvhREqgC,atCuhRqB4K,EAAQ5K,aAC/BrgC,EsCvhRE4T,atCuhRqB+sB,EAAQ/sB,aAC/B5T,EsCthREiC,OtCshRe4H,EAAStG,QAC1BvD,EsCthRE2T,WtCshRmBgtB,EAAQhtB,WAC7B3T,EsCthREmJ,wBtCshRgCgL,EAAQhL,wBAC1CnJ,EsCrhREoG,QtCqhRgBiK,EAAQjK,QAC1BpG,EsCphREqnB,wBtCohRgCuZ,EAAYvZ,wBAC9CrnB,EsCphREsnB,wBtCohRgCsZ,EAAYtZ,wBAC9CtnB,EsCphREunB,wBtCohRgCqZ,EAAYrZ,wBAC9CvnB,EsCnhREwnB,6BtCmhRqCoZ,EAAYpZ,6BACnDxnB,EsCnhREynB,yBtCmhRiCmZ,EAAYnZ,yBAC/CznB,EsCnhRE0nB,yBtCmhRiCkZ,EAAYlZ,yBAC/C1nB,EsClhRE2nB,yBtCkhRiCiZ,EAAYjZ,yBAC/C3nB,EsClhRE4nB,wBtCkhRgCgZ,EAAYhZ,wBAC9C5nB,EsClhRE6nB,2BtCkhRmC+Y,EAAY/Y","file":"AgoraRTC-production.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"AgoraRTC\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"AgoraRTC\"] = factory();\n\telse\n\t\troot[\"AgoraRTC\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"AgoraRTC\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"AgoraRTC\"] = factory();\n\telse\n\t\troot[\"AgoraRTC\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 38);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _Time = __webpack_require__(15);\n\n/*\n * API to write logs based on traditional logging mechanisms: debug, trace, info, warning, error\n */\nvar Logger = function () {\n  \"use strict\";\n\n  var DEBUG = 0,\n      INFO = 1,\n      WARNING = 2,\n      ERROR = 3,\n      NONE = 4,\n      logLevel = DEBUG,\n      setLogLevel,\n      log,\n      debug,\n      info,\n      warning,\n      error;\n\n  // It sets the new log level. We can set it to NONE if we do not want to print logs\n  setLogLevel = function setLogLevel(level) {\n    if (level > NONE) {\n      level = NONE;\n    } else if (level < DEBUG) {\n      level = DEBUG;\n    }\n    logLevel = level;\n  };\n\n  // Generic function to print logs for a given level: [DEBUG, TRACE, INFO, WARNING, ERROR]\n  log = function log() {\n    var level = arguments[0];\n    var args = arguments;\n    if (level < logLevel) {\n      return;\n    }\n    switch (level) {\n      case DEBUG:\n        args[0] = (0, _Time.getTimestamp)() + ' DEBUG:';\n        console.log.apply(console, args);\n        break;\n      case INFO:\n        args[0] = (0, _Time.getTimestamp)() + ' INFO:';\n        console.log.apply(console, args);\n        break;\n      case WARNING:\n        args[0] = (0, _Time.getTimestamp)() + ' WARN:';\n        console.warn.apply(console, args);\n        break;\n      case ERROR:\n        args[0] = (0, _Time.getTimestamp)() + ' ERROR:';\n        console.error.apply(console, args);\n        break;\n      default:\n        args[0] = (0, _Time.getTimestamp)() + ' DEFAULT:';\n        console.log.apply(console, args);\n        return;\n    }\n  };\n\n  // It prints debug logs\n  debug = function debug() {\n    var args = [DEBUG];\n    for (var i = 0; i < arguments.length; i++) {\n      args.push(arguments[i]);\n    }\n    log.apply(this, args);\n  };\n\n  // It prints info logs\n  info = function info() {\n    var args = [INFO];\n    for (var i = 0; i < arguments.length; i++) {\n      args.push(arguments[i]);\n    }\n    log.apply(this, args);\n  };\n\n  // It prints warning logs\n  warning = function warning() {\n    var args = [WARNING];\n    for (var i = 0; i < arguments.length; i++) {\n      args.push(arguments[i]);\n    }\n    log.apply(this, args);\n  };\n\n  // It prints error logs\n  error = function error() {\n    var args = [ERROR];\n    for (var i = 0; i < arguments.length; i++) {\n      args.push(arguments[i]);\n    }\n    log.apply(this, args);\n  };\n\n  return {\n    DEBUG: DEBUG,\n    INFO: INFO,\n    WARNING: WARNING,\n    ERROR: ERROR,\n    NONE: NONE,\n    setLogLevel: setLogLevel,\n    log: log,\n    debug: debug,\n    info: info,\n    warning: warning,\n    error: error\n  };\n}();\n\nexports.default = Logger;\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar GIT_VERSION = \"release_20180109_01-136-gcefa6b1\";\n\nvar VERSION = \"2.2.0\";\n// const WEBCS_DOMAIN = \"webcs-1.agora.io\";\n// const WEBCS_DOMAIN_BACKUP_LIST = [\n//   \"webcs-2.agora.io\",\n//   \"webcs-3.agora.io\",\n//   \"webcs-4.agora.io\",\n// ];\nvar WEBCS_DOMAIN = [\"webcs-1.agora.io\", \"webcs-2.agora.io\"];\nvar WEBCS_DOMAIN_BACKUP_LIST = [\"webcs-3.agora.io\", \"webcs-4.agora.io\"];\n\nvar EVENT_REPORT_DOMAIN = \"webcollector-1.agora.io\";\nvar EVENT_REPORT_BACKUP_DOMAIN = \"webcollector-2.agora.io\";\n\nvar WEBCS_BACKUP_CONNECT_TIMEOUT = 6000;\nvar HTTP_CONNECT_TIMEOUT = 5000;\n\nvar SUPPORT_RESOLUTION_LIST = {\n  '90p_1': [160, 90],\n  '120p_1': [160, 120],\n  '120p_3': [120, 120],\n  '120p_4': [212, 120],\n  '180p_1': [320, 180],\n  '180p_3': [180, 180],\n  '180p_4': [240, 180],\n  '240p_1': [320, 240],\n  '240p_3': [240, 240],\n  '240p_4': [424, 240],\n  '360p_1': [640, 360],\n  '360p_3': [360, 360],\n  '360p_4': [640, 360],\n  '360p_6': [360, 360],\n  '360p_7': [480, 360],\n  '360p_8': [480, 360],\n  '360p_9': [640, 360],\n  '360p_10': [640, 360],\n  '360p_11': [640, 360],\n  '480p_1': [640, 480],\n  '480p_2': [640, 480],\n  '480p_3': [480, 480],\n  '480p_4': [640, 480],\n  '480p_6': [480, 480],\n  '480p_8': [848, 480],\n  '480p_9': [848, 480],\n  '480p_10': [640, 480],\n  '720p_1': [1280, 720],\n  '720p_2': [1280, 720],\n  '720p_3': [1280, 720],\n  '720p_5': [960, 720],\n  '720p_6': [960, 720],\n  '1080p_1': [1920, 1080],\n  '1080p_2': [1920, 1080],\n  '1080p_3': [1920, 1080],\n  '1080p_5': [1920, 1080],\n  '1440p_1': [2560, 1440],\n  '1440p_2': [2560, 1440],\n  '4k_1': [3840, 2160],\n  '4k_3': [3840, 2160]\n};\n\nexports.GIT_VERSION = GIT_VERSION;\nexports.VERSION = VERSION;\nexports.WEBCS_DOMAIN = WEBCS_DOMAIN;\nexports.WEBCS_DOMAIN_BACKUP_LIST = WEBCS_DOMAIN_BACKUP_LIST;\nexports.EVENT_REPORT_DOMAIN = EVENT_REPORT_DOMAIN;\nexports.EVENT_REPORT_BACKUP_DOMAIN = EVENT_REPORT_BACKUP_DOMAIN;\nexports.WEBCS_BACKUP_CONNECT_TIMEOUT = WEBCS_BACKUP_CONNECT_TIMEOUT;\nexports.HTTP_CONNECT_TIMEOUT = HTTP_CONNECT_TIMEOUT;\nexports.SUPPORT_RESOLUTION_LIST = SUPPORT_RESOLUTION_LIST;\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\nvar isChrome = function isChrome() {\n\tvar info = getBrowserInfo();\n\treturn info.name && info.name === 'Chrome';\n};\n\nvar isSafari = function isSafari() {\n\tvar info = getBrowserInfo();\n\treturn info.name && info.name === 'Safari';\n};\n\nvar isFireFox = function isFireFox() {\n\tvar info = getBrowserInfo();\n\treturn info.name && info.name === 'Firefox';\n};\n\nvar isOpera = function isOpera() {\n\tvar info = getBrowserInfo();\n\treturn info.name && info.name === 'OPR';\n};\n\nvar isQQBrowser = function isQQBrowser() {\n\tvar info = getBrowserInfo();\n\treturn info.name && info.name === 'MQQBrowser';\n};\n\nvar isWeChatBrowser = function isWeChatBrowser() {\n\tvar info = getBrowserInfo();\n\treturn info.name && info.name === 'MicroMessenger';\n};\n\nvar isSupportedPC = function isSupportedPC() {\n\tvar os = getBrowserOS();\n\treturn os === 'Linux' || os === 'Mac OS X' || os === 'Mac OS' || os.indexOf(\"Windows\") !== -1;\n};\n\nvar isSupportedMobile = function isSupportedMobile() {\n\tvar os = getBrowserOS();\n\treturn os === 'Android' || os === 'iOS';\n};\n\nvar getBrowserVersion = function getBrowserVersion() {\n\tvar info = getBrowserInfo();\n\treturn info.version;\n};\n\nvar getBrowserOS = function getBrowserOS() {\n\tvar info = getBrowserInfo();\n\treturn info.os;\n};\n\nvar _getBrowserInfo = function _getBrowserInfo() {\n\tvar ua = navigator.userAgent,\n\t    tem,\n\t    M = ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\\/))\\/?\\s*(\\d+)/i) || [];\n\n\t// TODO: copy from Stack OverFlow, I don't think it works\n\tif (/trident/i.test(M[1])) {\n\t\ttem = /\\brv[ :]+(\\d+)/g.exec(ua) || [];\n\t\treturn { name: 'IE', version: tem[1] || '' };\n\t}\n\n\t// for opera\n\tif (M[1] === 'Chrome') {\n\t\ttem = ua.match(/(OPR(?=\\/))\\/?(\\d+)/i);\n\t\tif (tem != null) {\n\t\t\tM = tem;\n\t\t}\n\t}\n\n\t// for Safari version\n\tif (M[1] === 'Safari') {\n\t\tif ((tem = ua.match(/version\\/(\\d+)/i)) != null) {\n\t\t\tM[2] = tem[1];\n\t\t}\n\t}\n\n\t// for QQ\n\tif (~ua.toLowerCase().indexOf('mqqbrowser')) {\n\t\ttem = ua.match(/(mqqbrowser(?=\\/))\\/?(\\d+)/i);\n\t\tif (tem != null) {\n\t\t\tM = tem;\n\t\t}\n\t}\n\n\t// for weChat\n\tif (~ua.toLowerCase().indexOf('micromessenger')) {\n\t\ttem = ua.match(/(micromessenger(?=\\/))\\/?(\\d+)/i);\n\t\tif (tem != null) {\n\t\t\tM = tem;\n\t\t}\n\t}\n\n\tvar os = undefined;\n\tvar clientStrings = [{ s: 'Windows 10', r: /(Windows 10.0|Windows NT 10.0)/ }, { s: 'Windows 8.1', r: /(Windows 8.1|Windows NT 6.3)/ }, { s: 'Windows 8', r: /(Windows 8|Windows NT 6.2)/ }, { s: 'Windows 7', r: /(Windows 7|Windows NT 6.1)/ }, { s: 'Windows Vista', r: /Windows NT 6.0/ }, { s: 'Windows Server 2003', r: /Windows NT 5.2/ }, { s: 'Windows XP', r: /(Windows NT 5.1|Windows XP)/ }, { s: 'Windows 2000', r: /(Windows NT 5.0|Windows 2000)/ }, { s: 'Windows ME', r: /(Win 9x 4.90|Windows ME)/ }, { s: 'Windows 98', r: /(Windows 98|Win98)/ }, { s: 'Windows 95', r: /(Windows 95|Win95|Windows_95)/ }, { s: 'Windows NT 4.0', r: /(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/ }, { s: 'Windows CE', r: /Windows CE/ }, { s: 'Windows 3.11', r: /Win16/ }, { s: 'Android', r: /Android/ }, { s: 'Open BSD', r: /OpenBSD/ }, { s: 'Sun OS', r: /SunOS/ }, { s: 'Linux', r: /(Linux|X11)/ }, { s: 'iOS', r: /(iPhone|iPad|iPod)/ }, { s: 'Mac OS X', r: /Mac OS X/ }, { s: 'Mac OS', r: /(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/ }, { s: 'QNX', r: /QNX/ }, { s: 'UNIX', r: /UNIX/ }, { s: 'BeOS', r: /BeOS/ }, { s: 'OS/2', r: /OS\\/2/ }, { s: 'Search Bot', r: /(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\\/Teoma|ia_archiver)/ }];\n\tfor (var id in clientStrings) {\n\t\tvar cs = clientStrings[id];\n\t\tif (cs.r.test(navigator.userAgent)) {\n\t\t\tos = cs.s;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn {\n\t\tname: M[1],\n\t\tversion: M[2],\n\t\tos: os\n\t};\n};\n\nvar getBrowserInfo = function () {\n\tvar info = _getBrowserInfo();\n\treturn function () {\n\t\treturn info;\n\t};\n}();\n\nexports.getBrowserInfo = getBrowserInfo;\nexports.getBrowserVersion = getBrowserVersion;\nexports.getBrowserOS = getBrowserOS;\nexports.isChrome = isChrome;\nexports.isSafari = isSafari;\nexports.isFireFox = isFireFox;\nexports.isOpera = isOpera;\nexports.isQQBrowser = isQQBrowser;\nexports.isWeChatBrowser = isWeChatBrowser;\nexports.isSupportedPC = isSupportedPC;\nexports.isSupportedMobile = isSupportedMobile;\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.random = exports.safeCall = exports.is32Uint = exports.vsResHack = exports.CSCrashRecord = exports.audioLevelHelper = exports.generateSessionId = exports.isLiveTranscodingValid = exports.checkSystemRequirements = undefined;\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _Browser = __webpack_require__(2);\n\nvar Browser = _interopRequireWildcard(_Browser);\n\nvar _Logger = __webpack_require__(0);\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _v = __webpack_require__(16);\n\nvar _v2 = _interopRequireDefault(_v);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nvar checkSystemRequirements = function checkSystemRequirements() {\n  var PC = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection;\n  var getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.msGetUserMedia || navigator.mozGetUserMedia || navigator.mediaDevices && navigator.mediaDevices.getUserMedia;\n  var webSocket = window.WebSocket;\n  var isAPISupport = !!PC && !!getUserMedia && !!webSocket;\n\n  var isVendorAndVersionSupport = false;\n  _Logger2.default.debug(Browser.getBrowserInfo(), \"isAPISupport:\" + isAPISupport);\n\n  if (Browser.isChrome() && Browser.getBrowserVersion() >= 58) {\n    if (Browser.getBrowserOS() !== 'iOS') {\n      isVendorAndVersionSupport = true;\n    }\n  }\n\n  if (Browser.isFireFox() && Browser.getBrowserVersion() >= 56) {\n    isVendorAndVersionSupport = true;\n  }\n\n  if (Browser.isOpera() && Browser.getBrowserVersion() >= 45) {\n    isVendorAndVersionSupport = true;\n  }\n\n  if (Browser.isSafari() && Browser.getBrowserVersion() >= 11) {\n    isVendorAndVersionSupport = true;\n  }\n\n  if (Browser.isWeChatBrowser() || Browser.isQQBrowser()) {\n    if (Browser.getBrowserOS() !== 'iOS') {\n      isVendorAndVersionSupport = true;\n    }\n  }\n\n  if (!Browser.isSupportedPC() && !Browser.isSupportedMobile()) {\n    isVendorAndVersionSupport = false;\n  }\n\n  return isAPISupport && isVendorAndVersionSupport;\n};\n\nvar safeCall = function safeCall() {\n  var callback = arguments[0];\n  if (typeof callback === \"function\") {\n    var args = Array.prototype.slice.call(arguments, 1);\n    callback.apply(null, args);\n  }\n};\n\nvar audioContext = new (window.AudioContext || window.webkitAudioContext)();\nvar audioLevelHelper = function audioLevelHelper(stream) {\n  this.audioContext = audioContext;\n  this.sourceNode = stream.otWebkitAudioSource || this.audioContext.createMediaStreamSource(stream);\n  this.analyser = this.audioContext.createAnalyser();\n  this.timeDomainData = new Uint8Array(this.analyser.frequencyBinCount);\n  this.sourceNode.connect(this.analyser);\n\n  this.getAudioLevel = function () {\n    if (this.analyser) {\n      this.analyser.getByteTimeDomainData(this.timeDomainData);\n\n      // varies from 0 to 255\n      var max = 0;\n      for (var idx = 0; idx < this.timeDomainData.length; idx++) {\n        max = Math.max(max, Math.abs(this.timeDomainData[idx] - 128));\n      }\n\n      // normalize the collected level to match the range delivered by\n      // the getStats' audioOutputLevel\n      return max / 128;\n    } else {\n      _Logger2.default.warning(\"can't find analyser in audioLevelHelper\");\n      return 0;\n    }\n  };\n  return this;\n};\n\nfunction generateSessionId() {\n  return (0, _v2.default)().replace(/-/g, \"\").toUpperCase();\n  // return 'xxxxxxxxxxxxxx4xxxxyxxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n  //   var r = Math.random() * 16 | 0,\n  //   v= c=='x' ? r : r & 0x3 | 0x8;\n  //   return v.toString(16).toUpperCase();\n  // });\n}\n\nvar CSCrashRecord = {\n  shouldBlock: function shouldBlock() {\n    if (localStorage) {\n      var record = JSON.parse(localStorage.getItem(\"agoraCSCrashRecord\"));\n      return record && record.length > 6 ? new Date().getTime() - record[record.length - 6] - 10000 < 0 ? true : false : false;\n    } else {\n      return false;\n    }\n  },\n  record: function record(date) {\n    if (localStorage) {\n      var record = JSON.parse(localStorage.getItem(\"agoraCSCrashRecord\"));\n      record = !record || record.length > 50 ? [] : record;\n      record.push(date);\n      localStorage.setItem(\"agoraCSCrashRecord\", JSON.stringify(record));\n    }\n  }\n};\n\nvar vsResHack = function vsResHack(stream, onSuccess, onFailure) {\n  try {\n    var video = document.createElement('video');\n    video.setAttribute('autoplay', '');\n    video.setAttribute('muted', '');\n    // in iOS, not this attribute will not trigger 'playing' event\n    video.setAttribute('playsinline', '');\n    video.setAttribute('style', 'position: absolute; top: 0; left: 0; width:1px; high:1px;');\n    document.body.appendChild(video);\n\n    video.addEventListener('playing', function (ev) {\n      // Firefox will triger this event twice\n      if (Browser.isFireFox()) {\n        if (video.videoWidth) {\n          onSuccess(video.videoWidth, video.videoHeight);\n          document.body.removeChild(video);\n        }\n      } else {\n        onSuccess(video.videoWidth, video.videoHeight);\n        document.body.removeChild(video);\n      }\n    });\n    video.srcObject = stream;\n  } catch (error) {\n    onFailure(error);\n  }\n};\n\nvar is32Uint = function is32Uint(n) {\n  return !!(0 <= n && n <= 4294967296 - 1);\n};\n\nvar isLiveTranscodingValid = function isLiveTranscodingValid(transcoding) {\n  var specialAttr = ['lowLatency', 'userConfigExtraInfo', 'transcodingUsers'];\n  for (var key in transcoding) {\n    if (key === 'lowLatency' && typeof transcoding[key] !== 'boolean' || key === 'userConfigExtraInfo' && _typeof(transcoding[key]) !== 'object' || key === 'transcodingUsers' && !isTranscodingUsersValid(transcoding[key]) || !~specialAttr.indexOf(key) && typeof transcoding[key] !== 'number') {\n      throw new Error('Param [' + key + '] is inVaild');\n    }\n  }\n  return true;\n};\n\nvar isTranscodingUsersValid = function isTranscodingUsersValid(users) {\n  for (var i = 0; i < users.length; i++) {\n    for (var key in users[i]) {\n      if (typeof users[i][key] !== 'number') {\n        throw new Error('Param user[' + i + '] - [' + key + '] is inVaild');\n      }\n    }\n  }\n  return true;\n};\n\nvar random = function random(number) {\n  if (isNaN(number)) {\n    number = 1000;\n  }\n  var seed = +new Date();\n  // https://www.zhihu.com/question/22818104\n  seed = (seed * 9301 + 49297) % 233280;\n  var rnd = seed / 233280.0;\n  return Math.ceil(rnd * number);\n};\n\nexports.checkSystemRequirements = checkSystemRequirements;\nexports.isLiveTranscodingValid = isLiveTranscodingValid;\nexports.generateSessionId = generateSessionId;\nexports.audioLevelHelper = audioLevelHelper;\nexports.CSCrashRecord = CSCrashRecord;\nexports.vsResHack = vsResHack;\nexports.is32Uint = is32Uint;\nexports.safeCall = safeCall;\nexports.random = random;\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n/*\n * Class EventDispatcher provides event handling to sub-classes.\n * It is inherited from Publisher, Room, etc.\n */\nvar EventDispatcher = function EventDispatcher() {\n    \"use strict\";\n\n    var that = {};\n    // Private vars\n    that.dispatcher = {};\n    that.dispatcher.eventListeners = {};\n\n    // Public functions\n\n    // It adds an event listener attached to an event type.\n    that.addEventListener = function (eventType, listener) {\n        if (that.dispatcher.eventListeners[eventType] === undefined) {\n            that.dispatcher.eventListeners[eventType] = [];\n        }\n        that.dispatcher.eventListeners[eventType].push(listener);\n    };\n\n    that.on = that.addEventListener;\n\n    // It removes an available event listener.\n    that.removeEventListener = function (eventType, listener) {\n        var index;\n        index = that.dispatcher.eventListeners[eventType].indexOf(listener);\n        if (index !== -1) {\n            that.dispatcher.eventListeners[eventType].splice(index, 1);\n        }\n    };\n\n    // It dispatch a new event to the event listeners, based on the type\n    // of event. All events are intended to be LicodeEvents.\n    that.dispatchEvent = function (event) {\n        var listener;\n        for (listener in that.dispatcher.eventListeners[event.type]) {\n            if (that.dispatcher.eventListeners[event.type].hasOwnProperty(listener) && typeof that.dispatcher.eventListeners[event.type][listener] === 'function') {\n                that.dispatcher.eventListeners[event.type][listener](event);\n            }\n        }\n    };\n\n    that.dispatchSocketEvent = function (event) {\n        var listener;\n        for (listener in that.dispatcher.eventListeners[event.type]) {\n            if (that.dispatcher.eventListeners[event.type].hasOwnProperty(listener) && typeof that.dispatcher.eventListeners[event.type][listener] === 'function') {\n                that.dispatcher.eventListeners[event.type][listener](event.msg);\n            }\n        }\n    };\n\n    return that;\n};\n\n// **** EVENTS ****\n\n/*\n * Class LicodeEvent represents a generic Event in the library.\n * It handles the type of event, that is important when adding\n * event listeners to EventDispatchers and dispatching new events.\n * A LicodeEvent can be initialized this way:\n * var event = LicodeEvent({type: \"room-connected\"});\n */\nvar LicodeEvent = function LicodeEvent(spec) {\n    \"use strict\";\n\n    var that = {};\n\n    // Event type. Examples are: 'room-connected', 'stream-added', etc.\n    that.type = spec.type;\n\n    return that;\n};\n\n/*\n * Class StreamEvent represents an event related to a stream. It is a LicodeEvent.\n * It is usually initialized this way:\n * var streamEvent = StreamEvent({type:\"stream-added\", stream:stream1});\n * Event types:\n * 'stream-added' - indicates that there is a new stream available in the room.\n * 'stream-removed' - shows that a previous available stream has been removed from the room.\n */\nvar StreamEvent = function StreamEvent(spec) {\n    \"use strict\";\n\n    var that = LicodeEvent(spec);\n\n    // The stream related to this event.\n    that.stream = spec.stream;\n    that.reason = spec.reason;\n    that.msg = spec.msg;\n\n    return that;\n};\n\n/*\n * Class ClientEvent represents an event related to a client. It is a LicodeEvent.\n * It is usually initialized this way:\n * var clientEvent = ClientEvent({type:\"client-left\", uid: user, attr: attributes});\n * Event types:\n * 'client-connected' - points out that the user has been successfully connected.\n * 'client-disconnected' - shows that the user has been already disconnected.\n * 'client-joined' - indicates that there is a new client joined.\n * 'client-left' - indicates that a client has left.\n *\n * NOTE: 'client-connected' event shall always trigger 'client-joined' event,\n * while 'client-disconnected' event shall always trigger 'client-left' event;\n */\nvar ClientEvent = function ClientEvent(spec) {\n    \"use strict\";\n\n    var that = LicodeEvent(spec);\n    that.uid = spec.uid;\n    that.attr = spec.attr;\n    that.stream = spec.stream;\n    return that;\n};\n\n/*\n * Class MediaEvent represents an event related to a getUserMedia(). It is a LicodeEvent.\n * It usually initializes as:\n * var mediaEvent = MediaEvent({})\n * Event types:\n * 'access-accepted' - indicates that the user has accepted to share his camera and microphone\n * 'warning' - details are included in the event message (msg)\n * 'error' - details are included in the event message (msg)\n */\nvar MediaEvent = function MediaEvent(spec) {\n    \"use strict\";\n\n    var that = LicodeEvent(spec);\n    that.msg = spec.msg;\n    return that;\n};\n\nvar LiveStreamingEvent = function LiveStreamingEvent(spec) {\n    \"use strict\";\n\n    var that = LicodeEvent(spec);\n    that.url = spec.url;\n    that.reason = spec.reason;\n    return that;\n};\n\nexports.EventDispatcher = EventDispatcher;\nexports.StreamEvent = StreamEvent;\nexports.ClientEvent = ClientEvent;\nexports.MediaEvent = MediaEvent;\nexports.LiveStreamingEvent = LiveStreamingEvent;\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SUBSCRIBE = exports.PUBLISH = exports.JOIN_GATEWAY = exports.JOIN_CHOOSE_SERVER = exports.SESSION_INIT = exports.report = undefined;\n\nvar _Config = __webpack_require__(1);\n\nvar config = _interopRequireWildcard(_Config);\n\nvar _Logger = __webpack_require__(0);\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _Request = __webpack_require__(11);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nvar SESSION_INIT = 'session_init';\nvar JOIN_CHOOSE_SERVER = 'join_choose_server';\nvar JOIN_GATEWAY = 'join_gateway';\nvar PUBLISH = 'publish';\nvar SUBSCRIBE = 'subscribe';\nvar FIRST_REMOTE_FRAME = 'first_remote_frame';\nvar STREAM_SWITCH = 'stream_switch';\nvar AUDIO_SENDING_STOPPED = 'audio_sending_stopped';\nvar VIDEO_SENDING_STOPPED = 'video_sending_stopped';\n\nvar base = {\n  type: null,\n  sid: null,\n  lts: null,\n  succ: null,\n  cname: null,\n  uid: null,\n  peerid: null,\n  cid: null,\n  elaps: null,\n  extend: null,\n  vid: 0\n};\n\nvar report = function () {\n  var that = {};\n  that.list = {};\n  that.url = (0, _Request.shouldUseHttps)() ? 'https://' + config.EVENT_REPORT_DOMAIN + ':6443/events/report' : 'http://' + config.EVENT_REPORT_DOMAIN + ':6080/events/report';\n\n  that.urlBackup = (0, _Request.shouldUseHttps)() ? 'https://' + config.EVENT_REPORT_BACKUP_DOMAIN + ':6443/events/report' : 'http://' + config.EVENT_REPORT_BACKUP_DOMAIN + '\":6080/events/report';\n\n  that.sessionInit = function (sid, param) {\n    param.sid = sid;\n    var head = Object.assign(base, param);\n    // the first time join\n    if (!that.list[sid]) {\n      head.startTime = +new Date();\n    }\n    var si = Object.assign({}, head);\n\n    delete head.appid;\n    delete head.mode;\n    that.list[sid] = head;\n\n    si.extend = null;\n    si.ver = config.VERSION;\n    si.type = SESSION_INIT;\n    si.browser = navigator.userAgent;\n    si.lts = +new Date();\n    si.elaps = si.lts - si.startTime;\n    that.send(si);\n  };\n\n  that.joinChooseServer = function (sid, param, coverHead) {\n    var jcs;\n    // when multi cs request, only the first result will cover the head\n    if (coverHead) {\n      jcs = Object.assign(that.list[sid], param);\n    } else {\n      jcs = Object.assign({}, that.list[sid], param);\n    }\n    jcs.type = JOIN_CHOOSE_SERVER;\n    var endTime = +new Date();\n    jcs.ev_elaps = endTime - jcs.lts;\n    jcs.elaps = endTime - jcs.startTime;\n    jcs.lts = endTime;\n    jcs.serverList = JSON.stringify(jcs.serverList);\n    that.send(jcs);\n  };\n\n  that.joinGateway = function (sid, param) {\n    var jg = Object.assign(that.list[sid], param);\n    jg.type = JOIN_GATEWAY;\n    var endTime = +new Date();\n    jg.ev_elaps = endTime - jg.lts;\n    jg.elaps = endTime - jg.startTime;\n    jg.lts = endTime;\n    that.send(jg);\n  };\n\n  that.publish = function (sid, param) {\n    var pu = Object.assign({}, that.list[sid], param);\n    pu.type = PUBLISH;\n    // We have a previous LTS which is defined as a timestamp of start point. Now a new LTS is created for the end point. And ev_elapse is the difference between peers.\n    var endTime = +new Date();\n    pu.ev_elaps = endTime - pu.lts;\n    pu.elaps = endTime - pu.startTime;\n    pu.lts = endTime;\n    that.send(pu);\n  };\n\n  that.subscribe = function (sid, param) {\n    var sub = Object.assign({}, that.list[sid], param);\n    sub.type = SUBSCRIBE;\n    // We have a previous LTS which is defined as a timestamp of start point. Now a new LTS is created for the end point. And ev_elapse is the difference between peers.\n    var endTime = +new Date();\n    sub.ev_elaps = endTime - sub.lts;\n    sub.elaps = endTime - sub.startTime;\n    sub.lts = endTime;\n    that.send(sub);\n  };\n\n  that.firstRemoteFrame = function (sid, param) {\n    var frf = Object.assign({}, that.list[sid], param);\n    frf.type = FIRST_REMOTE_FRAME;\n    // frf.elaps = null;\n    frf.lts = +new Date();\n    frf.elaps = frf.lts - frf.startTime;\n    that.send(frf);\n  };\n\n  that.streamSwitch = function (sid, param) {\n    var ss = Object.assign({}, that.list[sid], param);\n    ss.type = STREAM_SWITCH;\n    ss.isdual = param.isdual;\n    ss.lts = +new Date();\n    ss.elaps = ss.lts - ss.startTime;\n    that.send(ss);\n  };\n\n  that.audioSendingStopped = function (sid, param) {\n    var ass = Object.assign({}, that.list[sid], param);\n    ass.type = AUDIO_SENDING_STOPPED;\n    ass.lts = +new Date();\n    ass.elaps = ass.lts - ass.startTime;\n    that.send(ass);\n  };\n\n  that.videoSendingStopped = function (sid, param) {\n    var vss = Object.assign({}, that.list[sid], param);\n    vss.type = VIDEO_SENDING_STOPPED;\n    vss.lts = +new Date();\n    vss.elaps = vss.lts - vss.startTime;\n    that.send(vss);\n  };\n\n  that.send = function (data) {\n    try {\n      (0, _Request.post)(that.url, data, null, function (e) {\n        (0, _Request.post)(that.urlBackup, data, null, function (e) {\n          // user should not see anything about report\n          // Logger.warning(\"Event report failed\");\n        }, { timeout: 10000 });\n      }, { timeout: 10000 });\n    } catch (error) {\n      // won't throw out error\n    }\n  };\n  return that;\n}();\n\nexports.report = report;\nexports.SESSION_INIT = SESSION_INIT;\nexports.JOIN_CHOOSE_SERVER = JOIN_CHOOSE_SERVER;\nexports.JOIN_GATEWAY = JOIN_GATEWAY;\nexports.PUBLISH = PUBLISH;\nexports.SUBSCRIBE = SUBSCRIBE;\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _Events = __webpack_require__(4);\n\nvar View = function View(spec) {\n  \"use strict\";\n\n  var that = (0, _Events.EventDispatcher)(spec);\n\n  // Variables\n\n  // URL where it will look for icons and assets\n  that.url = \".\";\n  return that;\n}; /*\n    * View class represents a HTML component\n    * Every view is an EventDispatcher.\n    */\n\nexports.default = View;\n\n/***/ }),\n/* 7 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getDevices = exports.createStream = exports.Stream = undefined;\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _VideoPlayer = __webpack_require__(20);\n\nvar _VideoPlayer2 = _interopRequireDefault(_VideoPlayer);\n\nvar _AudioPlayer = __webpack_require__(24);\n\nvar _AudioPlayer2 = _interopRequireDefault(_AudioPlayer);\n\nvar _Connection = __webpack_require__(10);\n\nvar _Events = __webpack_require__(4);\n\nvar _Logger = __webpack_require__(0);\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _Browser = __webpack_require__(2);\n\nvar _Stats = __webpack_require__(31);\n\nvar _Helper = __webpack_require__(3);\n\nvar _Report = __webpack_require__(5);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/*\n * Class Stream represents a local or a remote Stream in the client.\n * It will handle the WebRTC stream and identify the stream and\n * where it should be drawn.\n */\nvar Stream = function Stream(spec) {\n  \"use strict\";\n\n  var that = (0, _Events.EventDispatcher)();\n\n  // TODO: rewrite\n  // use to create low stream\n  that.params = Object.assign({}, spec);\n\n  that.stream = spec.stream;\n  that.aux_stream = undefined;\n  that.url = spec.url;\n  that.onClose = undefined;\n  that.local = false;\n  that.video = !!spec.video;\n  that.audio = !!spec.audio;\n  that.screen = !!spec.screen;\n  that.screenAttributes = { width: 1920, height: 1080, maxFr: 5, minFr: 1 };\n  that.videoSize = spec.videoSize;\n  that.player = undefined;\n  that.audioLevelHelper = null;\n  spec.attributes = spec.attributes || {};\n\n  that.videoEnabled = true;\n  that.audioEnabled = true;\n  that.lowStream = null;\n\n  that.videoWidth = 0;\n  that.videoHeight = 0;\n\n  that.streamId = null;\n  that.streamId = spec.streamID;\n  that.mirror = spec.mirror === false ? false : true;\n\n  if (that.videoSize !== undefined && (!(that.videoSize instanceof Array) || that.videoSize.length !== 4)) {\n    throw Error(\"Invalid Video Size\");\n  } else {\n    that.videoSize = [640, 480, 640, 480];\n  }\n\n  if (spec.local === undefined || spec.local === true) {\n    that.local = true;\n  }\n\n  that.initialized = !that.local;\n\n  function isLegacyChrome() {\n    return window.navigator.appVersion.match(/Chrome\\/([\\w\\W]*?)\\./) !== null && window.navigator.appVersion.match(/Chrome\\/([\\w\\W]*?)\\./)[1] <= 35;\n  }\n\n  function isFirefox() {\n    return window.navigator.userAgent.match(\"Firefox\") !== null;\n  }\n\n  function getReso(w, h) {\n    return {\n      width: { ideal: w },\n      height: { ideal: h },\n      deviceId: spec.cameraId ? { exact: spec.cameraId } : undefined\n    };\n  }\n\n  var supportedVideoList = {\n    'true': true,\n    'unspecified': true,\n    '90p_1': getReso(160, 90),\n    '120p_1': getReso(160, 120),\n    '120p_3': getReso(120, 120),\n    '120p_4': getReso(212, 120),\n    '180p_1': getReso(320, 180),\n    '180p_3': getReso(180, 180),\n    '180p_4': getReso(240, 180),\n    '240p_1': getReso(320, 240),\n    '240p_3': getReso(240, 240),\n    '240p_4': getReso(424, 240),\n    '360p_1': getReso(640, 360),\n    '360p_3': getReso(360, 360),\n    '360p_4': getReso(640, 360),\n    '360p_6': getReso(360, 360),\n    '360p_7': getReso(480, 360),\n    '360p_8': getReso(480, 360),\n    '360p_9': getReso(640, 360),\n    '360p_10': getReso(640, 360),\n    '360p_11': getReso(640, 360),\n    '480p_1': getReso(640, 480),\n    '480p_2': getReso(640, 480),\n    '480p_3': getReso(480, 480),\n    '480p_4': getReso(640, 480),\n    '480p_6': getReso(480, 480),\n    '480p_8': getReso(848, 480),\n    '480p_9': getReso(848, 480),\n    '480p_10': getReso(640, 480),\n    '720p_1': getReso(1280, 720),\n    '720p_2': getReso(1280, 720),\n    '720p_3': getReso(1280, 720),\n    '720p_5': getReso(960, 720),\n    '720p_6': getReso(960, 720),\n    '1080p_1': getReso(1920, 1080),\n    '1080p_2': getReso(1920, 1080),\n    '1080p_3': getReso(1920, 1080),\n    '1080p_5': getReso(1920, 1080),\n    '1440p_1': getReso(2560, 1440),\n    '1440p_2': getReso(2560, 1440),\n    '4k_1': getReso(3840, 2160),\n    '4k_3': getReso(3840, 2160)\n  };\n\n  that.unmuteAudio = undefined;\n  that.muteAudio = undefined;\n  that.unmuteVideo = undefined;\n  that.muteVideo = undefined;\n\n  that.setVideoResolution = function (resolution) {\n    resolution += '';\n    if (supportedVideoList[resolution] !== undefined) {\n      spec.video = supportedVideoList[resolution];\n      spec.attributes = spec.attributes || {};\n      spec.attributes.resolution = resolution;\n      return true;\n    }\n    return false;\n  };\n\n  that.setVideoFrameRate = function (framerate) {\n    if ((0, _Browser.isFireFox)()) {\n      return false;\n    }\n\n    if ((typeof framerate === 'undefined' ? 'undefined' : _typeof(framerate)) === 'object' && framerate instanceof Array && framerate.length > 1) {\n      spec.attributes = spec.attributes || {};\n      spec.attributes.minFrameRate = framerate[0];\n      spec.attributes.maxFrameRate = framerate[1];\n      return true;\n    }\n    return false;\n  };\n\n  that.setVideoBitRate = function (bitrate) {\n    if ((typeof bitrate === 'undefined' ? 'undefined' : _typeof(bitrate)) === 'object' && bitrate instanceof Array && bitrate.length > 1) {\n      spec.attributes = spec.attributes || {};\n      spec.attributes.minVideoBW = bitrate[0];\n      spec.attributes.maxVideoBW = bitrate[1];\n      return true;\n    }\n    return false;\n  };\n\n  // Public functions\n  that.setScreenProfile = function (profile) {\n    if (typeof profile == 'string' && that.screen) {\n      switch (profile) {\n        case '480p_1':\n          that.screenAttributes.width = 640;\n          that.screenAttributes.height = 480;\n          that.screenAttributes.maxFr = 5;\n          that.screenAttributes.minFr = 1;\n          break;\n        case '480p_2':\n          that.screenAttributes.width = 640;\n          that.screenAttributes.height = 480;\n          that.screenAttributes.maxFr = 30;\n          that.screenAttributes.minFr = 25;\n          break;\n        case '720p_1':\n          that.screenAttributes.width = 1280;\n          that.screenAttributes.height = 720;\n          that.screenAttributes.maxFr = 5;\n          that.screenAttributes.minFr = 1;\n          break;\n        case '720p_2':\n          that.screenAttributes.width = 1280;\n          that.screenAttributes.height = 720;\n          that.screenAttributes.maxFr = 30;\n          that.screenAttributes.minFr = 25;\n          break;\n        case '1080p_1':\n          that.screenAttributes.width = 1920;\n          that.screenAttributes.height = 1080;\n          that.screenAttributes.maxFr = 5;\n          that.screenAttributes.minFr = 1;\n          break;\n        case '1080p_2':\n          that.screenAttributes.width = 1920;\n          that.screenAttributes.height = 1080;\n          that.screenAttributes.maxFr = 30;\n          that.screenAttributes.minFr = 25;\n          break;\n      }\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  that.setVideoProfileCustom = function (profile) {\n    that.setVideoResolution(profile[0]);\n    that.setVideoFrameRate([profile[1], profile[1]]);\n    that.setVideoBitRate([profile[2], profile[2]]);\n  };\n\n  that.setVideoProfileCustomPlus = function (profile) {\n    console.log(profile);\n    spec.video = getReso(profile.width, profile.height);\n    spec.attributes = spec.attributes || {};\n    spec.attributes.resolution = profile.width + 'x' + profile.height;\n\n    that.setVideoFrameRate([profile.framerate, profile.framerate]);\n    that.setVideoBitRate([profile.bitrate, profile.bitrate]);\n  };\n\n  that.setVideoProfile = function (profile) {\n    that.profile = profile;\n    if (typeof profile == 'string' && that.video) {\n      switch (profile) {\n        case '120p':\n        case '120P':\n        case '120p_1':\n        case '120P_1':\n          that.setVideoResolution('120p_1');\n          that.setVideoFrameRate([15, 15]);\n          that.setVideoBitRate([10, 65]);\n          break;\n        case '120p_3':\n        case '120P_3':\n          that.setVideoResolution('120p_3');\n          that.setVideoFrameRate([15, 15]);\n          that.setVideoBitRate([10, 50]);\n          break;\n        case '180p':\n        case '180P':\n        case '180p_1':\n        case '180P_1':\n          that.setVideoResolution('180p_1');\n          that.setVideoFrameRate([15, 15]);\n          that.setVideoBitRate([10, 140]);\n          break;\n        case '180p_3':\n        case '180P_3':\n          that.setVideoResolution('180p_3');\n          that.setVideoFrameRate([15, 15]);\n          that.setVideoBitRate([10, 100]);\n          break;\n        case '180p_4':\n        case '180P_4':\n          that.setVideoResolution('180p_4');\n          that.setVideoFrameRate([15, 15]);\n          that.setVideoBitRate([10, 120]);\n          break;\n        case '240p':\n        case '240P':\n        case '240p_1':\n        case '240P_1':\n          that.setVideoResolution('240p_1');\n          that.setVideoFrameRate([15, 15]);\n          that.setVideoBitRate([10, 200]);\n          break;\n        case '240p_3':\n        case '240P_3':\n          that.setVideoResolution('240p_3');\n          that.setVideoFrameRate([15, 15]);\n          that.setVideoBitRate([10, 140]);\n          break;\n        case '240p_4':\n        case '240P_4':\n          that.setVideoResolution('240p_4');\n          that.setVideoFrameRate([15, 15]);\n          that.setVideoBitRate([10, 220]);\n          break;\n        case '360p':\n        case '360P':\n        case '360p_1':\n        case '360P_1':\n          that.setVideoResolution('360p_1');\n          that.setVideoFrameRate([15, 15]);\n          that.setVideoBitRate([20, 400]);\n          break;\n        case '360p_3':\n        case '360P_3':\n          that.setVideoResolution('360p_3');\n          that.setVideoFrameRate([15, 15]);\n          that.setVideoBitRate([20, 260]);\n          break;\n        case '360p_4':\n        case '360P_4':\n          that.setVideoResolution('360p_4');\n          that.setVideoFrameRate([30, 30]);\n          that.setVideoBitRate([20, 600]);\n          break;\n        case '360p_6':\n        case '360P_6':\n          that.setVideoResolution('360p_6');\n          that.setVideoFrameRate([30, 30]);\n          that.setVideoBitRate([20, 400]);\n          break;\n        case '360p_7':\n        case '360P_7':\n          that.setVideoResolution('360p_7');\n          that.setVideoFrameRate([15, 15]);\n          that.setVideoBitRate([20, 320]);\n          break;\n        case '360p_8':\n        case '360P_8':\n          that.setVideoResolution('360p_8');\n          that.setVideoFrameRate([30, 30]);\n          that.setVideoBitRate([20, 490]);\n          break;\n        case '360p_9':\n        case '360P_9':\n          that.setVideoResolution('360p_9');\n          that.setVideoFrameRate([15, 15]);\n          that.setVideoBitRate([20, 800]);\n          break;\n        case '360p_10':\n        case '360P_10':\n          that.setVideoResolution('360p_10');\n          that.setVideoFrameRate([24, 24]);\n          that.setVideoBitRate([20, 800]);\n          break;\n        case '360p_11':\n        case '360P_11':\n          that.setVideoResolution('360p_11');\n          that.setVideoFrameRate([24, 24]);\n          that.setVideoBitRate([20, 1000]);\n          break;\n        case '480p':\n        case '480P':\n        case '480p_1':\n        case '480P_1':\n          that.setVideoResolution('480p_1');\n          that.setVideoFrameRate([15, 15]);\n          that.setVideoBitRate([20, 500]);\n          break;\n        case '480p_2':\n        case '480P_2':\n          that.setVideoResolution('480p_2');\n          that.setVideoFrameRate([30, 30]);\n          that.setVideoBitRate([20, 1000]);\n          break;\n        case '480p_3':\n        case '480P_3':\n          that.setVideoResolution('480p_3');\n          that.setVideoFrameRate([15, 15]);\n          that.setVideoBitRate([20, 400]);\n          break;\n        case '480p_4':\n        case '480P_4':\n          that.setVideoResolution('480p_4');\n          that.setVideoFrameRate([30, 30]);\n          that.setVideoBitRate([20, 750]);\n          break;\n        case '480p_6':\n        case '480P_6':\n          that.setVideoResolution('480p_6');\n          that.setVideoFrameRate([30, 30]);\n          that.setVideoBitRate([20, 600]);\n          break;\n        case '480p_8':\n        case '480P_8':\n          that.setVideoResolution('480p_8');\n          that.setVideoFrameRate([15, 15]);\n          that.setVideoBitRate([20, 610]);\n          break;\n        case '480p_9':\n        case '480P_9':\n          that.setVideoResolution('480p_9');\n          that.setVideoFrameRate([30, 30]);\n          that.setVideoBitRate([20, 930]);\n          break;\n        case '480p_10':\n        case '480P_10':\n          that.setVideoResolution('480p_10');\n          that.setVideoFrameRate([10, 10]);\n          that.setVideoBitRate([20, 400]);\n          break;\n        case '720p':\n        case '720P':\n        case '720p_1':\n        case '720P_1':\n          that.setVideoResolution('720p_1');\n          that.setVideoFrameRate([15, 15]);\n          that.setVideoBitRate([30, 1130]);\n          break;\n        case '720p_2':\n        case '720P_2':\n          that.setVideoResolution('720p_2');\n          that.setVideoFrameRate([30, 30]);\n          that.setVideoBitRate([30, 2000]);\n          break;\n        case '720p_3':\n        case '720P_3':\n          that.setVideoResolution('720p_3');\n          that.setVideoFrameRate([30, 30]);\n          that.setVideoBitRate([30, 1710]);\n          break;\n        case '720p_5':\n        case '720P_5':\n          that.setVideoResolution('720p_5');\n          that.setVideoFrameRate([15, 15]);\n          that.setVideoBitRate([30, 910]);\n          break;\n        case '720p_6':\n        case '720P_6':\n          that.setVideoResolution('720p_6');\n          that.setVideoFrameRate([30, 30]);\n          that.setVideoBitRate([30, 1380]);\n          break;\n        case '1080p':\n        case '1080P':\n        case '1080p_1':\n        case '1080P_1':\n          that.setVideoResolution('1080p_1');\n          that.setVideoFrameRate([15, 15]);\n          that.setVideoBitRate([50, 2080]);\n          break;\n        case '1080p_2':\n        case '1080P_2':\n          that.setVideoResolution('1080p_2');\n          that.setVideoFrameRate([30, 30]);\n          that.setVideoBitRate([50, 3000]);\n          break;\n        case '1080p_3':\n        case '1080P_3':\n          that.setVideoResolution('1080p_3');\n          that.setVideoFrameRate([30, 30]);\n          that.setVideoBitRate([50, 3150]);\n          break;\n        case '1080p_5':\n        case '1080P_5':\n          that.setVideoResolution('1080p_5');\n          that.setVideoFrameRate([60, 60]);\n          that.setVideoBitRate([50, 4780]);\n          break;\n        case '1440p':\n        case '1440P':\n        case '1440p_1':\n        case '1440P_1':\n          that.setVideoResolution('1440p_1');\n          that.setVideoFrameRate([30, 30]);\n          that.setVideoBitRate([50, 4850]);\n          break;\n        case '1440p_2':\n        case '1440P_2':\n          that.setVideoResolution('1440p_2');\n          that.setVideoFrameRate([60, 60]);\n          that.setVideoBitRate([50, 7350]);\n          break;\n        case '4k':\n        case '4K':\n        case '4k_1':\n        case '4K_1':\n          that.setVideoResolution('4k_1');\n          that.setVideoFrameRate([30, 30]);\n          that.setVideoBitRate([50, 8910]);\n          break;\n        case '4k_3':\n        case '4K_3':\n          that.setVideoResolution('4k_3');\n          that.setVideoFrameRate([60, 60]);\n          that.setVideoBitRate([50, 13500]);\n          break;\n        default:\n          that.setVideoResolution('480p_1');\n          that.setVideoFrameRate([15, 15]);\n          that.setVideoBitRate([20, 500]);\n      }\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  that.getId = function () {\n    return that.streamId;\n  };\n\n  that.getAttributes = function () {\n    if (spec.screen) {\n      return that.screenAttributes;\n    } else {\n      return spec.attributes;\n    }\n  };\n\n  // Indicates if the stream has audio activated\n  that.hasAudio = function () {\n    return that.audio;\n  };\n\n  // Indicates if the stream has video activated\n  that.hasVideo = function () {\n    return that.video;\n  };\n\n  // Indicates if the stream has screen activated\n  that.hasScreen = function () {\n    return that.screen;\n  };\n\n  // Indicates if the video track is in playing\n  that.isVideoOn = function () {\n    return that.hasVideo && that.videoEnabled;\n  };\n\n  // Indicates if the audio track is in playing\n  that.isAudioOn = function () {\n    return that.hasAudio && that.audioEnabled;\n  };\n\n  // Initializes the stream and tries to retrieve a stream from local video and audio\n  // We need to call this method before we can publish it in the client.\n  that.init = function (onSuccess, onFailure) {\n    var lts = new Date().getTime();\n\n    var init_retry = arguments[2];\n    if (init_retry === undefined) {\n      init_retry = 2;\n    } // do not write: var init_retry = arguments[1] || 2;\n    if (that.initialized === true) {\n      if (typeof onFailure === 'function') {\n        onFailure({\n          type: 'warning',\n          msg: 'STREAM_ALREADY_INITIALIZED'\n        });\n      }\n      return;\n    }\n    if (that.local !== true) {\n      if (typeof onFailure === 'function') {\n        onFailure({\n          type: 'warning',\n          msg: 'STREAM_NOT_LOCAL'\n        });\n      }\n      return;\n    }\n    try {\n      if ((spec.audio || spec.video || spec.screen) && spec.url === undefined) {\n        _Logger2.default.debug(\"Requested access to local media\");\n        var videoOpt = spec.video;\n        if (spec.screen) {\n          var constraints = {\n            video: videoOpt,\n            audio: spec.audio,\n            screen: true,\n            data: true,\n            extensionId: spec.extensionId,\n            attributes: that.screenAttributes,\n            fake: spec.fake,\n            mediaSource: spec.mediaSource\n          };\n        } else {\n          var constraints = {\n            video: videoOpt,\n            audio: spec.audio,\n            fake: spec.fake\n          };\n\n          if (!isLegacyChrome()) {\n            var minFr = 30;\n            var maxFr = 30;\n            if (spec.attributes.minFrameRate !== undefined) minFr = spec.attributes.minFrameRate;\n            if (spec.attributes.maxFrameRate !== undefined) maxFr = spec.attributes.maxFrameRate;\n\n            if (!isFirefox()) {\n              if (constraints.audio === true) {\n                constraints.audio = spec.microphoneId ? { deviceId: { exact: spec.microphoneId } } : true;\n              }\n              if (constraints.video === true) {\n                constraints.video = { width: { ideal: that.videoSize[0] }, height: { ideal: that.videoSize[1] }, frameRate: { ideal: minFr, max: maxFr } };\n                that.setVideoBitRate([500, 500]);\n              } else if (_typeof(constraints.video) === 'object') {\n                constraints.video.frameRate = { ideal: minFr, max: maxFr };\n              }\n            } else {\n              if (constraints.video === true) {\n                // video profile not set, use default\n                constraints.video = { width: { ideal: that.videoSize[0] }, height: { ideal: that.videoSize[1] }, frameRate: { ideal: minFr, max: maxFr } };\n                that.setVideoBitRate([500, 500]);\n              } else if (_typeof(constraints.video) === 'object') {\n                constraints.video.frameRate = { ideal: minFr, max: maxFr };\n              }\n            }\n          }\n        }\n        _Logger2.default.debug(constraints);\n        var constraints_copy = Object.assign({}, constraints);\n        (0, _Connection.GetUserMedia)(constraints_copy, function (stream) {\n          _Logger2.default.debug(\"User has granted access to local media\");\n          that.dispatchEvent({ type: 'accessAllowed' });\n          that.stream = stream;\n          that.initialized = true;\n          onSuccess && onSuccess();\n          // get video resolution from <video>\n          if (that.hasVideo()) {\n            (0, _Helper.vsResHack)(stream, function (videoWidth, videoHeight) {\n              that.videoWidth = videoWidth;\n              that.videoHeight = videoHeight;\n            }, function (e) {\n              _Logger2.default.warning('vsResHack failed:' + e);\n            });\n          }\n          // when user click button 'stop sharing' on chrome\n          if (spec.screen && (0, _Browser.isChrome)() && that.stream && that.stream.getVideoTracks()[0]) {\n            that.stream.getVideoTracks()[0].onended = function () {\n              that.dispatchEvent({ type: 'stopScreenSharing' });\n            };\n          }\n          // report accurate video resolution demo in [sdk].ui.js::videoplayer.js, thru <1>.\n          // 1. from ui display (require ui): $('$streamid')[0].videoWidth, $('$streamid')[0].videoHeight\n          // 2. from webrtc_internals (stream should be published): stream.pc.peerConnection.getStats(function(stats){stats.result();});\n          // 2.1. new method? E.g., stream.getFrameResolution() when pc id ready.\n        }, function (error) {\n          var err = { type: 'error', msg: error.name || error };\n          switch (err.msg) {\n            // below - internally handled\n            case 'Starting video failed': // firefox: camera possessed by other process?\n            case 'TrackStartError':\n              // chrome: probably resolution not supported\n              that.videoSize = undefined;\n              if (init_retry > 0) {\n                setTimeout(function () {\n                  that.init(onSuccess, onFailure, init_retry - 1);\n                }, 1);\n                return;\n              } else {\n                err.msg = 'MEDIA_OPTION_INVALID';\n              }\n              break;\n            // below - exposed\n            case 'DevicesNotFoundError':\n              // chrome\n              err.msg = 'DEVICES_NOT_FOUND';\n              break;\n            case 'NotSupportedError':\n              // chrome\n              err.msg = 'NOT_SUPPORTED';\n              break;\n            case 'PermissionDeniedError':\n              // chrome\n              err.msg = 'PERMISSION_DENIED';\n              that.dispatchEvent({ type: 'accessDenied' });\n              break;\n            case 'PERMISSION_DENIED':\n              // firefox\n              that.dispatchEvent({ type: 'accessDenied' });\n              break;\n            case 'InvalidStateError':\n              // chrome\n              err.msg = 'PERMISSION_DENIED';\n              that.dispatchEvent({ type: 'accessDenied' });\n              break;\n            case 'NotAllowedError':\n              // firefox\n              that.dispatchEvent({ type: 'accessDenied' });\n              break;\n            case 'ConstraintNotSatisfiedError':\n              // chrome\n              err.msg = 'CONSTRAINT_NOT_SATISFIED';\n              break;\n            default:\n              if (!err.msg) {\n                err.msg = 'UNDEFINED';\n              }\n          }\n          _Logger2.default.error('Media access:', err.msg);\n          if (typeof onFailure === 'function') {\n            onFailure(err);\n          }\n        });\n\n        if (spec.screen && spec.audio) {\n          var theConfig = { video: false, audio: constraints.audio };\n          _Logger2.default.debug(theConfig);\n          (0, _Connection.GetUserMedia)(theConfig, function (stream) {\n            _Logger2.default.info(\"User has granted access to auxiliary local media.\");\n            that.dispatchEvent({ type: 'accessAllowed' });\n            that.aux_stream = stream;\n          }, function (error) {\n            var err = { type: 'error', msg: error.name || error };\n            switch (err.msg) {\n              // below - internally handled\n              case 'Starting video failed': // firefox: camera possessed by other process?\n              case 'TrackStartError':\n                // chrome: probably resolution not supported\n                that.videoSize = undefined;\n                if (init_retry > 0) {\n                  setTimeout(function () {\n                    that.init(onSuccess, onFailure, init_retry - 1);\n                  }, 1);\n                  return;\n                } else {\n                  err.msg = 'MEDIA_OPTION_INVALID';\n                }\n                break;\n              // below - exposed\n              case 'DevicesNotFoundError':\n                // chrome\n                err.msg = 'DEVICES_NOT_FOUND';\n                break;\n              case 'NotSupportedError':\n                // chrome\n                err.msg = 'NOT_SUPPORTED';\n                break;\n              case 'PermissionDeniedError':\n                // chrome\n                err.msg = 'PERMISSION_DENIED';\n                that.dispatchEvent({ type: 'accessDenied' });\n                break;\n              case 'InvalidStateError':\n                // chrome\n                err.msg = 'PERMISSION_DENIED';\n                that.dispatchEvent({ type: 'accessDenied' });\n                break;\n              case 'PERMISSION_DENIED':\n                // firefox\n                that.dispatchEvent({ type: 'accessDenied' });\n                break;\n              case 'NotAllowedError':\n                // firefox\n                that.dispatchEvent({ type: 'accessDenied' });\n                break;\n              case 'ConstraintNotSatisfiedError':\n                // chrome\n                err.msg = 'CONSTRAINT_NOT_SATISFIED';\n                break;\n              default:\n                if (!err.msg) {\n                  err.msg = 'UNDEFINED';\n                }\n            }\n            _Logger2.default.error('Media access:', err.msg);\n            if (typeof onFailure === 'function') {\n              onFailure(err);\n            }\n          });\n        }\n      } else {\n        if (typeof onFailure === 'function') {\n          onFailure({\n            type: 'warning',\n            msg: 'STREAM_HAS_NO_MEDIA_ATTRIBUTES'\n          });\n        }\n      }\n    } catch (e) {\n      _Logger2.default.error('Stream init:', e);\n      if (typeof onFailure === 'function') {\n        onFailure({\n          type: 'error',\n          msg: e.message || e\n        });\n      }\n    }\n  };\n\n  that.close = function () {\n    _Logger2.default.debug('Close stream with id', that.streamId);\n    if (that.stream !== undefined) {\n      var tracks = that.stream.getTracks();\n      for (var t in tracks) {\n        if (tracks.hasOwnProperty(t)) {\n          tracks[t].stop();\n        }\n      }\n      that.stream = undefined;\n    }\n\n    that.initialized = false;\n\n    that.unmuteAudio = undefined;\n    that.muteAudio = undefined;\n    that.unmuteVideo = undefined;\n    that.muteVideo = undefined;\n\n    if (that.lowStream) {\n      that.lowStream.close();\n    }\n  };\n\n  that.enableAudio = function () {\n    _Logger2.default.debug('Enable audio stream with id', that.streamId);\n    if (that.hasAudio() && that.initialized && that.stream !== undefined && that.stream.getAudioTracks()[0].enabled !== true) {\n      if (that.unmuteAudio !== undefined) {\n        that.unmuteAudio();\n      }\n      that.audioEnabled = true;\n      that.stream.getAudioTracks()[0].enabled = true;\n      return true;\n    }\n    return false;\n  };\n\n  that.disableAudio = function () {\n    _Logger2.default.debug('Disable audio stream with id', that.streamId);\n    if (that.hasAudio() && that.initialized && that.stream !== undefined && that.stream.getAudioTracks()[0].enabled) {\n      if (that.muteAudio !== undefined) {\n        that.muteAudio();\n      }\n      that.audioEnabled = false;\n      that.stream.getAudioTracks()[0].enabled = false;\n\n      // only loacl stream will have sid\n      if (that.sid) {\n        _Report.report.audioSendingStopped(that.sid, {\n          succ: true,\n          reason: 'muteAudio'\n        });\n      }\n      return true;\n    }\n    return false;\n  };\n\n  that.enableVideo = function () {\n    _Logger2.default.debug('Enable video stream with id', that.streamId);\n    if (that.initialized && that.stream !== undefined && that.stream.getVideoTracks().length && that.stream.getVideoTracks()[0].enabled !== true) {\n      if (that.unmuteVideo !== undefined) {\n        that.unmuteVideo();\n      }\n      that.videoEnabled = true;\n      that.stream.getVideoTracks()[0].enabled = true;\n      if (that.lowStream) {\n        that.lowStream.enableVideo();\n      }\n      return true;\n    }\n    return false;\n  };\n\n  that.disableVideo = function () {\n    _Logger2.default.debug('Disable video stream with id', that.streamId);\n    if (that.initialized && that.stream !== undefined && that.stream.getVideoTracks().length && that.stream.getVideoTracks()[0].enabled) {\n      if (that.muteVideo !== undefined) {\n        that.muteVideo();\n      }\n      that.videoEnabled = false;\n      that.stream.getVideoTracks()[0].enabled = false;\n      if (that.lowStream) {\n        that.lowStream.disableVideo();\n      }\n\n      // only loacl stream will have sid\n      if (that.sid) {\n        _Report.report.videoSendingStopped(that.sid, {\n          succ: true,\n          reason: 'muteVideo'\n        });\n      }\n      return true;\n    }\n    return false;\n  };\n\n  that.play = function (elementID, assetsURL) {\n    var options = undefined;\n    that.showing = false;\n    if (!that.local || that.video || that.screen) {\n      //that.hasVideo() may be changed\n      if (elementID !== undefined) {\n        that.player = new _VideoPlayer2.default({ id: that.getId(), stream: that, elementID: elementID, options: options, url: assetsURL });\n        that.showing = true;\n      }\n    } else if (that.hasAudio()) {\n      // local audio-only\n      that.player = new _VideoPlayer2.default({ id: that.getId(), stream: that, elementID: elementID, options: options, url: assetsURL });\n      that.showing = true;\n    }\n  };\n\n  that.stop = function () {\n    _Logger2.default.debug('Stop stream player with id', that.streamId);\n    if (that.player !== undefined) {\n      that.player.destroy();\n    }\n  };\n\n  that.getStats = function (cb) {\n    if (that.pc && that.pc.getStats) {\n      that.pc.getStats(function (stats) {\n        if (that.pc.isSubscriber) {\n          var filterStats = (0, _Stats.subscribeStatsFilter)(stats);\n          if ((0, _Browser.isFireFox)()) {\n            filterStats.videoReceivedResolutionHeight = that.videoHeight + '';\n            filterStats.videoReceivedResolutionWidth = that.videoWidth + '';\n          }\n          cb && cb((0, _Stats.subscribeStatsFilter)(stats));\n        } else {\n          var filterStats = (0, _Stats.publishStatsFilter)(stats);\n          if (!(0, _Browser.isChrome)()) {\n            filterStats.videoSendResolutionHeight = that.videoHeight + '';\n            filterStats.videoSendResolutionWidth = that.videoWidth + '';\n          }\n          if (!(0, _Browser.isChrome)() && that.uplinkStats) {\n            filterStats.videoSendBandwidth = that.uplinkStats.uplink_available_bandwidth + \"\";\n            filterStats.videoSendPacketsLost = that.uplinkStats.uplink_cumulative_lost + \"\";\n          }\n          cb && cb(filterStats);\n        }\n      });\n    } else {\n      _Logger2.default.warning(\"use getStats after peerConnection established\");\n    }\n  };\n\n  that.getAudioLevel = function () {\n    if (that.audioLevelHelper) {\n      return that.audioLevelHelper.getAudioLevel();\n    } else {\n      if (that.stream) {\n        if (that.stream.getAudioTracks().length !== 0) {\n          that.audioLevelHelper = new _Helper.audioLevelHelper(that.stream);\n          return that.audioLevelHelper.getAudioLevel();\n        } else {\n          _Logger2.default.warning(\"can't get audioLevel beacuse no audio trace in stream\");\n        }\n      } else {\n        _Logger2.default.warning(\"can't get audioLevel beacuse no stream exist\");\n        return 0;\n      }\n    }\n  };\n\n  return that;\n};\n\nvar createStream = function createStream(spec) {\n  _Logger2.default.debug('Create stream');\n  return Stream(spec);\n};\n\nvar getDevices = function getDevices(onSuccess, onFailure) {\n  if (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices) {\n    _Logger2.default.warning(\"enumerateDevices() not supported.\");\n    onFailure && onFailure(\"enumerateDevices() not supported\");\n  }\n\n  navigator.mediaDevices.enumerateDevices().then(function (devices) {\n    return onSuccess(devices);\n  }).catch(function (err) {\n    return onFailure && onFailure(err.name + ': ' + err.message);\n  });\n};\n\nexports.Stream = Stream;\nexports.createStream = createStream;\nexports.getDevices = getDevices;\n\n/***/ }),\n/* 8 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nvar ErrorCodes = {\n    FAILED: 'FAILED',\n    INVALID_KEY: 'INVALID_KEY',\n    INVALID_OPERATION: 'INVALID_OPERATION',\n    INVALID_PARAMETER: 'INVALID_PARAMETER',\n    INVALID_LOCAL_STREAM: 'INVALID_LOCAL_STREAM',\n    INVALID_REMOTE_STREAM: 'INVALID_REMOTE_STREAM',\n    INVALID_DYNAMIC_KEY: 'INVALID_DYNAMIC_KEY',\n    DYNAMIC_KEY_TIMEOUT: 'DYNAMIC_KEY_TIMEOUT',\n    NO_VOCS_AVAILABLE: 'NO_VOCS_AVAILABLE',\n    NO_VOS_AVAILABLE: 'ERR_NO_VOS_AVAILABLE',\n    JOIN_CHANNEL_TIMEOUT: 'ERR_JOIN_CHANNEL_TIMEOUT',\n    NO_AVAILABLE_CHANNEL: 'NO_AVAILABLE_CHANNEL',\n    LOOKUP_CHANNEL_TIMEOUT: 'LOOKUP_CHANNEL_TIMEOUT',\n    LOOKUP_CHANNEL_REJECTED: 'LOOKUP_CHANNEL_REJECTED',\n    OPEN_CHANNEL_TIMEOUT: 'OPEN_CHANNEL_TIMEOUT',\n    OPEN_CHANNEL_REJECTED: 'OPEN_CHANNEL_REJECTED',\n    REQUEST_DEFERRED: 'REQUEST_DEFERRED',\n\n    SOCKET_ERROR: 'SOCKET_ERROR',\n    SOCKET_DISCONNECTED: 'SOCKET_DISCONNECTED',\n    PEERCONNECTION_FAILED: 'PEERCONNECTION_FAILED',\n    CONNECT_GATEWAY_ERROR: 'CONNECT_GATEWAY_ERROR',\n\n    SERVICE_NOT_AVAILABLE: 'SERVICE_NOT_AVAILABLE',\n    JOIN_CHANNEL_FAILED: 'JOIN_CHANNEL_FAILED',\n    PUBLISH_STREAM_FAILED: 'PUBLISH_STREAM_FAILED',\n    UNPUBLISH_STREAM_FAILED: 'UNPUBLISH_STREAM_FAILED',\n    SUBSCRIBE_STREAM_FAILED: 'SUBSCRIBE_STREAM_FAILED',\n    UNSUBSCRIBE_STREAM_FAILED: 'UNSUBSCRIBE_STREAM_FAILED',\n    NO_SUCH_REMOTE_STREAM: 'NO_SUCH_REMOTE_STREAM',\n\n    ERR_FAILED: '1',\n    ERR_INVALID_VENDOR_KEY: '101',\n    ERR_INVALID_CHANNEL_NAME: '102',\n    WARN_NO_AVAILABLE_CHANNEL: '103',\n    WARN_LOOKUP_CHANNEL_TIMEOUT: '104',\n    WARN_LOOKUP_CHANNEL_REJECTED: '105',\n    WARN_OPEN_CHANNEL_TIMEOUT: '106',\n    WARN_OPEN_CHANNEL_REJECTED: '107',\n    WARN_REQUEST_DEFERRED: '108',\n    ERR_DYNAMIC_KEY_TIMEOUT: '109',\n    ERR_INVALID_DYNAMIC_KEY: '110',\n    ERR_NO_VOCS_AVAILABLE: '2000',\n    ERR_NO_VOS_AVAILABLE: '2001',\n    ERR_JOIN_CHANNEL_TIMEOUT: '2002',\n\n    // for dualStream\n    IOS_NOT_SUPPORT: 'iOS not support dualStream',\n    SHARING_SCREEN_NOT_SUPPORT: 'sharing screen not support dualStream',\n    STILL_ON_PUBLISHING: 'Can\\'t open or close low-Stream when publishing or unpublish high-stream',\n\n    // other\n    ELECTRON_NOT_SUPPORT_SHARING_SCREEN: 'ELECTRON_NOT_SUPPORT_SHARING_SCREEN'\n};\n\nvar GatewayErrorCode = {\n    // internal  \n    '2000': 'ERR_NO_VOCS_AVAILABLE',\n    '2001': 'ERR_NO_VOS_AVAILABLE',\n    '2002': 'ERR_JOIN_CHANNEL_TIMEOUT',\n\n    // vocs\n    '101': 'ERR_INVALID_VENDOR_KEY',\n    '102': 'ERR_INVALID_CHANNEL_NAME',\n    '103': 'WARN_NO_AVAILABLE_CHANNEL',\n    '104': 'WARN_LOOKUP_CHANNEL_TIMEOUT',\n    '105': 'WARN_LOOKUP_CHANNEL_REJECTED',\n    '106': 'WARN_OPEN_CHANNEL_TIMEOUT',\n    '107': 'WARN_OPEN_CHANNEL_REJECTED',\n    '108': 'WARN_REQUEST_DEFERRED',\n    '109': 'ERR_DYNAMIC_KEY_TIMEOUT',\n    '110': 'ERR_NO_AUTHORIZED',\n    '111': 'ERR_VOM_SERVICE_UNAVAILABLE',\n    '112': 'ERR_NO_CHANNEL_AVAILABLE_CODE',\n    '113': 'ERR_TOO_MANY_USERS',\n    '114': 'ERR_MASTER_VOCS_UNAVAILABLE',\n    '115': 'ERR_INTERNAL_ERROR',\n    '116': 'ERR_NO_ACTIVE_STATUS',\n    '117': 'ERR_INVALID_UID',\n    '118': 'ERR_DYNAMIC_KEY_EXPIRED',\n    '119': 'ERR_STATIC_USE_DYANMIC_KE',\n    '120': 'ERR_DYNAMIC_USE_STATIC_KE',\n\n    //vos \n    '2': 'K_TIMESTAMP_EXPIRED',\n    '3': 'K_CHANNEL_PERMISSION_INVALID',\n    '4': 'K_CERTIFICATE_INVALID',\n    '5': 'K_CHANNEL_NAME_EMPTY',\n    '6': 'K_CHANNEL_NOT_FOUND',\n    '7': 'K_TICKET_INVALID',\n    '8': 'K_CHANNEL_CONFLICTED',\n    '9': 'K_SERVICE_NOT_READY',\n    '10': 'K_SERVICE_TOO_HEAVY',\n    '14': 'K_UID_BANNED',\n    '15': 'K_IP_BANNED',\n    '16': 'K_CHANNEL_BANNED'\n\n};\n\nexports.default = ErrorCodes;\nexports.GatewayErrorCode = GatewayErrorCode;\n\n/***/ }),\n/* 9 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _View = __webpack_require__(6);\n\nvar _View2 = _interopRequireDefault(_View);\n\nvar _Speaker = __webpack_require__(21);\n\nvar _Speaker2 = _interopRequireDefault(_Speaker);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/*global window, document, clearTimeout, setTimeout */\n\n/*\n * Bar represents the bottom menu bar of every mediaPlayer.\n * It contains a Speaker and an icon.\n * Every Bar is a View.\n * Ex.: var bar = Bar({elementID: element, id: id});\n */\nvar Bar = function Bar(spec) {\n    \"use strict\";\n\n    var that = (0, _View2.default)({}),\n        waiting,\n        show;\n\n    // Variables\n\n    // DOM element in which the Bar will be appended\n    that.elementID = spec.elementID;\n\n    // Bar ID\n    that.id = spec.id;\n\n    // Assets URL\n    that.url = spec.url;\n\n    // Container\n    that.div = document.createElement('div');\n    that.div.setAttribute('id', 'bar_' + that.id);\n\n    // Bottom bar\n    that.bar = document.createElement('div');\n    that.bar.setAttribute('style', 'width: 100%; height: 15%; max-height: 30px; position: absolute; bottom: 0; right: 0; background-color: rgba(255,255,255,0.62)');\n    that.bar.setAttribute('id', 'subbar_' + that.id);\n\n    // Lynckia icon\n    that.link = document.createElement('a');\n    that.link.setAttribute('href', 'http://www.lynckia.com/');\n    that.link.setAttribute('target', '_blank');\n\n    that.logo = document.createElement('img');\n    that.logo.setAttribute('style', 'width: 100%; height: 100%; max-width: 30px; position: absolute; top: 0; left: 2px;');\n    that.logo.setAttribute('alt', 'Lynckia');\n    //that.logo.setAttribute('src', that.url + '/assets/star.svg');\n\n    // Private functions\n    show = function show(displaying) {\n        if (displaying !== 'block') {\n            displaying = 'none';\n        } else {\n            clearTimeout(waiting);\n        }\n\n        that.div.setAttribute('style', 'width: 100%; height: 100%; position: absolute; bottom: 0; right: 0; display:' + displaying);\n    };\n\n    // Public functions\n\n    that.display = function () {\n        show('block');\n    };\n\n    that.hide = function () {\n        waiting = setTimeout(show, 1000);\n    };\n\n    document.getElementById(that.elementID).appendChild(that.div);\n    that.div.appendChild(that.bar);\n    // that.bar.appendChild(that.link);\n    // that.link.appendChild(that.logo);\n\n    // Speaker component\n    if (!spec.stream.screen && (spec.options === undefined || spec.options.speaker === undefined || spec.options.speaker === true)) {\n        that.speaker = new _Speaker2.default({ elementID: 'subbar_' + that.id, id: that.id, stream: spec.stream, media: spec.media, url: that.url });\n    }\n\n    that.display();\n    that.hide();\n\n    return that;\n};\n\nexports.default = Bar;\n\n/***/ }),\n/* 10 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.GetUserMedia = exports.Connection = undefined;\n\nvar _ChromeCanaryStack = __webpack_require__(26);\n\nvar _ChromeCanaryStack2 = _interopRequireDefault(_ChromeCanaryStack);\n\nvar _ChromeStableStack = __webpack_require__(27);\n\nvar _ChromeStableStack2 = _interopRequireDefault(_ChromeStableStack);\n\nvar _SafariStableStack = __webpack_require__(28);\n\nvar _SafariStableStack2 = _interopRequireDefault(_SafariStableStack);\n\nvar _FcStack = __webpack_require__(29);\n\nvar _FcStack2 = _interopRequireDefault(_FcStack);\n\nvar _FirefoxStack = __webpack_require__(30);\n\nvar _FirefoxStack2 = _interopRequireDefault(_FirefoxStack);\n\nvar _Logger = __webpack_require__(0);\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _ErrorCodes = __webpack_require__(8);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar sessionId = 103;\n\nvar Connection = function Connection(spec) {\n  \"use strict\";\n\n  var that = {};\n\n  spec.session_id = sessionId += 1;\n\n  // Check which WebRTC Stack is installed.\n  if (typeof window == \"undefined\" || !window.navigator) {\n    _Logger2.default.error('Publish/subscribe video/audio streams not supported yet');\n    that = (0, _FcStack2.default)(spec);\n  } else if (window.navigator.userAgent.match(\"Firefox\") !== null) {\n    // Firefox\n    that.browser = \"mozilla\";\n    that = (0, _FirefoxStack2.default)(spec);\n  } else if (window.navigator.userAgent.indexOf(\"Safari\") > -1 && navigator.userAgent.indexOf(\"Chrome\") === -1) {\n    // Safari.\n    _Logger2.default.debug(\"Safari\");\n    that = (0, _SafariStableStack2.default)(spec);\n    that.browser = \"safari\";\n  } else if (window.navigator.userAgent.indexOf(\"MSIE \")) {\n    // Internet Explorer.\n    //Logger.debug(\"IE\");\n    that = (0, _ChromeStableStack2.default)(spec);\n    that.browser = \"ie\";\n  } else if (window.navigator.appVersion.match(/Chrome\\/([\\w\\W]*?)\\./)[1] >= 26) {\n    // Google Chrome Stable.\n    //Logger.debug(\"Stable\");\n    that = (0, _ChromeStableStack2.default)(spec);\n    that.browser = \"chrome-stable\";\n  } else if (window.navigator.userAgent.toLowerCase().indexOf(\"chrome\") >= 40) {\n    // Google Chrome Canary.\n    //Logger.debug(\"Canary!\");\n    that = (0, _ChromeCanaryStack2.default)(spec);\n    that.browser = \"chrome-canary\";\n  } else {\n    // None.\n    that.browser = \"none\";\n    throw \"WebRTC stack not available\";\n  }\n  return that;\n};\n\nvar electronUtil = function electronUtil(config, callback, error) {\n  var that = {};\n  that.callback = callback;\n  that.config = config;\n  that.error = error;\n\n  that.selectSource = function (sources, callback, error) {\n    var dialog = document.createElement('div');\n    dialog.setAttribute('style', 'position: absolute; z-index: 99999999; width: 65%; height: 70%; top:50%; left:50%; -webkit-transform:translate(-50%,-50%); transform:translate(-50%,-50%); border: #333333 1px solid; background: #ffffff; overflow: scroll;' + 'display: flex; justify-content: space-around; flex-wrap: wrap;' + 'padding: 50px 20px 5px 20px;box-shadow: 10px #333333;');\n\n    document.body.appendChild(dialog);\n\n    sources.map(function (source) {\n      if (source.id) {\n        var item = document.createElement('div');\n        item.setAttribute('style', 'width: 30%;text-align: center;');\n\n        var span = document.createElement('div');\n        span.innerHTML = source.name;\n        span.setAttribute('style', 'display: inline-block;width: 70%;word-break: keep-all;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;');\n\n        var imgContain = document.createElement('div');\n        imgContain.setAttribute('style', 'width: 100%;height: 70%');\n\n        var img = document.createElement('img');\n        img.setAttribute('style', 'height: 100%;');\n        img.src = source.thumbnail.toDataURL();\n\n        item.onclick = function () {\n          document.body.removeChild(dialog);\n          callback && callback(source.id);\n        };\n        imgContain.appendChild(img);\n        item.appendChild(imgContain);\n        item.appendChild(span);\n        dialog.appendChild(item);\n      }\n    });\n\n    var bottom = document.createElement('button');\n    bottom.innerHTML = 'Back';\n    bottom.setAttribute('style', ' width: 100%; padding:10px 0; background-color: #fff; font-size: 20px; color: #333;border: none;');\n    bottom.onclick = function () {\n      document.body.removeChild(dialog);\n      error && error('NotAllowedError');\n    };\n    dialog.appendChild(bottom);\n  };\n\n  that.share = function (electron) {\n    electron.desktopCapturer.getSources({ types: ['window', 'screen'] }, function (error, sources) {\n      if (error) throw error;\n      that.selectSource(sources, function (sourceId) {\n\n        var mWidth = that.config.attributes.width;\n        var mHeight = that.config.attributes.height;\n        var maxFr = that.config.attributes.maxFr;\n        var minFr = that.config.attributes.minFr;\n\n        var config = {\n          audio: false,\n          video: {\n            mandatory: {\n              chromeMediaSource: 'desktop',\n              chromeMediaSourceId: sourceId,\n              maxHeight: mHeight,\n              maxWidth: mWidth,\n              maxFrameRate: maxFr,\n              minFrameRate: minFr\n            }\n          }\n        };\n\n        navigator.webkitGetUserMedia(config, that.callback, that.error);\n      }, that.error);\n    });\n  };\n  return that;\n};\n\nvar GetUserMedia = function GetUserMedia(config, callback, error) {\n  \"use strict\";\n\n  navigator.getMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;\n  if (config.screen) {\n\n    // for electron\n    var electron = null;\n    try {\n      electron = window.require('electron');\n    } catch (err) {}\n\n    if (electron) {\n      if (electron.desktopCapturer) {\n        var el = electronUtil(config, callback, error);\n        el.share(electron);\n      } else {\n        error(_ErrorCodes.ErrorCodes.ELECTRON_NOT_SUPPORT_SHARING_SCREEN);\n      }\n      return;\n    }\n\n    _Logger2.default.debug(\"Screen access requested\");\n    if (window.navigator.userAgent.match(\"Firefox\") !== null) {\n      //firefox\n      var mediaSource = ['screen', 'window', 'application'];\n      if (!~mediaSource.indexOf(config.mediaSource)) {\n        return error && error('Invalid mediaSource, mediaSource should be one of [screen, window, application]');\n      }\n\n      var theConfig = {};\n      if (config.video.mandatory != undefined) {\n        theConfig.video = config.video;\n        theConfig.video.mediaSource = config.mediaSource;\n      } else {\n        theConfig = { video: { mediaSource: config.mediaSource } };\n      }\n      navigator.getMedia(theConfig, callback, error);\n    } else if (window.navigator.userAgent.match(\"Chrome\") !== null) {\n      //chrome\n      if (window.navigator.appVersion.match(/Chrome\\/([\\w\\W]*?)\\./)[1] < 34) {\n        error({ code: \"This browser does not support screen sharing\" });\n        return;\n      }\n      var extensionId = \"okeephmleflklcdebijnponpabbmmgeo\";\n      if (config.extensionId) {\n        _Logger2.default.debug(\"extensionId supplied, using \" + config.extensionId);\n        extensionId = config.extensionId;\n      }\n      _Logger2.default.debug(\"Screen access on chrome stable, looking for extension\");\n      try {\n        chrome.runtime.sendMessage(extensionId, { getStream: true }, function (response) {\n          if (response === undefined) {\n            _Logger2.default.debug(\"Access to screen denied\");\n            var theError = { code: \"Access to screen denied\" };\n            error(theError);\n            return;\n          }\n          var theId = response.streamId;\n          var mWidth = config.attributes.width;\n          var mHeight = config.attributes.height;\n          var maxFr = config.attributes.maxFr;\n          var minFr = config.attributes.minFr;\n          theConfig = {\n            video: { mandatory: { chromeMediaSource: 'desktop', chromeMediaSourceId: theId, maxHeight: mHeight, maxWidth: mWidth, maxFrameRate: maxFr, minFrameRate: minFr } } };\n          navigator.getMedia(theConfig, callback, error);\n        });\n      } catch (e) {\n        _Logger2.default.debug(\"AgoraRTC screensharing plugin is not accessible\");\n        var theError = { code: \"no_plugin_present\" };\n        error(theError);\n        return;\n      }\n    } else {\n      _Logger2.default.debug(\"This browser does not support screenSharing\");\n    }\n  } else if (window.navigator.userAgent.indexOf(\"Safari\") > -1 && navigator.userAgent.indexOf(\"Chrome\") === -1) {\n    navigator.mediaDevices.getUserMedia(config).then(callback).catch(error);\n  } else {\n    if (typeof navigator == 'undefined' || !navigator.getMedia) {\n      _Logger2.default.error('Video/audio streams not supported yet');\n    } else {\n      navigator.getMedia(config, callback, error);\n    }\n  }\n};\n\nexports.Connection = Connection;\nexports.GetUserMedia = GetUserMedia;\n\n/***/ }),\n/* 11 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.shouldUseHttps = exports.post = undefined;\n\nvar _Config = __webpack_require__(1);\n\nvar config = _interopRequireWildcard(_Config);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nvar post = function post(url, data, success, failure) {\n  var xhr = new XMLHttpRequest();\n  xhr.timeout = data.timeout || config.HTTP_CONNECT_TIMEOUT;\n  xhr.open(\"POST\", url, true);\n  xhr.setRequestHeader(\"Content-type\", \"application/json; charset=utf-8\");\n  xhr.onload = function (e) {\n    success && success(xhr.responseText);\n  };\n  xhr.onerror = function (e) {\n    failure && failure(e, url);\n  };\n  xhr.ontimeout = function (e) {\n    failure && failure(e, url);\n  };\n  xhr.send(JSON.stringify(data));\n};\n\nvar shouldUseHttps = function shouldUseHttps() {\n  return \"https:\" == document.location.protocol ? true : false;\n};\n\nexports.post = post;\nexports.shouldUseHttps = shouldUseHttps;\n\n/***/ }),\n/* 12 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nvar AgoraCall = function AgoraCall(callback) {\n    if (callback) {\n        callback.apply(this, [].slice.call(arguments, 1));\n    }\n};\n\nexports.default = AgoraCall;\n\n/***/ }),\n/* 13 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getGatewayList = undefined;\n\nvar _Config = __webpack_require__(1);\n\nvar config = _interopRequireWildcard(_Config);\n\nvar _Logger = __webpack_require__(0);\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _Request = __webpack_require__(11);\n\nvar _Report = __webpack_require__(5);\n\nvar _Helper = __webpack_require__(3);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nvar requestChooseServer = function requestChooseServer(url, option, onSuccess, onFailure) {\n  var lts = new Date().getTime();\n\n  var csOption = {\n    key: option.appId,\n    cname: option.cname,\n    uid: option.uid\n  };\n\n  (0, _Request.post)(url, csOption, function (res) {\n    var response = JSON.parse(res);\n    var error = response.error;\n\n    if (error != undefined) {\n      _Report.report.joinChooseServer(option.sid, {\n        lts: lts,\n        succ: false,\n        csAddr: url,\n        serverList: null,\n        ec: error\n      });\n      onFailure(\"Get server node failed [\" + error + \"]\", url);\n    } else {\n      onSuccess(response, url);\n    }\n  }, function (e, url) {\n    if (e.type === \"timeout\") {\n      _Report.report.joinChooseServer(option.sid, {\n        lts: lts,\n        succ: false,\n        csAddr: url,\n        serverList: null,\n        ec: \"timeout\"\n      });\n      onFailure(\"Connect choose server timeout\", url);\n    } else {\n      _Report.report.joinChooseServer(option.sid, {\n        lts: lts,\n        succ: false,\n        csAddr: url,\n        serverList: null,\n        ec: \"server_wrong\"\n      });\n      // onFailure(\"Connect choose server error\", url);\n    }\n  });\n};\n\nvar requestGatewayList = function requestGatewayList(joinInfo, onSuccess, onFailure) {\n  var lts = new Date().getTime();\n  var connected = false;\n  _Helper.CSCrashRecord.record(lts);\n\n  var success = function success(response, url) {\n    if (!connected) {\n      clearTimeout(st);\n      connected = true;\n      _Logger2.default.debug(\"Get gateway address:\", response.gateway_addr);\n      onSuccess(response);\n\n      _Report.report.joinChooseServer(joinInfo.sid, {\n        lts: lts,\n        succ: true,\n        csAddr: url,\n        serverList: response.gateway_addr,\n        cid: response.cid + \"\",\n        uid: response.uid + \"\",\n        ec: null\n      }, true);\n    } else {\n      _Report.report.joinChooseServer(joinInfo.sid, {\n        lts: lts,\n        succ: true,\n        csAddr: url,\n        serverList: response.gateway_addr,\n        cid: response.cid + \"\",\n        uid: response.uid + \"\",\n        ec: null\n      }, false);\n    }\n  };\n\n  var failed = function failed(e, url) {\n    _Logger2.default.error(e, url);\n  };\n\n  var domainlist = config.WEBCS_DOMAIN;\n  for (var i = 0; i < domainlist.length; ++i) {\n    var csURL;\n    csURL = (0, _Request.shouldUseHttps)() ? \"https://\" + domainlist[i] + \":5668/getwebgw/jsonp\" : \"http://\" + domainlist[i] + \":5669/getwebgw/jsonp\";\n    // Logger.debug(\"Connect to backup_choose_server:\", csURL);\n    requestChooseServer(csURL, joinInfo, success, failed);\n  }\n\n  var st = setTimeout(function () {\n    if (!connected) {\n      var backupList = config.WEBCS_DOMAIN_BACKUP_LIST;\n      for (var i = 0; i < backupList.length; ++i) {\n        var csURL;\n        csURL = (0, _Request.shouldUseHttps)() ? \"https://\" + backupList[i] + \":5668/getwebgw/jsonp\" : \"http://\" + backupList[i] + \":5669/getwebgw/jsonp\";\n        // Logger.debug(\"Connect to backup_choose_server:\", csURL);\n        requestChooseServer(csURL, joinInfo, success, failed);\n      }\n    }\n  }, 1000);\n\n  setTimeout(function () {\n    if (!connected) {\n      onFailure();\n    }\n  }, config.WEBCS_BACKUP_CONNECT_TIMEOUT);\n};\n\n//TODO: put it in Controll layer\nvar getGatewayList = function getGatewayList(param, onSuccess, onFailure) {\n  var isSuccess = false;\n  var timer = null;\n  var times = 1;\n\n  var request = function request() {\n    // To prevent so many request that make server crash.\n    if (_Helper.CSCrashRecord.shouldBlock()) {\n      _Logger2.default.warning(\"CS connetion crash too many times in 10s\");\n      return onFailure && onFailure();\n    }\n\n    if (!isSuccess) {\n      requestGatewayList(param, function (gatewayAddr) {\n        isSuccess = true;\n        clearTimeout(timer);\n        onSuccess(gatewayAddr);\n      }, function () {\n        // Backoff mechanism is reconnecting after double previous time,like 1,2,4,8,16,32... until 3600.\n        _Logger2.default.debug(\"Request gateway list will be restart in \" + times + \"s\");\n        timer = setTimeout(function () {\n          request();\n        }, times * 1000);\n        times = times >= 3600 ? 3600 : times * 2;\n      });\n    }\n  };\n  request();\n};\n\nexports.getGatewayList = getGatewayList;\n\n/***/ }),\n/* 14 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n// AUDIO_SAMPLE_RATE_TYPE\nvar AUDIO_SAMPLE_RATE_32000 = 32000;\nvar AUDIO_SAMPLE_RATE_44100 = 44100;\nvar AUDIO_SAMPLE_RATE_48000 = 48000;\n\n// VIDEO_CODEC_PROFILE_TYPE\nvar VIDEO_CODEC_PROFILE_BASELINE = 66;\nvar VIDEO_CODEC_PROFILE_MAIN = 77;\nvar VIDEO_CODEC_PROFILE_HIGH = 100;\n\n// REMOTE VIDEO STREAM TYPES\nvar REMOTE_VIDEO_STREAM_HIGH = 0;\nvar REMOTE_VIDEO_STREAM_LOW = 1;\nvar REMOTE_VIDEO_STREAM_MEDIUM = 2;\n\nexports.AUDIO_SAMPLE_RATE_32000 = AUDIO_SAMPLE_RATE_32000;\nexports.AUDIO_SAMPLE_RATE_44100 = AUDIO_SAMPLE_RATE_44100;\nexports.AUDIO_SAMPLE_RATE_48000 = AUDIO_SAMPLE_RATE_48000;\nexports.VIDEO_CODEC_PROFILE_BASELINE = VIDEO_CODEC_PROFILE_BASELINE;\nexports.VIDEO_CODEC_PROFILE_MAIN = VIDEO_CODEC_PROFILE_MAIN;\nexports.VIDEO_CODEC_PROFILE_HIGH = VIDEO_CODEC_PROFILE_HIGH;\nexports.REMOTE_VIDEO_STREAM_HIGH = REMOTE_VIDEO_STREAM_HIGH;\nexports.REMOTE_VIDEO_STREAM_LOW = REMOTE_VIDEO_STREAM_LOW;\nexports.REMOTE_VIDEO_STREAM_MEDIUM = REMOTE_VIDEO_STREAM_MEDIUM;\n\n/***/ }),\n/* 15 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\nvar getTimestamp = function getTimestamp() {\n\tvar date = new Date();\n\treturn date.toTimeString().split(\" \")[0] + \":\" + date.getMilliseconds();\n};\n\nexports.getTimestamp = getTimestamp;\n\n/***/ }),\n/* 16 */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar rng = __webpack_require__(17);\nvar bytesToUuid = __webpack_require__(19);\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options == 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n\n\n/***/ }),\n/* 17 */\n/***/ (function(module, exports, __webpack_require__) {\n\n/* WEBPACK VAR INJECTION */(function(global) {// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\nvar rng;\n\nvar crypto = global.crypto || global.msCrypto; // for IE 11\nif (crypto && crypto.getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16);\n  rng = function whatwgRNG() {\n    crypto.getRandomValues(rnds8);\n    return rnds8;\n  };\n}\n\nif (!rng) {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var  rnds = new Array(16);\n  rng = function() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n\nmodule.exports = rng;\n\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(18)))\n\n/***/ }),\n/* 18 */\n/***/ (function(module, exports) {\n\nvar g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n/***/ }),\n/* 19 */\n/***/ (function(module, exports) {\n\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  return  bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]];\n}\n\nmodule.exports = bytesToUuid;\n\n\n/***/ }),\n/* 20 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _View = __webpack_require__(6);\n\nvar _View2 = _interopRequireDefault(_View);\n\nvar _Bar = __webpack_require__(9);\n\nvar _Bar2 = _interopRequireDefault(_Bar);\n\nvar _ResizeSensor = __webpack_require__(22);\n\nvar _ResizeSensor2 = _interopRequireDefault(_ResizeSensor);\n\nvar _Logger = __webpack_require__(0);\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _adapter = __webpack_require__(23);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar VideoPlayer = function VideoPlayer(spec) {\n    \"use strict\";\n\n    var that = (0, _View2.default)({}),\n        onmouseover,\n        onmouseout;\n\n    // Variables\n\n    // VideoPlayer ID\n    that.id = spec.id;\n\n    // Assets URL\n    that.url = spec.url;\n\n    // Stream that the VideoPlayer will play\n    that.stream = spec.stream.stream;\n\n    // DOM element in which the VideoPlayer will be appended\n    that.elementID = spec.elementID;\n\n    // Public functions\n\n    // It will stop the VideoPlayer and remove it from the HTML\n    that.destroy = function () {\n        // document.getElementById('video'+that.id).srcObject = null;\n        // document.getElementById('audio'+that.id).srcObject = null;\n        that.video.srcObject = null;\n        that.audio.srcObject = null;\n        that.video.pause();\n        delete that.resizer;\n        document.getElementById(that.div.id) && that.parentNode.removeChild(that.div);\n    };\n\n    that.resize = function () {\n\n        var width = that.container.offsetWidth,\n            height = that.container.offsetHeight;\n\n        if (spec.stream.screen) {\n\n            if (width * (3 / 4) < height) {\n\n                that.video.style.width = width + \"px\";\n                that.video.style.height = 3 / 4 * width + \"px\";\n\n                that.video.style.top = -(3 / 4 * width / 2 - height / 2) + \"px\";\n                that.video.style.left = \"0px\";\n            } else {\n\n                that.video.style.height = height + \"px\";\n                that.video.style.width = 4 / 3 * height + \"px\";\n\n                that.video.style.left = -(4 / 3 * height / 2 - width / 2) + \"px\";\n                that.video.style.top = \"0px\";\n            }\n        } else {\n            if (width !== that.containerWidth || height !== that.containerHeight) {\n\n                if (width * (3 / 4) > height) {\n\n                    that.video.style.width = width + \"px\";\n                    that.video.style.height = 3 / 4 * width + \"px\";\n\n                    that.video.style.top = -(3 / 4 * width / 2 - height / 2) + \"px\";\n                    that.video.style.left = \"0px\";\n                } else {\n\n                    that.video.style.height = height + \"px\";\n                    that.video.style.width = 4 / 3 * height + \"px\";\n\n                    that.video.style.left = -(4 / 3 * height / 2 - width / 2) + \"px\";\n                    that.video.style.top = \"0px\";\n                }\n            }\n        }\n\n        that.containerWidth = width;\n        that.containerHeight = height;\n    };\n\n    /*window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {\n        document.getElementById(key).value = unescape(value);\n    });*/\n\n    //Logger.debug('Creating URL from stream ' + that.stream);\n    //var myURL = window.URL || webkitURL;\n    //that.stream_url = myURL.createObjectURL(that.stream);\n\n    // Container\n    that.div = document.createElement('div');\n    that.div.setAttribute('id', 'player_' + that.id);\n    if (spec.stream.video) {\n        that.div.setAttribute('style', 'width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;');\n    } else {\n        that.div.setAttribute('style', 'width: 100%; height: 100%; position: relative; overflow: hidden;');\n    }\n\n    // Loader icon\n    //that.loader = document.createElement('img');\n    //that.loader.setAttribute('style', 'width: 16px; height: 16px; position: absolute; top: 50%; left: 50%; margin-top: -8px; margin-left: -8px');\n    //that.loader.setAttribute('id', 'back_' + that.id);\n    //that.loader.setAttribute('src', that.url + '/assets/loader.gif');\n\n    // Video tag\n    that.video = document.createElement('video');\n    that.video.setAttribute('id', 'video' + that.id);\n    if (spec.stream.local && !spec.stream.screen) {\n        if (spec.stream.mirror) {\n            that.video.setAttribute('style', 'width: 100%; height: 100%; position: absolute; transform: rotateY(180deg);');\n        } else {\n            that.video.setAttribute('style', 'width: 100%; height: 100%; position: absolute; ');\n        }\n    } else {\n        if (spec.stream.video) {\n            that.video.setAttribute('style', 'width: 100%; height: 100%; position: absolute;');\n            if (window.navigator.userAgent.indexOf(\"Safari\") > -1 && navigator.userAgent.indexOf(\"Chrome\") === -1) {\n                that.video.setAttribute('controls', '');\n            }\n        } else if (spec.stream.screen) {\n            that.video.setAttribute('style', 'width: 100%; height: 100%; position: absolute;');\n        } else {\n            that.video.setAttribute('style', 'width: 100%; height: 100%; position: absolute; display: none;');\n        }\n    }\n    that.video.setAttribute('autoplay', '');\n    that.video.setAttribute('muted', '');\n    that.video.setAttribute('playsinline', '');\n\n    if (spec.stream.local) {\n        that.video.volume = 0;\n        that.video.setAttribute('muted', '');\n    }\n\n    // Audio tag\n    that.audio = document.createElement('audio');\n    that.audio.setAttribute('id', 'audio' + that.id);\n    that.audio.setAttribute('autoplay', '');\n\n    if (spec.stream.local) {\n        that.audio.volume = 0;\n        that.audio.setAttribute('muted', '');\n    }\n\n    if (that.elementID !== undefined) {\n        document.getElementById(that.elementID).appendChild(that.div);\n        that.container = document.getElementById(that.elementID);\n    } else {\n        document.body.appendChild(that.div);\n        that.container = document.body;\n    }\n\n    that.parentNode = that.div.parentNode;\n\n    //that.div.appendChild(that.loader);\n    // that.div.appendChild(that.video);\n    // that.div.appendChild(that.audio);\n    that.video.addEventListener(\"playing\", function (evt) {\n        var display = function display() {\n            if (that.video.videoWidth * that.video.videoHeight > 4) {\n                // why remote video size initially is 2*2 in chrome?\n                _Logger2.default.debug('video dimensions:', that.video.videoWidth, that.video.videoHeight);\n                return;\n            }\n            setTimeout(display, 50);\n        };\n        display();\n    });\n\n    that.containerWidth = 0;\n    that.containerHeight = 0;\n\n    that.resizer = new _ResizeSensor2.default(that.container, that.resize);\n\n    that.resize();\n\n    if (spec.stream.hasVideo() || spec.stream.hasScreen()) {\n        that.div.appendChild(that.video);\n        that.div.appendChild(that.audio);\n\n        (0, _adapter.attachMediaStream)(that.video, spec.stream.stream);\n        (0, _adapter.attachMediaStream)(that.audio, spec.stream.stream);\n    } else {\n        // in audio-only mode\n        // local player should not be muted\n        !spec.stream.local && that.video.removeAttribute('muted');\n        that.div.appendChild(that.video);\n\n        var audioStream = new MediaStream(spec.stream.stream.getAudioTracks());\n        that.video.srcObject = audioStream;\n        // that.video.play();\n    }\n\n    return that;\n}; /*global window, console, document, webkitURL*/\n/*\n * VideoPlayer represents a Licode video component that shows either a local or a remote video.\n * Ex.: var player = VideoPlayer({id: id, stream: stream, elementID: elementID});\n * A VideoPlayer is also a View component.\n */\nexports.default = VideoPlayer;\n\n/***/ }),\n/* 21 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _View = __webpack_require__(6);\n\nvar _View2 = _interopRequireDefault(_View);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar Speaker = function Speaker(spec) {\n    \"use strict\";\n\n    var that = (0, _View2.default)({}),\n        show,\n        mute,\n        unmute,\n        lastVolume = 50;\n\n    // Variables\n\n    // DOM element in which the Speaker will be appended\n    that.elementID = spec.elementID;\n\n    // media tag\n    that.media = spec.media;\n\n    // Speaker id\n    that.id = spec.id;\n\n    // Assets URL\n    if (spec.url !== undefined) {\n        that.url = spec.url;\n    }\n\n    // MediaStream\n    that.stream = spec.stream;\n\n    // Container\n    that.div = document.createElement('div');\n    that.div.setAttribute('style', 'width: 40%; height: 100%; max-width: 32px; position: absolute; right: 0;z-index:0;');\n\n    // Volume icon\n    that.icon = document.createElement('img');\n    that.icon.setAttribute('id', 'volume_' + that.id);\n    that.icon.setAttribute('src', that.url + '/assets/sound48.png');\n    that.icon.setAttribute('style', 'width: 80%; height: 100%; position: absolute;');\n    that.div.appendChild(that.icon);\n\n    if (!that.stream.local) {\n\n        // Volume bar\n        that.picker = document.createElement('input');\n        that.picker.setAttribute('id', 'picker_' + that.id);\n        that.picker.type = \"range\";\n        that.picker.min = 0;\n        that.picker.max = 100;\n        that.picker.step = 10;\n        that.picker.value = lastVolume;\n        that.picker.setAttribute(\"orient\", \"vertical\"); //  FireFox supports range sliders as of version 23\n\n        that.div.appendChild(that.picker);\n        that.media.volume = that.picker.value / 100;\n        that.media.muted = false;\n\n        that.picker.oninput = function () {\n            if (that.picker.value > 0) {\n                that.media.muted = false;\n                that.icon.setAttribute('src', that.url + '/assets/sound48.png');\n            } else {\n                that.media.muted = true;\n                that.icon.setAttribute('src', that.url + '/assets/mute48.png');\n            }\n            that.media.volume = that.picker.value / 100;\n        };\n\n        // Private functions\n        show = function show(displaying) {\n            that.picker.setAttribute('style', 'background: transparent; width: 32px; height: 100px; position: absolute; bottom: 90%; z-index: 1;' + that.div.offsetHeight + 'px; right: 0px; -webkit-appearance: slider-vertical; display: ' + displaying);\n        };\n\n        mute = function mute() {\n            that.icon.setAttribute('src', that.url + '/assets/mute48.png');\n            lastVolume = that.picker.value;\n            that.picker.value = 0;\n            that.media.volume = 0;\n            that.media.muted = true;\n        };\n\n        unmute = function unmute() {\n            that.icon.setAttribute('src', that.url + '/assets/sound48.png');\n            that.picker.value = lastVolume;\n            that.media.volume = that.picker.value / 100;\n            that.media.muted = false;\n        };\n\n        that.icon.onclick = function () {\n            if (that.media.muted) {\n                unmute();\n            } else {\n                mute();\n            }\n        };\n\n        // Public functions\n        that.div.onmouseover = function () {\n            show('block');\n        };\n\n        that.div.onmouseout = function () {\n            show('none');\n        };\n\n        show('none');\n    } else {\n\n        mute = function mute() {\n            that.media.muted = true;\n            that.icon.setAttribute('src', that.url + '/assets/mute48.png');\n            //that.stream.stream.getAudioTracks()[0].enabled = false;\n        };\n\n        unmute = function unmute() {\n            that.media.muted = false;\n            that.icon.setAttribute('src', that.url + '/assets/sound48.png');\n            //that.stream.stream.getAudioTracks()[0].enabled = true;\n        };\n\n        that.icon.onclick = function () {\n            if (that.media.muted) {\n                unmute();\n            } else {\n                mute();\n            }\n        };\n    }\n\n    document.getElementById(that.elementID).appendChild(that.div);\n    return that;\n}; /*global window, console, document */\n/*\n * Speaker represents the volume icon that will be shown in the mediaPlayer, for example.\n * It manages the volume level of the media tag given in the constructor.\n * Every Speaker is a View.\n * Ex.: var speaker = Speaker({elementID: element, media: mediaTag, id: id});\n */\nexports.default = Speaker;\n\n/***/ }),\n/* 22 */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_RESULT__;/**\n * Copyright Marc J. Schmidt. See the LICENSE file at the top-level\n * directory of this distribution and at\n * https://github.com/marcj/css-element-queries/blob/master/LICENSE.\n */\n;\n(function (root, factory) {\n    if (true) {\n        !(__WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.call(exports, __webpack_require__, exports, module)) :\n\t\t\t\t__WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n    } else if (typeof exports === \"object\") {\n        module.exports = factory();\n    } else {\n        root.ResizeSensor = factory();\n    }\n}(this, function () {\n\n    //Make sure it does not throw in a SSR (Server Side Rendering) situation\n    if (typeof window === \"undefined\") {\n        return null;\n    }\n    // Only used for the dirty checking, so the event callback count is limted to max 1 call per fps per sensor.\n    // In combination with the event based resize sensor this saves cpu time, because the sensor is too fast and\n    // would generate too many unnecessary events.\n    var requestAnimationFrame = window.requestAnimationFrame ||\n        window.mozRequestAnimationFrame ||\n        window.webkitRequestAnimationFrame ||\n        function (fn) {\n            return window.setTimeout(fn, 20);\n        };\n\n    /**\n     * Iterate over each of the provided element(s).\n     *\n     * @param {HTMLElement|HTMLElement[]} elements\n     * @param {Function}                  callback\n     */\n    function forEachElement(elements, callback){\n        var elementsType = Object.prototype.toString.call(elements);\n        var isCollectionTyped = ('[object Array]' === elementsType\n            || ('[object NodeList]' === elementsType)\n            || ('[object HTMLCollection]' === elementsType)\n            || ('[object Object]' === elementsType)\n            || ('undefined' !== typeof jQuery && elements instanceof jQuery) //jquery\n            || ('undefined' !== typeof Elements && elements instanceof Elements) //mootools\n        );\n        var i = 0, j = elements.length;\n        if (isCollectionTyped) {\n            for (; i < j; i++) {\n                callback(elements[i]);\n            }\n        } else {\n            callback(elements);\n        }\n    }\n\n    /**\n     * Class for dimension change detection.\n     *\n     * @param {Element|Element[]|Elements|jQuery} element\n     * @param {Function} callback\n     *\n     * @constructor\n     */\n    var ResizeSensor = function(element, callback) {\n        /**\n         *\n         * @constructor\n         */\n        function EventQueue() {\n            var q = [];\n            this.add = function(ev) {\n                q.push(ev);\n            };\n\n            var i, j;\n            this.call = function() {\n                for (i = 0, j = q.length; i < j; i++) {\n                    q[i].call();\n                }\n            };\n\n            this.remove = function(ev) {\n                var newQueue = [];\n                for(i = 0, j = q.length; i < j; i++) {\n                    if(q[i] !== ev) newQueue.push(q[i]);\n                }\n                q = newQueue;\n            }\n\n            this.length = function() {\n                return q.length;\n            }\n        }\n\n        /**\n         * @param {HTMLElement} element\n         * @param {String}      prop\n         * @returns {String|Number}\n         */\n        function getComputedStyle(element, prop) {\n            if (element.currentStyle) {\n                return element.currentStyle[prop];\n            } else if (window.getComputedStyle) {\n                return window.getComputedStyle(element, null).getPropertyValue(prop);\n            } else {\n                return element.style[prop];\n            }\n        }\n\n        /**\n         *\n         * @param {HTMLElement} element\n         * @param {Function}    resized\n         */\n        function attachResizeEvent(element, resized) {\n            if (!element.resizedAttached) {\n                element.resizedAttached = new EventQueue();\n                element.resizedAttached.add(resized);\n            } else if (element.resizedAttached) {\n                element.resizedAttached.add(resized);\n                return;\n            }\n\n            element.resizeSensor = document.createElement('div');\n            element.resizeSensor.className = 'resize-sensor';\n            var style = 'position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;';\n            var styleChild = 'position: absolute; left: 0; top: 0; transition: 0s;';\n\n            element.resizeSensor.style.cssText = style;\n            element.resizeSensor.innerHTML =\n                '<div class=\"resize-sensor-expand\" style=\"' + style + '\">' +\n                    '<div style=\"' + styleChild + '\"></div>' +\n                '</div>' +\n                '<div class=\"resize-sensor-shrink\" style=\"' + style + '\">' +\n                    '<div style=\"' + styleChild + ' width: 200%; height: 200%\"></div>' +\n                '</div>';\n            element.appendChild(element.resizeSensor);\n\n            if (getComputedStyle(element, 'position') == 'static') {\n                element.style.position = 'relative';\n            }\n\n            var expand = element.resizeSensor.childNodes[0];\n            var expandChild = expand.childNodes[0];\n            var shrink = element.resizeSensor.childNodes[1];\n            var dirty, rafId, newWidth, newHeight;\n            var lastWidth = element.offsetWidth;\n            var lastHeight = element.offsetHeight;\n\n            var reset = function() {\n                expandChild.style.width = '100000px';\n                expandChild.style.height = '100000px';\n\n                expand.scrollLeft = 100000;\n                expand.scrollTop = 100000;\n\n                shrink.scrollLeft = 100000;\n                shrink.scrollTop = 100000;\n            };\n\n            reset();\n\n            var onResized = function() {\n                rafId = 0;\n\n                if (!dirty) return;\n\n                lastWidth = newWidth;\n                lastHeight = newHeight;\n\n                if (element.resizedAttached) {\n                    element.resizedAttached.call();\n                }\n            };\n\n            var onScroll = function() {\n                newWidth = element.offsetWidth;\n                newHeight = element.offsetHeight;\n                dirty = newWidth != lastWidth || newHeight != lastHeight;\n\n                if (dirty && !rafId) {\n                    rafId = requestAnimationFrame(onResized);\n                }\n\n                reset();\n            };\n\n            var addEvent = function(el, name, cb) {\n                if (el.attachEvent) {\n                    el.attachEvent('on' + name, cb);\n                } else {\n                    el.addEventListener(name, cb);\n                }\n            };\n\n            addEvent(expand, 'scroll', onScroll);\n            addEvent(shrink, 'scroll', onScroll);\n        }\n\n        forEachElement(element, function(elem){\n            attachResizeEvent(elem, callback);\n        });\n\n        this.detach = function(ev) {\n            ResizeSensor.detach(element, ev);\n        };\n    };\n\n    ResizeSensor.detach = function(element, ev) {\n        forEachElement(element, function(elem){\n            if(elem.resizedAttached && typeof ev == \"function\"){\n                elem.resizedAttached.remove(ev);\n                if(elem.resizedAttached.length()) return;\n            }\n            if (elem.resizeSensor) {\n                if (elem.contains(elem.resizeSensor)) {\n                    elem.removeChild(elem.resizeSensor);\n                }\n                delete elem.resizeSensor;\n                delete elem.resizedAttached;\n            }\n        });\n    };\n\n    return ResizeSensor;\n\n}));\n\n\n/***/ }),\n/* 23 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/*\n *  Copyright (c) 2014 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n\n/* More information about these options at jshint.com/docs/options */\n/* jshint browser: true, camelcase: true, curly: true, devel: true,\n eqeqeq: true, forin: false, globalstrict: true, node: true,\n quotmark: single, undef: true, unused: strict */\n/* global mozRTCIceCandidate, mozRTCPeerConnection, Promise,\n mozRTCSessionDescription, webkitRTCPeerConnection, MediaStreamTrack */\n/* exported trace,requestUserMedia */\n\n\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar getUserMedia = null;\nvar attachMediaStream = null;\nvar reattachMediaStream = null;\nvar webrtcDetectedBrowser = null;\nvar webrtcDetectedVersion = null;\nvar webrtcMinimumVersion = null;\nvar webrtcUtils = {\n    log: function log() {\n        // suppress console.log output when being included as a module.\n        if (true) {\n            return;\n        }\n        console.log.apply(console, arguments);\n    },\n    extractVersion: function extractVersion(uastring, expr, pos) {\n        var match = uastring.match(expr);\n        return match && match.length >= pos && parseInt(match[pos]);\n    }\n};\n\nfunction trace(text) {\n    // This function is used for logging.\n    if (text[text.length - 1] === '\\n') {\n        text = text.substring(0, text.length - 1);\n    }\n    if (window.performance) {\n        var now = (window.performance.now() / 1000).toFixed(3);\n        webrtcUtils.log(now + ': ' + text);\n    } else {\n        webrtcUtils.log(text);\n    }\n}\n\nif ((typeof window === 'undefined' ? 'undefined' : _typeof(window)) === 'object') {\n    if (window.HTMLMediaElement && !('srcObject' in window.HTMLMediaElement.prototype)) {\n        // Shim the srcObject property, once, when HTMLMediaElement is found.\n        Object.defineProperty(window.HTMLMediaElement.prototype, 'srcObject', {\n            get: function get() {\n                // If prefixed srcObject property exists, return it.\n                // Otherwise use the shimmed property, _srcObject\n                return 'mozSrcObject' in this ? this.mozSrcObject : this._srcObject;\n            },\n            set: function set(stream) {\n                if ('mozSrcObject' in this) {\n                    this.mozSrcObject = stream;\n                } else {\n                    // Use _srcObject as a private property for this shim\n                    this._srcObject = stream;\n                    // TODO: revokeObjectUrl(this.src) when !stream to release resources?\n                    this.src = URL.createObjectURL(stream);\n                }\n            }\n        });\n    }\n    // Proxy existing globals\n    getUserMedia = window.navigator && window.navigator.getUserMedia;\n}\n\n// Attach a media stream to an element.\nattachMediaStream = function attachMediaStream(element, stream) {\n    element.srcObject = stream;\n};\n\nreattachMediaStream = function reattachMediaStream(to, from) {\n    to.srcObject = from.srcObject;\n};\n\nif (typeof window === 'undefined' || !window.navigator) {\n    webrtcUtils.log('This does not appear to be a browser');\n    webrtcDetectedBrowser = 'not a browser';\n} else if (navigator.mozGetUserMedia && window.mozRTCPeerConnection) {\n    webrtcUtils.log('This appears to be Firefox');\n\n    webrtcDetectedBrowser = 'firefox';\n\n    // the detected firefox version.\n    webrtcDetectedVersion = webrtcUtils.extractVersion(navigator.userAgent, /Firefox\\/([0-9]+)\\./, 1);\n\n    // the minimum firefox version still supported by adapter.\n    webrtcMinimumVersion = 31;\n\n    // The RTCPeerConnection object.\n    window.RTCPeerConnection = function (pcConfig, pcConstraints) {\n        if (webrtcDetectedVersion < 38) {\n            // .urls is not supported in FF < 38.\n            // create RTCIceServers with a single url.\n            if (pcConfig && pcConfig.iceServers) {\n                var newIceServers = [];\n                for (var i = 0; i < pcConfig.iceServers.length; i++) {\n                    var server = pcConfig.iceServers[i];\n                    if (server.hasOwnProperty('urls')) {\n                        for (var j = 0; j < server.urls.length; j++) {\n                            var newServer = {\n                                url: server.urls[j]\n                            };\n                            if (server.urls[j].indexOf('turn') === 0) {\n                                newServer.username = server.username;\n                                newServer.credential = server.credential;\n                            }\n                            newIceServers.push(newServer);\n                        }\n                    } else {\n                        newIceServers.push(pcConfig.iceServers[i]);\n                    }\n                }\n                pcConfig.iceServers = newIceServers;\n            }\n        }\n        return new mozRTCPeerConnection(pcConfig, pcConstraints); // jscs:ignore requireCapitalizedConstructors\n    };\n\n    // The RTCSessionDescription object.\n    if (!window.RTCSessionDescription) {\n        window.RTCSessionDescription = mozRTCSessionDescription;\n    }\n\n    // The RTCIceCandidate object.\n    if (!window.RTCIceCandidate) {\n        window.RTCIceCandidate = mozRTCIceCandidate;\n    }\n\n    // getUserMedia constraints shim.\n    getUserMedia = function getUserMedia(constraints, onSuccess, onError) {\n        var constraintsToFF37 = function constraintsToFF37(c) {\n            if ((typeof c === 'undefined' ? 'undefined' : _typeof(c)) !== 'object' || c.require) {\n                return c;\n            }\n            var require = [];\n            Object.keys(c).forEach(function (key) {\n                if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n                    return;\n                }\n                var r = c[key] = _typeof(c[key]) === 'object' ? c[key] : { ideal: c[key] };\n                if (r.min !== undefined || r.max !== undefined || r.exact !== undefined) {\n                    require.push(key);\n                }\n                if (r.exact !== undefined) {\n                    if (typeof r.exact === 'number') {\n                        r.min = r.max = r.exact;\n                    } else {\n                        c[key] = r.exact;\n                    }\n                    delete r.exact;\n                }\n                if (r.ideal !== undefined) {\n                    c.advanced = c.advanced || [];\n                    var oc = {};\n                    if (typeof r.ideal === 'number') {\n                        oc[key] = { min: r.ideal, max: r.ideal };\n                    } else {\n                        oc[key] = r.ideal;\n                    }\n                    c.advanced.push(oc);\n                    delete r.ideal;\n                    if (!Object.keys(r).length) {\n                        delete c[key];\n                    }\n                }\n            });\n            if (require.length) {\n                c.require = require;\n            }\n            return c;\n        };\n        if (webrtcDetectedVersion < 38) {\n            webrtcUtils.log('spec: ' + JSON.stringify(constraints));\n            if (constraints.audio) {\n                constraints.audio = constraintsToFF37(constraints.audio);\n            }\n            if (constraints.video) {\n                constraints.video = constraintsToFF37(constraints.video);\n            }\n            webrtcUtils.log('ff37: ' + JSON.stringify(constraints));\n        }\n        return navigator.mozGetUserMedia(constraints, onSuccess, onError);\n    };\n\n    navigator.getUserMedia = getUserMedia;\n\n    // Shim for mediaDevices on older versions.\n    if (!navigator.mediaDevices) {\n        navigator.mediaDevices = { getUserMedia: requestUserMedia,\n            addEventListener: function addEventListener() {},\n            removeEventListener: function removeEventListener() {}\n        };\n    }\n    navigator.mediaDevices.enumerateDevices = navigator.mediaDevices.enumerateDevices || function () {\n        return new Promise(function (resolve) {\n            var infos = [{ kind: 'audioinput', deviceId: 'default', label: '', groupId: '' }, { kind: 'videoinput', deviceId: 'default', label: '', groupId: '' }];\n            resolve(infos);\n        });\n    };\n\n    if (webrtcDetectedVersion < 41) {\n        // Work around http://bugzil.la/1169665\n        var orgEnumerateDevices = navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);\n        navigator.mediaDevices.enumerateDevices = function () {\n            return orgEnumerateDevices().then(undefined, function (e) {\n                if (e.name === 'NotFoundError') {\n                    return [];\n                }\n                throw e;\n            });\n        };\n    }\n} else if (navigator.webkitGetUserMedia && window.webkitRTCPeerConnection) {\n    webrtcUtils.log('This appears to be Chrome');\n\n    webrtcDetectedBrowser = 'chrome';\n\n    // the detected chrome version.\n    webrtcDetectedVersion = webrtcUtils.extractVersion(navigator.userAgent, /Chrom(e|ium)\\/([0-9]+)\\./, 2);\n\n    // the minimum chrome version still supported by adapter.\n    webrtcMinimumVersion = 38;\n\n    // The RTCPeerConnection object.\n    window.RTCPeerConnection = function (pcConfig, pcConstraints) {\n        // Translate iceTransportPolicy to iceTransports,\n        // see https://code.google.com/p/webrtc/issues/detail?id=4869\n        if (pcConfig && pcConfig.iceTransportPolicy) {\n            pcConfig.iceTransports = pcConfig.iceTransportPolicy;\n        }\n\n        var pc = new webkitRTCPeerConnection(pcConfig, pcConstraints); // jscs:ignore requireCapitalizedConstructors\n        var origGetStats = pc.getStats.bind(pc);\n        pc.getStats = function (selector, successCallback, errorCallback) {\n            // jshint ignore: line\n            var self = this;\n            var args = arguments;\n\n            // If selector is a function then we are in the old style stats so just\n            // pass back the original getStats format to avoid breaking old users.\n            if (arguments.length > 0 && typeof selector === 'function') {\n                return origGetStats(selector, successCallback);\n            }\n\n            var fixChromeStats = function fixChromeStats(response) {\n                var standardReport = {};\n                var reports = response.result();\n                reports.forEach(function (report) {\n                    var standardStats = {\n                        id: report.id,\n                        timestamp: report.timestamp,\n                        type: report.type\n                    };\n                    report.names().forEach(function (name) {\n                        standardStats[name] = report.stat(name);\n                    });\n                    standardReport[standardStats.id] = standardStats;\n                });\n\n                return standardReport;\n            };\n\n            if (arguments.length >= 2) {\n                var successCallbackWrapper = function successCallbackWrapper(response) {\n                    args[1](fixChromeStats(response));\n                };\n\n                return origGetStats.apply(this, [successCallbackWrapper, arguments[0]]);\n            }\n\n            // promise-support\n            return new Promise(function (resolve, reject) {\n                if (args.length === 1 && selector === null) {\n                    origGetStats.apply(self, [function (response) {\n                        resolve.apply(null, [fixChromeStats(response)]);\n                    }, reject]);\n                } else {\n                    origGetStats.apply(self, [resolve, reject]);\n                }\n            });\n        };\n\n        return pc;\n    };\n\n    // add promise support\n    ['createOffer', 'createAnswer'].forEach(function (method) {\n        var nativeMethod = webkitRTCPeerConnection.prototype[method];\n        webkitRTCPeerConnection.prototype[method] = function () {\n            var self = this;\n            if (arguments.length < 1 || arguments.length === 1 && _typeof(arguments[0]) === 'object') {\n                var opts = arguments.length === 1 ? arguments[0] : undefined;\n                return new Promise(function (resolve, reject) {\n                    nativeMethod.apply(self, [resolve, reject, opts]);\n                });\n            } else {\n                return nativeMethod.apply(this, arguments);\n            }\n        };\n    });\n\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'].forEach(function (method) {\n        var nativeMethod = webkitRTCPeerConnection.prototype[method];\n        webkitRTCPeerConnection.prototype[method] = function () {\n            var args = arguments;\n            var self = this;\n            return new Promise(function (resolve, reject) {\n                nativeMethod.apply(self, [args[0], function () {\n                    resolve();\n                    if (args.length >= 2) {\n                        args[1].apply(null, []);\n                    }\n                }, function (err) {\n                    reject(err);\n                    if (args.length >= 3) {\n                        args[2].apply(null, [err]);\n                    }\n                }]);\n            });\n        };\n    });\n\n    // getUserMedia constraints shim.\n    var constraintsToChrome = function constraintsToChrome(c) {\n        if ((typeof c === 'undefined' ? 'undefined' : _typeof(c)) !== 'object' || c.mandatory || c.optional) {\n            return c;\n        }\n        var cc = {};\n        Object.keys(c).forEach(function (key) {\n            if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n                return;\n            }\n            var r = _typeof(c[key]) === 'object' ? c[key] : { ideal: c[key] };\n            if (r.exact !== undefined && typeof r.exact === 'number') {\n                r.min = r.max = r.exact;\n            }\n            var oldname = function oldname(prefix, name) {\n                if (prefix) {\n                    return prefix + name.charAt(0).toUpperCase() + name.slice(1);\n                }\n                return name === 'deviceId' ? 'sourceId' : name;\n            };\n            if (r.ideal !== undefined) {\n                cc.optional = cc.optional || [];\n                var oc = {};\n                if (typeof r.ideal === 'number') {\n                    oc[oldname('min', key)] = r.ideal;\n                    cc.optional.push(oc);\n                    oc = {};\n                    oc[oldname('max', key)] = r.ideal;\n                    cc.optional.push(oc);\n                } else {\n                    oc[oldname('', key)] = r.ideal;\n                    cc.optional.push(oc);\n                }\n            }\n            if (r.exact !== undefined && typeof r.exact !== 'number') {\n                cc.mandatory = cc.mandatory || {};\n                cc.mandatory[oldname('', key)] = r.exact;\n            } else {\n                ['min', 'max'].forEach(function (mix) {\n                    if (r[mix] !== undefined) {\n                        cc.mandatory = cc.mandatory || {};\n                        cc.mandatory[oldname(mix, key)] = r[mix];\n                    }\n                });\n            }\n        });\n        if (c.advanced) {\n            cc.optional = (cc.optional || []).concat(c.advanced);\n        }\n        return cc;\n    };\n\n    getUserMedia = function getUserMedia(constraints, onSuccess, onError) {\n        if (constraints.audio) {\n            constraints.audio = constraintsToChrome(constraints.audio);\n        }\n        if (constraints.video) {\n            constraints.video = constraintsToChrome(constraints.video);\n        }\n        webrtcUtils.log('chrome: ' + JSON.stringify(constraints));\n        return navigator.webkitGetUserMedia(constraints, onSuccess, onError);\n    };\n    navigator.getUserMedia = getUserMedia;\n\n    if (!navigator.mediaDevices) {\n        navigator.mediaDevices = { getUserMedia: requestUserMedia,\n            enumerateDevices: function enumerateDevices() {\n                return new Promise(function (resolve) {\n                    var kinds = { audio: 'audioinput', video: 'videoinput' };\n                    return MediaStreamTrack.getSources(function (devices) {\n                        resolve(devices.map(function (device) {\n                            return { label: device.label,\n                                kind: kinds[device.kind],\n                                deviceId: device.id,\n                                groupId: '' };\n                        }));\n                    });\n                });\n            } };\n    }\n\n    // A shim for getUserMedia method on the mediaDevices object.\n    // TODO(KaptenJansson) remove once implemented in Chrome stable.\n    if (!navigator.mediaDevices.getUserMedia) {\n        navigator.mediaDevices.getUserMedia = function (constraints) {\n            return requestUserMedia(constraints);\n        };\n    } else {\n        // Even though Chrome 45 has navigator.mediaDevices and a getUserMedia\n        // function which returns a Promise, it does not accept spec-style\n        // constraints.\n        var origGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);\n        navigator.mediaDevices.getUserMedia = function (c) {\n            webrtcUtils.log('spec:   ' + JSON.stringify(c)); // whitespace for alignment\n            c.audio = constraintsToChrome(c.audio);\n            c.video = constraintsToChrome(c.video);\n            webrtcUtils.log('chrome: ' + JSON.stringify(c));\n            return origGetUserMedia(c);\n        };\n    }\n\n    // Dummy devicechange event methods.\n    // TODO(KaptenJansson) remove once implemented in Chrome stable.\n    if (typeof navigator.mediaDevices.addEventListener === 'undefined') {\n        navigator.mediaDevices.addEventListener = function () {\n            webrtcUtils.log('Dummy mediaDevices.addEventListener called.');\n        };\n    }\n    if (typeof navigator.mediaDevices.removeEventListener === 'undefined') {\n        navigator.mediaDevices.removeEventListener = function () {\n            webrtcUtils.log('Dummy mediaDevices.removeEventListener called.');\n        };\n    }\n\n    // Attach a media stream to an element.\n    attachMediaStream = function attachMediaStream(element, stream) {\n        if (webrtcDetectedVersion >= 43) {\n            element.srcObject = stream;\n        } else if (typeof element.src !== 'undefined') {\n            element.src = URL.createObjectURL(stream);\n        } else {\n            webrtcUtils.log('Error attaching stream to element.');\n        }\n    };\n    reattachMediaStream = function reattachMediaStream(to, from) {\n        if (webrtcDetectedVersion >= 43) {\n            to.srcObject = from.srcObject;\n        } else {\n            to.src = from.src;\n        }\n    };\n} else if (navigator.mediaDevices && navigator.userAgent.match(/Edge\\/(\\d+).(\\d+)$/)) {\n    webrtcUtils.log('This appears to be Edge');\n    webrtcDetectedBrowser = 'edge';\n\n    webrtcDetectedVersion = webrtcUtils.extractVersion(navigator.userAgent, /Edge\\/(\\d+).(\\d+)$/, 2);\n\n    // the minimum version still supported by adapter.\n    webrtcMinimumVersion = 12;\n} else {\n    webrtcUtils.log('Browser does not appear to be WebRTC-capable');\n}\n\n// Returns the result of getUserMedia as a Promise.\nfunction requestUserMedia(constraints) {\n    return new Promise(function (resolve, reject) {\n        getUserMedia(constraints, resolve, reject);\n    });\n}\n\nvar webrtcTesting = {};\ntry {\n    Object.defineProperty(webrtcTesting, 'version', {\n        set: function set(version) {\n            webrtcDetectedVersion = version;\n        }\n    });\n} catch (e) {}\n\nif (true) {\n    var RTCPeerConnection;\n    if (typeof window !== 'undefined') {\n        RTCPeerConnection = window.RTCPeerConnection;\n    }\n    module.exports = {\n        RTCPeerConnection: RTCPeerConnection,\n        getUserMedia: getUserMedia,\n        attachMediaStream: attachMediaStream,\n        reattachMediaStream: reattachMediaStream,\n        webrtcDetectedBrowser: webrtcDetectedBrowser,\n        webrtcDetectedVersion: webrtcDetectedVersion,\n        webrtcMinimumVersion: webrtcMinimumVersion,\n        webrtcTesting: webrtcTesting,\n        webrtcUtils: webrtcUtils\n        //requestUserMedia: not exposed on purpose.\n        //trace: not exposed on purpose.\n    };\n} else if (typeof require === 'function' && typeof define === 'function') {\n    // Expose objects and functions when RequireJS is doing the loading.\n    define([], function () {\n        return {\n            RTCPeerConnection: window.RTCPeerConnection,\n            getUserMedia: getUserMedia,\n            attachMediaStream: attachMediaStream,\n            reattachMediaStream: reattachMediaStream,\n            webrtcDetectedBrowser: webrtcDetectedBrowser,\n            webrtcDetectedVersion: webrtcDetectedVersion,\n            webrtcMinimumVersion: webrtcMinimumVersion,\n            webrtcTesting: webrtcTesting,\n            webrtcUtils: webrtcUtils\n            //requestUserMedia: not exposed on purpose.\n            //trace: not exposed on purpose.\n        };\n    });\n}\n\n/***/ }),\n/* 24 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _View = __webpack_require__(6);\n\nvar _View2 = _interopRequireDefault(_View);\n\nvar _Bar = __webpack_require__(9);\n\nvar _Bar2 = _interopRequireDefault(_Bar);\n\nvar _Logger = __webpack_require__(0);\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _Browser = __webpack_require__(2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/*global window, console, document, webkitURL*/\n/*\n * AudioPlayer represents a Licode Audio component that shows either a local or a remote Audio.\n * Ex.: var player = AudioPlayer({id: id, stream: stream, elementID: elementID});\n * A AudioPlayer is also a View component.\n */\nvar AudioPlayer = function AudioPlayer(spec) {\n    \"use strict\";\n\n    var that = (0, _View2.default)({}),\n        onmouseover,\n        onmouseout;\n\n    // Variables\n\n    // AudioPlayer ID\n    that.id = spec.id;\n\n    // Assets URL\n    that.url = spec.url;\n\n    // Stream that the AudioPlayer will play\n    that.stream = spec.stream.stream;\n\n    // DOM element in which the AudioPlayer will be appended\n    that.elementID = spec.elementID;\n\n    // Audio tag\n    that.audio = document.createElement('audio');\n    that.audio.setAttribute('id', 'stream' + that.id);\n    that.audio.setAttribute('style', 'width: 100%; height: 100%; position: absolute');\n    that.audio.setAttribute('autoplay', 'autoplay');\n\n    if (spec.stream.local) {\n        that.audio.volume = 0;\n    }\n\n    if (spec.stream.local) {\n        that.audio.volume = 0;\n    }\n\n    if (that.elementID !== undefined) {\n\n        // It will stop the AudioPlayer and remove it from the HTML\n        that.destroy = function () {\n            that.audio.pause();\n            //clearInterval(that.resize);\n            that.parentNode.removeChild(that.div);\n        };\n\n        onmouseover = function onmouseover() {\n            that.bar.display();\n        };\n\n        onmouseout = function onmouseout() {\n            that.bar.hide();\n        };\n\n        // Container\n        that.div = document.createElement('div');\n        that.div.setAttribute('id', 'player_' + that.id);\n        that.div.setAttribute('style', 'width: 100%; height: 100%; position: relative; overflow: hidden;');\n\n        document.getElementById(that.elementID).appendChild(that.div);\n        that.container = document.getElementById(that.elementID);\n\n        that.parentNode = that.div.parentNode;\n\n        that.div.appendChild(that.audio);\n\n        // Bottom Bar\n        that.bar = new _Bar2.default({ elementID: 'player_' + that.id, id: that.id, stream: spec.stream, media: that.audio, options: spec.options, url: that.url });\n\n        if (spec.stream.local) {\n            that.div.onmouseover = onmouseout;\n        } else {\n            that.div.onmouseover = onmouseover;\n        }\n        that.div.onmouseout = onmouseout;\n    } else {\n        // It will stop the AudioPlayer and remove it from the HTML\n        that.destroy = function () {\n            that.audio.pause();\n            //clearInterval(that.resize);\n            that.parentNode.removeChild(that.audio);\n        };\n\n        document.body.appendChild(that.audio);\n        that.parentNode = document.body;\n    }\n\n    _Logger2.default.debug('Creating URL from stream ' + that.stream);\n    if ((0, _Browser.isSafari)()) {\n        that.audio.srcObject = that.stream;\n    } else {\n        var myURL = window.URL || webkitURL;\n        that.stream_url = myURL.createObjectURL(that.stream);\n        that.audio.src = that.stream_url;\n    }\n\n    return that;\n};\n\nexports.default = AudioPlayer;\n\n/***/ }),\n/* 25 */,\n/* 26 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _Logger = __webpack_require__(0);\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar ChromeCanaryStack = function ChromeCanaryStack(spec) {\n    \"use strict\";\n\n    var that = {},\n        WebkitRTCPeerConnection = webkitRTCPeerConnection;\n\n    that.pc_config = {\n        \"iceServers\": []\n    };\n\n    that.con = { 'optional': [{ 'DtlsSrtpKeyAgreement': true }] };\n\n    if (spec.iceServers instanceof Array) {\n        that.pc_config.iceServers = spec.iceServers;\n    } else {\n        if (spec.stunServerUrl) {\n            if (spec.stunServerUrl instanceof Array) {\n                spec.stunServerUrl.map(function (url) {\n                    if (typeof url === 'string' && url !== '') {\n                        that.pc_config.iceServers.push({ \"url\": url });\n                    }\n                });\n            } else if (typeof spec.stunServerUrl === 'string' && spec.stunServerUrl !== '') {\n                that.pc_config.iceServers.push({ \"url\": spec.stunServerUrl });\n            }\n        }\n\n        if (spec.turnServer) {\n            if (spec.turnServer instanceof Array) {\n                spec.turnServer.map(function (turn) {\n                    if (typeof turn.url === 'string' && turn.url !== '') {\n                        that.pc_config.iceServers.push({\n                            \"username\": turn.username,\n                            \"credential\": turn.password,\n                            \"url\": turn.url\n                        });\n                    }\n                });\n            } else if (typeof spec.turnServer.url === 'string' && spec.turnServer.url !== '') {\n                that.pc_config.iceServers.push({\n                    \"username\": spec.turnServer.username,\n                    \"credential\": spec.turnServer.password,\n                    \"url\": spec.turnServer.url\n                });\n            }\n        }\n    }\n\n    if (spec.audio === undefined) {\n        spec.audio = true;\n    }\n\n    if (spec.video === undefined) {\n        spec.video = true;\n    }\n\n    that.mediaConstraints = {\n        'mandatory': {\n            'OfferToReceiveVideo': spec.video,\n            'OfferToReceiveAudio': spec.audio\n        }\n    };\n\n    that.roapSessionId = 103;\n\n    that.peerConnection = new WebkitRTCPeerConnection(that.pc_config, that.con);\n\n    that.peerConnection.onicecandidate = function (event) {\n        //Logger.debug(\"PeerConnection: \", spec.session_id);\n        if (!event.candidate) {\n            // At the moment, we do not renegotiate when new candidates\n            // show up after the more flag has been false once.\n            _Logger2.default.debug(\"PeerConnection State: \" + that.peerConnection.iceGatheringState);\n\n            if (that.ices === undefined) {\n                that.ices = 0;\n            }\n            that.ices = that.ices + 1;\n            if (that.ices >= 1 && that.moreIceComing) {\n                that.moreIceComing = false;\n                that.markActionNeeded();\n            }\n        } else {\n            that.iceCandidateCount += 1;\n        }\n    };\n\n    //Logger.debug(\"Created webkitRTCPeerConnnection with config \\\"\" + JSON.stringify(that.pc_config) + \"\\\".\");\n\n    var setMaxBW = function setMaxBW(sdp) {\n        var a, r;\n        if (spec.minVideoBW && spec.maxVideoBW) {\n            a = sdp.match(/m=video.*\\r\\n/);\n            r = a[0] + \"b=AS:\" + spec.maxVideoBW + \"\\r\\n\";\n            //if (spec.mode === 'live') { //h.264\n            //  r = a[0] + \"a=fmtp:107 x-google-min-bitrate=\" + spec.minVideoBW + \"; x-google-max-bitrate=\" + spec.maxVideoBW + \"\\r\\n\";\n            //} else { //vp8\n            //  r = a[0] + \"a=fmtp:100 x-google-min-bitrate=\" + spec.minVideoBW + \"; x-google-max-bitrate=\" + spec.maxVideoBW + \"\\r\\n\";\n            //}\n            sdp = sdp.replace(a[0], r);\n            _Logger2.default.debug('Set Video Bitrate - min:' + spec.minVideoBW + \" max:\" + spec.maxVideoBW);\n        }\n\n        if (spec.maxAudioBW) {\n            a = sdp.match(/m=audio.*\\r\\n/);\n            r = a[0] + \"b=AS:\" + spec.maxAudioBW + \"\\r\\n\";\n            sdp = sdp.replace(a[0], r);\n        }\n\n        return sdp;\n    };\n\n    /**\n     * This function processes signalling messages from the other side.\n     * @param {string} msgstring JSON-formatted string containing a ROAP message.\n     */\n    that.processSignalingMessage = function (msgstring) {\n        // Offer: Check for glare and resolve.\n        // Answer/OK: Remove retransmit for the msg this is an answer to.\n        // Send back \"OK\" if this was an Answer.\n        //Logger.debug('Activity on conn ' + that.sessionId);\n        var msg = JSON.parse(msgstring),\n            sd;\n        that.incomingMessage = msg;\n\n        if (that.state === 'new') {\n            if (msg.messageType === 'OFFER') {\n                // Initial offer.\n                sd = {\n                    sdp: msg.sdp,\n                    type: 'offer'\n                };\n                that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd));\n\n                that.state = 'offer-received';\n                // Allow other stuff to happen, then reply.\n                that.markActionNeeded();\n            } else {\n                that.error('Illegal message for this state: ' + msg.messageType + ' in state ' + that.state);\n            }\n        } else if (that.state === 'offer-sent') {\n            if (msg.messageType === 'ANSWER') {\n\n                sd = {\n                    sdp: msg.sdp,\n                    type: 'answer'\n                };\n                //Logger.debug(\"Received ANSWER: \", sd.sdp);\n\n                sd.sdp = setMaxBW(sd.sdp);\n\n                that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd));\n                that.sendOK();\n                that.state = 'established';\n            } else if (msg.messageType === 'pr-answer') {\n                sd = {\n                    sdp: msg.sdp,\n                    type: 'pr-answer'\n                };\n                that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd));\n\n                // No change to state, and no response.\n            } else if (msg.messageType === 'offer') {\n                // Glare processing.\n                that.error('Not written yet');\n            } else {\n                that.error('Illegal message for this state: ' + msg.messageType + ' in state ' + that.state);\n            }\n        } else if (that.state === 'established') {\n            if (msg.messageType === 'OFFER') {\n                // Subsequent offer.\n                sd = {\n                    sdp: msg.sdp,\n                    type: 'offer'\n                };\n                that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd));\n\n                that.state = 'offer-received';\n                // Allow other stuff to happen, then reply.\n                that.markActionNeeded();\n            } else {\n                that.error('Illegal message for this state: ' + msg.messageType + ' in state ' + that.state);\n            }\n        }\n    };\n\n    /**\n     * Adds a stream - this causes signalling to happen, if needed.\n     * @param {MediaStream} stream The outgoing MediaStream to add.\n     */\n    that.addStream = function (stream) {\n        that.peerConnection.addStream(stream);\n        that.markActionNeeded();\n    };\n\n    /**\n     * Removes a stream.\n     * @param {MediaStream} stream The MediaStream to remove.\n     */\n    that.removeStream = function () {\n        //        var i;\n        //        for (i = 0; i < that.peerConnection.localStreams.length; ++i) {\n        //            if (that.localStreams[i] === stream) {\n        //                that.localStreams[i] = null;\n        //            }\n        //        }\n        that.markActionNeeded();\n    };\n\n    /**\n     * Closes the connection.\n     */\n    that.close = function () {\n        that.state = 'closed';\n        that.peerConnection.close();\n    };\n\n    /**\n     * Internal function: Mark that something happened.\n     */\n    that.markActionNeeded = function () {\n        that.actionNeeded = true;\n        that.doLater(function () {\n            that.onstablestate();\n        });\n    };\n\n    /**\n     * Internal function: Do something later (not on this stack).\n     * @param {function} what Callback to be executed later.\n     */\n    that.doLater = function (what) {\n        // Post an event to myself so that I get called a while later.\n        // (needs more JS/DOM info. Just call the processing function on a delay\n        // for now.)\n        window.setTimeout(what, 1);\n    };\n\n    /**\n     * Internal function called when a stable state\n     * is entered by the browser (to allow for multiple AddStream calls or\n     * other interesting actions).\n     * This function will generate an offer or answer, as needed, and send\n     * to the remote party using our onsignalingmessage function.\n     */\n    that.onstablestate = function () {\n        var mySDP;\n        if (that.actionNeeded) {\n            if (that.state === 'new' || that.state === 'established') {\n                // See if the current offer is the same as what we already sent.\n                // If not, no change is needed.\n\n                that.peerConnection.createOffer(function (sessionDescription) {\n\n                    //sessionDescription.sdp = newOffer.replace(/a=ice-options:google-ice\\r\\n/g, \"\");\n                    //sessionDescription.sdp = newOffer.replace(/a=crypto:0 AES_CM_128_HMAC_SHA1_80 inline:.*\\r\\n/g, \"a=crypto:0 AES_CM_128_HMAC_SHA1_80 inline:eUMxlV2Ib6U8qeZot/wEKHw9iMzfKUYpOPJrNnu3\\r\\n\");\n                    //sessionDescription.sdp = newOffer.replace(/a=crypto:1 AES_CM_128_HMAC_SHA1_80 inline:.*\\r\\n/g, \"a=crypto:1 AES_CM_128_HMAC_SHA1_80 inline:eUMxlV2Ib6U8qeZot/wEKHw9iMzfKUYpOPJrNnu3\\r\\n\");\n\n                    sessionDescription.sdp = setMaxBW(sessionDescription.sdp);\n                    _Logger2.default.debug(\"Changed\", sessionDescription.sdp);\n\n                    var newOffer = sessionDescription.sdp;\n\n                    if (newOffer !== that.prevOffer) {\n\n                        that.peerConnection.setLocalDescription(sessionDescription);\n\n                        that.state = 'preparing-offer';\n                        that.markActionNeeded();\n                        return;\n                    } else {\n                        _Logger2.default.debug('Not sending a new offer');\n                    }\n                }, function (err) {\n                    _Logger2.default.debug('peer connection create offer failed ', err);\n                }, that.mediaConstraints);\n            } else if (that.state === 'preparing-offer') {\n                // Don't do anything until we have the ICE candidates.\n                if (that.moreIceComing) {\n                    return;\n                }\n\n                // Now able to send the offer we've already prepared.\n                that.prevOffer = that.peerConnection.localDescription.sdp;\n                //Logger.debug(\"Sending OFFER: \" + that.prevOffer);\n                //Logger.debug('Sent SDP is ' + that.prevOffer);\n                that.sendMessage('OFFER', that.prevOffer);\n                // Not done: Retransmission on non-response.\n                that.state = 'offer-sent';\n            } else if (that.state === 'offer-received') {\n\n                that.peerConnection.createAnswer(function (sessionDescription) {\n                    that.peerConnection.setLocalDescription(sessionDescription);\n                    that.state = 'offer-received-preparing-answer';\n\n                    if (!that.iceStarted) {\n                        var now = new Date();\n                        _Logger2.default.debug(now.getTime() + ': Starting ICE in responder');\n                        that.iceStarted = true;\n                    } else {\n                        that.markActionNeeded();\n                        return;\n                    }\n                }, function (err) {\n                    _Logger2.default.debug('peer connection create answer failed ', err);\n                }, that.mediaConstraints);\n            } else if (that.state === 'offer-received-preparing-answer') {\n                if (that.moreIceComing) {\n                    return;\n                }\n\n                mySDP = that.peerConnection.localDescription.sdp;\n\n                that.sendMessage('ANSWER', mySDP);\n                that.state = 'established';\n            } else {\n                that.error('Dazed and confused in state ' + that.state + ', stopping here');\n            }\n            that.actionNeeded = false;\n        }\n    };\n\n    /**\n     * Internal function to send an \"OK\" message.\n     */\n    that.sendOK = function () {\n        that.sendMessage('OK');\n    };\n\n    /**\n     * Internal function to send a signalling message.\n     * @param {string} operation What operation to signal.\n     * @param {string} sdp SDP message body.\n     */\n    that.sendMessage = function (operation, sdp) {\n        var roapMessage = {};\n        roapMessage.messageType = operation;\n        roapMessage.sdp = sdp; // may be null or undefined\n        if (operation === 'OFFER') {\n            roapMessage.offererSessionId = that.sessionId;\n            roapMessage.answererSessionId = that.otherSessionId; // may be null\n            roapMessage.seq = that.sequenceNumber += 1;\n            // The tiebreaker needs to be neither 0 nor 429496725.\n            roapMessage.tiebreaker = Math.floor(Math.random() * 429496723 + 1);\n        } else {\n            roapMessage.offererSessionId = that.incomingMessage.offererSessionId;\n            roapMessage.answererSessionId = that.sessionId;\n            roapMessage.seq = that.incomingMessage.seq;\n        }\n        that.onsignalingmessage(JSON.stringify(roapMessage));\n    };\n\n    /**\n     * Internal something-bad-happened function.\n     * @param {string} text What happened - suitable for logging.\n     */\n    that.error = function (text) {\n        throw 'Error in RoapOnJsep: ' + text;\n    };\n\n    that.sessionId = that.roapSessionId += 1;\n    that.sequenceNumber = 0; // Number of last ROAP message sent. Starts at 1.\n    that.actionNeeded = false;\n    that.iceStarted = false;\n    that.moreIceComing = true;\n    that.iceCandidateCount = 0;\n    that.onsignalingmessage = spec.callback;\n\n    that.peerConnection.onopen = function () {\n        if (that.onopen) {\n            that.onopen();\n        }\n    };\n\n    that.peerConnection.onaddstream = function (stream) {\n        if (that.onaddstream) {\n            that.onaddstream(stream);\n        }\n    };\n\n    that.peerConnection.onremovestream = function (stream) {\n        if (that.onremovestream) {\n            that.onremovestream(stream);\n        }\n    };\n\n    that.peerConnection.oniceconnectionstatechange = function (e) {\n        if (that.oniceconnectionstatechange) {\n            that.oniceconnectionstatechange(e.currentTarget.iceConnectionState);\n        }\n    };\n\n    // Variables that are part of the public interface of PeerConnection\n    // in the 28 January 2012 version of the webrtc specification.\n    that.onaddstream = null;\n    that.onremovestream = null;\n    that.state = 'new';\n    // Auto-fire next events.\n    that.markActionNeeded();\n    return that;\n};\n\nexports.default = ChromeCanaryStack;\n\n/***/ }),\n/* 27 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _Logger = __webpack_require__(0);\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar ChromeStableStack = function ChromeStableStack(spec) {\n    \"use strict\";\n\n    var that = {},\n\n    //WebkitRTCPeerConnection = webkitRTCPeerConnection;\n    WebkitRTCPeerConnection = RTCPeerConnection;\n    that.isSubscriber = spec.isSubscriber;\n    that.pc_config = {\n        \"iceServers\": []\n    };\n\n    that.con = { 'optional': [{ 'DtlsSrtpKeyAgreement': true }] };\n\n    if (spec.iceServers instanceof Array) {\n        that.pc_config.iceServers = spec.iceServers;\n    } else {\n        if (spec.stunServerUrl) {\n            if (spec.stunServerUrl instanceof Array) {\n                spec.stunServerUrl.map(function (url) {\n                    if (typeof url === 'string' && url !== '') {\n                        that.pc_config.iceServers.push({ \"url\": url });\n                    }\n                });\n            } else if (typeof spec.stunServerUrl === 'string' && spec.stunServerUrl !== '') {\n                that.pc_config.iceServers.push({ \"url\": spec.stunServerUrl });\n            }\n        }\n\n        if (spec.turnServer) {\n            if (spec.turnServer instanceof Array) {\n                spec.turnServer.map(function (turn) {\n                    if (typeof turn.url === 'string' && turn.url !== '') {\n                        that.pc_config.iceServers.push({\n                            \"username\": turn.username,\n                            \"credential\": turn.password,\n                            \"url\": turn.url\n                        });\n                    }\n                });\n            } else if (typeof spec.turnServer.url === 'string' && spec.turnServer.url !== '') {\n                that.pc_config.iceServers.push({\n                    \"username\": spec.turnServer.username,\n                    \"credential\": spec.turnServer.password,\n                    \"url\": spec.turnServer.url\n                });\n            }\n        }\n    }\n\n    if (spec.audio === undefined) {\n        spec.audio = true;\n    }\n\n    if (spec.video === undefined) {\n        spec.video = true;\n    }\n\n    that.mediaConstraints = {\n        'mandatory': {\n            'OfferToReceiveVideo': spec.video,\n            'OfferToReceiveAudio': spec.audio\n        }\n    };\n\n    that.roapSessionId = 103;\n\n    that.peerConnection = new WebkitRTCPeerConnection({ \"iceServers\": [{ urls: [\"stun:webcs.agora.io:3478\"] }] }, that.con);\n\n    that.peerConnection.onicecandidate = function (event) {\n        //Logger.debug(\"PeerConnection: \", spec.session_id);\n        var localsdp, hassrflxcand, hashostcand;\n        localsdp = that.peerConnection.localDescription.sdp;\n        hassrflxcand = localsdp.match(/a=candidate:.+typ\\ssrflx.+\\r\\n/);\n        hashostcand = localsdp.match(/a=candidate:.+typ\\shost.+\\r\\n/);\n        if (that.iceCandidateCount === 0) {\n            that.timeout = setTimeout(function () {\n                if (that.moreIceComing) {\n                    that.moreIceComing = false;\n                    that.markActionNeeded();\n                }\n            }, 1000);\n        }\n\n        if ((hassrflxcand !== null || hashostcand !== null) && that.ice === undefined) {\n            _Logger2.default.debug(\"srflx candidate : \" + hassrflxcand + \" host candidate : \" + hashostcand);\n            clearTimeout(that.timeout);\n            that.ice = 0;\n            that.moreIceComing = false;\n            that.markActionNeeded();\n        }\n        that.iceCandidateCount = that.iceCandidateCount + 1;\n    };\n\n    //Logger.debug(\"Created webkitRTCPeerConnnection with config \\\"\" + JSON.stringify(that.pc_config) + \"\\\".\");\n\n    var filterSdp = function filterSdp(sdp) {\n        var a, r;\n        if (spec.screen) {\n            sdp = sdp.replace(\"a=x-google-flag:conference\\r\\n\", '');\n        }\n        return sdp;\n    };\n\n    var setMaxBW = function setMaxBW(sdp) {\n        var a, r;\n        if (spec.minVideoBW && spec.maxVideoBW) {\n            a = sdp.match(/m=video.*\\r\\n/);\n            r = a[0] + \"b=AS:\" + spec.maxVideoBW + \"\\r\\n\";\n            //if (spec.mode === 'live') { //h.264\n            //  r = a[0] + \"a=fmtp:107 x-google-min-bitrate=\" + spec.minVideoBW + \"; x-google-max-bitrate=\" + spec.maxVideoBW + \"\\r\\n\";\n            //} else { //vp8\n            //  r = a[0] + \"a=fmtp:100 x-google-min-bitrate=\" + spec.minVideoBW + \"; x-google-max-bitrate=\" + spec.maxVideoBW + \"\\r\\n\";\n            //}\n            sdp = sdp.replace(a[0], r);\n            _Logger2.default.debug('Set Video Bitrate - min:' + spec.minVideoBW + \" max:\" + spec.maxVideoBW);\n        }\n\n        if (spec.maxAudioBW) {\n            a = sdp.match(/m=audio.*\\r\\n/);\n            r = a[0] + \"b=AS:\" + spec.maxAudioBW + \"\\r\\n\";\n            sdp = sdp.replace(a[0], r);\n        }\n\n        return sdp;\n    };\n\n    /**\n     * This function processes signalling messages from the other side.\n     * @param {string} msgstring JSON-formatted string containing a ROAP message.\n     */\n    that.processSignalingMessage = function (msgstring) {\n        // Offer: Check for glare and resolve.\n        // Answer/OK: Remove retransmit for the msg this is an answer to.\n        // Send back \"OK\" if this was an Answer.\n        //Logger.debug('Activity on conn ' + that.sessionId);\n        var msg = JSON.parse(msgstring),\n            sd;\n        that.incomingMessage = msg;\n\n        if (that.state === 'new') {\n            if (msg.messageType === 'OFFER') {\n                // Initial offer.\n                sd = {\n                    sdp: msg.sdp,\n                    type: 'offer'\n                };\n                that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd));\n\n                that.state = 'offer-received';\n                // Allow other stuff to happen, then reply.\n                that.markActionNeeded();\n            } else {\n                that.error('Illegal message for this state: ' + msg.messageType + ' in state ' + that.state);\n            }\n        } else if (that.state === 'offer-sent') {\n            if (msg.messageType === 'ANSWER') {\n\n                sd = {\n                    sdp: msg.sdp,\n                    type: 'answer'\n                };\n                //Logger.debug(\"Received ANSWER: \", sd.sdp);\n                sd.sdp = filterSdp(sd.sdp);\n                sd.sdp = setMaxBW(sd.sdp);\n\n                that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd));\n                that.sendOK();\n                that.state = 'established';\n            } else if (msg.messageType === 'pr-answer') {\n                sd = {\n                    sdp: msg.sdp,\n                    type: 'pr-answer'\n                };\n                that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd));\n\n                // No change to state, and no response.\n            } else if (msg.messageType === 'offer') {\n                // Glare processing.\n                that.error('Not written yet');\n            } else {\n                that.error('Illegal message for this state: ' + msg.messageType + ' in state ' + that.state);\n            }\n        } else if (that.state === 'established') {\n            if (msg.messageType === 'OFFER') {\n                // Subsequent offer.\n                sd = {\n                    sdp: msg.sdp,\n                    type: 'offer'\n                };\n                that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd));\n\n                that.state = 'offer-received';\n                // Allow other stuff to happen, then reply.\n                that.markActionNeeded();\n            } else {\n                that.error('Illegal message for this state: ' + msg.messageType + ' in state ' + that.state);\n            }\n        }\n    };\n\n    that.getStatsRate = function (callback) {\n        that.getStats(function (stats) {\n            callback(stats);\n        });\n    };\n\n    that.getStats = function (callback) {\n        that.peerConnection.getStats(null, function (stats) {\n            var filterList = [];\n            var originList = [];\n            var timeStamp = null;\n            Object.keys(stats).forEach(function (stat) {\n                var report = stats[stat];\n                originList.push(report);\n                if (report.type === 'ssrc' || report.type === 'VideoBwe') {\n                    timeStamp = report.timestamp;\n                    filterList.push(report);\n                }\n            });\n            filterList.push({\n                id: \"time\",\n                startTime: that.connectedTime,\n                timestamp: timeStamp || new Date()\n            });\n            callback(filterList, originList);\n        });\n    };\n\n    /**\n     * Adds a stream - this causes signalling to happen, if needed.\n     * @param {MediaStream} stream The outgoing MediaStream to add.\n     */\n    that.addStream = function (stream) {\n        that.peerConnection.addStream(stream);\n        that.markActionNeeded();\n    };\n\n    /**\n     * Removes a stream.\n     * @param {MediaStream} stream The MediaStream to remove.\n     */\n    that.removeStream = function () {\n        //        var i;\n        //        for (i = 0; i < that.peerConnection.localStreams.length; ++i) {\n        //            if (that.localStreams[i] === stream) {\n        //                that.localStreams[i] = null;\n        //            }\n        //        }\n        that.markActionNeeded();\n    };\n\n    /**\n     * Closes the connection.\n     */\n    that.close = function () {\n        that.state = 'closed';\n        that.peerConnection.close();\n    };\n\n    /**\n     * Internal function: Mark that something happened.\n     */\n    that.markActionNeeded = function () {\n        that.actionNeeded = true;\n        that.doLater(function () {\n            that.onstablestate();\n        });\n    };\n\n    /**\n     * Internal function: Do something later (not on this stack).\n     * @param {function} what Callback to be executed later.\n     */\n    that.doLater = function (what) {\n        // Post an event to myself so that I get called a while later.\n        // (needs more JS/DOM info. Just call the processing function on a delay\n        // for now.)\n        window.setTimeout(what, 1);\n    };\n\n    /**\n     * Internal function called when a stable state\n     * is entered by the browser (to allow for multiple AddStream calls or\n     * other interesting actions).\n     * This function will generate an offer or answer, as needed, and send\n     * to the remote party using our onsignalingmessage function.\n     */\n    that.onstablestate = function () {\n        var mySDP;\n        if (that.actionNeeded) {\n            if (that.state === 'new' || that.state === 'established') {\n                // See if the current offer is the same as what we already sent.\n                // If not, no change is needed.\n\n                that.peerConnection.createOffer(function (sessionDescription) {\n\n                    //sessionDescription.sdp = newOffer.replace(/a=ice-options:google-ice\\r\\n/g, \"\");\n                    //sessionDescription.sdp = newOffer.replace(/a=crypto:0 AES_CM_128_HMAC_SHA1_80 inline:.*\\r\\n/g, \"a=crypto:0 AES_CM_128_HMAC_SHA1_80 inline:eUMxlV2Ib6U8qeZot/wEKHw9iMzfKUYpOPJrNnu3\\r\\n\");\n                    //sessionDescription.sdp = newOffer.replace(/a=crypto:1 AES_CM_128_HMAC_SHA1_80 inline:.*\\r\\n/g, \"a=crypto:1 AES_CM_128_HMAC_SHA1_80 inline:eUMxlV2Ib6U8qeZot/wEKHw9iMzfKUYpOPJrNnu3\\r\\n\");\n\n                    sessionDescription.sdp = setMaxBW(sessionDescription.sdp);\n                    //Logger.debug(\"Changed\", sessionDescription.sdp);\n\n                    var newOffer = sessionDescription.sdp;\n\n                    if (newOffer !== that.prevOffer) {\n\n                        that.peerConnection.setLocalDescription(sessionDescription);\n\n                        that.state = 'preparing-offer';\n                        that.markActionNeeded();\n                        return;\n                    } else {\n                        _Logger2.default.debug('Not sending a new offer');\n                    }\n                }, function (err) {\n                    _Logger2.default.debug('peer connection create offer failed ', err);\n                }, that.mediaConstraints);\n            } else if (that.state === 'preparing-offer') {\n                // Don't do anything until we have the ICE candidates.\n                if (that.moreIceComing) {\n                    return;\n                }\n\n                // Now able to send the offer we've already prepared.\n                that.prevOffer = that.peerConnection.localDescription.sdp;\n                that.prevOffer = that.prevOffer.replace(/a=candidate:.+typ\\shost.+\\r\\n/g, \"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\\r\\n\");\n                //Logger.debug(\"Sending OFFER: \" + that.prevOffer);\n                //Logger.debug('Sent SDP is ' + that.prevOffer);\n                that.sendMessage('OFFER', that.prevOffer);\n                // Not done: Retransmission on non-response.\n                that.state = 'offer-sent';\n            } else if (that.state === 'offer-received') {\n\n                that.peerConnection.createAnswer(function (sessionDescription) {\n                    that.peerConnection.setLocalDescription(sessionDescription);\n                    that.state = 'offer-received-preparing-answer';\n\n                    if (!that.iceStarted) {\n                        var now = new Date();\n                        _Logger2.default.debug(now.getTime() + ': Starting ICE in responder');\n                        that.iceStarted = true;\n                    } else {\n                        that.markActionNeeded();\n                        return;\n                    }\n                }, function (err) {\n                    _Logger2.default.debug('peer connection create answer failed ', err);\n                }, that.mediaConstraints);\n            } else if (that.state === 'offer-received-preparing-answer') {\n                if (that.moreIceComing) {\n                    return;\n                }\n\n                mySDP = that.peerConnection.localDescription.sdp;\n\n                that.sendMessage('ANSWER', mySDP);\n                that.state = 'established';\n            } else {\n                that.error('Dazed and confused in state ' + that.state + ', stopping here');\n            }\n            that.actionNeeded = false;\n        }\n    };\n\n    /**\n     * Internal function to send an \"OK\" message.\n     */\n    that.sendOK = function () {\n        that.sendMessage('OK');\n    };\n\n    /**\n     * Internal function to send a signalling message.\n     * @param {string} operation What operation to signal.\n     * @param {string} sdp SDP message body.\n     */\n    that.sendMessage = function (operation, sdp) {\n        var roapMessage = {};\n        roapMessage.messageType = operation;\n        roapMessage.sdp = sdp; // may be null or undefined\n        if (operation === 'OFFER') {\n            roapMessage.offererSessionId = that.sessionId;\n            roapMessage.answererSessionId = that.otherSessionId; // may be null\n            roapMessage.seq = that.sequenceNumber += 1;\n            // The tiebreaker needs to be neither 0 nor 429496725.\n            roapMessage.tiebreaker = Math.floor(Math.random() * 429496723 + 1);\n        } else {\n            roapMessage.offererSessionId = that.incomingMessage.offererSessionId;\n            roapMessage.answererSessionId = that.sessionId;\n            roapMessage.seq = that.incomingMessage.seq;\n        }\n        that.onsignalingmessage(JSON.stringify(roapMessage));\n    };\n\n    /**\n     * Internal something-bad-happened function.\n     * @param {string} text What happened - suitable for logging.\n     */\n    that.error = function (text) {\n        throw 'Error in RoapOnJsep: ' + text;\n    };\n\n    that.sessionId = that.roapSessionId += 1;\n    that.sequenceNumber = 0; // Number of last ROAP message sent. Starts at 1.\n    that.actionNeeded = false;\n    that.iceStarted = false;\n    that.moreIceComing = true;\n    that.iceCandidateCount = 0;\n    that.onsignalingmessage = spec.callback;\n\n    //that.peerConnection.onopen = function () {\n    //    if (that.onopen) {\n    //        that.onopen();\n    //    }\n    //};\n\n    that.peerConnection.ontrack = function (evt) {\n        if (that.onaddstream) {\n            that.onaddstream(evt, \"ontrack\");\n            that.peerConnection.onaddstream = null;\n        }\n    };\n\n    that.peerConnection.onaddstream = function (evt) {\n        if (that.onaddstream) {\n            that.onaddstream(evt, \"onaddstream\");\n            that.peerConnection.ontrack = null;\n        }\n    };\n\n    that.peerConnection.onremovestream = function (stream) {\n        if (that.onremovestream) {\n            that.onremovestream(stream);\n        }\n    };\n\n    that.peerConnection.oniceconnectionstatechange = function (e) {\n        if (e.currentTarget.iceConnectionState === \"connected\") {\n            that.connectedTime = new Date();\n        }\n\n        if (that.oniceconnectionstatechange) {\n            that.oniceconnectionstatechange(e.currentTarget.iceConnectionState);\n        }\n    };\n\n    // Variables that are part of the public interface of PeerConnection\n    // in the 28 January 2012 version of the webrtc specification.\n    that.onaddstream = null;\n    that.onremovestream = null;\n    that.state = 'new';\n    // Auto-fire next events.\n    that.markActionNeeded();\n    return that;\n};\n\nexports.default = ChromeStableStack;\n\n/***/ }),\n/* 28 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _Logger = __webpack_require__(0);\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar SafariStableStack = function SafariStableStack(spec) {\n    \"use strict\";\n\n    var that = {},\n\n    //WebkitRTCPeerConnection = webkitRTCPeerConnection;\n    WebkitRTCPeerConnection = RTCPeerConnection;\n\n    that.isSubscriber = spec.isSubscriber;\n    that.pc_config = {\n        \"iceServers\": [{ urls: [\"stun:72.251.224.27:3478\"] }],\n        \"bundlePolicy\": \"max-bundle\"\n    };\n\n    that.con = { 'optional': [{ 'DtlsSrtpKeyAgreement': true }] };\n\n    if (spec.iceServers instanceof Array) {\n        that.pc_config.iceServers = spec.iceServers;\n    } else {\n        if (spec.stunServerUrl) {\n            if (spec.stunServerUrl instanceof Array) {\n                spec.stunServerUrl.map(function (url) {\n                    if (typeof url === 'string' && url !== '') {\n                        that.pc_config.iceServers.push({ \"url\": url });\n                    }\n                });\n            } else if (typeof spec.stunServerUrl === 'string' && spec.stunServerUrl !== '') {\n                that.pc_config.iceServers.push({ \"url\": spec.stunServerUrl });\n            }\n        }\n\n        if (spec.turnServer) {\n            if (spec.turnServer instanceof Array) {\n                spec.turnServer.map(function (turn) {\n                    if (typeof turn.url === 'string' && turn.url !== '') {\n                        that.pc_config.iceServers.push({\n                            \"username\": turn.username,\n                            \"credential\": turn.password,\n                            \"url\": turn.url\n                        });\n                    }\n                });\n            } else if (typeof spec.turnServer.url === 'string' && spec.turnServer.url !== '') {\n                that.pc_config.iceServers.push({\n                    \"username\": spec.turnServer.username,\n                    \"credential\": spec.turnServer.password,\n                    \"url\": spec.turnServer.url\n                });\n            }\n        }\n    }\n\n    if (spec.audio === undefined) {\n        spec.audio = true;\n    }\n\n    if (spec.video === undefined) {\n        spec.video = true;\n    }\n\n    that.mediaConstraints = {\n        'mandatory': {\n            'OfferToReceiveVideo': spec.video,\n            'OfferToReceiveAudio': spec.audio\n        }\n    };\n\n    that.roapSessionId = 103;\n\n    that.peerConnection = new RTCPeerConnection({ \"iceServers\": [{ urls: [\"stun:webcs.agora.io:3478\", \"stun:stun.l.google.com:19302\"] }], \"bundlePolicy\": \"max-bundle\" });\n\n    that.peerConnection.onicecandidate = function (event) {\n        _Logger2.default.debug(\"PeerConnection: \", spec.session_id, event);\n        if (!event.candidate) {\n            // At the moment, we do not renegotiate when new candidates\n            // show up after the more flag has been false once.\n            _Logger2.default.debug(\"PeerConnection State: \" + that.peerConnection.iceGatheringState);\n\n            clearTimeout(that.timeout);\n            if (that.ices === undefined) {\n                that.ices = 0;\n            }\n            that.ices = that.ices + 1;\n            if (that.ices >= 1 && that.moreIceComing) {\n                that.moreIceComing = false;\n                that.markActionNeeded();\n            }\n        } else {\n            //Logger.debug(event.candidate);\n            if (that.iceCandidateCount === 0) {\n                that.timeout = setTimeout(function () {\n                    if (that.moreIceComing) {\n                        that.moreIceComing = false;\n                        that.markActionNeeded();\n                    }\n                }, 1000);\n            }\n            that.iceCandidateCount = that.iceCandidateCount + 1;\n        }\n    };\n\n    //Logger.debug(\"Created webkitRTCPeerConnnection with config \\\"\" + JSON.stringify(that.pc_config) + \"\\\".\");\n\n    var filterSdp = function filterSdp(sdp) {\n        var a, r;\n        if (spec.screen) {\n            sdp = sdp.replace(\"a=x-google-flag:conference\\r\\n\", '');\n        }\n        return sdp;\n    };\n\n    var setMaxBW = function setMaxBW(sdp) {\n        var a, r;\n        if (spec.minVideoBW && spec.maxVideoBW) {\n            a = sdp.match(/m=video.*\\r\\n/);\n            r = a[0] + \"b=AS:\" + spec.maxVideoBW + \"\\r\\n\";\n            //if (spec.mode === 'live') { //h.264\n            //  r = a[0] + \"a=fmtp:107 x-google-min-bitrate=\" + spec.minVideoBW + \"; x-google-max-bitrate=\" + spec.maxVideoBW + \"\\r\\n\";\n            //} else { //vp8\n            //  r = a[0] + \"a=fmtp:100 x-google-min-bitrate=\" + spec.minVideoBW + \"; x-google-max-bitrate=\" + spec.maxVideoBW + \"\\r\\n\";\n            //}\n            sdp = sdp.replace(a[0], r);\n            _Logger2.default.debug('Set Video Bitrate - min:' + spec.minVideoBW + \" max:\" + spec.maxVideoBW);\n        }\n\n        if (spec.maxAudioBW) {\n            a = sdp.match(/m=audio.*\\r\\n/);\n            r = a[0] + \"b=AS:\" + spec.maxAudioBW + \"\\r\\n\";\n            sdp = sdp.replace(a[0], r);\n        }\n\n        return sdp;\n    };\n\n    /**\n     * This function processes signalling messages from the other side.\n     * @param {string} msgstring JSON-formatted string containing a ROAP message.\n     */\n    that.processSignalingMessage = function (msgstring) {\n        // Offer: Check for glare and resolve.\n        // Answer/OK: Remove retransmit for the msg this is an answer to.\n        // Send back \"OK\" if this was an Answer.\n        //Logger.debug('Activity on conn ' + that.sessionId);\n        var msg = JSON.parse(msgstring),\n            sd;\n        that.incomingMessage = msg;\n\n        if (that.state === 'new') {\n            if (msg.messageType === 'OFFER') {\n                // Initial offer.\n                sd = {\n                    sdp: msg.sdp,\n                    type: 'offer'\n                };\n                that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd));\n\n                that.state = 'offer-received';\n                // Allow other stuff to happen, then reply.\n                that.markActionNeeded();\n            } else {\n                that.error('Illegal message for this state: ' + msg.messageType + ' in state ' + that.state);\n            }\n        } else if (that.state === 'offer-sent') {\n            if (msg.messageType === 'ANSWER') {\n\n                sd = {\n                    sdp: msg.sdp,\n                    type: 'answer'\n                };\n\n                //Logger.debug(\"Received ANSWER: \", sd.sdp);\n                sd.sdp = filterSdp(sd.sdp);\n                sd.sdp = setMaxBW(sd.sdp);\n                sd.sdp = sd.sdp.replace(/a=x-google-flag:conference\\r\\n/g, \"\");\n\n                that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd));\n                that.sendOK();\n                that.state = 'established';\n            } else if (msg.messageType === 'pr-answer') {\n                sd = {\n                    sdp: msg.sdp,\n                    type: 'pr-answer'\n                };\n                that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd));\n\n                // No change to state, and no response.\n            } else if (msg.messageType === 'offer') {\n                // Glare processing.\n                that.error('Not written yet');\n            } else {\n                that.error('Illegal message for this state: ' + msg.messageType + ' in state ' + that.state);\n            }\n        } else if (that.state === 'established') {\n            if (msg.messageType === 'OFFER') {\n                // Subsequent offer.\n                sd = {\n                    sdp: msg.sdp,\n                    type: 'offer'\n                };\n                that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd));\n\n                that.state = 'offer-received';\n                // Allow other stuff to happen, then reply.\n                that.markActionNeeded();\n            } else {\n                that.error('Illegal message for this state: ' + msg.messageType + ' in state ' + that.state);\n            }\n        }\n    };\n\n    var outbound_rtp_audio = {\n        id: \"\",\n        type: \"\",\n        mediaType: \"\",\n        googCodecName: \"opus\",\n        aecDivergentFilterFraction: \"0\",\n        audioInputLevel: \"0\",\n        bytesSent: \"0\",\n        packetsSent: \"0\",\n        googEchoCancellationReturnLoss: \"0\",\n        googEchoCancellationReturnLossEnhancement: \"0\"\n    };\n\n    var outbound_rtp_video = {\n        id: \"\",\n        type: \"\",\n        mediaType: \"\",\n        googCodecName: spec.codec === \"h264\" ? \"H264\" : \"VP8\",\n        bytesSent: \"0\",\n        packetsLost: \"0\",\n        packetsSent: \"0\",\n        googAdaptationChanges: \"0\",\n        googAvgEncodeMs: \"0\",\n        googEncodeUsagePercent: \"0\",\n        googFirsReceived: \"0\",\n        googFrameHeightSent: \"0\",\n        googFrameHeightInput: \"0\",\n        googFrameRateInput: \"0\",\n        googFrameRateSent: \"0\",\n        googFrameWidthSent: \"0\",\n        googFrameWidthInput: \"0\",\n        googNacksReceived: \"0\",\n        googPlisReceived: \"0\",\n        googRtt: \"0\",\n        googFramesEncoded: \"0\"\n    };\n\n    var inbound_rtp_audio = {\n        id: \"\",\n        type: \"\",\n        mediaType: \"\",\n        audioOutputLevel: \"0\",\n        bytesReceived: \"0\",\n        packetsLost: \"0\",\n        packetsReceived: \"0\",\n        googAccelerateRate: \"0\",\n        googCurrentDelayMs: \"0\",\n        googDecodingCNG: \"0\",\n        googDecodingCTN: \"0\",\n        googDecodingCTSG: \"0\",\n        googDecodingNormal: \"0\",\n        googDecodingPLC: \"0\",\n        googDecodingPLCCNG: \"0\",\n        googExpandRate: \"0\",\n        googJitterBufferMs: \"0\",\n        googJitterReceived: \"0\",\n        googPreemptiveExpandRate: \"0\",\n        googPreferredJitterBufferMs: \"0\",\n        googSecondaryDecodedRate: \"0\",\n        googSpeechExpandRate: \"0\"\n    };\n\n    var inbound_rtp_video = {\n        id: \"\",\n        type: \"\",\n        mediaType: \"\",\n        googTargetDelayMs: \"0\",\n        packetsLost: \"0\",\n        googDecodeMs: \"0\",\n        googMaxDecodeMs: \"0\",\n        googRenderDelayMs: \"0\",\n        googFrameWidthReceived: \"0\",\n        googFrameHeightReceived: \"0\",\n        googFrameRateReceived: \"0\",\n        googFrameRateDecoded: \"0\",\n        googFrameRateOutput: \"0\",\n        googFramesDecoded: \"0\",\n        googFrameReceived: \"0\",\n\n        googJitterBufferMs: \"0\",\n        googCurrentDelayMs: \"0\",\n        googMinPlayoutDelayMs: \"0\",\n        googNacksSent: \"0\",\n        googPlisSent: \"0\",\n        googFirsSent: \"0\",\n        bytesReceived: \"0\",\n        packetsReceived: \"0\"\n    };\n\n    var bweforvideo = {\n        id: \"bweforvideo\",\n        type: \"VideoBwe\",\n        googAvailableSendBandwidth: \"0\",\n        googAvailableReceiveBandwidth: \"0\",\n        googActualEncBitrate: \"0\",\n        googRetransmitBitrate: \"0\",\n        googTargetEncBitrate: \"0\",\n        googBucketDelay: \"0\",\n        googTransmitBitrate: \"0\"\n    };\n\n    var lastFramesEncoded = 0;\n    var lastFramesDecoded = 0;\n    var lastFramesReceived = 0;\n\n    that.getStatsRate = function (callback) {\n        that.getStats(function (stats) {\n            stats.forEach(function (report) {\n                if (report.type === 'outbound-rtp' && report.mediaType === 'video') {\n                    if (report.googFramesEncoded) {\n                        report.googFrameRateSent = ((report.googFramesEncoded - lastFramesEncoded) / 3).toString();\n                        lastFramesEncoded = report.googFramesEncoded;\n                    }\n                }\n                if (report.type === 'inbound-rtp' && report.id.indexOf(\"55543\") != -1) {\n                    // if googFrameRateReceived or googFrameRateDecoded is \"null\" or \"undefined\", it will sent \"NAN\" to server and make server crash\n                    if (report.googFrameRateReceived) {\n                        report.googFrameRateReceived = ((report.googFrameReceived - lastFramesReceived) / 3).toString();\n                        lastFramesReceived = report.googFrameReceived;\n                    }\n                    if (report.googFrameRateDecoded) {\n                        report.googFrameRateDecoded = ((report.googFramesDecoded - lastFramesDecoded) / 3).toString();\n                        lastFramesDecoded = report.googFramesDecoded;\n                    }\n                }\n            });\n            callback(stats);\n        });\n    };\n\n    that.getStats = function (callback) {\n        var originList = [];\n        that.peerConnection.getStats().then(function (stats) {\n            var list = [];\n            stats.forEach(function (report) {\n                originList.push(report);\n                if (report.type === 'outbound-rtp' && report.mediaType === 'audio') {\n                    outbound_rtp_audio.id = report.id;\n                    outbound_rtp_audio.type = report.type;\n                    outbound_rtp_audio.mediaType = report.mediaType;\n                    outbound_rtp_audio.bytesSent = report.bytesSent ? report.bytesSent + '' : '0';\n                    outbound_rtp_audio.packetsSent = report.packetsSent ? report.packetsSent + '' : '0';\n                }\n                if (report.type === 'outbound-rtp' && report.mediaType === 'video') {\n                    outbound_rtp_video.id = report.id;\n                    outbound_rtp_video.type = report.type;\n                    outbound_rtp_video.mediaType = report.mediaType;\n                    outbound_rtp_video.bytesSent = report.bytesSent ? report.bytesSent + '' : '0';\n                    outbound_rtp_video.packetsSent = report.packetsSent ? report.packetsSent + '' : '0';\n                    outbound_rtp_video.googPlisReceived = report.pliCount ? report.pliCount + '' : '0';\n                    outbound_rtp_video.googNacksReceived = report.nackCount ? report.nackCount + '' : '0';\n                    outbound_rtp_video.googFirsReceived = report.firCount ? report.firCount + '' : '0';\n                    outbound_rtp_video.googFramesEncoded = report.framesEncoded ? report.framesEncoded + '' : '0';\n                }\n                if (report.type === 'inbound-rtp' && report.id.indexOf(\"44444\") != -1) {\n                    inbound_rtp_audio.id = report.id;\n                    inbound_rtp_audio.type = report.type;\n                    inbound_rtp_audio.mediaType = \"audio\";\n                    inbound_rtp_audio.packetsReceived = report.packetsReceived ? report.packetsReceived + '' : '0';\n                    inbound_rtp_audio.bytesReceived = report.bytesReceived ? report.bytesReceived + '' : '0';\n                    inbound_rtp_audio.packetsLost = report.packetsLost ? report.packetsLost + '' : '0';\n                    inbound_rtp_audio.packetsReceived = report.packetsReceived ? report.packetsReceived + '' : '0';\n                    inbound_rtp_audio.googJitterReceived = report.jitter ? report.jitter + '' : '0';\n                }\n                if (report.type === 'inbound-rtp' && report.id.indexOf(\"55543\") != -1) {\n                    inbound_rtp_video.id = report.id;\n                    inbound_rtp_video.type = report.type;\n                    inbound_rtp_video.mediaType = \"video\";\n                    inbound_rtp_video.packetsReceived = report.packetsReceived ? report.packetsReceived + '' : '0';\n                    inbound_rtp_video.bytesReceived = report.bytesReceived ? report.bytesReceived + '' : '0';\n                    inbound_rtp_video.packetsLost = report.packetsLost ? report.packetsLost + '' : '0';\n                    inbound_rtp_video.googJitterBufferMs = report.jitter ? report.jitter + '' : '0';\n                    inbound_rtp_video.googNacksSent = report.nackCount ? report.nackCount + '' : '0';\n                    inbound_rtp_video.googPlisSent = report.pliCount ? report.pliCount + '' : '0';\n                    inbound_rtp_video.googFirsSent = report.firCount ? report.firCount + '' : '0';\n                }\n                if (report.type === 'track' && report.id.indexOf(\"55543\") != -1) {\n                    inbound_rtp_video.googFrameWidthReceived = report.frameWidth ? report.frameWidth + '' : '0';\n                    inbound_rtp_video.googFrameHeightReceived = report.frameHeight ? report.frameHeight + '' : '0';\n                    inbound_rtp_video.googFrameReceived = report.framesReceived ? report.framesReceived + '' : '0';\n                    inbound_rtp_video.googFramesDecoded = report.framesDecoded ? report.framesDecoded + '' : '0';\n                }\n                if (report.type === 'track' && report.id.indexOf(\"44444\") != -1) {\n                    inbound_rtp_audio.audioOutputLevel = report.audioLevel + \"\";\n                    outbound_rtp_audio.audioInputLevel = report.audioLevel + \"\";\n                }\n                if (report.type === 'candidate-pair') {\n                    if (report.availableIncomingBitrate == 0) {\n                        bweforvideo.googAvailableSendBandwidth = report.availableOutgoingBitrate + \"\";\n                    } else {\n                        bweforvideo.googAvailableReceiveBandwidth = report.availableIncomingBitrate + \"\";\n                    }\n                }\n            });\n            var filterList = [bweforvideo, outbound_rtp_audio, outbound_rtp_video, inbound_rtp_audio, inbound_rtp_video];\n            filterList.push({\n                id: \"time\",\n                startTime: that.connectedTime,\n                timestamp: new Date()\n            });\n            callback(filterList, originList);\n        }).catch(function (error) {\n            console.error(error);\n        });\n    };\n\n    /**\n     * Adds a stream - this causes signalling to happen, if needed.\n     * @param {MediaStream} stream The outgoing MediaStream to add.\n     */\n    that.addStream = function (stream) {\n        if (window.navigator.userAgent.indexOf(\"Safari\") > -1 && navigator.userAgent.indexOf(\"Chrome\") === -1) {\n            stream.getTracks().forEach(function (track) {\n                return that.peerConnection.addTrack(track, stream);\n            });\n        } else {\n            that.peerConnection.addStream(stream);\n        }\n        that.markActionNeeded();\n    };\n\n    /**\n     * Removes a stream.\n     * @param {MediaStream} stream The MediaStream to remove.\n     */\n    that.removeStream = function () {\n        //        var i;\n        //        for (i = 0; i < that.peerConnection.localStreams.length; ++i) {\n        //            if (that.localStreams[i] === stream) {\n        //                that.localStreams[i] = null;\n        //            }\n        //        }\n        that.markActionNeeded();\n    };\n\n    /**\n     * Closes the connection.\n     */\n    that.close = function () {\n        that.state = 'closed';\n        that.peerConnection.close();\n    };\n\n    /**\n     * Internal function: Mark that something happened.\n     */\n    that.markActionNeeded = function () {\n        that.actionNeeded = true;\n        that.doLater(function () {\n            that.onstablestate();\n        });\n    };\n\n    /**\n     * Internal function: Do something later (not on this stack).\n     * @param {function} what Callback to be executed later.\n     */\n    that.doLater = function (what) {\n        // Post an event to myself so that I get called a while later.\n        // (needs more JS/DOM info. Just call the processing function on a delay\n        // for now.)\n        window.setTimeout(what, 1);\n    };\n\n    /**\n     * Internal function called when a stable state\n     * is entered by the browser (to allow for multiple AddStream calls or\n     * other interesting actions).\n     * This function will generate an offer or answer, as needed, and send\n     * to the remote party using our onsignalingmessage function.\n     */\n    that.onstablestate = function () {\n        var mySDP;\n        if (that.actionNeeded) {\n            if (that.state === 'new' || that.state === 'established') {\n                // See if the current offer is the same as what we already sent.\n                // If not, no change is needed.\n\n                if (spec.isSubscriber && window.navigator.userAgent.indexOf(\"Safari\") > -1 && navigator.userAgent.indexOf(\"Chrome\") === -1) {\n                    var audioReceiver = that.peerConnection.addTransceiver(\"audio\");\n                    var videoReceiver = that.peerConnection.addTransceiver(\"video\");\n                    audioReceiver.setDirection(\"recvonly\");\n                    videoReceiver.setDirection(\"recvonly\");\n                }\n                that.peerConnection.createOffer(that.mediaConstraints).then(function (sessionDescription) {\n                    sessionDescription.sdp = setMaxBW(sessionDescription.sdp);\n\n                    if (!spec.isSubscriber) {\n                        // Solve the video orientation issue between iOS Safari and Firefox.\n                        sessionDescription.sdp = sessionDescription.sdp.replace(/a=extmap:4 urn:3gpp:video-orientation\\r\\n/g, \"\");\n                    }\n\n                    //Logger.debug(\"Offer\", sessionDescription.sdp);\n\n                    var newOffer = sessionDescription.sdp;\n\n                    if (newOffer !== that.prevOffer) {\n\n                        that.peerConnection.setLocalDescription(sessionDescription);\n\n                        that.state = 'preparing-offer';\n                        that.markActionNeeded();\n                        return;\n                    } else {\n                        _Logger2.default.debug('Not sending a new offer');\n                    }\n                }).catch(function (err) {\n                    _Logger2.default.debug('peer connection create offer failed ', err);\n                });\n            } else if (that.state === 'preparing-offer') {\n                // Don't do anything until we have the ICE candidates.\n                if (that.moreIceComing) {\n                    return;\n                }\n\n                // Now able to send the offer we've already prepared.\n                that.prevOffer = that.peerConnection.localDescription.sdp;\n                //Logger.debug(\"Sending OFFER: \" + that.prevOffer);\n                that.sendMessage('OFFER', that.prevOffer);\n                // Not done: Retransmission on non-response.\n                that.state = 'offer-sent';\n            } else if (that.state === 'offer-received') {\n\n                that.peerConnection.createAnswer(function (sessionDescription) {\n                    that.peerConnection.setLocalDescription(sessionDescription);\n                    that.state = 'offer-received-preparing-answer';\n\n                    if (!that.iceStarted) {\n                        var now = new Date();\n                        _Logger2.default.debug(now.getTime() + ': Starting ICE in responder');\n                        that.iceStarted = true;\n                    } else {\n                        that.markActionNeeded();\n                        return;\n                    }\n                }, function (err) {\n                    _Logger2.default.debug('peer connection create answer failed ', err);\n                }, that.mediaConstraints);\n            } else if (that.state === 'offer-received-preparing-answer') {\n                if (that.moreIceComing) {\n                    return;\n                }\n\n                mySDP = that.peerConnection.localDescription.sdp;\n\n                that.sendMessage('ANSWER', mySDP);\n                that.state = 'established';\n            } else {\n                that.error('Dazed and confused in state ' + that.state + ', stopping here');\n            }\n            that.actionNeeded = false;\n        }\n    };\n\n    /**\n     * Internal function to send an \"OK\" message.\n     */\n    that.sendOK = function () {\n        that.sendMessage('OK');\n    };\n\n    /**\n     * Internal function to send a signalling message.\n     * @param {string} operation What operation to signal.\n     * @param {string} sdp SDP message body.\n     */\n    that.sendMessage = function (operation, sdp) {\n        var roapMessage = {};\n        roapMessage.messageType = operation;\n        roapMessage.sdp = sdp; // may be null or undefined\n        if (operation === 'OFFER') {\n            roapMessage.offererSessionId = that.sessionId;\n            roapMessage.answererSessionId = that.otherSessionId; // may be null\n            roapMessage.seq = that.sequenceNumber += 1;\n            // The tiebreaker needs to be neither 0 nor 429496725.\n            roapMessage.tiebreaker = Math.floor(Math.random() * 429496723 + 1);\n        } else {\n            roapMessage.offererSessionId = that.incomingMessage.offererSessionId;\n            roapMessage.answererSessionId = that.sessionId;\n            roapMessage.seq = that.incomingMessage.seq;\n        }\n        that.onsignalingmessage(JSON.stringify(roapMessage));\n    };\n\n    /**\n     * Internal something-bad-happened function.\n     * @param {string} text What happened - suitable for logging.\n     */\n    that.error = function (text) {\n        throw 'Error in RoapOnJsep: ' + text;\n    };\n\n    that.sessionId = that.roapSessionId += 1;\n    that.sequenceNumber = 0; // Number of last ROAP message sent. Starts at 1.\n    that.actionNeeded = false;\n    that.iceStarted = false;\n    that.moreIceComing = true;\n    that.iceCandidateCount = 0;\n    that.onsignalingmessage = spec.callback;\n\n    that.peerConnection.ontrack = function (evt) {\n        if (that.onaddstream) {\n            that.onaddstream(evt, \"ontrack\");\n        }\n    };\n\n    that.peerConnection.onremovestream = function (stream) {\n        if (that.onremovestream) {\n            that.onremovestream(stream);\n        }\n    };\n\n    that.peerConnection.oniceconnectionstatechange = function (e) {\n        if (e.currentTarget.iceConnectionState === \"connected\") {\n            that.connectedTime = new Date();\n        }\n\n        if (that.oniceconnectionstatechange) {\n            that.oniceconnectionstatechange(e.currentTarget.iceConnectionState);\n        }\n    };\n\n    // Variables that are part of the public interface of PeerConnection\n    // in the 28 January 2012 version of the webrtc specification.\n    that.onaddstream = null;\n    that.onremovestream = null;\n    that.state = 'new';\n    // Auto-fire next events.\n    that.markActionNeeded();\n    return that;\n};\n\nexports.default = SafariStableStack;\n\n/***/ }),\n/* 29 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar FcStack = function FcStack() {\n  \"use strict\";\n\n  var that = {};\n  that.addStream = function () {};\n\n  return that;\n};\n\nexports.default = FcStack;\n\n/***/ }),\n/* 30 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _Logger = __webpack_require__(0);\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar FirefoxStack = function FirefoxStack(spec) {\n  \"use strict\";\n\n  var that = {},\n      WebkitRTCPeerConnection = mozRTCPeerConnection,\n      RTCSessionDescription = mozRTCSessionDescription;\n  var hasStream = false;\n  that.isSubscriber = spec.isSubscriber;\n  that.pc_config = {\n    \"iceServers\": []\n  };\n\n  // currently firefox does not support turn\n  if (spec.iceServers instanceof Array) {\n    spec.iceServers.map(function (server) {\n      if (server.url.indexOf('stun:') === 0) {\n        that.pc_config.iceServers.push({ \"url\": server.url });\n      }\n    });\n  } else {\n    if (spec.stunServerUrl) {\n      if (spec.stunServerUrl instanceof Array) {\n        spec.stunServerUrl.map(function (url) {\n          if (typeof url === 'string' && url !== '') {\n            that.pc_config.iceServers.push({ \"url\": url });\n          }\n        });\n      } else if (typeof spec.stunServerUrl === 'string' && spec.stunServerUrl !== '') {\n        that.pc_config.iceServers.push({ \"url\": spec.stunServerUrl });\n      }\n    }\n  }\n\n  if (spec.audio === undefined) {\n    spec.audio = true;\n  }\n\n  if (spec.video === undefined) {\n    spec.video = true;\n  }\n\n  that.mediaConstraints = {\n    offerToReceiveAudio: spec.audio,\n    offerToReceiveVideo: spec.video,\n    mozDontOfferDataChannel: true\n  };\n\n  that.roapSessionId = 103;\n\n  that.peerConnection = new RTCPeerConnection(that.pc_config);\n\n  that.peerConnection.onicecandidate = function (event) {\n    if (!event.candidate) {\n      // At the moment, we do not renegotiate when new candidates\n      // show up after the more flag has been false once.\n      _Logger2.default.debug(\"PeerConnection State: \" + that.peerConnection.iceGatheringState);\n\n      if (that.ices === undefined) {\n        that.ices = 0;\n      }\n      that.ices = that.ices + 1;\n      if (that.ices >= 1 && that.moreIceComing) {\n        that.moreIceComing = false;\n        that.markActionNeeded();\n      }\n    } else {\n      that.iceCandidateCount += 1;\n    }\n  };\n\n  that.processSignalingMessage = function (msgstring) {\n    // Offer: Check for glare and resolve.\n    // Answer/OK: Remove retransmit for the msg this is an answer to.\n    // Send back \"OK\" if this was an Answer.\n    //Logger.debug('Activity on conn ' + that.sessionId);\n    var msg = JSON.parse(msgstring),\n        sd;\n    that.incomingMessage = msg;\n\n    if (that.state === 'new') {\n      if (msg.messageType === 'OFFER') {\n        // Initial offer.\n        msg.sdp = setMaxBW(msg.sdp);\n        sd = { sdp: msg.sdp, type: 'offer' };\n        that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd), function () {\n          _Logger2.default.debug(\"setRemoteDescription succeeded\");\n        }, function (error) {\n          _Logger2.default.info(\"setRemoteDescription failed: \" + error.name);\n        });\n\n        that.state = 'offer-received';\n        // Allow other stuff to happen, then reply.\n        that.markActionNeeded();\n      } else {\n        that.error('Illegal message for this state: ' + msg.messageType + ' in state ' + that.state);\n      }\n    } else if (that.state === 'offer-sent') {\n      if (msg.messageType === 'ANSWER') {\n        msg.sdp = setMaxBW(msg.sdp);\n        msg.sdp = msg.sdp.replace(/ generation 0/g, \"\");\n        msg.sdp = msg.sdp.replace(/ udp /g, \" UDP \");\n        msg.sdp = msg.sdp.replace(/a=group:BUNDLE audio video/, \"a=group:BUNDLE sdparta_0 sdparta_1\");\n        msg.sdp = msg.sdp.replace(/a=mid:audio/, \"a=mid:sdparta_0\");\n        msg.sdp = msg.sdp.replace(/a=mid:video/, \"a=mid:sdparta_1\");\n\n        sd = { sdp: msg.sdp, type: 'answer' };\n        //Logger.debug(\"Received ANSWER: \", sd.sdp);\n        that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd), function () {\n          _Logger2.default.debug(\"setRemoteDescription succeeded\");\n        }, function (error) {\n          _Logger2.default.info(\"setRemoteDescription failed: \" + error);\n        });\n        that.sendOK();\n        that.state = 'established';\n      } else if (msg.messageType === 'pr-answer') {\n        sd = { sdp: msg.sdp, type: 'pr-answer' };\n        that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd), function () {\n          _Logger2.default.debug(\"setRemoteDescription succeeded\");\n        }, function (error) {\n          _Logger2.default.info(\"setRemoteDescription failed: \" + error.name);\n        });\n\n        // No change to state, and no response.\n      } else if (msg.messageType === 'offer') {\n        // Glare processing.\n        that.error('Not written yet');\n      } else {\n        that.error('Illegal message for this state: ' + msg.messageType + ' in state ' + that.state);\n      }\n    } else if (that.state === 'established') {\n      if (msg.messageType === 'OFFER') {\n        // Subsequent offer.\n        sd = { sdp: msg.sdp, type: 'offer' };\n        that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd), function () {\n          _Logger2.default.debug(\"setRemoteDescription succeeded\");\n        }, function (error) {\n          _Logger2.default.info(\"setRemoteDescription failed: \" + error.name);\n        });\n\n        that.state = 'offer-received';\n        // Allow other stuff to happen, then reply.\n        that.markActionNeeded();\n      } else {\n        that.error('Illegal message for this state: ' + msg.messageType + ' in state ' + that.state);\n      }\n    }\n  };\n\n  var outbound_rtp_audio = {\n    id: \"\",\n    type: \"\",\n    mediaType: \"opus\",\n    googCodecName: \"opus\",\n    aecDivergentFilterFraction: \"0\",\n    audioInputLevel: \"0\",\n    bytesSent: \"0\",\n    packetsSent: \"0\",\n    googEchoCancellationReturnLoss: \"0\",\n    googEchoCancellationReturnLossEnhancement: \"0\"\n  };\n\n  var outbound_rtp_video = {\n    id: \"\",\n    type: \"\",\n    mediaType: \"\",\n    googCodecName: spec.codec === \"h264\" ? \"H264\" : \"VP8\",\n    bytesSent: \"0\",\n    packetsLost: \"0\",\n    packetsSent: \"0\",\n    googAdaptationChanges: \"0\",\n    googAvgEncodeMs: \"0\",\n    googEncodeUsagePercent: \"0\",\n    googFirsReceived: \"0\",\n    googFrameHeightSent: \"0\",\n    googFrameHeightInput: \"0\",\n    googFrameRateInput: \"0\",\n    googFrameRateSent: \"0\",\n    googFrameWidthSent: \"0\",\n    googFrameWidthInput: \"0\",\n    googNacksReceived: \"0\",\n    googPlisReceived: \"0\",\n    googRtt: \"0\"\n  };\n\n  var inbound_rtp_audio = {\n    id: \"\",\n    type: \"\",\n    mediaType: \"\",\n    audioOutputLevel: \"0\",\n    bytesReceived: \"0\",\n    packetsLost: \"0\",\n    packetsReceived: \"0\",\n    googAccelerateRate: \"0\",\n    googCurrentDelayMs: \"0\",\n    googDecodingCNG: \"0\",\n    googDecodingCTN: \"0\",\n    googDecodingCTSG: \"0\",\n    googDecodingNormal: \"0\",\n    googDecodingPLC: \"0\",\n    googDecodingPLCCNG: \"0\",\n    googExpandRate: \"0\",\n    googJitterBufferMs: \"0\",\n    googJitterReceived: \"0\",\n    googPreemptiveExpandRate: \"0\",\n    googPreferredJitterBufferMs: \"0\",\n    googSecondaryDecodedRate: \"0\",\n    googSpeechExpandRate: \"0\"\n  };\n\n  var inbound_rtp_video = {\n    id: \"\",\n    type: \"\",\n    mediaType: \"\",\n    googTargetDelayMs: \"0\",\n    packetsLost: \"0\",\n    googDecodeMs: \"0\",\n    googMaxDecodeMs: \"0\",\n    googRenderDelayMs: \"0\",\n    googFrameWidthReceived: \"0\",\n    googFrameHeightReceived: \"0\",\n    googFrameRateReceived: \"0\",\n    googFrameRateDecoded: \"0\",\n    googFrameRateOutput: \"0\",\n    googJitterBufferMs: \"0\",\n    googCurrentDelayMs: \"0\",\n    googMinPlayoutDelayMs: \"0\",\n    googNacksSent: \"0\",\n    googPlisSent: \"0\",\n    googFirsSent: \"0\",\n    bytesReceived: \"0\",\n    packetsReceived: \"0\",\n    googFramesDecoded: \"0\"\n  };\n\n  var lastFramesDecoded = 0;\n\n  that.getStatsRate = function (callback) {\n    that.getStats(function (stats) {\n      stats.forEach(function (report) {\n        if (report.type === 'inboundrtp' && report.mediaType === 'video') {\n          if (report.googFrameRateDecoded) {\n            report.googFrameRateDecoded = ((report.googFramesDecoded - lastFramesDecoded) / 3).toString();\n            lastFramesDecoded = report.googFramesDecoded;\n          }\n        }\n      });\n      callback(stats);\n    });\n  };\n\n  that.getStats = function (callback) {\n    that.peerConnection.getStats().then(function (stats) {\n      var originList = [];\n      Object.keys(stats).forEach(function (stat) {\n        var report = stats[stat];\n        originList.push(report);\n        if (report.type === 'outboundrtp' && report.mediaType === 'video') {\n          outbound_rtp_video.id = report.id;\n          outbound_rtp_video.type = report.type;\n          outbound_rtp_video.mediaType = report.mediaType;\n          outbound_rtp_video.bytesSent = report.bytesSent ? report.bytesSent + '' : '0';\n          outbound_rtp_video.packetsSent = report.packetsSent ? report.packetsSent + '' : '0';\n          outbound_rtp_video.googPlisReceived = report.pliCount ? report.pliCount + '' : '0';\n          outbound_rtp_video.googNacksReceived = report.nackCount ? report.nackCount + '' : '0';\n          outbound_rtp_video.googFirsReceived = report.firCount ? report.firCount + '' : '0';\n          outbound_rtp_video.googFrameRateSent = report.framerateMean ? report.framerateMean + '' : '0';\n        }\n        if (report.type === 'outboundrtp' && report.mediaType === 'audio') {\n          outbound_rtp_audio.id = report.id;\n          outbound_rtp_audio.type = report.type;\n          outbound_rtp_audio.mediaType = report.mediaType;\n          outbound_rtp_audio.bytesSent = report.bytesSent ? report.bytesSent + '' : '0';\n          outbound_rtp_audio.packetsSent = report.packetsSent ? report.packetsSent + '' : '0';\n        }\n        if (report.type === 'inboundrtp' && report.mediaType === 'audio' && !report.isRemote) {\n          inbound_rtp_audio.id = report.id;\n          inbound_rtp_audio.type = report.type;\n          inbound_rtp_audio.mediaType = report.mediaType;\n          inbound_rtp_audio.bytesReceived = report.bytesReceived ? report.bytesReceived + '' : '0';\n          inbound_rtp_audio.packetsLost = report.packetsLost ? report.packetsLost + '' : '0';\n          inbound_rtp_audio.packetsReceived = report.packetsReceived ? report.packetsReceived + '' : '0';\n          inbound_rtp_audio.googJitterReceived = report.jitter ? report.jitter + '' : '0';\n        }\n        if (report.type === 'inboundrtp' && report.mediaType === 'video' && !report.isRemote) {\n          inbound_rtp_video.id = report.id;\n          inbound_rtp_video.type = report.type;\n          inbound_rtp_video.mediaType = report.mediaType;\n          inbound_rtp_video.bytesReceived = report.bytesReceived ? report.bytesReceived + '' : '0';\n          inbound_rtp_video.googFrameRateReceived = report.framerateMean ? report.framerateMean + '' : '0';\n          inbound_rtp_video.googFramesDecoded = report.framesDecoded ? report.framesDecoded + '' : '0';\n          inbound_rtp_video.packetsLost = report.packetsLost ? report.packetsLost + '' : '0';\n          inbound_rtp_video.packetsReceived = report.packetsReceived ? report.packetsReceived + '' : '0';\n          inbound_rtp_video.googJitterBufferMs = report.jitter ? report.jitter + '' : '0';\n          inbound_rtp_video.googNacksSent = report.nackCount ? report.nackCount + '' : '0';\n          inbound_rtp_video.googPlisSent = report.pliCount ? report.pliCount + '' : '0';\n          inbound_rtp_video.googFirsSent = report.firCount ? report.firCount + '' : '0';\n        }\n        if (report.id.indexOf('outbound_rtcp_video') !== -1) {\n          outbound_rtp_video.packetsLost = report.packetsLost ? report.packetsLost + '' : '0';\n        }\n      });\n      var filterList = [outbound_rtp_video, outbound_rtp_audio, inbound_rtp_audio, inbound_rtp_video];\n      filterList.push({\n        id: \"time\",\n        startTime: that.connectedTime,\n        timestamp: new Date()\n      });\n      callback(filterList, originList);\n    }, function (error) {\n      _Logger2.default.error(error);\n    });\n  };\n\n  that.addStream = function (stream) {\n    hasStream = true;\n    that.peerConnection.addStream(stream);\n    that.markActionNeeded();\n  };\n\n  that.removeStream = function () {\n    that.markActionNeeded();\n  };\n\n  that.close = function () {\n    that.state = 'closed';\n    that.peerConnection.close();\n  };\n\n  that.markActionNeeded = function () {\n    that.actionNeeded = true;\n    that.doLater(function () {\n      that.onstablestate();\n    });\n  };\n\n  that.doLater = function (what) {\n    // Post an event to myself so that I get called a while later.\n    // (needs more JS/DOM info. Just call the processing function on a delay\n    // for now.)\n    window.setTimeout(what, 1);\n  };\n\n  /**\n   * Internal function called when a stable state\n   * is entered by the browser (to allow for multiple AddStream calls or\n   * other interesting actions).\n   * This function will generate an offer or answer, as needed, and send\n   * to the remote party using our onsignalingmessage function.\n   */\n  that.onstablestate = function () {\n    if (that.actionNeeded) {\n      if (that.state === 'new' || that.state === 'established') {\n        var onSuccess = function onSuccess() {\n          that.peerConnection.createOffer(function (sessionDescription) {\n            sessionDescription.sdp = setMaxBW(sessionDescription.sdp);\n            sessionDescription.sdp = sessionDescription.sdp.replace(/a=extmap:1 http:\\/\\/www.webrtc.org\\/experiments\\/rtp-hdrext\\/abs-send-time/, \"a=extmap:3 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\");\n            var newOffer = sessionDescription.sdp;\n            if (newOffer !== that.prevOffer) {\n              that.peerConnection.setLocalDescription(sessionDescription);\n\n              that.state = 'preparing-offer';\n              that.markActionNeeded();\n              return;\n            } else {\n              _Logger2.default.debug('Not sending a new offer');\n            }\n          }, function (error) {\n            _Logger2.default.debug(\"Ups! create offer failed \", error);\n          }, that.mediaConstraints);\n        };\n\n        if (hasStream) {\n          that.mediaConstraints = undefined;\n        }\n\n        onSuccess();\n      } else if (that.state === 'preparing-offer') {\n        // Don't do anything until we have the ICE candidates.\n        if (that.moreIceComing) {\n          return;\n        }\n\n        // Now able to send the offer we've already prepared.\n        that.prevOffer = that.peerConnection.localDescription.sdp;\n        //Logger.debug(\"Sending OFFER: \", that.prevOffer);\n        that.sendMessage('OFFER', that.prevOffer);\n        // Not done: Retransmission on non-response.\n        that.state = 'offer-sent';\n      } else if (that.state === 'offer-received') {\n        that.peerConnection.createAnswer(function (sessionDescription) {\n          that.peerConnection.setLocalDescription(sessionDescription);\n          that.state = 'offer-received-preparing-answer';\n\n          if (!that.iceStarted) {\n            var now = new Date();\n            _Logger2.default.debug(now.getTime() + ': Starting ICE in responder');\n            that.iceStarted = true;\n          } else {\n            that.markActionNeeded();\n            return;\n          }\n        }, function () {\n          _Logger2.default.debug(\"Ups! Something went wrong\");\n        });\n      } else if (that.state === 'offer-received-preparing-answer') {\n        if (that.moreIceComing) {\n          return;\n        }\n\n        var mySDP = that.peerConnection.localDescription.sdp;\n        that.sendMessage('ANSWER', mySDP);\n        that.state = 'established';\n      } else {\n        that.error('Dazed and confused in state ' + that.state + ', stopping here');\n      }\n      that.actionNeeded = false;\n    }\n  };\n\n  that.sendOK = function () {\n    that.sendMessage('OK');\n  };\n\n  /**\n   * Internal function to send a signalling message.\n   * @param {string} operation What operation to signal.\n   * @param {string} sdp SDP message body.\n   */\n  that.sendMessage = function (operation, sdp) {\n    var roapMessage = {};\n    roapMessage.messageType = operation;\n    roapMessage.sdp = sdp; // may be null or undefined\n    if (operation === 'OFFER') {\n      roapMessage.offererSessionId = that.sessionId;\n      roapMessage.answererSessionId = that.otherSessionId; // may be null\n      roapMessage.seq = that.sequenceNumber += 1;\n      // The tiebreaker needs to be neither 0 nor 429496725.\n      roapMessage.tiebreaker = Math.floor(Math.random() * 429496723 + 1);\n    } else {\n      roapMessage.offererSessionId = that.incomingMessage.offererSessionId;\n      roapMessage.answererSessionId = that.sessionId;\n      roapMessage.seq = that.incomingMessage.seq;\n    }\n    that.onsignalingmessage(JSON.stringify(roapMessage));\n  };\n\n  that.error = function (text) {\n    throw 'Error in RoapOnJsep: ' + text;\n  };\n\n  that.sessionId = that.roapSessionId += 1;\n  that.sequenceNumber = 0; // Number of last ROAP message sent. Starts at 1.\n  that.actionNeeded = false;\n  that.iceStarted = false;\n  that.moreIceComing = true;\n  that.iceCandidateCount = 0;\n  that.onsignalingmessage = spec.callback;\n\n  that.peerConnection.ontrack = function (stream) {\n    if (that.onaddstream) {\n      that.onaddstream(stream, \"ontrack\");\n    }\n  };\n\n  that.peerConnection.onremovestream = function (stream) {\n    if (that.onremovestream) {\n      that.onremovestream(stream);\n    }\n  };\n\n  that.peerConnection.oniceconnectionstatechange = function (e) {\n    if (e.currentTarget.iceConnectionState === \"connected\") {\n      that.connectedTime = new Date();\n    }\n\n    if (that.oniceconnectionstatechange) {\n      that.oniceconnectionstatechange(e.currentTarget.iceConnectionState);\n    }\n  };\n\n  var setMaxBW = function setMaxBW(sdp) {\n    if (spec.video && spec.maxVideoBW) {\n      var a = sdp.match(/m=video.*\\r\\n/);\n      if (a == null) {\n        a = sdp.match(/m=video.*\\n/);\n      }\n      if (a && a.length > 0) {\n        var r = a[0] + \"b=TIAS:\" + spec.maxVideoBW * 1000 + \"\\r\\n\";\n        sdp = sdp.replace(a[0], r);\n      }\n    }\n\n    if (spec.audio && spec.maxAudioBW) {\n      var a = sdp.match(/m=audio.*\\r\\n/);\n      if (a == null) {\n        a = sdp.match(/m=audio.*\\n/);\n      }\n      if (a && a.length > 0) {\n        var r = a[0] + \"b=TIAS:\" + spec.maxAudioBW * 1000 + \"\\r\\n\";\n        sdp = sdp.replace(a[0], r);\n      }\n    }\n\n    return sdp;\n  };\n\n  that.onaddstream = null;\n  that.onremovestream = null;\n  that.state = 'new';\n  // Auto-fire next events.\n  that.markActionNeeded();\n  return that;\n};\n\nexports.default = FirefoxStack;\n\n/***/ }),\n/* 31 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar publishStatsFilter = function publishStatsFilter(stats) {\n  var detection = {\n    audioSendBytes: \"0\",\n    audioSendPackets: \"0\",\n\n    videoSendBytes: \"0\",\n    videoSendPackets: \"0\",\n    videoSendPacketsLost: \"0\",\n    videoSendFrameRate: \"0\",\n    videoSendBandwidth: \"0\",\n    videoSendResolutionWidth: \"0\",\n    videoSendResolutionHeight: \"0\",\n\n    audioCodecName: \"\",\n    videoCodecName: \"\",\n\n    timestamp: \"\",\n    startTime: \"\",\n    duration: \"0\"\n  };\n\n  stats.forEach(function (stat) {\n    if (stat.type === \"VideoBwe\") {\n      detection.videoSendBandwidth = stat.googAvailableSendBandwidth;\n    } else if (stat.id.indexOf(\"send\") !== -1 || stat.id.indexOf(\"outbound_rtp\") !== -1 || stat.id.indexOf(\"OutboundRTP\") !== -1) {\n\n      if (stat.mediaType === \"audio\") {\n        detection.audioSendBytes = stat.bytesSent;\n        detection.audioSendPackets = stat.packetsSent;\n        detection.audioCodecName = stat.googCodecName;\n      } else {\n        detection.videoSendBytes = stat.bytesSent;\n        detection.videoSendPackets = stat.packetsSent;\n        detection.videoSendPacketsLost = stat.packetsLost;\n        detection.videoSendFrameRate = stat.googFrameRateSent;\n        detection.videoSendResolutionWidth = stat.googFrameWidthSent;\n        detection.videoSendResolutionHeight = stat.googFrameHeightSent;\n        detection.videoCodecName = stat.googCodecName;\n      }\n    } else if (stat.id === \"time\") {\n      detection.timestamp = stat.timestamp;\n      detection.startTime = stat.startTime;\n    }\n  });\n\n  if (detection.timestamp instanceof Date && detection.startTime instanceof Date) {\n    detection.duration = Math.floor((detection.timestamp.getTime() - detection.startTime.getTime()) / 1000) + \"\";\n  }\n\n  return detection;\n};\n\nvar subscribeStatsFilter = function subscribeStatsFilter(stats) {\n  var detection = {\n    audioReceiveBytes: \"0\",\n    audioReceivePackets: \"0\",\n    audioReceivePacketsLost: \"0\",\n\n    videoReceiveBytes: \"0\",\n    videoReceivePackets: \"0\",\n    videoReceivePacketsLost: \"0\",\n    videoReceiveFrameRate: \"0\",\n    videoReceiveDecodeFrameRate: \"0\",\n    videoReceiveBandwidth: \"0\",\n    videoReceivedResolutionWidth: \"0\",\n    videoReceivedResolutionHeight: \"0\",\n\n    timestamp: \"\",\n    startTime: \"\",\n    duration: \"0\"\n  };\n\n  stats.forEach(function (stat) {\n    if (stat.type === \"VideoBwe\") {\n      detection.videoReceiveBandwidth = stat.googAvailableReceiveBandwidth;\n    } else if (stat.id.indexOf(\"recv\") !== -1 || stat.id.indexOf(\"inbound_rtp\") !== -1 || stat.id.indexOf(\"InboundRTP\") !== -1) {\n\n      if (stat.mediaType === \"audio\") {\n        detection.audioReceiveBytes = stat.bytesReceived;\n        detection.audioReceivePackets = stat.packetsReceived;\n        detection.audioReceivePacketsLost = stat.packetsLost;\n      } else {\n        detection.videoReceiveBytes = stat.bytesReceived;\n        detection.videoReceivePacketsLost = stat.packetsLost;\n        detection.videoReceivePackets = stat.packetsReceived;\n        detection.videoReceiveFrameRate = stat.googFrameRateReceived;\n        detection.videoReceiveDecodeFrameRate = stat.googFrameRateDecoded;\n        detection.videoReceivedResolutionWidth = stat.googFrameWidthReceived;\n        detection.videoReceivedResolutionHeight = stat.googFrameHeightReceived;\n      }\n    } else if (stat.id === \"time\") {\n      detection.timestamp = stat.timestamp;\n      detection.startTime = stat.startTime;\n    }\n  });\n  if (detection.timestamp instanceof Date && detection.startTime instanceof Date) {\n    detection.duration = Math.floor((detection.timestamp.getTime() - detection.startTime.getTime()) / 1000) + \"\";\n  }\n\n  return detection;\n};\n\nexports.publishStatsFilter = publishStatsFilter;\nexports.subscribeStatsFilter = subscribeStatsFilter;\n\n/***/ }),\n/* 32 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.LiveTranscoding = exports.TranscodingUser = exports.createLiveClient = exports.createRtcClient = exports.createClient = undefined;\n\nvar _GatewayClient = __webpack_require__(33);\n\nvar _GatewayClient2 = _interopRequireDefault(_GatewayClient);\n\nvar _Logger = __webpack_require__(0);\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _ErrorCodes = __webpack_require__(8);\n\nvar _ErrorCodes2 = _interopRequireDefault(_ErrorCodes);\n\nvar _Helper = __webpack_require__(3);\n\nvar _Server = __webpack_require__(13);\n\nvar _Report = __webpack_require__(5);\n\nvar _Browser = __webpack_require__(2);\n\nvar _SimMap = __webpack_require__(36);\n\nvar _Stream = __webpack_require__(7);\n\nvar _GlobalName = __webpack_require__(14);\n\nvar _Config = __webpack_require__(1);\n\nvar config = _interopRequireWildcard(_Config);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar PUBLISHED = 0;\nvar PUBLISHING = 1;\nvar UNPUBLISHED = 2;\n\nvar Client = function Client(spec) {\n  \"use strict\";\n\n  var that = {};\n  that.key = undefined;\n\n  that.highStream = null;\n  that.lowStream = null;\n  that.lowStreamParameter = null;\n  that.isDualStream = false;\n  that.highStreamState = UNPUBLISHED;\n  that.lowStreamState = UNPUBLISHED;\n\n  that.setLowStreamParameter = function (lowStreamParameter) {\n    that.lowStreamParameter = lowStreamParameter;\n  };\n\n  that._getVideoCameraIdByLabel = function (label, onSuccess, onFailure) {\n    (0, _Stream.getDevices)(function (devices) {\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = devices[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var device = _step.value;\n\n          if (device.label === label && device.kind === 'videoinput') {\n            return onSuccess(device.deviceId);\n          }\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      return onFailure();\n    }, onFailure);\n  };\n\n  that.init = function (appId, onSuccess, onFailure) {\n    if (typeof appId !== 'string') {\n      throw new Error('Param appId should be string');\n    }\n\n    _Logger2.default.info(\"Initializing AgoraRTC client\");\n    spec.appId = appId;\n    spec.sessionId = (0, _Helper.generateSessionId)();\n    onSuccess && onSuccess();\n  };\n\n  that.configPublisher = function (config) {\n    that.gatewayClient.configPublisher(config);\n  };\n\n  that.enableDualStream = function (onSuccess, onFailure) {\n    if ((0, _Browser.getBrowserOS)() === \"iOS\") {\n      _Report.report.streamSwitch(spec.sessionId, {\n        lts: new Date().getTime(),\n        isdual: true,\n        succ: false\n      });\n      return onFailure && onFailure(_ErrorCodes2.default.IOS_NOT_SUPPORT);\n    }\n\n    _Report.report.streamSwitch(spec.sessionId, {\n      lts: new Date().getTime(),\n      isdual: true,\n      succ: true\n    });\n\n    that.isDualStream = true;\n    if (that.highStreamState === PUBLISHED) {\n      that._publishLowStream(onSuccess, onFailure);\n    } else if (that.highStreamState === PUBLISHING) {\n      onFailure && onFailure(_ErrorCodes2.default.STILL_ON_PUBLISHING);\n    } else {\n      onSuccess && onSuccess();\n    }\n  };\n\n  that.disableDualStream = function (onSuccess, onFailure) {\n    _Report.report.streamSwitch(spec.sessionId, {\n      lts: new Date().getTime(),\n      isdual: false,\n      succ: true\n    });\n\n    that.isDualStream = false;\n    if (that.highStreamState === PUBLISHED) {\n      that._unpublishLowStream(onSuccess, onFailure);\n    } else if (that.highStreamState === PUBLISHING) {\n      onFailure && onFailure(_ErrorCodes2.default.STILL_ON_PUBLISHING);\n    } else {\n      onSuccess && onSuccess();\n    }\n  };\n\n  that._createLowStream = function (onSuccess, onFailure) {\n    if (!that.highStream || !that.highStream.stream) {\n      return _Logger2.default.warning(\"Can't create low-stream without highStream\");\n    }\n\n    var spec = Object.assign({}, that.highStream.params);\n    spec.streamID += 1;\n    spec.audio = false;\n\n    if (!spec.video) {\n      return;\n    }\n\n    var videoTrack = that.highStream.stream.getVideoTracks()[0];\n    if (!videoTrack) {\n      onFailure('can not get hight-stream video track');\n    }\n\n    that._getVideoCameraIdByLabel(videoTrack.label, function (deviceId) {\n      spec.cameraId = deviceId;\n      var lowStream = new _Stream.Stream(spec);\n      lowStream.streamId = that.highStream.getId() + 1;\n      if (that.lowStreamParameter) {\n        var parameter = Object.assign({}, that.lowStreamParameter);\n        if (!parameter.width || !parameter.height) {\n          var sim = (0, _SimMap.simMap)(that.highStream.profile);\n          var res = config.SUPPORT_RESOLUTION_LIST[sim[0]];\n          parameter.width = res[0];\n          parameter.height = res[1];\n        }\n        parameter.framerate = parameter.framerate || 5;\n        parameter.bitrate = parameter.bitrate || 50;\n\n        if ((0, _Browser.isSafari)()) {\n          var res = config.SUPPORT_RESOLUTION_LIST[that.highStream.profile];\n          parameter.width = res[0];\n          parameter.height = res[1];\n        }\n        lowStream.setVideoProfileCustomPlus(parameter);\n      } else {\n        lowStream.setVideoProfileCustom((0, _SimMap.simMap)(that.highStream.profile));\n      }\n      lowStream.init(function () {\n        that.highStream.lowStream = lowStream;\n        if (!videoTrack.enabled) {\n          lowStream.disableVideo();\n        }\n        onSuccess && onSuccess(lowStream);\n      }, function () {\n        return onFailure('can not get hight-stream video track');\n      });\n    });\n  };\n\n  that._getLowStream = function (onSuccess, onFailure) {\n    if (that.lowStream) {\n      onSuccess(that.lowStream);\n    } else {\n      that._createLowStream(function (lowStream) {\n        that.lowStream = lowStream;\n        onSuccess(that.lowStream);\n      }, onFailure);\n    }\n  };\n\n  that._publishLowStream = function (onSuccess, onFailure) {\n    if (that.lowStreamState !== UNPUBLISHED) {\n      _Logger2.default.warning(\"Can't publish low-stream when low-stream already publish\");\n      return onFailure && onFailure();\n    }\n\n    if (that.highStream && that.highStream.hasScreen()) {\n      return onFailure && onFailure(_ErrorCodes2.default.SHARING_SCREEN_NOT_SUPPORT);\n    }\n\n    that._getLowStream(function (lowStream) {\n      that.lowStreamState = PUBLISHING;\n      that.gatewayClient.publish(lowStream, function () {\n        that.lowStreamState = PUBLISHED;\n        onSuccess && onSuccess();\n      }, function (e) {\n        _Logger2.default.debug(\"publish low stream failed\");\n        onFailure && onFailure(e);\n      });\n    }, onFailure);\n  };\n\n  that._unpublishLowStream = function (onSuccess, onFailure) {\n    if (that.lowStreamState !== PUBLISHED) {\n      _Logger2.default.warning(\"Can't unpublish low-stream when low-stream not ever publish\");\n      return onFailure && onFailure();\n    }\n\n    if (that.lowStream) {\n      that.gatewayClient.unpublish(that.lowStream, function () {}, function (e) {\n        _Logger2.default.debug(\"unpublish low stream failed\");\n        onFailure && onFailure(e);\n      });\n      that.lowStream.close();\n      that.lowStream = null;\n      that.lowStreamState = UNPUBLISHED;\n      onSuccess && onSuccess();\n    }\n  };\n\n  that.join = function (channelKey, channel, uid, onSuccess, onFailure) {\n    if (channelKey && typeof channelKey !== 'string') {\n      return onFailure && onFailure('Param channelKey should be string');\n    }\n\n    if (typeof channel !== 'string') {\n      return onFailure && onFailure('Param channel should be string');\n    }\n\n    if (uid && (typeof uid !== 'number' || !(0, _Helper.is32Uint)(uid))) {\n      return onFailure && onFailure('Param uid should be number');\n    }\n\n    that.highStream = null;\n    that.lowStream = null;\n    that.lowStreamParameter = null;\n    that.isDualStream = false;\n    that.highStreamState = UNPUBLISHED;\n    that.lowStreamState = UNPUBLISHED;\n\n    var joinInfo = {\n      appId: spec.appId,\n      sid: spec.sessionId,\n      cname: channel,\n      uid: uid\n\n      // sessionInit event report\n    };_Report.report.sessionInit(spec.sessionId, {\n      lts: new Date().getTime(),\n      cname: channel,\n      appid: spec.appId,\n      mode: spec.mode,\n      succ: true\n    });\n\n    (0, _Server.getGatewayList)(joinInfo, function (res) {\n      _Logger2.default.info(\"Joining channel: \" + channel);\n\n      // TODO delete if useless\n      if (channelKey) {\n        that.key = channelKey;\n      } else {\n        that.key = spec.appId;\n      }\n\n      joinInfo.cid = res.cid;\n      joinInfo.uid = res.uid;\n      joinInfo.gatewayAddr = res.gateway_addr;\n      that.joinInfo = joinInfo;\n\n      that.gatewayClient.join(joinInfo, that.key, function (uid) {\n        _Logger2.default.info(\"Join channal \" + channel + \" success\");\n        onSuccess(uid);\n      }, onFailure);\n    }, onFailure);\n  };\n\n  that.renewChannelKey = function (channelKey, onSuccess, onFailure) {\n    if (that.key === undefined) {\n      _Logger2.default.error(\"renewChannelKey should not be called before user join\");\n      (0, _Helper.safeCall)(onFailure, _ErrorCodes2.default.INVALID_OPERATION);\n    }\n    that.key = channelKey;\n    (0, _Helper.safeCall)(onSuccess);\n  };\n\n  that.leave = function (onSuccess, onFailure) {\n    _Logger2.default.info(\"Leaving channel\");\n    that.gatewayClient.leave(onSuccess, onFailure);\n  };\n\n  that._publish = function (stream, onSuccess, onFailure) {\n    if (that.highStreamState !== UNPUBLISHED) {\n      _Logger2.default.warning(\"Can't publish stream when stream already publish\", stream.getId());\n      return onFailure && onFailure(\"stream already publish\");\n    }\n\n    _Logger2.default.info(\"Publishing stream, uid: \", stream.getId());\n    that.highStream = stream;\n    that.highStreamState = PUBLISHING;\n    that.highStream.streamId = that.joinInfo.uid;\n\n    that.gatewayClient.publish(stream, function () {\n      stream.sid = spec.sessionId;\n      that.highStreamState = PUBLISHED;\n      _Logger2.default.info(\"Publish success, uid:\", stream.getId());\n      if (that.isDualStream) {\n        that._publishLowStream(function () {\n          onSuccess && onSuccess();\n        }, onFailure);\n      } else {\n        onSuccess && onSuccess();\n      }\n    }, onFailure);\n  };\n\n  that._unpublish = function (stream, onSuccess, onFailure) {\n    if (that.highStreamState !== PUBLISHED) {\n      _Logger2.default.warning(\"Can't unpublish stream when stream not publish\");\n      return onFailure && onFailure(\"stream not publish\");\n    }\n\n    _Logger2.default.info(\"Unpublish stream, uid: \", stream.getId());\n\n    if (that.isDualStream && that.lowStream) {\n      that._unpublishLowStream(null, onFailure);\n      that.gatewayClient.unpublish(stream, null, onFailure);\n      that.highStreamState = UNPUBLISHED;\n      _Logger2.default.info(\"Unpublish stream success, uid:\", stream.getId());\n    } else {\n      that.gatewayClient.unpublish(stream, null, onFailure);\n      that.highStreamState = UNPUBLISHED;\n      _Logger2.default.info(\"Unpublish stream success, uid:\", stream.getId());\n    }\n    onSuccess && onSuccess();\n  };\n\n  that.publish = function (stream, onFailure) {\n    if (that.highStreamState !== UNPUBLISHED) {\n      onFailure && onFailure('stream already published');\n    }\n    that._publish(stream, null, onFailure);\n  };\n\n  that.unpublish = function (stream, onFailure) {\n    if (that.highStreamState !== PUBLISHED) {\n      onFailure && onFailure('stream not yet published');\n    }\n    that._unpublish(stream, null, onFailure);\n  };\n\n  that.subscribe = function (stream, onFailure) {\n    _Logger2.default.info(\"Subscribe stream, uid: \", stream.getId());\n    that.gatewayClient.subscribe(stream, null, onFailure);\n  };\n\n  that.unsubscribe = function (stream, onFailure) {\n    _Logger2.default.info(\"Unsubscribe stream, uid: \", stream.getId());\n    that.gatewayClient.unsubscribe(stream, null, onFailure);\n  };\n\n  that.setRemoteVideoStreamType = function (stream, streamType) {\n    that.gatewayClient.setRemoteVideoStreamType(stream, streamType);\n  };\n\n  that.startLiveStreaming = function (url, transcodingEnabled) {\n    that.gatewayClient.startLiveStreaming(url, transcodingEnabled);\n  };\n\n  that.stopLiveStreaming = function (url) {\n    that.gatewayClient.stopLiveStreaming(url);\n  };\n\n  that.setLiveTranscoding = function (transcoding) {\n    Object.assign(LiveTranscoding, transcoding);\n    that.gatewayClient.setLiveTranscoding(LiveTranscoding);\n  };\n\n  that.gatewayClient = (0, _GatewayClient2.default)(spec);\n  that.on = that.gatewayClient.on;\n\n  that.on(\"rejoin\", function () {\n    // won't republish if preState = UNPUBLISHED, and PUBLISHING as PUBLISHED;\n    var preState = that.highStreamState === UNPUBLISHED ? UNPUBLISHED : PUBLISHED;\n\n    if (that.highStream && preState === PUBLISHED) {\n      _Logger2.default.info(\"publish after rejoin\");\n      that.highStreamState = UNPUBLISHED;\n      that.lowStreamState = UNPUBLISHED;\n\n      that.publish(that.highStream, function (e) {\n        e && _Logger2.default.info(e);\n      });\n    }\n  });\n\n  that.on(\"pubP2PLost\", function (evt) {\n    _Logger2.default.debug('Start reconnect local peerConnection :', that.highStream.getId());\n    that.gatewayClient.dispatchEvent({ type: \"stream-reconnect-start\", id: that.highStream.getId() });\n    that._unpublish(that.highStream, function () {\n      that._publish(that.highStream, function () {\n        _Logger2.default.debug('Reconnect local peerConnection success:', that.highStream.getId());\n        that.gatewayClient.dispatchEvent({ type: \"stream-reconnect-end\", id: that.highStream.getId() });\n      }, function (err) {\n        _Logger2.default.debug('Reconnect local peerConnection failed:' + err);\n        that.gatewayClient.dispatchEvent({ type: \"stream-reconnect-end\", id: that.highStream.getId() });\n      });\n    }, function (err) {\n      _Logger2.default.debug('Reconnect local peerConnection failed:' + err);\n      that.gatewayClient.dispatchEvent({ type: \"stream-reconnect-end\", id: that.highStream.getId() });\n    });\n  });\n\n  that.on(\"subP2PLost\", function (evt) {\n    _Logger2.default.debug('Start reconnect remote peerConnection :', evt.stream.getId());\n    that.gatewayClient.dispatchEvent({ type: \"stream-reconnect-start\", id: evt.stream.getId() });\n    that.gatewayClient.unsubscribe(evt.stream, function () {\n      that.gatewayClient.subscribe(evt.stream, function () {\n        _Logger2.default.debug('Reconnect remote peerConnection success:', evt.stream.getId());\n        that.gatewayClient.dispatchEvent({ type: \"stream-reconnect-end\", id: evt.stream.getId() });\n      }, function (err) {\n        _Logger2.default.debug('Reconnect remote peerConnection failed:' + err);\n        that.gatewayClient.dispatchEvent({ type: \"stream-reconnect-end\", id: evt.stream.getId() });\n      });\n    }, function (err) {\n      _Logger2.default.debug('Reconnect remote peerConnection failed:' + err);\n      that.gatewayClient.dispatchEvent({ type: \"stream-reconnect-end\", id: evt.stream.getId() });\n    });\n  });\n\n  return that;\n};\n\nvar TranscodingUser = {\n  uid: 0,\n  x: 0,\n  y: 0,\n  width: 0,\n  height: 0,\n  zOrder: 0,\n  alpha: 1.0\n};\n\nvar LiveTranscoding = {\n  width: 640,\n  height: 360,\n  videoBitrate: 400,\n  videoFramerate: 15,\n  lowLatency: false,\n  audioSampleRate: _GlobalName.AUDIO_SAMPLE_RATE_48000,\n  audioBitrate: 48,\n  audioChannels: 1,\n  videoGop: 30,\n  videoCodecProfile: _GlobalName.VIDEO_CODEC_PROFILE_HIGH,\n  userCount: 0,\n  userConfigExtraInfo: {},\n  backgroundColor: 0x000000,\n  transcodingUsers: []\n};\n\nvar createClient = function createClient(options) {\n  if (options && options.mode === \"interop\") {\n    _Logger2.default.info(\"Creating client , MODE : Interop\");\n    return Client({ mode: \"live\" });\n  } else if (options && options.mode === \"h264_interop\") {\n    _Logger2.default.info(\"Creating client , MODE : h264_interop\");\n    return Client({ mode: \"live\", codec: \"h264\" });\n  } else if (options && options.mode === \"web-only\") {\n    _Logger2.default.info(\"Creating client , MODE : web-only\");\n    return Client({ mode: \"rtc\" });\n  } else {\n    throw new Error('Invalid mode');\n  }\n};\n\nvar createRtcClient = function createRtcClient() {\n  _Logger2.default.info(\"Creating client , MODE : rtc\");\n  _Logger2.default.warning(\"createRtcClient is deprecated.\");\n  return Client({ mode: \"rtc\" });\n};\n\nvar createLiveClient = function createLiveClient(spec) {\n  var id = \"host\";\n  if (spec && spec.role === \"audience\") {\n    id = spec.role;\n  }\n  _Logger2.default.info(\"Creating client , MODE : live\");\n  _Logger2.default.warning(\"createLiveClient is deprecated.\");\n  return Client({ mode: \"live\", role: id });\n};\n\nexports.createClient = createClient;\nexports.createRtcClient = createRtcClient;\nexports.createLiveClient = createLiveClient;\nexports.TranscodingUser = TranscodingUser;\nexports.LiveTranscoding = LiveTranscoding;\n\n/***/ }),\n/* 33 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _Stream = __webpack_require__(7);\n\nvar _Websocket = __webpack_require__(34);\n\nvar _Websocket2 = _interopRequireDefault(_Websocket);\n\nvar _Connection = __webpack_require__(10);\n\nvar _Events = __webpack_require__(4);\n\nvar _Logger = __webpack_require__(0);\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _ErrorCodes = __webpack_require__(8);\n\nvar _ErrorCodes2 = _interopRequireDefault(_ErrorCodes);\n\nvar _AgoraCall = __webpack_require__(12);\n\nvar _AgoraCall2 = _interopRequireDefault(_AgoraCall);\n\nvar _Server = __webpack_require__(13);\n\nvar _Config = __webpack_require__(1);\n\nvar _Report = __webpack_require__(5);\n\nvar _Helper = __webpack_require__(3);\n\nvar _Browser = __webpack_require__(2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar GatewayClient = function GatewayClient(spec) {\n  \"use strict\";\n\n  var isBanned = false;\n  var Ping = function Ping() {\n    return { \"_type\": \"ping\" };\n  };\n  var Join = function Join() {\n    var join = {\n      \"key\": that.key, // type: string\n      \"channel\": that.joinInfo.cname, // type: string\n      \"uid\": that.uid, // type: uint32\n      \"version\": _Config.VERSION, // type: string\n      \"browser\": navigator.userAgent, // type: string\n      \"mode\": spec.mode, // type: string, check value in (\"live\", ...)\n      \"role\": spec.role, // type: string, check value in (\"audience\", ...)\n      \"config\": that.config // type: object\n    };\n    return { \"_type\": \"join1\", \"message\": join };\n  };\n  var Leave = function Leave() {\n    return { \"_type\": \"leave\" };\n  };\n  var Control = function Control(options) {\n    return { \"_type\": \"control\", \"message\": options };\n  };\n  var Token = function Token(spec) {\n    // \"spec\":{\"mode\":\"live\",\"version\":\"1.12.0\",\"host\":\"webgw-washington-na-1.agora.io:5866\"}\n    return { \"_type\": \"token\", \"message\": spec };\n  };\n  var P2PLost = function P2PLost() {\n    return { \"_type\": \"p2p_lost\", \"message\": null };\n  };\n  var Unpublish = function Unpublish(streamId) {\n    return {\n      \"_type\": \"unpublish\",\n      \"message\": streamId // type: uint32\n    };\n  };\n  var Unsubscribe = function Unsubscribe(streamId) {\n    return {\n      \"_type\": \"unsubscribe\",\n      \"message\": streamId // type: uint32\n    };\n  };\n  var SwitchVideoStream = function SwitchVideoStream(streamId, streamType) {\n    return {\n      \"_type\": \"switchVideoStream\",\n      \"message\": {\n        id: streamId // type: uint32\n        , type: streamType // type: int32\n      } };\n  };\n  var Publish = function Publish(options, sdp, p2pid) {\n    return { \"_type\": \"publish\", \"options\": options, \"sdp\": sdp, \"p2pid\": p2pid };\n  };\n  var PublishStats = function PublishStats(stats) {\n    return { \"_type\": \"publish_stats\", \"options\": { \"stats\": stats }, \"sdp\": null };\n  };\n  var PublishStatsLow = function PublishStatsLow(stats) {\n    return { \"_type\": \"publish_stats_low\", \"options\": { \"stats\": stats }, \"sdp\": null };\n  };\n  var Subscribe = function Subscribe(options, sdp, p2pid) {\n    return { \"_type\": \"subscribe\", \"options\": options, \"sdp\": sdp, \"p2pid\": p2pid };\n  };\n  var SubscribeStats = function SubscribeStats(streamId, stats) {\n    return { \"_type\": \"subscribe_stats\", \"options\": { id: streamId, stats: stats }, \"sdp\": null };\n  };\n  var StartLiveStreaming = function StartLiveStreaming(url, transcodingEnabled) {\n    return { \"_type\": \"start_live_streaming\", \"message\": { url: url, transcodingEnabled: transcodingEnabled } };\n  };\n  var StopLiveStreaming = function StopLiveStreaming(url) {\n    return { \"_type\": \"stop_live_streaming\", \"message\": { url: url } };\n  };\n  var SetLiveTranscoding = function SetLiveTranscoding(transcoding) {\n    return { \"_type\": \"set_live_transcoding\", \"message\": { transcoding: transcoding } };\n  };\n\n  var DISCONNECTED = 0;\n  var CONNECTING = 1;\n  var CONNECTED = 2;\n\n  var that = (0, _Events.EventDispatcher)(spec);\n  that.socket = undefined;\n  that.state = DISCONNECTED;\n  that.mode = spec.mode;\n  that.role = spec.role;\n  that.codec = spec.codec;\n  that.config = {};\n  that.timers = {};\n  that.timer_counter = {};\n  that.localStreams = {};\n  that.remoteStreams = {};\n  that.attemps = 1;\n  that.p2p_attemps = 1;\n  that.audioLevel = {};\n  that.activeSpeaker = undefined;\n\n  that.p2ps = new Map();\n  that.firstFrameTimer = new Map();\n\n  that.liveStreams = new Map();\n\n  var safeCall = _AgoraCall2.default;\n  that.p2pCounter = (0, _Helper.random)(100000);\n  that.generateP2PId = function () {\n    return ++that.p2pCounter;\n  };\n\n  that.remoteVideoStreamTypes = {\n    REMOTE_VIDEO_STREAM_HIGH: 0,\n    REMOTE_VIDEO_STREAM_LOW: 1,\n    REMOTE_VIDEO_STREAM_MEDIUM: 2\n  };\n\n  that.configPublisher = function (config) {\n    that.config = config;\n  };\n\n  that.join = function (joinInfo, channelKey, onSuccess, onFailure) {\n    var lts = new Date().getTime();\n    var uid = joinInfo.uid;\n\n    if (that.state !== DISCONNECTED) {\n      _Logger2.default.error(\"Server already in connecting/connected state\");\n      onFailure && onFailure(_ErrorCodes2.default.INVALID_OPERATION);\n      _Report.report.joinGateway(joinInfo.sid, {\n        lts: lts,\n        succ: false,\n        ec: _ErrorCodes2.default.INVALID_OPERATION,\n        addr: null\n      });\n      return;\n    }\n\n    if (uid !== null && uid !== undefined && parseInt(uid) !== uid) {\n      //user specified uid MUST be integer\n      _Logger2.default.error(\"Input uid is invalid\");\n      onFailure && onFailure(_ErrorCodes2.default.INVALID_PARAMETER);\n      _Report.report.joinGateway(joinInfo.sid, {\n        lts: lts,\n        succ: false,\n        ec: _ErrorCodes2.default.INVALID_PARAMETER,\n        addr: null\n      });\n      return;\n    }\n\n    that.joinInfo = joinInfo;\n    that.uid = uid;\n    that.key = channelKey;\n    // Connect to VosGateway\n    that.state = CONNECTING;\n    connectSocket(joinInfo, function (response) {\n      that.stunServerUrl = response.stunServerUrl;\n      that.turnServer = response.turnServer;\n      that.state = CONNECTED;\n      _Logger2.default.debug(\"Connected to gateway server\");\n\n      that.pingTimer = setInterval(function () {\n        sendMessage(Ping(), function () {}, function (e) {});\n      }, 3000);\n\n      sendMessage(Join(), function (message) {\n        _Report.report.joinGateway(joinInfo.sid, {\n          lts: lts,\n          succ: true,\n          ec: null,\n          vid: message.vid,\n          addr: that.socket.getURL()\n        });\n        onSuccess(that.uid);\n      }, function (err) {\n        _Logger2.default.error(\"User join failed [\" + err + \"]\");\n        onFailure && onFailure(err);\n        _Report.report.joinGateway(joinInfo.sid, {\n          lts: lts,\n          succ: false,\n          ec: err,\n          addr: that.socket.getURL()\n        });\n      });\n    }, function (error) {\n      // error = JSON.stringify(error);\n      _Logger2.default.error(\"User join failed [\" + error + \"]\");\n      onFailure && onFailure(error);\n      _Report.report.joinGateway(joinInfo.sid, {\n        lts: lts,\n        succ: false,\n        ec: error,\n        addr: that.socket.getURL()\n      });\n    });\n  };\n\n  that.leave = function (onSuccess, onFailure) {\n    // Logger.debug(\"Leaving channel ts\", new Date().getTime());\n    if (that.state != CONNECTED) {\n      safeCall(onSuccess);\n      return;\n    }\n\n    clearInterval(that.pingTimer);\n    for (var i in that.timers) {\n      if (that.timers.hasOwnProperty(i)) {\n        clearInterval(that.timers[i]);\n      }\n    }\n\n    sendMessage(Leave(), function (message) {\n      that.socket.close();\n      that.socket = undefined;\n      _Logger2.default.info(\"Leave channal success\");\n      onSuccess && onSuccess(message);\n    }, onFailure);\n\n    // Remove local streams\n    for (var i in that.localStreams) {\n      if (that.localStreams.hasOwnProperty(i)) {\n        var stream = that.localStreams[i];\n        delete that.localStreams[i];\n        if (stream.pc !== undefined) {\n          stream.pc.close();\n          stream.pc = undefined;\n        }\n      }\n    }\n\n    removeRemoteStreams();\n\n    that.state = DISCONNECTED;\n  };\n\n  // It publishes the stream provided as argument.\n  that.publish = function (stream, onSuccess, onFailure) {\n    var lts = new Date().getTime();\n    //TODO rwrite - for the dtls failed can not raise event to report\n    stream.publishLTS = lts;\n\n    if ((typeof stream === \"undefined\" ? \"undefined\" : _typeof(stream)) !== \"object\" || stream === null) {\n      _Logger2.default.error(\"Invalid local stream\");\n      onFailure && onFailure(_ErrorCodes2.default.INVALID_LOCAL_STREAM);\n      _Report.report.publish(that.joinInfo.sid, {\n        lts: lts,\n        succ: false,\n        ec: _ErrorCodes2.default.INVALID_LOCAL_STREAM\n      });\n      return;\n    }\n    if (stream.stream === null && stream.url === undefined) {\n      _Logger2.default.error(\"Invalid local media stream\");\n      onFailure && onFailure(_ErrorCodes2.default.INVALID_LOCAL_STREAM);\n      _Report.report.publish(that.joinInfo.sid, {\n        lts: lts,\n        succ: false,\n        ec: _ErrorCodes2.default.INVALID_LOCAL_STREAM\n      });\n      return;\n    }\n    if (that.state !== CONNECTED) {\n      _Logger2.default.error(\"User is not in the session\");\n      onFailure && onFailure(_ErrorCodes2.default.INVALID_OPERATION);\n      _Report.report.publish(that.joinInfo.sid, {\n        lts: lts,\n        succ: false,\n        ec: _ErrorCodes2.default.INVALID_OPERATION\n      });\n      return;\n    }\n    var options = stream.getAttributes() || {};\n    // If the stream is not local we do nothing\n    if (stream.local && that.localStreams[stream.getId()] === undefined) {\n      // Publish media stream to VoS gateway\n      if (stream.hasAudio() || stream.hasVideo() || stream.hasScreen()) {\n\n        var p2pId = that.generateP2PId();\n\n        if (stream.url !== undefined) {\n          // TODO:   --\n          sendSimpleSdp(Publish({\n            state: \"url\",\n            audio: stream.hasAudio(),\n            video: stream.hasVideo(),\n            attributes: stream.getAttributes(),\n            mode: that.mode\n          }, stream.url), function (answer, id) {\n            if (answer === \"success\") {\n              stream.getUserId = function () {\n                return id;\n              };\n              that.localStreams[id] = stream;\n              stream.onClose = function () {\n                that.unpublish(stream);\n              };\n            } else {\n              _Logger2.default.error(\"Publish local stream failed\", answer);\n            }\n          });\n        } else {\n          // Keep record of the local stream before sending publish message.\n          // We rely on this record to recover when reconnecting.\n          that.localStreams[stream.getId()] = stream;\n          stream.pc = (0, _Connection.Connection)({\n            callback: function callback(offer) {\n              _Logger2.default.debug(\"SDP exchange in publish : send offer --  \", JSON.parse(offer));\n              sendSimpleSdp(Publish({\n                state: \"offer\",\n                id: stream.getId(),\n                audio: stream.hasAudio(),\n                video: stream.hasVideo() || stream.hasScreen(),\n                attributes: stream.getAttributes(),\n                mode: that.mode,\n                codec: that.codec,\n                p2pid: p2pId\n              }, offer), function (answer, info) {\n                if (answer === \"error\") {\n                  _Logger2.default.error(\"Publish local stream failed\");\n                  onFailure && onFailure(_ErrorCodes2.default.PUBLISH_STREAM_FAILED);\n                  _Report.report.publish(that.joinInfo.sid, {\n                    lts: lts,\n                    succ: false,\n                    localSDP: offer,\n                    ec: _ErrorCodes2.default.PUBLISH_STREAM_FAILED\n                  });\n                  return;\n                }\n\n                stream.pc.onsignalingmessage = function (ok) {\n                  stream.pc.onsignalingmessage = function () {};\n                  sendSimpleSdp(Publish({\n                    state: \"ok\",\n                    id: stream.getId(),\n                    audio: stream.hasAudio(),\n                    video: stream.hasVideo(),\n                    screen: stream.hasScreen(),\n                    attributes: stream.getAttributes(),\n                    mode: that.mode\n                  }, ok));\n\n                  stream.getUserId = function () {\n                    return info.id;\n                  };\n                  _Logger2.default.info(\"Local stream published with uid\", info.id);\n                  stream.onClose = function () {\n                    that.unpublish(stream);\n                  };\n                  stream.unmuteAudio = function () {\n                    sendMessage(Control({ \"action\": \"audio-out-on\", \"streamId\": stream.getId() }), function () {}, function () {});\n                  };\n                  stream.unmuteVideo = function () {\n                    sendMessage(Control({ \"action\": \"video-out-on\", \"streamId\": stream.getId() }), function () {}, function () {});\n                  };\n                  stream.muteAudio = function () {\n                    sendMessage(Control({ \"action\": \"audio-out-off\", \"streamId\": stream.getId() }), function () {}, function () {});\n                  };\n                  stream.muteVideo = function () {\n                    sendMessage(Control({ \"action\": \"video-out-off\", \"streamId\": stream.getId() }), function () {}, function () {});\n                  };\n                };\n\n                stream.pc.oniceconnectionstatechange = function (state) {\n                  if (state === \"failed\") {\n                    if (that.timers[stream.getId()] != undefined) {\n                      clearInterval(that.timers[stream.getId()]);\n                    }\n\n                    _Logger2.default.error(\"Publisher connection is lost\");\n                    onFailure && onFailure(_ErrorCodes2.default.PEERCONNECTION_FAILED);\n                    that.p2ps.delete(p2pId);\n                    that.dispatchEvent((0, _Events.ClientEvent)({ type: \"pubP2PLost\", stream: stream }));\n                    _Report.report.publish(that.joinInfo.sid, {\n                      lts: lts,\n                      succ: false,\n                      ec: _ErrorCodes2.default.PEERCONNECTION_FAILED\n                    });\n                  } else if (state === \"connected\") {\n                    that.p2ps.set(p2pId, stream);\n                    stream.p2pId = p2pId;\n                    onSuccess && onSuccess();\n                    // Logger.info(\"Publish success, uid:\", stream.getId());\n                    _Report.report.publish(that.joinInfo.sid, {\n                      lts: lts,\n                      succ: true,\n                      ec: null\n                    });\n                  }\n                };\n\n                _Logger2.default.debug(\"SDP exchange in publish : receive answer --  \", JSON.parse(answer));\n                stream.pc.processSignalingMessage(answer);\n              });\n            }, audio: stream.hasAudio(),\n            video: stream.hasVideo(),\n            screen: stream.hasScreen(),\n            isSubscriber: false,\n            iceServers: [],\n            stunServerUrl: that.stunServerUrl,\n            turnServer: that.turnServer,\n            maxAudioBW: options.maxAudioBW,\n            minVideoBW: options.minVideoBW,\n            maxVideoBW: options.maxVideoBW,\n            mode: that.mode,\n            codec: that.codec\n          });\n\n          stream.pc.addStream(stream.stream);\n          _Logger2.default.debug(\"PeerConnection add stream :\", stream.stream);\n          that.timers[stream.getId()] = setInterval(function () {\n            if (stream && stream.pc && stream.pc.getStats) {\n              stream.pc.getStatsRate(function (stats) {\n                stats.forEach(function (stat) {\n                  // Firefox and Safari get resolution from stream\n                  if ((stat.id.indexOf(\"outbound_rtp\") !== -1 || stat.id.indexOf(\"OutboundRTP\") !== -1) && stat.mediaType === \"video\") {\n                    stat.googFrameWidthSent = stream.videoWidth + '';\n                    stat.googFrameHeightSent = stream.videoHeight + '';\n                  }\n\n                  // stream.getUserId wiil be undefined if pc dtls failed\n                  if (!stream.getUserId) return;\n\n                  if (stream.getId() === stream.getUserId()) {\n                    sendMessage(PublishStats(stat), null, null);\n                  } else {\n                    sendMessage(PublishStatsLow(stat), null, null);\n                  }\n                });\n              });\n            }\n          }, 3000);\n\n          if (stream.aux_stream !== undefined) {\n            stream.pc.addStream(stream.aux_stream);\n            _Logger2.default.debug(\"PeerConnection add stream :\", stream.aux_stream);\n          }\n        }\n      }\n    }\n  };\n\n  // It unpublishes the local stream,\n  // dispatching a StreamEvent(\"stream-removed\")\n  that.unpublish = function (stream, onSuccess, onFailure) {\n    // Logger.debug(\"Start unpublishing local stream\");\n    if ((typeof stream === \"undefined\" ? \"undefined\" : _typeof(stream)) !== \"object\" || stream === null) {\n      _Logger2.default.error(\"Invalid local stream\");\n      safeCall(onFailure, _ErrorCodes2.default.INVALID_LOCAL_STREAM);\n      return;\n    }\n    if (that.state !== CONNECTED) {\n      _Logger2.default.error(\"User not in the session\");\n      safeCall(onFailure, _ErrorCodes2.default.INVALID_OPERATION);\n      return;\n    }\n    if (that.timers[stream.getId()] != undefined) {\n      clearInterval(that.timers[stream.getId()]);\n    }\n    if (that.socket !== undefined) {\n      // Unpublish stream from VoS gateway\n      if (stream.local && that.localStreams[stream.getId()] !== undefined) {\n        delete that.localStreams[stream.getId()];\n        sendMessage(Unpublish(stream.getUserId()), function (answer) {\n          if (answer === \"error\") {\n            _Logger2.default.error(\"Unpublish stream failed\");\n            safeCall(onFailure, _ErrorCodes2.default.UNPUBLISH_STREAM_FAILED);\n            return;\n          }\n          if ((stream.hasAudio() || stream.hasVideo() || stream.hasScreen()) && stream.url === undefined) {\n            if (stream.pc !== undefined) {\n              stream.pc.close();\n              stream.pc = undefined;\n            }\n          }\n          stream.onClose = undefined;\n          stream.unmuteAudio = undefined;\n          stream.muteAudio = undefined;\n          stream.unmuteVideo = undefined;\n          stream.muteVideo = undefined;\n          that.p2ps.delete(stream.p2pId);\n          onSuccess && onSuccess();\n          // Logger.info(\"Unpublish stream success, uid:\", stream.getId());\n        }, onFailure);\n      } else {\n        _Logger2.default.error(\"Invalid local stream\");\n        safeCall(onFailure, _ErrorCodes2.default.INVALID_LOCAL_STREAM);\n      }\n    } else {\n      _Logger2.default.error(\"User not in the session\");\n      safeCall(onFailure, _ErrorCodes2.default.INVALID_OPERATION);\n    }\n  };\n\n  // It subscribes to a remote stream and draws it inside the HTML tag given\n  // by the ID=\"elementID\"\n  that.subscribe = function (stream, onSuccess, onFailure) {\n    var lts = new Date().getTime();\n    //TODO rwrite - for the dtls failed can not raise event to report\n    stream.subscribeLTS = lts;\n\n    if ((typeof stream === \"undefined\" ? \"undefined\" : _typeof(stream)) !== \"object\" || stream === null) {\n      _Logger2.default.error(\"Invalid remote stream\");\n      onFailure && onFailure(_ErrorCodes2.default.INVALID_REMOTE_STREAM);\n      _Report.report.subscribe(that.joinInfo.sid, {\n        lts: lts,\n        succ: false,\n        peerid: stream.getId() + \"\",\n        ec: _ErrorCodes2.default.INVALID_REMOTE_STREAM\n      });\n      return;\n    }\n    if (that.state !== CONNECTED) {\n      _Logger2.default.error(\"User is not in the session\");\n      onFailure && onFailure(_ErrorCodes2.default.INVALID_OPERATION);\n      _Report.report.subscribe(that.joinInfo.sid, {\n        lts: lts,\n        succ: false,\n        peerid: stream.getId() + \"\",\n        ec: _ErrorCodes2.default.INVALID_OPERATION\n      });\n      return;\n    }\n    if (!stream.local && that.remoteStreams.hasOwnProperty(stream.getId())) {\n      if (stream.hasAudio() || stream.hasVideo() || stream.hasScreen()) {\n        var p2pId = that.generateP2PId();\n        stream.pc = (0, _Connection.Connection)({\n          callback: function callback(offer) {\n            _Logger2.default.debug(\"SDP exchange in subscribe : send offer --  \", JSON.parse(offer));\n            sendSimpleSdp(Subscribe({\n              streamId: stream.getId(),\n              audio: true, video: true,\n              mode: that.mode,\n              codec: that.codec,\n              p2pid: p2pId\n            }, offer), function (answer) {\n              if (answer === \"error\") {\n                _Logger2.default.error(\"Subscribe remote stream failed, closing stream \", stream.getId());\n                stream.close();\n                onFailure && onFailure(_ErrorCodes2.default.SUBSCRIBE_STREAM_FAILED);\n                _Report.report.subscribe(that.joinInfo.sid, {\n                  lts: lts,\n                  succ: false,\n                  peerid: stream.getId() + \"\",\n                  ec: _ErrorCodes2.default.SUBSCRIBE_STREAM_FAILED\n                });\n                return;\n              }\n              _Logger2.default.debug(\"SDP exchange in subscribe : receive answer --  \", JSON.parse(answer));\n              stream.pc.processSignalingMessage(answer);\n            });\n          },\n          nop2p: true,\n          audio: true,\n          video: true,\n          screen: stream.hasScreen(),\n          isSubscriber: true,\n          iceServers: [],\n          stunServerUrl: that.stunServerUrl,\n          turnServer: that.turnServer\n        });\n\n        stream.pc.onaddstream = function (evt, type) {\n          // Draw on html\n          if (type === \"ontrack\" && evt.track.kind === \"video\" || type === \"onaddstream\") {\n            _Logger2.default.info(\"Remote stream subscribed with uid \", stream.getId());\n            if (type === \"onaddstream\") {\n              that.remoteStreams[stream.getId()].stream = evt.stream;\n            } else {\n              that.remoteStreams[stream.getId()].stream = evt.streams[0];\n            }\n            if (!that.remoteStreams[stream.getId()].hasVideo()) {\n              that.remoteStreams[stream.getId()].disableVideo();\n            } else {\n              if ((0, _Browser.isFireFox)()) {\n                var st = that.remoteStreams[stream.getId()].stream;\n                (0, _Helper.vsResHack)(st, function (videoWidth, videoHeight) {\n                  stream.videoWidth = videoWidth;\n                  stream.videoHeight = videoHeight;\n                }, function (e) {\n                  return _Logger2.default.warning('vsResHack failed:' + e);\n                });\n              }\n            }\n            var subscribeEvt = (0, _Events.StreamEvent)({\n              type: \"stream-subscribed\", stream: that.remoteStreams[stream.getId()] });\n            that.dispatchEvent(subscribeEvt);\n          }\n          stream.unmuteAudio = function () {\n            sendMessage(Control({ \"action\": \"audio-in-on\", \"streamId\": stream.getId() }), function () {}, function () {});\n          };\n          stream.muteAudio = function () {\n            sendMessage(Control({ \"action\": \"audio-in-off\", \"streamId\": stream.getId() }), function () {}, function () {});\n          };\n          stream.unmuteVideo = function () {\n            sendMessage(Control({ \"action\": \"video-in-on\", \"streamId\": stream.getId() }), function () {}, function () {});\n          };\n          stream.muteVideo = function () {\n            sendMessage(Control({ \"action\": \"video-in-off\", \"streamId\": stream.getId() }), function () {}, function () {});\n          };\n        };\n\n        // for argus\n        that.timers[stream.getId()] = setInterval(function () {\n          if (stream && stream.pc && stream.pc.getStats) {\n            stream.pc.getStatsRate(function (stats) {\n              stats.forEach(function (stat) {\n                // Firefox get resolution from stream\n                if (stat.id.indexOf(\"inbound_rtp\") !== -1 && stat.mediaType === \"video\") {\n                  stat.googFrameWidthReceived = stream.videoWidth + '';\n                  stat.googFrameHeightReceived = stream.videoHeight + '';\n                }\n                sendSimpleSdp(SubscribeStats(stream.getId(), stat), null, null);\n              });\n            });\n          }\n        }, 3000);\n\n        // find active-speaker\n        that.audioLevel[stream.getId()] = 0;\n        that.timers[stream.getId() + \"audio\"] = setInterval(function () {\n          if (stream && stream.pc && stream.pc.getStats) {\n            stream.pc.getStats(function (stats) {\n              stats.forEach(function (stat) {\n                if (stat.mediaType === \"audio\") {\n                  //Logger.info(\"[zzz] uid:\"+stream.getId()+\" output level\"+stat.audioOutputLevel);\n                  if (stat.audioOutputLevel > 5000) {\n                    if (that.audioLevel[stream.getId()] < 20) {\n                      that.audioLevel[stream.getId()] += 1;\n                      //Logger.info(\"[xxx] user:\"+stream.getId()+\" counter:\"+that.audioLevel[stream.getId()]);\n                    }\n                    for (var i in that.audioLevel) {\n                      if (parseInt(i) !== stream.getId() && that.audioLevel[i] > 0) {\n                        that.audioLevel[i] -= 1;\n                        //Logger.info(\"[yyy] user:\"+i+\" counter:\"+that.audioLevel[i]+\" stream:\"+stream.getId());\n                      }\n                    }\n                  }\n                  var unsortedKeys = Object.keys(that.audioLevel);\n                  var sortedUids = unsortedKeys.sort(function (uid1, uid2) {\n                    return that.audioLevel[uid2] - that.audioLevel[uid1];\n                  });\n                  if (that.activeSpeaker !== sortedUids[0]) {\n                    var evt = (0, _Events.ClientEvent)({ type: \"active-speaker\", uid: sortedUids[0] });\n                    that.dispatchEvent(evt);\n                    that.activeSpeaker = sortedUids[0];\n                    _Logger2.default.debug(\"Update active speaker:\" + that.activeSpeaker);\n                  }\n                }\n              });\n            });\n          }\n        }, 50);\n\n        stream.pc.oniceconnectionstatechange = function (state) {\n          if (state === \"failed\") {\n            if (that.timers[stream.getId()] != undefined) {\n              clearInterval(that.timers[stream.getId()]);\n              clearInterval(that.timers[stream.getId()] + \"audio\");\n            }\n            that.p2ps.delete(p2pId);\n            _Logger2.default.error(\"Subscriber connection is lost\", stream.getId());\n            onFailure && onFailure(_ErrorCodes2.default.PEERCONNECTION_FAILED);\n            if (that.remoteStreams[stream.getId()]) {\n              that.dispatchEvent((0, _Events.ClientEvent)({ type: \"subP2PLost\", stream: stream }));\n            }\n            _Report.report.subscribe(that.joinInfo.sid, {\n              lts: lts,\n              succ: false,\n              peerid: stream.getId() + \"\",\n              ec: _ErrorCodes2.default.PEERCONNECTION_FAILED\n            });\n          } else if (state === \"connected\") {\n            that.p2ps.set(p2pId, stream);\n            stream.p2pId = p2pId;\n            onSuccess && onSuccess();\n            _Report.report.subscribe(that.joinInfo.sid, {\n              lts: lts,\n              succ: true,\n              peerid: stream.getId() + \"\",\n              ec: null\n            });\n            // Report first frame\n            that.firstFrameTimer.set(stream.getId(), setInterval(function () {\n              if (stream.pc) {\n                stream.pc.getStats(function (stats) {\n                  stats.forEach(function (stat) {\n                    if (stat.id.indexOf(\"recv\") !== -1 || stat.id.indexOf(\"inbound_rtp\") !== -1 || stat.id.indexOf(\"InboundRTP\") !== -1) {\n                      if (stat.mediaType === \"video\") {\n                        if (stat.framesDecoded > 0 || stat.googFramesDecoded > 0) {\n                          clearInterval(that.firstFrameTimer.get(stream.getId()));\n                          that.firstFrameTimer.delete(stream.getId());\n                          _Report.report.firstRemoteFrame(that.joinInfo.sid, {\n                            lts: new Date().getTime(),\n                            peerid: stream.getId() + \"\",\n                            succ: true,\n                            width: +stat.googFrameWidthReceived,\n                            height: +stat.googFrameHeightReceived\n                          });\n                        }\n                      }\n                    }\n                  });\n                });\n              } else {\n                clearInterval(that.firstFrameTimer.get(stream.getId()));\n                that.firstFrameTimer.delete(stream.getId());\n              }\n            }, 100));\n          }\n        };\n      } else {\n        _Logger2.default.error(\"Invalid remote stream\");\n        onFailure && onFailure(_ErrorCodes2.default.INVALID_REMOTE_STREAM);\n        _Report.report.subscribe(that.joinInfo.sid, {\n          lts: lts,\n          succ: false,\n          peerid: stream.getId() + \"\",\n          ec: _ErrorCodes2.default.INVALID_REMOTE_STREAM\n        });\n      }\n    } else {\n      _Logger2.default.error(\"Invalid remote stream\");\n      onFailure && onFailure(_ErrorCodes2.default.INVALID_REMOTE_STREAM);\n      _Report.report.subscribe(that.joinInfo.sid, {\n        lts: lts,\n        succ: false,\n        peerid: stream.getId() + \"\",\n        ec: _ErrorCodes2.default.INVALID_REMOTE_STREAM\n      });\n    }\n  };\n\n  // It unsubscribes from the stream, removing the HTML element\n  that.unsubscribe = function (stream, onSuccess, onFailure) {\n    // Logger.debug(\"Start unsubscribing remote stream with uid\", stream.getId());\n    if ((typeof stream === \"undefined\" ? \"undefined\" : _typeof(stream)) !== \"object\" || stream === null) {\n      _Logger2.default.error(\"Invalid remote stream\");\n      safeCall(onFailure, _ErrorCodes2.default.INVALID_REMOTE_STREAM);\n      return;\n    }\n\n    if (that.state !== CONNECTED) {\n      _Logger2.default.error(\"User is not in the session\");\n      safeCall(onFailure, _ErrorCodes2.default.INVALID_OPERATION);\n      return;\n    }\n\n    if (that.timers[stream.getId()] != undefined) {\n      clearInterval(that.timers[stream.getId()]);\n      clearInterval(that.timers[stream.getId()] + \"audio\");\n    }\n\n    if (that.audioLevel[stream.getId()] != undefined) {\n      delete that.audioLevel[stream.getId()];\n    }\n\n    if (that.timer_counter[stream.getId()] != undefined) {\n      delete that.timer_counter[stream.getId()];\n    }\n\n    if (!that.remoteStreams.hasOwnProperty(stream.getId())) {\n      safeCall(onFailure, _ErrorCodes2.default.NO_SUCH_REMOTE_STREAM);\n      return;\n    }\n    if (!that.socket) {\n      _Logger2.default.error(\"User is not in the session\");\n      safeCall(onFailure, _ErrorCodes2.default.INVALID_OPERATION);\n      return;\n    }\n\n    if (stream.local) {\n      _Logger2.default.error(\"Invalid remote stream\");\n      safeCall(onFailure, _ErrorCodes2.default.INVALID_REMOTE_STREAM);\n      return;\n    }\n\n    stream.close();\n    // delete that.remoteStreams[stream.getId()];\n\n    sendMessage(Unsubscribe(stream.getId()), function (answer) {\n      if (answer === \"error\") {\n        _Logger2.default.error(\"Unsubscribe remote stream failed\", stream.getId());\n        safeCall(onFailure, _ErrorCodes2.default.UNSUBSCRIBE_STREAM_FAILED);\n        return;\n      }\n      if (stream.pc !== undefined) {\n        stream.pc.close();\n        stream.pc = undefined;\n      }\n      stream.onClose = undefined;\n      stream.unmuteAudio = undefined;\n      stream.muteAudio = undefined;\n      stream.unmuteVideo = undefined;\n      stream.muteVideo = undefined;\n\n      that.p2ps.delete(stream.p2pId);\n      _Logger2.default.info(\"Unsubscribe stream success\");\n      that.dispatchEvent((0, _Events.ClientEvent)({ type: \"stream-removed\", uid: stream.getId(), stream: stream }));\n      onSuccess && onSuccess();\n    }, onFailure);\n  };\n\n  that.setRemoteVideoStreamType = function (stream, streamType) {\n    _Logger2.default.debug(\"Switching remote video stream \" + stream.getId() + \" to \" + streamType);\n    if ((typeof stream === \"undefined\" ? \"undefined\" : _typeof(stream)) !== \"object\" || stream === null) {\n      _Logger2.default.error(\"Invalid remote stream\");\n      return;\n    }\n    if (that.state !== CONNECTED) {\n      _Logger2.default.error(\"User is not in the session\");\n      return;\n    }\n    if (!stream.local) {\n      switch (streamType) {\n        case that.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_HIGH:\n        case that.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_LOW:\n        case that.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_MEDIUM:\n          break;\n        default:\n          //safeCall(onFailure, ErrorCodes.INVALID_OPERATION);\n          return;\n      }\n      sendMessage(SwitchVideoStream(stream.getId(), streamType), null, null);\n    } else {\n      //safeCall(onFailure, ErrorCodes.INVALID_REMOTE_STREAM);\n    }\n  };\n\n  that.startLiveStreaming = function (url, transcodingEnabled) {\n    that.liveStreams.set(url, transcodingEnabled);\n    _Logger2.default.debug(\"Start live streaming \" + url + \" transcodingEnabled \" + transcodingEnabled);\n    if (that.state !== CONNECTED) {\n      _Logger2.default.error(\"User is not in the session\");\n      return;\n    }\n    sendMessage(StartLiveStreaming(url, transcodingEnabled), null, null);\n  };\n\n  that.stopLiveStreaming = function (url) {\n    _Logger2.default.debug(\"Stop live streaming \" + url);\n    if (that.state !== CONNECTED) {\n      _Logger2.default.error(\"User is not in the session\");\n      return;\n    }\n    that.liveStreams.delete(url);\n    sendMessage(StopLiveStreaming(url), null, null);\n  };\n\n  that.setLiveTranscoding = function (transcoding) {\n    if (!(0, _Helper.isLiveTranscodingValid)(transcoding)) {\n      return;\n    }\n    that.transcoding = transcoding;\n    _Logger2.default.debug(\"Set live transcoding \", transcoding);\n    if (that.state !== CONNECTED) {\n      _Logger2.default.error(\"User is not in the session\");\n      return;\n    }\n    sendMessage(SetLiveTranscoding(transcoding), null, null);\n  };\n\n  var generateInterval = function generateInterval(k) {\n    return Math.min(30, Math.pow(2, k) - 1) * 1000;\n  };\n\n  var recover = function recover() {\n    if (that.key) {\n      _Logger2.default.info(\"Re-joining to channel \" + that.joinInfo.cname);\n      that.join(that.joinInfo, that.key, function (uid) {\n        _Logger2.default.info(\"User \" + uid + \" is re-joined to \" + that.joinInfo.cname);\n        //TODO rewrite\n        for (var streamId in that.localStreams) {\n          if (that.localStreams[streamId] !== undefined) {\n            var stream = that.localStreams[streamId];\n            delete that.localStreams[streamId];\n            if (stream.pc !== undefined) {\n              stream.pc.close();\n              stream.pc = undefined;\n            }\n          }\n        }\n        that.dispatchEvent((0, _Events.ClientEvent)({ type: \"rejoin\" }));\n        // Logger.info(\"Publish the old local stream again\");\n        // that.publish(stream, function (err) {\n        //   Logger.error(\"Publish the old stream failed\");\n        // });\n        if (that.liveStreams && that.liveStreams.size) {\n          that.liveStreams.forEach(function (value, key) {\n            if (value) {\n              that.setLiveTranscoding(that.transcoding);\n            }\n            that.startLiveStreaming(key, value);\n          });\n        }\n      }, function (err) {\n        _Logger2.default.error(\"Re-join to channel failed [\" + err + \"]\");\n        if (err === 'ERR_DYNAMIC_KEY_TIMEOUT') {\n          var evt = (0, _Events.StreamEvent)({ type: \"error\", reason: _ErrorCodes2.default.DYNAMIC_KEY_TIMEOUT });\n          that.dispatchEvent(evt);\n          var time = generateInterval(that.attemps);\n          _Logger2.default.error(\"Connect to server failed [Channel key timeout], attempt to recover [#\" + that.attemps + \"] after \" + time / 1000 + \" seconds\");\n          var timer = setTimeout(function () {\n            that.attemps++;\n            if (that.socket !== undefined) {\n              that.socket.disconnect();\n            }\n          }, time);\n        } else {\n          that.dispatchEvent((0, _Events.StreamEvent)({ type: \"error\", reason: err }));\n        }\n      });\n    } else {\n      _Logger2.default.error(\"Connection recover failed [Invalid channel key]\");\n    }\n  };\n\n  var createSocket = function createSocket(host) {\n    that.socket = (0, _Websocket2.default)(host, { sid: that.joinInfo.sid });\n  };\n\n  var connectSocket = function connectSocket(joinInfo, callback, error) {\n    // Once we have connected\n    var max_connect_attempts = 10;\n    var connect_timeout_attempt = 0;\n    // Deal with transport close\n    // Sometimes socket.io will disconnect immediately after connected,\n    // we need some strategy to deal with this case.\n\n    // This handles reconnection.\n    // If we try to re-initialize \"that.socket\" each time when connecting,\n    // reconnecting after disconnected from gateway could not result in sucess.\n    // However, we could simply reuse previous created \"that.socket\" to\n    // re-establish the connection between client and gateway, by calling\n    // \"that.socket.socket.connect()\". And we don\"t delete \"that.socket\"\n    // when \"client-disconnect\" event triggered.\n    if (that.socket !== undefined) {\n      that.socket.socket.connect();\n    } else {\n      // Create socket connection.\n      createSocket(joinInfo.gatewayAddr);\n\n      that.socket.on(\"onUplinkStats\", function (args) {\n        if (that.localStreams[that.uid]) {\n          that.localStreams[that.uid].uplinkStats = args;\n        }\n      });\n\n      // Add connect event listener.\n      that.socket.on(\"connect\", function () {\n        that.attemps = 1;\n        sendMessage(Token(joinInfo), callback, error);\n      });\n\n      that.socket.on(\"reconnect\", function () {\n        _Logger2.default.debug(\"Try to reconnect choose server and get gateway list again \");\n        (0, _Server.getGatewayList)(that.joinInfo, function (res) {\n          that.socket.reconnect(res.gateway_addr);\n        });\n      });\n\n      // Add connect_error event listener.\n      that.socket.on(\"connect_error\", function (err) {\n        // Clear peer connection stats timers\n        for (var i in that.timers) {\n          if (that.timers.hasOwnProperty(i)) {\n            clearInterval(that.timers[i]);\n          }\n        }\n\n        for (var i in that.remoteStreams) {\n          if (that.remoteStreams.hasOwnProperty(i)) {\n            var stream = that.remoteStreams[i];\n            // Dispatch peer leave event\n            var evt = (0, _Events.ClientEvent)({ type: \"stream-removed\", uid: stream.getId(), stream: stream });\n            that.dispatchEvent(evt);\n          }\n        }\n\n        removeRemoteStreams();\n        if (isBanned == true) return;\n\n        clearInterval(that.pingTimer);\n        that.state = DISCONNECTED;\n        that.socket = undefined;\n        var evt = (0, _Events.StreamEvent)({ type: \"error\", reason: _ErrorCodes2.default.SOCKET_ERROR });\n        that.dispatchEvent(evt);\n\n        var time = generateInterval(that.attemps);\n        _Logger2.default.error(\"Connect to server error [\" + JSON.stringify(err) + \"], attempt to recover [#\" + that.attemps + \"] after \" + time / 1000 + \" seconds\");\n        var timer = setTimeout(function () {\n          // We\"ve tried to reconnect so increase the attempts by 1\n          that.attemps++;\n          recover();\n        }, time);\n      });\n\n      that.socket.on(\"disconnect\", function (reason) {\n        if (that.state === DISCONNECTED) return;\n        that.state = DISCONNECTED;\n\n        // Clear peer connection stats timers\n        for (var i in that.timers) {\n          if (that.timers.hasOwnProperty(i)) {\n            clearInterval(that.timers[i]);\n          }\n        }\n\n        for (var i in that.remoteStreams) {\n          if (that.remoteStreams.hasOwnProperty(i)) {\n            var stream = that.remoteStreams[i];\n            // Dispatch peer leave event\n            var evt = (0, _Events.ClientEvent)({ type: \"stream-removed\", uid: stream.getId(), stream: stream });\n            that.dispatchEvent(evt);\n          }\n        }\n\n        that.p2ps.clear();\n        removeRemoteStreams();\n        if (isBanned == true) return;\n        clearInterval(that.pingTimer);\n        that.socket = undefined;\n        //safeCall(error, ErrorCodes.SOCKET_DISCONNECTED);\n        var evt = (0, _Events.StreamEvent)({ type: \"error\", reason: _ErrorCodes2.default.SOCKET_DISCONNECTED });\n        that.dispatchEvent(evt);\n\n        var time = generateInterval(that.attemps);\n        _Logger2.default.error(\"Disconnect from server [\" + reason + \"], attempt to recover [#\" + that.attemps + \"] after \" + time / 1000 + \" seconds\");\n        var timer = setTimeout(function () {\n          // We\"ve tried to reconnect so increment the attempts by 1\n          that.attemps++;\n          recover();\n        }, time);\n      });\n\n      // We receive an event with a new stream.\n      // type can be \"media\" or \"data\"\n      that.socket.on(\"onAddAudioStream\", function (arg) {\n        _Logger2.default.info(\"Newly added audio stream with uid\", arg.id);\n        if (that.remoteStreams[arg.id] === undefined) {\n          var stream = (0, _Stream.Stream)({\n            streamID: arg.id, local: false, audio: arg.audio, video: arg.video,\n            screen: arg.screen, attributes: arg.attributes });\n          that.remoteStreams[arg.id] = stream;\n          var evt = (0, _Events.StreamEvent)({ type: \"stream-added\", stream: stream });\n          that.dispatchEvent(evt);\n        }\n      });\n\n      that.socket.on(\"onAddVideoStream\", function (arg) {\n        _Logger2.default.info(\"Newly added remote stream with uid\", arg.id);\n        if (that.remoteStreams[arg.id] === undefined) {\n          var stream = (0, _Stream.Stream)({\n            streamID: arg.id, local: false, audio: arg.audio, video: arg.video,\n            screen: arg.screen, attributes: arg.attributes });\n          that.remoteStreams[arg.id] = stream;\n          var evt = (0, _Events.StreamEvent)({ type: \"stream-added\", stream: stream });\n          that.dispatchEvent(evt);\n        } else {\n          if (that.remoteStreams[arg.id].stream !== undefined) {\n            that.remoteStreams[arg.id].video = true;\n            that.remoteStreams[arg.id].enableVideo();\n            _Logger2.default.info(\"Stream changed: enable video \" + arg.id);\n            var st = that.remoteStreams[arg.id];\n            var element = st.player.elementID;\n            st.stop();\n            st.play(element);\n          } else {\n            var stream = (0, _Stream.Stream)({\n              streamID: arg.id, local: false, audio: true, video: true,\n              screen: false, attributes: arg.attributes });\n            that.remoteStreams[arg.id] = stream;\n            _Logger2.default.info(\"Stream changed: modify video \" + arg.id);\n          }\n        }\n      });\n\n      // We receive an event of a stream removed\n      that.socket.on(\"onRemoveStream\", function (arg) {\n        var stream = that.remoteStreams[arg.id];\n        if (!stream) {\n          console.log(\"ERROR stream \", arg.id, \" not found onRemoveStream \", arg);\n          return;\n        }\n        delete that.remoteStreams[arg.id];\n        var evt = (0, _Events.StreamEvent)({ type: \"stream-removed\", stream: stream });\n        that.dispatchEvent(evt);\n        stream.close();\n        if (stream.pc !== undefined) {\n          stream.pc.close();\n          stream.pc = undefined;\n        }\n      });\n\n      // We receive an event of local stream published\n      that.socket.on(\"onPublishStream\", function (arg) {\n        var stream = that.localStreams[arg.id];\n        var evt = (0, _Events.StreamEvent)({ type: \"stream-published\", stream: stream });\n        that.dispatchEvent(evt);\n      });\n\n      that.socket.on(\"mute_audio\", function (arg) {\n        _Logger2.default.info(\"rcv peer mute audio\");\n        var evt = (0, _Events.ClientEvent)({ type: \"mute-audio\", uid: arg.peerid });\n        that.dispatchEvent(evt);\n      });\n\n      that.socket.on(\"unmute_audio\", function (arg) {\n        _Logger2.default.info(\"rcv peer unmute audio\");\n        var evt = (0, _Events.ClientEvent)({ type: \"unmute-audio\", uid: arg.peerid });\n        that.dispatchEvent(evt);\n      });\n\n      that.socket.on(\"mute_video\", function (arg) {\n        _Logger2.default.info(\"rcv peer mute video\");\n        var evt = (0, _Events.ClientEvent)({ type: \"mute-video\", uid: arg.peerid });\n        that.dispatchEvent(evt);\n      });\n\n      that.socket.on(\"unmute_video\", function (arg) {\n        _Logger2.default.info(\"rcv peer unmute video\");\n        var evt = (0, _Events.ClientEvent)({ type: \"unmute-video\", uid: arg.peerid });\n        that.dispatchEvent(evt);\n      });\n\n      that.socket.on(\"user_banned\", function (arg) {\n        _Logger2.default.info(\"user banned uid:\" + arg.id + \"error:\" + arg.errcode);\n        var evt = (0, _Events.ClientEvent)({ type: \"client-banned\", uid: arg.id, attr: arg.errcode });\n        that.dispatchEvent(evt);\n        isBanned = true;\n        leave();\n      });\n\n      that.socket.on(\"onP2PLost\", function (arg) {\n        _Logger2.default.debug(\"p2plost:\", arg);\n        if (arg.event === 'publish') {\n          var _stream = that.localStreams[arg.uid];\n          _stream && _Report.report.publish(that.joinInfo.sid, {\n            lts: _stream.publishLTS,\n            succ: false,\n            ec: 'DTLS failed'\n          });\n        }\n\n        if (arg.event === 'subscribe') {\n          var _stream2 = that.remoteStreams[arg.uid];\n          _stream2 && _Report.report.subscribe(that.joinInfo.sid, {\n            lts: _stream2.subscribeLTS,\n            succ: false,\n            peerid: arg.uid + '',\n            ec: 'DTLS failed'\n          });\n        }\n\n        _Logger2.default.debug('p2plost:', arg.p2pid);\n        var stream = that.p2ps.get(arg.p2pid);\n        if (stream) {\n          that.p2ps.delete(arg.p2pid);\n          if (stream.local) {\n            that.dispatchEvent((0, _Events.ClientEvent)({ type: \"pubP2PLost\", stream: stream }));\n          } else {\n            if (that.remoteStreams[stream.getId()]) {\n              that.dispatchEvent((0, _Events.ClientEvent)({ type: \"subP2PLost\", stream: stream }));\n            }\n          }\n        }\n      });\n\n      // We receive an event of a client leaved\n      that.socket.on(\"onPeerLeave\", function (arg) {\n        var evt = (0, _Events.ClientEvent)({ type: \"peer-leave\", uid: arg.id });\n        if (that.remoteStreams.hasOwnProperty(arg.id)) {\n          evt.stream = that.remoteStreams[arg.id];\n        }\n        that.dispatchEvent(evt);\n\n        if (that.remoteStreams.hasOwnProperty(arg.id)) {\n          _Logger2.default.info(\"closing stream on peer leave\", arg.id);\n          var stream = that.remoteStreams[arg.id];\n          stream.close();\n          delete that.remoteStreams[arg.id];\n          if (stream.pc !== undefined) {\n            stream.pc.close();\n            stream.pc = undefined;\n          }\n        }\n\n        if (that.timers.hasOwnProperty(arg.id)) {\n          clearInterval(that.timers[arg.id]);\n          delete that.timers[arg.id];\n        }\n\n        if (that.audioLevel[arg.id] != undefined) {\n          delete that.audioLevel[arg.id];\n        }\n\n        if (that.timer_counter[arg.id] != undefined) {\n          delete that.timer_counter[arg.id];\n        }\n      });\n\n      that.socket.on(\"onUplinkStats\", function (args) {});\n\n      that.socket.on(\"liveStreamingStarted\", function (args) {\n        var evt = (0, _Events.LiveStreamingEvent)({ type: \"liveStreamingStarted\", url: args.url });\n        that.dispatchEvent(evt);\n      });\n\n      that.socket.on(\"liveStreamingFailed\", function (args) {\n        var evt = (0, _Events.LiveStreamingEvent)({ type: \"liveStreamingFailed\", url: args.url });\n        that.dispatchEvent(evt);\n      });\n\n      that.socket.on(\"liveStreamingStopped\", function (args) {\n        var evt = (0, _Events.LiveStreamingEvent)({ type: \"liveStreamingStopped\", url: args.url });\n        that.dispatchEvent(evt);\n      });\n      that.socket.on(\"liveTranscodingUpdated\", function (args) {\n        var evt = (0, _Events.LiveStreamingEvent)({ type: \"liveTranscodingUpdated\", reason: args.reason });\n        that.dispatchEvent(evt);\n      });\n    }\n  };\n\n  var sendMessage = function sendMessage(message, callback, error) {\n    if (that.socket === undefined) {\n      _Logger2.default.error(\"No socket available\");\n      safeCall(error, _ErrorCodes2.default.INVALID_OPERATION);\n      return;\n    }\n    try {\n      that.socket.emitSimpleMessage(message, function (respType, result) {\n        if (respType === \"success\") {\n          if (typeof callback === \"function\") {\n            callback(result);\n          }\n        } else {\n          if (typeof error === \"function\") {\n            error(_ErrorCodes.GatewayErrorCode[result] || result);\n          }\n        }\n      });\n    } catch (err) {\n      _Logger2.default.error(\"Socket emit message failed\" + JSON.stringify(message));\n      _Logger2.default.error(err);\n      safeCall(error, _ErrorCodes2.default.SOCKET_ERROR);\n    }\n  };\n\n  // It sends a SDP message to the server using socket.io\n  var sendSimpleSdp = function sendSimpleSdp(message, callback) {\n    if (that.socket === undefined) {\n      _Logger2.default.error(\"Error in sendSimpleSdp [socket not ready]\");\n      return;\n    }\n    try {\n      that.socket.emitSimpleMessage(message, function (response, respCallback) {\n        callback && callback(response, respCallback);\n      });\n    } catch (err) {\n      _Logger2.default.error(\"Error in sendSimpleSdp [\" + err + \"]\");\n    }\n  };\n\n  function removeRemoteStreams() {\n    for (var i in that.remoteStreams) {\n      if (that.remoteStreams.hasOwnProperty(i)) {\n        var stream = that.remoteStreams[i];\n        stream.stop();\n        stream.close();\n        delete that.remoteStreams[i];\n        if (stream.pc !== undefined) {\n          stream.pc.close();\n          stream.pc = undefined;\n        }\n      }\n    }\n  }\n\n  return that;\n};\n\nexports.default = GatewayClient;\n\n/***/ }),\n/* 34 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _Signal = __webpack_require__(35);\n\nvar _Signal2 = _interopRequireDefault(_Signal);\n\nvar _Events = __webpack_require__(4);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/*\n\nAPI used in Client.js\n\nthat.socket = io.connect(host, {timeout: 10000, reconnection: false, secure: true, transports:['websocket'], upgrade: false});\nthat.socket = io.connect(host, {timeout: 10000, reconnection: false, secure: false, transports:['websocket'], upgrade: false});\n\nthat.socket.connect();          // --> that.socket.socket.connect();\nthat.socket.disconnect();\nthat.socket.disconnect();\n\nthat.socket.on('connect', function () {                         \nthat.socket.on('connect_error', function (err) {\nthat.socket.on('disconnect', function (reason) {\nthat.socket.on('onAddAudioStream', function (arg) {\nthat.socket.on('onAddVideoStream', function (arg) {\nthat.socket.on('onRemoveStream', function (arg) {\nthat.socket.on('onPublishStream', function (arg) {\nthat.socket.on('onP2PLost', function (arg) {\nthat.socket.on('onPeerLeave', function (arg) {\n\nthat.socket.emit(type, msg, function (respType, msg) {\n    //      sendMessageSocket('token', token, callback, error);\n            sendMessageSocket = function (type, msg, callback, error) {\n            sendMessageSocket('customMessage', msg, function (uid) {\n            sendMessageSocket('customMessage', {\"type\": \"leave\"}, onSuccess, onFailure);\n            sendMessageSocket(\n            sendMessageSocket(\n            sendMessageSocket(\n            sendMessageSocket(\n            sendMessageSocket('p2p_lost', undefined, function () {}, function () {});\n            sendMessageSocket('unpublish', stream.getId(), function (answer) {\n            sendMessageSocket(\n            sendMessageSocket(\n            sendMessageSocket(\n            sendMessageSocket(\n            sendMessageSocket('p2p_lost', undefined, function () {}, function () {});\n            sendMessageSocket('unsubscribe', stream.getId(), function (answer) {\n            sendMessageSocket('switchVideoStream', {id: stream.getId(), type: streamType}, null, null);\n\n\nthat.socket.emit(type, options, sdp, function (response, respCallback) {\n    //      sendSDPSocket('publish', {...}, stream.url, function (answer, id) {\n            sendSDPSocket('publish', {...}, offer, function (answer, info) {\n            sendSDPSocket('publish', {...}, ok);\n            sendSDPSocket('publish_stats', {stats: stats}, null, null);\n            sendSDPSocket('subscribe', {...}, offer, function (answer) {\n            sendSDPSocket('subscribe_stats', {...}, null, null);\n\n\n*/\nvar Socket = function Socket(host, spec) {\n\n    var that = {};\n\n    that.connect = function () {\n        spec.host = host;\n        that.signal = (0, _Signal2.default)(spec);\n        that.on = that.signal.on;\n        that.dispatchEvent = that.signal.dispatchEvent;\n\n        that.signal.on('onopen', function (e) {\n            that.signal.onEvent = function (e) {\n                that.dispatchEvent((0, _Events.MediaEvent)({ type: e.event, msg: e }));\n            };\n\n            that.dispatchEvent((0, _Events.MediaEvent)({ type: 'connect', msg: e }));\n        });\n\n        that.signal.on('onError', function (ev) {\n            var m = ev.msg;\n            onError(m.code, 'error');\n        });\n    };\n\n    that.disconnect = function () {\n        that.signal.disconnect();\n    };\n\n    that.close = function () {\n        that.signal.close();\n    };\n\n    that.getURL = function () {\n        return that.signal.getURL();\n    };\n\n    that.reconnect = function (host) {\n        that.signal.creatConnection(host);\n    };\n\n    that.emitSimpleMessage = function (message, callback) {\n        that.signal.sendSignalCommand(message, callback);\n    };\n\n    that.connect();\n    return that;\n};\n\nexports.default = Socket;\n\n/***/ }),\n/* 35 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _Events = __webpack_require__(4);\n\nvar _AgoraCall = __webpack_require__(12);\n\nvar _AgoraCall2 = _interopRequireDefault(_AgoraCall);\n\nvar _Logger = __webpack_require__(0);\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _Report = __webpack_require__(5);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar Signal = function Signal(spec) {\n  var that = (0, _Events.EventDispatcher)(spec);\n  that.needReconnect = true;\n  that.isTimeout = false;\n  that.isInit = true;\n\n  // test\n  // spec.host = [\n  //   \"webgw-shaoxing-cucc-1111.agora.io:5867\",\n  //   \"gw.agora.io:5688\",\n  //   \"webgw-shaoxing-cucc-1.agora.io:5867\"\n  // ];\n\n  that.hostIndex = 0;\n  that.requestID = 0;\n  if (spec.host instanceof Array) {\n    that.host = spec.host;\n  } else {\n    that.host = [spec.host];\n  }\n\n  that.Reconnection = function (host) {\n    that.host = host || that.host;\n    that.hostIndex = 0;\n    that.creatConnection();\n  };\n\n  that.getURL = function () {\n    return that.connection.url;\n  };\n\n  that.creatConnection = function () {\n    if (that.hostIndex >= that.host.length) {\n      that.hostIndex = 0;\n      that.dispatchEvent((0, _Events.MediaEvent)({ type: \"reconnect\" }));\n      return;\n    }\n    _Logger2.default.debug(\"start connect:\" + that.host[that.hostIndex]);\n    that.lts = new Date().getTime();\n\n    //agora daily build\n    that.connection = new WebSocket(\"wss://\" + that.host[that.hostIndex++]);\n\n    //onopen\n    that.connection.onopen = function (e) {\n      _Logger2.default.debug(\"websockect opened\");\n      that.isTimeout = false;\n      that.isInit = false;\n      clearTimeout(that.timeoutCheck);\n      that.dispatchEvent((0, _Events.MediaEvent)({ type: 'onopen', event: e, socket: that }));\n    };\n\n    //onmessage\n    that.connection.onmessage = function (e) {\n      // Logger.debug(\"websockect onmessage:\", e);\n      var m = JSON.parse(e.data);\n      if (m.hasOwnProperty(\"_id\")) {\n        that.dispatchEvent((0, _Events.MediaEvent)({ type: m._id, msg: m }));\n      } else if (m.hasOwnProperty(\"_type\")) {\n        that.dispatchSocketEvent((0, _Events.MediaEvent)({ type: m._type, msg: m.message }));\n      }\n    };\n\n    //onclose\n    that.connection.onclose = function (e) {\n      if (!that.needReconnect) {\n        _Logger2.default.debug(\"websockect closeed\");\n        (0, _AgoraCall2.default)(spec.onFailure, e);\n        clearTimeout(that.timeoutCheck);\n        that.dispatchEvent((0, _Events.MediaEvent)({ type: 'close', event: e }));\n        that.connection.onopen = undefined;\n        that.connection.onclose = undefined;\n        that.connection.onerror = undefined;\n        that.connection.onmessage = undefined;\n        that.connection = undefined;\n      } else {\n        if (!that.isTimeout && !that.isInit) {\n          that.dispatchEvent((0, _Events.MediaEvent)({ type: 'disconnect', event: e }));\n        } else {\n          _Logger2.default.debug(\"websockect connect timeout\");\n          _Report.report.joinGateway(spec.sid, {\n            lts: that.lts,\n            succ: false,\n            ec: \"timeout\",\n            addr: that.connection.url\n          });\n          that.creatConnection();\n        }\n      }\n    };\n\n    //onerror : \n    // it's very weird that invoke socket.close will triger onerror, \n    // and this callback just return \"error\" but nothing useful details.\n    that.connection.onerror = function (e) {\n      // if (!that.needReconnect) {\n      //   console.log(e);\n      //   AgoraCall(spec.onFailure, e);\n      //   that.dispatchEvent(MediaEvent({type: 'connect_error', event: e}));\n      //   that.connection.onopen = undefined;\n      //   that.connection.onclose = undefined;\n      //   that.connection.onerror = undefined;\n      //   that.connection.onmessage = undefined;\n      //   that.connection = undefined;\n      // }\n    };\n\n    // timeout check\n    var timeoutCheck = setTimeout(function () {\n      if (that.connection && that.connection.readyState != WebSocket.OPEN) {\n        that.isTimeout = true;\n        that.connection.close();\n      }\n    }, 5000);\n  };\n  that.creatConnection();\n\n  that.sendMessage = function (obj, onError) {\n    if (that.connection && that.connection.readyState == WebSocket.OPEN) {\n      that.connection.send(JSON.stringify(obj));\n    } else {\n      // console.log('Connection to gateway lost while sending ' + obj);\n      // console.log('signal connection state ' + that.connection.readyState);\n      onError({ error: 'Gateway not connected' });\n    }\n  };\n\n  that.disconnect = function () {\n    that.needReconnect = true;\n    that.connection.close();\n  };\n\n  that.close = function () {\n    that.needReconnect = false;\n    that.connection.close();\n  };\n\n  that.sendSignalCommand = function (message, callback) {\n    message._id = \"_request_\" + that.requestID;\n    that.requestID += 1;\n    if (!(message._type === 'publish_stats' || message._type === 'subscribe_stats' || message._type === 'publish_stats_low')) {\n      that.on(message._id, function (e) {\n        e.msg && callback && callback(e.msg._result, e.msg.message);\n        delete that.dispatcher.eventListeners[message._id];\n      });\n    }\n    that.sendMessage(message, function (e) {\n      e.reason = 'NOT_CONNECTED';\n      callback && callback(e.reason, e);\n    });\n  };\n\n  return that;\n};\n\nexports.default = Signal;\n\n/***/ }),\n/* 36 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.simMap = undefined;\n\nvar _Browser = __webpack_require__(2);\n\nvar simMap = function simMap(profile) {\n  var resolution;\n\n  switch (profile) {\n    case \"120p\":\n    case \"120p_1\":\n      resolution = [\"120p_1\", \"120p_1\", \"120p_1\"];\n      break;\n\n    case \"120p_3\":\n      resolution = [\"120p_3\", \"120p_3\", \"120p_3\"];\n      break;\n\n    case \"180p\":\n    case \"180p_1\":\n      resolution = [\"90p_1\", \"90p_1\", \"180p_1\"];\n      break;\n\n    case \"180p_3\":\n      resolution = [\"120p_3\", \"120p_3\", \"180p_3\"];\n      break;\n\n    case \"180p_4\":\n      resolution = [\"120p_1\", \"120p_1\", \"180p_4\"];\n      break;\n\n    case \"240p\":\n    case \"240p_1\":\n      resolution = [\"120p_1\", \"120p_1\", \"240p_1\"];\n      break;\n\n    case \"240p_3\":\n      resolution = [\"120p_3\", \"120p_3\", \"240p_3\"];\n      break;\n\n    case \"240p_4\":\n      resolution = [\"120p_4\", \"120p_4\", \"240p_4\"];\n      break;\n\n    case \"360p\":\n    case \"360p_1\":\n    case \"360p_4\":\n    case \"360p_9\":\n    case \"360p_10\":\n    case \"360p_11\":\n      resolution = [\"90p_1\", \"90p_1\", \"360p_1\"];\n      break;\n\n    case \"360p_3\":\n    case \"360p_6\":\n      resolution = [\"120p_3\", \"120p_3\", \"360p_3\"];\n      break;\n\n    case \"360p_7\":\n    case \"360p_8\":\n      resolution = [\"120p_1\", \"120p_1\", \"360p_7\"];\n      break;\n\n    case \"480p\":\n    case \"480p_1\":\n    case \"480p_2\":\n    case \"480p_4\":\n    case \"480p_10\":\n      resolution = [\"120p_1\", \"120p_1\", \"480p_1\"];\n      break;\n\n    case \"480p_3\":\n    case \"480p_6\":\n      resolution = [\"120p_3\", \"120p_3\", \"480p_3\"];\n      break;\n\n    case \"480p_8\":\n    case \"480p_9\":\n      resolution = [\"120p_4\", \"120p_4\", \"480p_8\"];\n      break;\n\n    case \"720p\":\n    case \"720p_1\":\n    case \"720p_2\":\n    case \"720p_3\":\n      resolution = [\"90p_1\", \"90p_1\", \"720p_1\"];\n      break;\n\n    case \"720p_5\":\n    case \"720p_6\":\n      resolution = [\"120p_1\", \"120p_1\", \"720p_5\"];\n      break;\n\n    case \"1080p\":\n    case \"1080p_1\":\n    case \"1080p_2\":\n    case \"1080p_3\":\n    case \"1080p_5\":\n      resolution = [\"90p_1\", \"90p_1\", \"1080p_1\"];\n      break;\n\n    case \"1440p\":\n    case \"1440p_1\":\n    case \"1440p_2\":\n      resolution = [\"90p_1\", \"90p_1\", \"1440p_1\"];\n      break;\n\n    case \"4k\":\n    case \"4k_1\":\n    case \"4k_3\":\n      resolution = [\"90p_1\", \"90p_1\", \"4k_1\"];\n      break;\n\n    default:\n      resolution = [\"120p_1\", \"120p_1\", \"360p_7\"];\n  }\n\n  if ((0, _Browser.isFireFox)()) {\n    // FF: adaptive frame rate, normally 30fps\n    // H264 - get resolution same as high stream\n    // VP8 - adaptive resolution close to the setting \n    return [resolution[1], 15, 50];\n  } else if ((0, _Browser.isSafari)()) {\n    // adaptive frame rate close to the setting\n    // H264 - low stream resolution must be same as high stream \n    return [resolution[2], 15, 50];\n  } else {\n    // adaptive frame rate close to the setting\n    // adaptive resolution close to the setting\n    return [resolution[0], 15, 50];\n  }\n};\n\nexports.simMap = simMap;\n\n/***/ }),\n/* 37 */,\n/* 38 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.REMOTE_VIDEO_STREAM_MEDIUM = exports.REMOTE_VIDEO_STREAM_LOW = exports.REMOTE_VIDEO_STREAM_HIGH = exports.VIDEO_CODEC_PROFILE_HIGH = exports.VIDEO_CODEC_PROFILE_MAIN = exports.VIDEO_CODEC_PROFILE_BASELINE = exports.AUDIO_SAMPLE_RATE_48000 = exports.AUDIO_SAMPLE_RATE_44100 = exports.AUDIO_SAMPLE_RATE_32000 = exports.VERSION = exports.checkSystemRequirements = exports.getDevices = exports.Logger = exports.createStream = exports.createClient = exports.LiveTranscoding = exports.TranscodingUser = undefined;\n\nvar _Config = __webpack_require__(1);\n\nvar _Logger = __webpack_require__(0);\n\nvar _Logger2 = _interopRequireDefault(_Logger);\n\nvar _Helper = __webpack_require__(3);\n\nvar _Stream = __webpack_require__(7);\n\nvar _GlobalName = __webpack_require__(14);\n\nvar _Client = __webpack_require__(32);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.TranscodingUser = _Client.TranscodingUser;\nexports.LiveTranscoding = _Client.LiveTranscoding;\nexports.createClient = _Client.createClient;\nexports.createStream = _Stream.createStream;\nexports.Logger = _Logger2.default;\nexports.getDevices = _Stream.getDevices;\nexports.checkSystemRequirements = _Helper.checkSystemRequirements;\nexports.VERSION = _Config.VERSION;\nexports.AUDIO_SAMPLE_RATE_32000 = _GlobalName.AUDIO_SAMPLE_RATE_32000;\nexports.AUDIO_SAMPLE_RATE_44100 = _GlobalName.AUDIO_SAMPLE_RATE_44100;\nexports.AUDIO_SAMPLE_RATE_48000 = _GlobalName.AUDIO_SAMPLE_RATE_48000;\nexports.VIDEO_CODEC_PROFILE_BASELINE = _GlobalName.VIDEO_CODEC_PROFILE_BASELINE;\nexports.VIDEO_CODEC_PROFILE_MAIN = _GlobalName.VIDEO_CODEC_PROFILE_MAIN;\nexports.VIDEO_CODEC_PROFILE_HIGH = _GlobalName.VIDEO_CODEC_PROFILE_HIGH;\nexports.REMOTE_VIDEO_STREAM_HIGH = _GlobalName.REMOTE_VIDEO_STREAM_HIGH;\nexports.REMOTE_VIDEO_STREAM_LOW = _GlobalName.REMOTE_VIDEO_STREAM_LOW;\nexports.REMOTE_VIDEO_STREAM_MEDIUM = _GlobalName.REMOTE_VIDEO_STREAM_MEDIUM;\n\n/***/ })\n/******/ ]);\n});\n\n\n// WEBPACK FOOTER //\n// AgoraRTC-production.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 38);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 005f9966c106f9a0942b","import {getTimestamp} from './Time'\n\n\n/*\n * API to write logs based on traditional logging mechanisms: debug, trace, info, warning, error\n */\nvar Logger = (function () {\n  \"use strict\";\n  var DEBUG = 0, INFO = 1, WARNING = 2, ERROR = 3, NONE = 4, logLevel = DEBUG, setLogLevel, log, debug, info, warning, error;\n\n  // It sets the new log level. We can set it to NONE if we do not want to print logs\n  setLogLevel = function (level) {\n    if (level > NONE) {\n      level = NONE;\n    } else if (level < DEBUG) {\n      level = DEBUG;\n    }\n    logLevel = level;\n  };\n\n  // Generic function to print logs for a given level: [DEBUG, TRACE, INFO, WARNING, ERROR]\n  log = function () {\n    var level = arguments[0];\n    var args = arguments;\n    if (level < logLevel) {\n      return;\n    }\n    switch (level) {\n    case DEBUG:\n      args[0] = getTimestamp() + ' DEBUG:';\n      console.log.apply(console, args);\n      break;\n    case INFO:\n      args[0] = getTimestamp() + ' INFO:';\n      console.log.apply(console, args);\n      break;\n    case WARNING:\n      args[0] = getTimestamp() + ' WARN:';\n      console.warn.apply(console, args);\n      break;\n    case ERROR:\n      args[0] = getTimestamp() + ' ERROR:';\n      console.error.apply(console, args);\n      break;\n    default:\n      args[0] = getTimestamp() + ' DEFAULT:';\n      console.log.apply(console, args);\n      return;\n    }\n  };\n\n  // It prints debug logs\n  debug = function () {\n    var args = [DEBUG];\n    for (var i = 0; i < arguments.length; i++) {\n      args.push(arguments[i]);\n    }\n    log.apply(this, args);\n  };\n\n  // It prints info logs\n  info = function () {\n    var args = [INFO];\n    for (var i = 0; i < arguments.length; i++) {\n      args.push(arguments[i]);\n    }\n    log.apply(this, args);\n  };\n\n  // It prints warning logs\n  warning = function () {\n    var args = [WARNING];\n    for (var i = 0; i < arguments.length; i++) {\n      args.push(arguments[i]);\n    }\n    log.apply(this, args);\n  };\n\n  // It prints error logs\n  error = function () {\n    var args = [ERROR];\n    for (var i = 0; i < arguments.length; i++) {\n      args.push(arguments[i]);\n    }\n    log.apply(this, args);\n  };\n\n  return {\n    DEBUG: DEBUG,\n    INFO: INFO,\n    WARNING: WARNING,\n    ERROR: ERROR,\n    NONE: NONE,\n    setLogLevel: setLogLevel,\n    log: log,\n    debug: debug,\n    info: info,\n    warning: warning,\n    error: error\n  };\n}());\n\nexport default Logger\n\n\n// WEBPACK FOOTER //\n// ./src/utils/Logger.js","const GIT_VERSION = \"DEFINE_GIT_VERSION\";\n\nconst VERSION = \"2.2.0\";\n// const WEBCS_DOMAIN = \"webcs-1.agora.io\";\n// const WEBCS_DOMAIN_BACKUP_LIST = [\n//   \"webcs-2.agora.io\",\n//   \"webcs-3.agora.io\",\n//   \"webcs-4.agora.io\",\n// ];\nconst WEBCS_DOMAIN = [\n  \"webcs-1.agora.io\",\n  \"webcs-2.agora.io\",\n]\nconst WEBCS_DOMAIN_BACKUP_LIST = [\n  \"webcs-3.agora.io\",\n  \"webcs-4.agora.io\",\n];\n\nconst EVENT_REPORT_DOMAIN = \"webcollector-1.agora.io\";\nconst EVENT_REPORT_BACKUP_DOMAIN = \"webcollector-2.agora.io\";\n\nconst WEBCS_BACKUP_CONNECT_TIMEOUT = 6000;\nconst HTTP_CONNECT_TIMEOUT = 5000;\n\nconst  SUPPORT_RESOLUTION_LIST = {\n  '90p_1' : [160, 90],\n  '120p_1' : [160, 120],\n  '120p_3' : [120, 120],\n  '120p_4' : [212, 120],\n  '180p_1' : [320, 180],\n  '180p_3' : [180, 180],\n  '180p_4' : [240, 180],\n  '240p_1' : [320, 240],\n  '240p_3' : [240, 240],\n  '240p_4' : [424, 240],\n  '360p_1' : [640, 360],\n  '360p_3' : [360, 360],\n  '360p_4' : [640, 360],\n  '360p_6' : [360, 360],\n  '360p_7' : [480, 360],\n  '360p_8' : [480, 360],\n  '360p_9' : [640, 360],\n  '360p_10': [640, 360],\n  '360p_11': [640, 360],\n  '480p_1' : [640, 480],\n  '480p_2' : [640, 480],\n  '480p_3' : [480, 480],\n  '480p_4' : [640, 480],\n  '480p_6' : [480, 480],\n  '480p_8' : [848, 480],\n  '480p_9' : [848, 480],\n  '480p_10': [640, 480],\n  '720p_1' : [1280, 720],\n  '720p_2' : [1280, 720],\n  '720p_3' : [1280, 720],\n  '720p_5' : [960, 720],\n  '720p_6' : [960, 720],\n  '1080p_1': [1920, 1080],\n  '1080p_2': [1920, 1080],\n  '1080p_3': [1920, 1080],\n  '1080p_5': [1920, 1080],\n  '1440p_1': [2560, 1440],\n  '1440p_2': [2560, 1440],\n  '4k_1'   : [3840, 2160],\n  '4k_3'   : [3840, 2160]\n};\n\n\nexport {\n  GIT_VERSION,\n  VERSION,\n  WEBCS_DOMAIN,\n  WEBCS_DOMAIN_BACKUP_LIST,\n\n  EVENT_REPORT_DOMAIN,\n  EVENT_REPORT_BACKUP_DOMAIN,\n\n  WEBCS_BACKUP_CONNECT_TIMEOUT,\n  HTTP_CONNECT_TIMEOUT,\n\n  SUPPORT_RESOLUTION_LIST\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Config.js","var isChrome = function() {\n\tvar info = getBrowserInfo();\n\treturn info.name && info.name === 'Chrome';\n}\n\nvar isSafari = function() {\n\tvar info = getBrowserInfo()\n\treturn info.name && info.name === 'Safari';\n}\n\nvar isFireFox = function() {\n\tvar info = getBrowserInfo()\n\treturn info.name && info.name === 'Firefox';\n}\n\nvar isOpera = function() {\n\tvar info = getBrowserInfo()\n\treturn info.name && info.name === 'OPR';\n}\n\nvar isQQBrowser = function() {\n\tvar info = getBrowserInfo()\n\treturn info.name && info.name === 'MQQBrowser';\n}\n\nvar isWeChatBrowser = function() {\n\tvar info = getBrowserInfo()\n\treturn info.name && info.name === 'MicroMessenger';\n}\n\nvar isSupportedPC = function() {\n\tvar os = getBrowserOS();\n\treturn os === 'Linux' || os === 'Mac OS X' || os === 'Mac OS' || os.indexOf(\"Windows\") !== -1;\n}\n\nvar isSupportedMobile = function() {\n\tvar os = getBrowserOS();\n\treturn os === 'Android' || os === 'iOS'; \n}\n\nvar getBrowserVersion = function() {\n\tvar info = getBrowserInfo();\n\treturn info.version;\n}\n\nvar getBrowserOS = function() {\n\tvar info = getBrowserInfo();\n\treturn info.os;\n}\n\nvar _getBrowserInfo = function() {\n\tvar ua=navigator.userAgent,tem,M=ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\\/))\\/?\\s*(\\d+)/i) || []; \n\n\t// TODO: copy from Stack OverFlow, I don't think it works\n\tif(/trident/i.test(M[1])){\n\t\ttem=/\\brv[ :]+(\\d+)/g.exec(ua) || []; \n\t\treturn {name:'IE',version:(tem[1]||'')};\n\t}   \n\n\t// for opera\n\tif(M[1]==='Chrome'){\n\t\ttem=ua.match(/(OPR(?=\\/))\\/?(\\d+)/i);\n\t\tif(tem!=null) {\n\t\t\tM = tem;\n\t\t}\n\t}\n\n\t// for Safari version\n\tif(M[1]==='Safari'){\n\t\tif((tem=ua.match(/version\\/(\\d+)/i))!=null) {\n\t\t\tM[2] = tem[1];\n\t}\n\t}\n\n\t// for QQ\n\tif(~ua.toLowerCase().indexOf('mqqbrowser')){\n\t\ttem=ua.match(/(mqqbrowser(?=\\/))\\/?(\\d+)/i);\n\t\tif(tem!=null) {\n\t\t\tM = tem;\n\t\t}\n\t}\n\n\t// for weChat\n\tif(~ua.toLowerCase().indexOf('micromessenger')){\n\t\ttem=ua.match(/(micromessenger(?=\\/))\\/?(\\d+)/i);\n\t\tif(tem!=null) {\n\t\t\tM = tem;\n\t\t}\n\t}\n\n\tvar os = undefined;\n\tvar clientStrings = [\n\t\t{s:'Windows 10', r:/(Windows 10.0|Windows NT 10.0)/},\n\t\t{s:'Windows 8.1', r:/(Windows 8.1|Windows NT 6.3)/},\n\t\t{s:'Windows 8', r:/(Windows 8|Windows NT 6.2)/},\n\t\t{s:'Windows 7', r:/(Windows 7|Windows NT 6.1)/},\n\t\t{s:'Windows Vista', r:/Windows NT 6.0/},\n\t\t{s:'Windows Server 2003', r:/Windows NT 5.2/},\n\t\t{s:'Windows XP', r:/(Windows NT 5.1|Windows XP)/},\n\t\t{s:'Windows 2000', r:/(Windows NT 5.0|Windows 2000)/},\n\t\t{s:'Windows ME', r:/(Win 9x 4.90|Windows ME)/},\n\t\t{s:'Windows 98', r:/(Windows 98|Win98)/},\n\t\t{s:'Windows 95', r:/(Windows 95|Win95|Windows_95)/},\n\t\t{s:'Windows NT 4.0', r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},\n\t\t{s:'Windows CE', r:/Windows CE/},\n\t\t{s:'Windows 3.11', r:/Win16/},\n\t\t{s:'Android', r:/Android/},\n\t\t{s:'Open BSD', r:/OpenBSD/},\n\t\t{s:'Sun OS', r:/SunOS/},\n\t\t{s:'Linux', r:/(Linux|X11)/},\n\t\t{s:'iOS', r:/(iPhone|iPad|iPod)/},\n\t\t{s:'Mac OS X', r:/Mac OS X/},\n\t\t{s:'Mac OS', r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},\n\t\t{s:'QNX', r:/QNX/},\n\t\t{s:'UNIX', r:/UNIX/},\n\t\t{s:'BeOS', r:/BeOS/},\n\t\t{s:'OS/2', r:/OS\\/2/},\n\t\t{s:'Search Bot', r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\\/Teoma|ia_archiver)/}\n\t];\n\tfor (var id in clientStrings) {\n\t\t\tvar cs = clientStrings[id];\n\t\t\tif (cs.r.test(navigator.userAgent)) {\n\t\t\t\tos = cs.s;\n\t\t\t\tbreak;\n\t\t\t}\n\t}\n\n\treturn {\n\t\tname: M[1],\n\t\tversion: M[2],\n\t\tos: os \n\t};\n}\n\nvar getBrowserInfo = (function() {\n\tvar info = _getBrowserInfo();\n\treturn function() {\n\t\treturn info;\n\t}\n})();\n\nexport {\n\tgetBrowserInfo,\n\tgetBrowserVersion,\n\tgetBrowserOS,\n\tisChrome,\n\tisSafari,\n\tisFireFox,\n\tisOpera,\n\tisQQBrowser,\n\tisWeChatBrowser,\n\tisSupportedPC,\n\tisSupportedMobile\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/Browser.js","import * as Browser from './utils/Browser';\nimport Logger from './utils/Logger';\nimport uuidv4 from 'uuid/v4';\n\nvar checkSystemRequirements = function() {\nvar PC = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection;\nvar getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.msGetUserMedia || navigator.mozGetUserMedia || (navigator.mediaDevices && navigator.mediaDevices.getUserMedia);\nvar webSocket = window.WebSocket;\n  var isAPISupport = !!PC && !!getUserMedia && !!webSocket;\n\n  var isVendorAndVersionSupport = false;\n  Logger.debug(Browser.getBrowserInfo(), \"isAPISupport:\"+isAPISupport);\n    \n  if(Browser.isChrome() && Browser.getBrowserVersion() >= 58) {\n    if (Browser.getBrowserOS() !== 'iOS') {\n      isVendorAndVersionSupport = true;\n    }\n  }\n\n  if(Browser.isFireFox() && Browser.getBrowserVersion() >= 56) {\n    isVendorAndVersionSupport = true;\n  }\n\n  if(Browser.isOpera() && Browser.getBrowserVersion() >= 45) {\n    isVendorAndVersionSupport = true;\n  }\n\n  if(Browser.isSafari() && Browser.getBrowserVersion() >= 11) {\n    isVendorAndVersionSupport = true;\n  }\n\n  if(Browser.isWeChatBrowser() || Browser.isQQBrowser()) {\n    if (Browser.getBrowserOS() !== 'iOS') {\n      isVendorAndVersionSupport = true;\n    }\n  }\n\n  if (!Browser.isSupportedPC() && !Browser.isSupportedMobile()) {\n    isVendorAndVersionSupport = false;\n  }\n\nreturn isAPISupport && isVendorAndVersionSupport;\n}\n\nvar safeCall = function() {\n  var callback = arguments[0];\n  if (typeof callback === \"function\") {\n    var args = Array.prototype.slice.call(arguments, 1);\n    callback.apply(null, args);\n  }\n};\n\nconst audioContext = new (window.AudioContext || window.webkitAudioContext)();\nvar audioLevelHelper = function(stream){\n  this.audioContext = audioContext;\n  this.sourceNode = stream.otWebkitAudioSource || this.audioContext.createMediaStreamSource(stream);\n  this.analyser = this.audioContext.createAnalyser();\n  this.timeDomainData = new Uint8Array(this.analyser.frequencyBinCount);\n  this.sourceNode.connect(this.analyser);\n\n  this.getAudioLevel = function() {\n    if (this.analyser) {\n      this.analyser.getByteTimeDomainData(this.timeDomainData);\n\n      // varies from 0 to 255\n      let max = 0;\n      for (let idx = 0; idx < this.timeDomainData.length; idx++) {\n        max = Math.max(max, Math.abs(this.timeDomainData[idx] - 128));\n      }\n\n      // normalize the collected level to match the range delivered by\n      // the getStats' audioOutputLevel\n      return max / 128;\n    } else {\n      Logger.warning(\"can't find analyser in audioLevelHelper\");\n      return 0;\n    }\n  }\n  return this;\n}\n\nfunction generateSessionId() {\n  return uuidv4().replace(/-/g,\"\").toUpperCase();\n  // return 'xxxxxxxxxxxxxx4xxxxyxxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n  //   var r = Math.random() * 16 | 0,\n  //   v= c=='x' ? r : r & 0x3 | 0x8;\n  //   return v.toString(16).toUpperCase();\n  // });\n}\n\n\nvar CSCrashRecord = {\n  shouldBlock: function() {\n    if(localStorage) {\n      var record = JSON.parse(localStorage.getItem(\"agoraCSCrashRecord\"));\n      return record && record.length > 6 ? (new Date().getTime() - record[record.length - 6] - 10000) < 0 ? true : false : false;\n    } else {\n      return false;\n    }\n  },\n  record: function(date) {\n    if(localStorage) {\n      var record = JSON.parse(localStorage.getItem(\"agoraCSCrashRecord\"));\n      record = !record || record.length > 50 ? [] : record;\n      record.push(date);\n      localStorage.setItem(\"agoraCSCrashRecord\", JSON.stringify(record));\n    }\n  }\n}\n\nvar vsResHack = function(stream, onSuccess, onFailure) {\n  try {\n    let video = document.createElement('video');\n    video.setAttribute('autoplay', '');\n    video.setAttribute('muted', '');\n    // in iOS, not this attribute will not trigger 'playing' event\n    video.setAttribute('playsinline', '');\n    video.setAttribute('style', 'position: absolute; top: 0; left: 0; width:1px; high:1px;');\n    document.body.appendChild(video);\n    \n    video.addEventListener('playing', ev => {\n      // Firefox will triger this event twice\n      if(Browser.isFireFox()) {\n        if(video.videoWidth) {\n          onSuccess(video.videoWidth, video.videoHeight);\n          document.body.removeChild(video);\n        }\n      } else {\n        onSuccess(video.videoWidth, video.videoHeight);\n        document.body.removeChild(video);\n      }\n    });\n    video.srcObject = stream;\n  } catch (error) {\n    onFailure(error);\n  }\n}\n\nvar is32Uint = function(n) {\n  return !!(0 <= n && n <= 4294967296-1);\n}\n\nvar isLiveTranscodingValid = function(transcoding) {\n  var specialAttr = ['lowLatency', 'userConfigExtraInfo', 'transcodingUsers'];\n  for(let key in transcoding) {\n    if (\n      (key === 'lowLatency' && typeof transcoding[key] !== 'boolean') ||\n      (key === 'userConfigExtraInfo' && typeof transcoding[key] !== 'object') ||\n      (key === 'transcodingUsers' && !isTranscodingUsersValid(transcoding[key])) ||\n      (!~specialAttr.indexOf(key) && typeof transcoding[key] !== 'number')\n    ) {\n      throw new Error('Param [' + key + '] is inVaild');\n    } \n  }\n  return true;\n}\n\nvar isTranscodingUsersValid = function(users) {\n  for(let i = 0; i < users.length; i++) {\n    for(let key in users[i]) {\n      if(typeof users[i][key] !== 'number') {\n        throw new Error('Param user[' + i + '] - [' + key + '] is inVaild');\n      }\n    }\n  }\n  return true;\n}\n\nvar random = function(number) {\n  if(isNaN(number)) {\n    number = 1000;\n  }\n  var seed = +new Date();\n  // https://www.zhihu.com/question/22818104\n  seed = (seed * 9301 + 49297) % 233280;\n  var rnd = seed / (233280.0);\n  return Math.ceil(rnd * number);\n}\n\nexport {\n  checkSystemRequirements, \n  isLiveTranscodingValid,\n  generateSessionId,\n  audioLevelHelper,\n  CSCrashRecord,\n  vsResHack,\n  is32Uint,\n  safeCall,\n  random,\n} \n\n\n\n// WEBPACK FOOTER //\n// ./src/Helper.js","/*\n * Class EventDispatcher provides event handling to sub-classes.\n * It is inherited from Publisher, Room, etc.\n */\nvar EventDispatcher = function () {\n    \"use strict\";\n    var that = {};\n    // Private vars\n    that.dispatcher = {};\n    that.dispatcher.eventListeners = {};\n\n    // Public functions\n\n    // It adds an event listener attached to an event type.\n    that.addEventListener = function (eventType, listener) {\n        if (that.dispatcher.eventListeners[eventType] === undefined) {\n            that.dispatcher.eventListeners[eventType] = [];\n        }\n        that.dispatcher.eventListeners[eventType].push(listener);\n    };\n\n    that.on = that.addEventListener;\n\n    // It removes an available event listener.\n    that.removeEventListener = function (eventType, listener) {\n        var index;\n        index = that.dispatcher.eventListeners[eventType].indexOf(listener);\n        if (index !== -1) {\n            that.dispatcher.eventListeners[eventType].splice(index, 1);\n        }\n    };\n\n    // It dispatch a new event to the event listeners, based on the type\n    // of event. All events are intended to be LicodeEvents.\n    that.dispatchEvent = function (event) {\n        var listener;\n        for (listener in that.dispatcher.eventListeners[event.type]) {\n            if (that.dispatcher.eventListeners[event.type].hasOwnProperty(listener) &&\n               typeof that.dispatcher.eventListeners[event.type][listener] === 'function') {\n                that.dispatcher.eventListeners[event.type][listener](event);\n            }\n        }\n    };\n\n    that.dispatchSocketEvent = function (event) {\n        var listener;\n        for (listener in that.dispatcher.eventListeners[event.type]) {\n            if (that.dispatcher.eventListeners[event.type].hasOwnProperty(listener) &&\n               typeof that.dispatcher.eventListeners[event.type][listener] === 'function') {\n                that.dispatcher.eventListeners[event.type][listener](event.msg);\n            }\n        }\n    };\n\n    return that;\n};\n\n// **** EVENTS ****\n\n/*\n * Class LicodeEvent represents a generic Event in the library.\n * It handles the type of event, that is important when adding\n * event listeners to EventDispatchers and dispatching new events.\n * A LicodeEvent can be initialized this way:\n * var event = LicodeEvent({type: \"room-connected\"});\n */\nvar LicodeEvent = function (spec) {\n    \"use strict\";\n    var that = {};\n\n    // Event type. Examples are: 'room-connected', 'stream-added', etc.\n    that.type = spec.type;\n\n    return that;\n};\n\n/*\n * Class StreamEvent represents an event related to a stream. It is a LicodeEvent.\n * It is usually initialized this way:\n * var streamEvent = StreamEvent({type:\"stream-added\", stream:stream1});\n * Event types:\n * 'stream-added' - indicates that there is a new stream available in the room.\n * 'stream-removed' - shows that a previous available stream has been removed from the room.\n */\nvar StreamEvent = function (spec) {\n    \"use strict\";\n    var that = LicodeEvent(spec);\n\n    // The stream related to this event.\n    that.stream = spec.stream;\n    that.reason = spec.reason;\n    that.msg = spec.msg;\n\n    return that;\n};\n\n/*\n * Class ClientEvent represents an event related to a client. It is a LicodeEvent.\n * It is usually initialized this way:\n * var clientEvent = ClientEvent({type:\"client-left\", uid: user, attr: attributes});\n * Event types:\n * 'client-connected' - points out that the user has been successfully connected.\n * 'client-disconnected' - shows that the user has been already disconnected.\n * 'client-joined' - indicates that there is a new client joined.\n * 'client-left' - indicates that a client has left.\n *\n * NOTE: 'client-connected' event shall always trigger 'client-joined' event,\n * while 'client-disconnected' event shall always trigger 'client-left' event;\n */\nvar ClientEvent = function (spec) {\n  \"use strict\";\n  var that = LicodeEvent(spec);\n  that.uid = spec.uid;\n  that.attr = spec.attr;\n  that.stream = spec.stream;\n  return that;\n};\n\n/*\n * Class MediaEvent represents an event related to a getUserMedia(). It is a LicodeEvent.\n * It usually initializes as:\n * var mediaEvent = MediaEvent({})\n * Event types:\n * 'access-accepted' - indicates that the user has accepted to share his camera and microphone\n * 'warning' - details are included in the event message (msg)\n * 'error' - details are included in the event message (msg)\n */\nvar MediaEvent = function (spec) {\n    \"use strict\";\n    var that = LicodeEvent(spec);\n    that.msg = spec.msg;\n    return that;\n};\n\nvar LiveStreamingEvent = function (spec) {\n    \"use strict\";\n    var that = LicodeEvent(spec);\n    that.url = spec.url;\n    that.reason = spec.reason;\n    return that;\n};\n\nexport {EventDispatcher, StreamEvent, ClientEvent, MediaEvent, LiveStreamingEvent}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Events.js","import * as config from './Config';\nimport Logger from './utils/Logger'\nimport {post, shouldUseHttps} from './utils/Request'\n\nconst SESSION_INIT       = 'session_init';\nconst JOIN_CHOOSE_SERVER = 'join_choose_server';\nconst JOIN_GATEWAY       = 'join_gateway';\nconst PUBLISH            = 'publish';\nconst SUBSCRIBE          = 'subscribe';\nconst FIRST_REMOTE_FRAME = 'first_remote_frame';\nconst STREAM_SWITCH      = 'stream_switch';\nconst AUDIO_SENDING_STOPPED = 'audio_sending_stopped';\nconst VIDEO_SENDING_STOPPED = 'video_sending_stopped';\n\n\nvar base = {\n  type: null,\n  sid: null,\n  lts: null,\n  succ: null,\n  cname: null,\n  uid: null,\n  peerid: null,\n  cid: null,\n  elaps: null,\n  extend: null,\n  vid: 0,\n}\n\nvar report = (function() {\n    var that = {};\n    that.list = {};\n    that.url = shouldUseHttps() ? \n    `https://${config.EVENT_REPORT_DOMAIN}:6443/events/report` :\n    `http://${config.EVENT_REPORT_DOMAIN}:6080/events/report`;\n\n    that.urlBackup = shouldUseHttps() ? \n    `https://${config.EVENT_REPORT_BACKUP_DOMAIN}:6443/events/report` :\n    `http://${config.EVENT_REPORT_BACKUP_DOMAIN}\":6080/events/report`;\n  \n    that.sessionInit = function(sid, param) {\n      param.sid = sid;\n      var head = Object.assign(base, param);\n      // the first time join\n      if(!that.list[sid]) {\n        head.startTime = +new Date();\n      }\n      var si = Object.assign({}, head);\n      \n      delete head.appid;\n      delete head.mode;\n      that.list[sid] = head;\n      \n      si.extend = null;\n      si.ver = config.VERSION;\n      si.type = SESSION_INIT;\n      si.browser = navigator.userAgent;\n      si.lts = +new Date();\n      si.elaps = si.lts - si.startTime;\n      that.send(si);\n    }\n  \n    that.joinChooseServer = function(sid, param, coverHead) {\n      var jcs;\n      // when multi cs request, only the first result will cover the head\n      if(coverHead) {\n        jcs = Object.assign(that.list[sid], param);  \n      } else {\n        jcs = Object.assign({}, that.list[sid], param);  \n      }\n      jcs.type = JOIN_CHOOSE_SERVER;\n      var endTime = +new Date();\n      jcs.ev_elaps = endTime - jcs.lts;\n      jcs.elaps = endTime - jcs.startTime;\n      jcs.lts = endTime;\n      jcs.serverList = JSON.stringify(jcs.serverList);\n      that.send(jcs);\n    }\n  \n    that.joinGateway = function(sid, param) {\n      var jg = Object.assign(that.list[sid], param);\n      jg.type = JOIN_GATEWAY;\n      var endTime = +new Date();\n      jg.ev_elaps = endTime - jg.lts;\n      jg.elaps = endTime - jg.startTime;\n      jg.lts = endTime;\n      that.send(jg);\n    }\n  \n    that.publish = function(sid, param) {\n      var pu = Object.assign({}, that.list[sid], param);\n      pu.type = PUBLISH;\n      // We have a previous LTS which is defined as a timestamp of start point. Now a new LTS is created for the end point. And ev_elapse is the difference between peers.\n      var endTime = +new Date();\n      pu.ev_elaps = endTime - pu.lts;\n      pu.elaps = endTime - pu.startTime;\n      pu.lts = endTime;\n      that.send(pu);\n    }\n  \n    that.subscribe = function(sid, param) {\n      var sub = Object.assign({}, that.list[sid], param);\n      sub.type = SUBSCRIBE;\n      // We have a previous LTS which is defined as a timestamp of start point. Now a new LTS is created for the end point. And ev_elapse is the difference between peers.\n      var endTime = +new Date();\n      sub.ev_elaps = endTime - sub.lts;\n      sub.elaps = endTime - sub.startTime;\n      sub.lts = endTime;\n      that.send(sub);\n    }\n\n    that.firstRemoteFrame = function(sid, param) {\n      var frf = Object.assign({}, that.list[sid], param);\n      frf.type = FIRST_REMOTE_FRAME;\n      // frf.elaps = null;\n      frf.lts = +new Date();\n      frf.elaps = frf.lts - frf.startTime;\n      that.send(frf);\n    }\n\n    that.streamSwitch = function(sid, param) {\n      var ss = Object.assign({}, that.list[sid], param);\n      ss.type = STREAM_SWITCH;\n      ss.isdual = param.isdual;\n      ss.lts = +new Date();\n      ss.elaps = ss.lts - ss.startTime;\n      that.send(ss);\n    }\n\n    that.audioSendingStopped = function(sid, param) {\n      var ass = Object.assign({}, that.list[sid], param);\n      ass.type = AUDIO_SENDING_STOPPED;\n      ass.lts = +new Date();\n      ass.elaps = ass.lts - ass.startTime;\n      that.send(ass);\n    }\n\n    that.videoSendingStopped = function(sid, param) {\n      var vss = Object.assign({}, that.list[sid], param);\n      vss.type = VIDEO_SENDING_STOPPED;\n      vss.lts = +new Date();\n      vss.elaps = vss.lts - vss.startTime;\n      that.send(vss);\n    }\n\n    that.send = function(data) {\n      try {\n        post(that.url, data, null, function(e) {\n          post(that.urlBackup, data, null, function(e) {\n            // user should not see anything about report\n            // Logger.warning(\"Event report failed\");\n          }, {timeout: 10000});\n        }, {timeout: 10000});\n      } catch (error) {\n        // won't throw out error\n      }\n    }\n    return that;\n  })();\n\nexport {\n  report,\n  SESSION_INIT,\n  JOIN_CHOOSE_SERVER,\n  JOIN_GATEWAY,\n  PUBLISH,\n  SUBSCRIBE,\n}\n\n\n// WEBPACK FOOTER //\n// ./src/Report2.js","/*\n * View class represents a HTML component\n * Every view is an EventDispatcher.\n */\n\nimport {EventDispatcher} from '../Events'\n\nvar View = function (spec) {\n  \"use strict\";\n\n  var that = EventDispatcher(spec);\n\n  // Variables\n\n  // URL where it will look for icons and assets\n  that.url = \".\";\n  return that;\n};\n\nexport default View\n\n\n\n// WEBPACK FOOTER //\n// ./src/views/View.js","import VideoPlayer from './views/VideoPlayer'\nimport AudioPlayer from './views/AudioPlayer'\nimport {GetUserMedia} from './Connection'\nimport {EventDispatcher} from './Events'\nimport Logger from './utils/Logger'\nimport {isFireFox, isChrome} from './utils/Browser'\nimport {publishStatsFilter, subscribeStatsFilter} from './Stats'\nimport {audioLevelHelper, vsResHack} from \"./Helper\"\nimport {report} from \"./Report2\"\n\n/*\n * Class Stream represents a local or a remote Stream in the client.\n * It will handle the WebRTC stream and identify the stream and\n * where it should be drawn.\n */\nvar Stream = function (spec) {\n  \"use strict\";\n  var that = EventDispatcher();\n\n  // TODO: rewrite\n  // use to create low stream\n  that.params = Object.assign({}, spec);\n\n  that.stream = spec.stream;\n  that.aux_stream = undefined;\n  that.url = spec.url;\n  that.onClose = undefined;\n  that.local = false;\n  that.video = !!spec.video;\n  that.audio = !!spec.audio;\n  that.screen = !!spec.screen;\n  that.screenAttributes = {width: 1920, height: 1080, maxFr: 5, minFr: 1};\n  that.videoSize = spec.videoSize;\n  that.player = undefined;\n  that.audioLevelHelper = null;\n  spec.attributes = spec.attributes || {};\n\n  that.videoEnabled = true;\n  that.audioEnabled = true;\n  that.lowStream = null;\n\n  that.videoWidth = 0;\n  that.videoHeight = 0;\n\n  that.streamId = null;\n  that.streamId = spec.streamID;\n  that.mirror = spec.mirror === false ? false : true;\n\n  if (that.videoSize !== undefined &&\n      (!(that.videoSize instanceof Array) || that.videoSize.length !== 4)) {\n    throw Error(\"Invalid Video Size\");\n  } else {\n    that.videoSize = [640, 480, 640, 480];\n  }\n\n  if (spec.local === undefined || spec.local === true) {\n    that.local = true;\n  }\n\n  that.initialized = !that.local;\n\n  function isLegacyChrome () {\n    return window.navigator.appVersion.match(/Chrome\\/([\\w\\W]*?)\\./) !== null &&\n      window.navigator.appVersion.match(/Chrome\\/([\\w\\W]*?)\\./)[1] <= 35;\n  }\n\n  function isFirefox () {\n    return window.navigator.userAgent.match(\"Firefox\") !== null;\n  }\n\n  function getReso(w, h) {\n    return {\n      width: {ideal: w},\n      height: {ideal: h},\n      deviceId: spec.cameraId ? {exact: spec.cameraId} : undefined\n    };\n  }\n\n  var supportedVideoList = {\n    'true': true,\n    'unspecified': true,\n    '90p_1' : getReso(160, 90),\n    '120p_1' : getReso(160, 120),\n    '120p_3' : getReso(120, 120),\n    '120p_4' : getReso(212, 120),\n    '180p_1' : getReso(320, 180),\n    '180p_3' : getReso(180, 180),\n    '180p_4' : getReso(240, 180),\n    '240p_1' : getReso(320, 240),\n    '240p_3' : getReso(240, 240),\n    '240p_4' : getReso(424, 240),\n    '360p_1' : getReso(640, 360),\n    '360p_3' : getReso(360, 360),\n    '360p_4' : getReso(640, 360),\n    '360p_6' : getReso(360, 360),\n    '360p_7' : getReso(480, 360),\n    '360p_8' : getReso(480, 360),\n    '360p_9' : getReso(640, 360),\n    '360p_10': getReso(640, 360),\n    '360p_11': getReso(640, 360),\n    '480p_1' : getReso(640, 480),\n    '480p_2' : getReso(640, 480),\n    '480p_3' : getReso(480, 480),\n    '480p_4' : getReso(640, 480),\n    '480p_6' : getReso(480, 480),\n    '480p_8' : getReso(848, 480),\n    '480p_9' : getReso(848, 480),\n    '480p_10': getReso(640, 480),\n    '720p_1' : getReso(1280, 720),\n    '720p_2' : getReso(1280, 720),\n    '720p_3' : getReso(1280, 720),\n    '720p_5' : getReso(960, 720),\n    '720p_6' : getReso(960, 720),\n    '1080p_1': getReso(1920, 1080),\n    '1080p_2': getReso(1920, 1080),\n    '1080p_3': getReso(1920, 1080),\n    '1080p_5': getReso(1920, 1080),\n    '1440p_1': getReso(2560, 1440),\n    '1440p_2': getReso(2560, 1440),\n    '4k_1'   : getReso(3840, 2160),\n    '4k_3'   : getReso(3840, 2160)\n  };\n\n  that.unmuteAudio = undefined;\n  that.muteAudio = undefined;\n  that.unmuteVideo = undefined;\n  that.muteVideo = undefined;\n\n  that.setVideoResolution = function(resolution) {\n    resolution += '';\n    if (supportedVideoList[resolution] !== undefined) {\n      spec.video = supportedVideoList[resolution];\n      spec.attributes = spec.attributes || {};\n      spec.attributes.resolution = resolution;\n      return true;\n    }\n    return false;\n  };\n\n  that.setVideoFrameRate = function(framerate) {\n    if(isFireFox()) {\n      return false;\n    }\n\n    if (typeof framerate === 'object' &&\n        framerate instanceof Array && framerate.length > 1) {\n      spec.attributes = spec.attributes || {};\n      spec.attributes.minFrameRate = framerate[0];\n      spec.attributes.maxFrameRate = framerate[1];\n      return true;\n    }\n    return false;\n  };\n\n  that.setVideoBitRate = function(bitrate) {\n    if (typeof bitrate === 'object' &&\n        bitrate instanceof Array && bitrate.length > 1) {\n      spec.attributes = spec.attributes || {};\n      spec.attributes.minVideoBW = bitrate[0];\n      spec.attributes.maxVideoBW = bitrate[1];\n      return true;\n    }\n    return false;\n  };\n\n  // Public functions\n  that.setScreenProfile = function (profile) {\n    if (typeof profile == 'string' && that.screen) {\n      switch (profile) {\n      case '480p_1':\n        that.screenAttributes.width = 640;\n        that.screenAttributes.height = 480;\n        that.screenAttributes.maxFr = 5;\n        that.screenAttributes.minFr = 1;\n        break;\n      case '480p_2':\n        that.screenAttributes.width = 640;\n        that.screenAttributes.height = 480;\n        that.screenAttributes.maxFr = 30;\n        that.screenAttributes.minFr = 25;\n        break;\n      case '720p_1':\n        that.screenAttributes.width = 1280;\n        that.screenAttributes.height = 720;\n        that.screenAttributes.maxFr = 5;\n        that.screenAttributes.minFr = 1;\n        break;\n      case '720p_2':\n        that.screenAttributes.width = 1280;\n        that.screenAttributes.height = 720;\n        that.screenAttributes.maxFr = 30;\n        that.screenAttributes.minFr = 25;\n        break;\n      case '1080p_1':\n        that.screenAttributes.width = 1920;\n        that.screenAttributes.height = 1080;\n        that.screenAttributes.maxFr = 5;\n        that.screenAttributes.minFr = 1;\n        break;\n      case '1080p_2':\n        that.screenAttributes.width = 1920;\n        that.screenAttributes.height = 1080;\n        that.screenAttributes.maxFr = 30;\n        that.screenAttributes.minFr = 25;\n        break;\n      }\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  that.setVideoProfileCustom = function(profile) {\n    that.setVideoResolution(profile[0]);\n    that.setVideoFrameRate([profile[1], profile[1]]);\n    that.setVideoBitRate([profile[2], profile[2]]);\n  }\n\n  that.setVideoProfileCustomPlus = function(profile) {\n    console.log(profile);\n    spec.video = getReso(profile.width, profile.height);\n    spec.attributes = spec.attributes || {};\n    spec.attributes.resolution = `${profile.width}x${profile.height}`;\n\n    that.setVideoFrameRate([profile.framerate, profile.framerate]);\n    that.setVideoBitRate([profile.bitrate, profile.bitrate]);\n  }\n\n  that.setVideoProfile = function (profile) {\n    that.profile = profile;\n    if (typeof profile == 'string' && that.video) {\n      switch (profile) {\n      case '120p':\n      case '120P':\n      case '120p_1':\n      case '120P_1':\n        that.setVideoResolution('120p_1');\n        that.setVideoFrameRate([15, 15]);\n        that.setVideoBitRate([10, 65]);\n        break;\n      case '120p_3':\n      case '120P_3':\n        that.setVideoResolution('120p_3');\n        that.setVideoFrameRate([15, 15]);\n        that.setVideoBitRate([10, 50]);\n        break;\n      case '180p':\n      case '180P':\n      case '180p_1':\n      case '180P_1':\n        that.setVideoResolution('180p_1');\n        that.setVideoFrameRate([15, 15]);\n        that.setVideoBitRate([10, 140]);\n        break;\n      case '180p_3':\n      case '180P_3':\n        that.setVideoResolution('180p_3');\n        that.setVideoFrameRate([15, 15]);\n        that.setVideoBitRate([10, 100]);\n        break;\n      case '180p_4':\n      case '180P_4':\n        that.setVideoResolution('180p_4');\n        that.setVideoFrameRate([15, 15]);\n        that.setVideoBitRate([10, 120]);\n        break;\n      case '240p':\n      case '240P':\n      case '240p_1':\n      case '240P_1':\n        that.setVideoResolution('240p_1');\n        that.setVideoFrameRate([15, 15]);\n        that.setVideoBitRate([10, 200]);\n        break;\n      case '240p_3':\n      case '240P_3':\n        that.setVideoResolution('240p_3');\n        that.setVideoFrameRate([15, 15]);\n        that.setVideoBitRate([10, 140]);\n        break;\n      case '240p_4':\n      case '240P_4':\n        that.setVideoResolution('240p_4');\n        that.setVideoFrameRate([15, 15]);\n        that.setVideoBitRate([10, 220]);\n        break;\n      case '360p':\n      case '360P':\n      case '360p_1':\n      case '360P_1':\n        that.setVideoResolution('360p_1');\n        that.setVideoFrameRate([15, 15]);\n        that.setVideoBitRate([20, 400]);\n        break;\n      case '360p_3':\n      case '360P_3':\n        that.setVideoResolution('360p_3');\n        that.setVideoFrameRate([15, 15]);\n        that.setVideoBitRate([20, 260]);\n        break;\n      case '360p_4':\n      case '360P_4':\n        that.setVideoResolution('360p_4');\n        that.setVideoFrameRate([30, 30]);\n        that.setVideoBitRate([20, 600]);\n        break;\n      case '360p_6':\n      case '360P_6':\n        that.setVideoResolution('360p_6');\n        that.setVideoFrameRate([30, 30]);\n        that.setVideoBitRate([20, 400]);\n        break;\n      case '360p_7':\n      case '360P_7':\n        that.setVideoResolution('360p_7');\n        that.setVideoFrameRate([15, 15]);\n        that.setVideoBitRate([20, 320]);\n        break;\n      case '360p_8':\n      case '360P_8':\n        that.setVideoResolution('360p_8');\n        that.setVideoFrameRate([30, 30]);\n        that.setVideoBitRate([20, 490]);\n        break;\n      case '360p_9':\n      case '360P_9':\n        that.setVideoResolution('360p_9');\n        that.setVideoFrameRate([15, 15]);\n        that.setVideoBitRate([20, 800]);\n        break;\n      case '360p_10':\n      case '360P_10':\n        that.setVideoResolution('360p_10');\n        that.setVideoFrameRate([24, 24]);\n        that.setVideoBitRate([20, 800]);\n        break;\n      case '360p_11':\n      case '360P_11':\n        that.setVideoResolution('360p_11');\n        that.setVideoFrameRate([24, 24]);\n        that.setVideoBitRate([20, 1000]);\n        break;\n      case '480p':\n      case '480P':\n      case '480p_1':\n      case '480P_1':\n        that.setVideoResolution('480p_1');\n        that.setVideoFrameRate([15, 15]);\n        that.setVideoBitRate([20, 500]);\n        break;\n      case '480p_2':\n      case '480P_2':\n        that.setVideoResolution('480p_2');\n        that.setVideoFrameRate([30, 30]);\n        that.setVideoBitRate([20, 1000]);\n        break;\n      case '480p_3':\n      case '480P_3':\n        that.setVideoResolution('480p_3');\n        that.setVideoFrameRate([15, 15]);\n        that.setVideoBitRate([20, 400]);\n        break;\n      case '480p_4':\n      case '480P_4':\n        that.setVideoResolution('480p_4');\n        that.setVideoFrameRate([30, 30]);\n        that.setVideoBitRate([20, 750]);\n        break;\n      case '480p_6':\n      case '480P_6':\n        that.setVideoResolution('480p_6');\n        that.setVideoFrameRate([30, 30]);\n        that.setVideoBitRate([20, 600]);\n        break;\n      case '480p_8':\n      case '480P_8':\n        that.setVideoResolution('480p_8');\n        that.setVideoFrameRate([15, 15]);\n        that.setVideoBitRate([20, 610]);\n        break;\n      case '480p_9':\n      case '480P_9':\n        that.setVideoResolution('480p_9');\n        that.setVideoFrameRate([30, 30]);\n        that.setVideoBitRate([20, 930]);\n        break;\n      case '480p_10':\n      case '480P_10':\n        that.setVideoResolution('480p_10');\n        that.setVideoFrameRate([10, 10]);\n        that.setVideoBitRate([20, 400]);\n        break;\n      case '720p':\n      case '720P':\n      case '720p_1':\n      case '720P_1':\n        that.setVideoResolution('720p_1');\n        that.setVideoFrameRate([15, 15]);\n        that.setVideoBitRate([30, 1130]);\n        break;\n      case '720p_2':\n      case '720P_2':\n        that.setVideoResolution('720p_2');\n        that.setVideoFrameRate([30, 30]);\n        that.setVideoBitRate([30, 2000]);\n        break;\n      case '720p_3':\n      case '720P_3':\n        that.setVideoResolution('720p_3');\n        that.setVideoFrameRate([30, 30]);\n        that.setVideoBitRate([30, 1710]);\n        break;\n      case '720p_5':\n      case '720P_5':\n        that.setVideoResolution('720p_5');\n        that.setVideoFrameRate([15, 15]);\n        that.setVideoBitRate([30, 910]);\n        break;\n      case '720p_6':\n      case '720P_6':\n        that.setVideoResolution('720p_6');\n        that.setVideoFrameRate([30, 30]);\n        that.setVideoBitRate([30, 1380]);\n        break;\n      case '1080p':\n      case '1080P':\n      case '1080p_1':\n      case '1080P_1':\n        that.setVideoResolution('1080p_1');\n        that.setVideoFrameRate([15, 15]);\n        that.setVideoBitRate([50, 2080]);\n        break;\n      case '1080p_2':\n      case '1080P_2':\n        that.setVideoResolution('1080p_2');\n        that.setVideoFrameRate([30, 30]);\n        that.setVideoBitRate([50, 3000]);\n        break;\n      case '1080p_3':\n      case '1080P_3':\n        that.setVideoResolution('1080p_3');\n        that.setVideoFrameRate([30, 30]);\n        that.setVideoBitRate([50, 3150]);\n        break;\n      case '1080p_5':\n      case '1080P_5':\n        that.setVideoResolution('1080p_5');\n        that.setVideoFrameRate([60, 60]);\n        that.setVideoBitRate([50, 4780]);\n        break;\n      case '1440p':\n      case '1440P':\n      case '1440p_1':\n      case '1440P_1':\n        that.setVideoResolution('1440p_1');\n        that.setVideoFrameRate([30, 30]);\n        that.setVideoBitRate([50, 4850]);\n        break;\n      case '1440p_2':\n      case '1440P_2':\n        that.setVideoResolution('1440p_2');\n        that.setVideoFrameRate([60, 60]);\n        that.setVideoBitRate([50, 7350]);\n        break;\n      case '4k':\n      case '4K':\n      case '4k_1':\n      case '4K_1':\n        that.setVideoResolution('4k_1');\n        that.setVideoFrameRate([30, 30]);\n        that.setVideoBitRate([50, 8910]);\n        break;\n      case '4k_3':\n      case '4K_3':\n        that.setVideoResolution('4k_3');\n        that.setVideoFrameRate([60, 60]);\n        that.setVideoBitRate([50, 13500]);\n        break;\n      default:\n        that.setVideoResolution('480p_1');\n        that.setVideoFrameRate([15, 15]);\n        that.setVideoBitRate([20, 500]);\n      }\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  that.getId = function () {\n    return that.streamId;\n  };\n\n  that.getAttributes = function () {\n    if (spec.screen) {\n      return that.screenAttributes;\n    } else {\n      return spec.attributes;\n    }\n  };\n\n  // Indicates if the stream has audio activated\n  that.hasAudio = function () {\n    return that.audio;\n  };\n\n  // Indicates if the stream has video activated\n  that.hasVideo = function () {\n    return that.video;\n  };\n\n  // Indicates if the stream has screen activated\n  that.hasScreen = function () {\n    return that.screen;\n  };\n\n  // Indicates if the video track is in playing\n  that.isVideoOn = function () {\n    return (that.hasVideo && that.videoEnabled);\n  }\n\n  // Indicates if the audio track is in playing\n  that.isAudioOn = function () {\n    return (that.hasAudio && that.audioEnabled);\n  }\n\n\n  // Initializes the stream and tries to retrieve a stream from local video and audio\n  // We need to call this method before we can publish it in the client.\n  that.init = function (onSuccess, onFailure) {\n    var lts = new Date().getTime();\n\n    var init_retry = arguments[2];\n    if (init_retry === undefined) {\n      init_retry = 2;\n    } // do not write: var init_retry = arguments[1] || 2;\n    if (that.initialized === true) {\n      if (typeof onFailure === 'function') {\n        onFailure({\n          type: 'warning',\n          msg: 'STREAM_ALREADY_INITIALIZED'\n        });\n      }\n      return;\n    }\n    if (that.local !== true) {\n      if (typeof onFailure === 'function') {\n        onFailure({\n          type: 'warning',\n          msg: 'STREAM_NOT_LOCAL'\n        });\n      }\n      return;\n    }\n    try {\n      if ((spec.audio || spec.video || spec.screen) && spec.url === undefined) {\n        Logger.debug(\"Requested access to local media\");\n        var videoOpt = spec.video;\n        if (spec.screen) {\n          var constraints = {\n            video: videoOpt, \n            audio: spec.audio, \n            screen: true, \n            data: true, \n            extensionId: \n            spec.extensionId, \n            attributes: that.screenAttributes, \n            fake: spec.fake,\n            mediaSource: spec.mediaSource\n          };\n        } else {\n          var constraints = {\n            video: videoOpt, \n            audio: spec.audio, \n            fake: spec.fake\n          };\n          \n          if (!isLegacyChrome()) {\n            var minFr = 30;\n            var maxFr = 30;\n            if (spec.attributes.minFrameRate !== undefined)\n              minFr = spec.attributes.minFrameRate;\n            if (spec.attributes.maxFrameRate !== undefined)\n              maxFr = spec.attributes.maxFrameRate;\n\n            if (!isFirefox()) {\n              if (constraints.audio === true) {\n                constraints.audio = spec.microphoneId ? {deviceId: {exact: spec.microphoneId} } : true;\n              }\n              if (constraints.video === true) {\n                constraints.video = {width: {ideal: that.videoSize[0]}, height: {ideal: that.videoSize[1]}, frameRate: {ideal: minFr, max: maxFr}};\n                that.setVideoBitRate([500, 500]);\n              } else if (typeof constraints.video === 'object') {\n                constraints.video.frameRate = {ideal: minFr, max: maxFr};\n              }\n            } else {\n              if (constraints.video === true) { // video profile not set, use default\n                constraints.video = {width: {ideal: that.videoSize[0]}, height: {ideal: that.videoSize[1]}, frameRate: {ideal: minFr, max: maxFr}};\n                that.setVideoBitRate([500, 500]);\n              } else if (typeof constraints.video === 'object') {\n                constraints.video.frameRate = {ideal: minFr, max: maxFr};\n              }\n            }\n          }\n        }\n        Logger.debug(constraints);\n        var constraints_copy = Object.assign({}, constraints);\n        GetUserMedia(constraints_copy, function (stream) {\n          Logger.debug(\"User has granted access to local media\");\n          that.dispatchEvent({type: 'accessAllowed'});\n          that.stream = stream;\n          that.initialized = true;\n          onSuccess && onSuccess();\n          // get video resolution from <video>\n          if(that.hasVideo()) {\n            vsResHack(stream, (videoWidth, videoHeight) => {\n              that.videoWidth = videoWidth;\n              that.videoHeight = videoHeight;\n            }, (e) => {\n              Logger.warning('vsResHack failed:' + e);\n            })\n          }\n          // when user click button 'stop sharing' on chrome\n          if(spec.screen && isChrome() && that.stream && that.stream.getVideoTracks()[0]) {\n            that.stream.getVideoTracks()[0].onended = () => {\n              that.dispatchEvent({type: 'stopScreenSharing'});\n            }\n          }\n          // report accurate video resolution demo in [sdk].ui.js::videoplayer.js, thru <1>.\n          // 1. from ui display (require ui): $('$streamid')[0].videoWidth, $('$streamid')[0].videoHeight\n          // 2. from webrtc_internals (stream should be published): stream.pc.peerConnection.getStats(function(stats){stats.result();});\n          // 2.1. new method? E.g., stream.getFrameResolution() when pc id ready.\n        }, function (error) {\n          var err = {type: 'error', msg: error.name || error};\n          switch (err.msg) {\n          // below - internally handled\n          case 'Starting video failed':       // firefox: camera possessed by other process?\n          case 'TrackStartError':             // chrome: probably resolution not supported\n            that.videoSize = undefined;\n            if (init_retry > 0) {\n              setTimeout(function () {\n                that.init(onSuccess, onFailure, init_retry-1);\n              }, 1);\n              return;\n            } else {\n              err.msg = 'MEDIA_OPTION_INVALID';\n            }\n            break;\n            // below - exposed\n          case 'DevicesNotFoundError':        // chrome\n            err.msg = 'DEVICES_NOT_FOUND';\n            break;\n          case 'NotSupportedError':           // chrome\n            err.msg = 'NOT_SUPPORTED';\n            break;\n          case 'PermissionDeniedError':       // chrome\n            err.msg = 'PERMISSION_DENIED';\n            that.dispatchEvent({type: 'accessDenied'});\n            break;\n          case 'PERMISSION_DENIED':           // firefox\n            that.dispatchEvent({type: 'accessDenied'});\n            break;\n          case 'InvalidStateError':          // chrome\n              err.msg = 'PERMISSION_DENIED';\n              that.dispatchEvent({type: 'accessDenied'});\n              break;\n          case 'NotAllowedError':           // firefox\n            that.dispatchEvent({type: 'accessDenied'});\n            break;\n          case 'ConstraintNotSatisfiedError': // chrome\n            err.msg = 'CONSTRAINT_NOT_SATISFIED';\n            break;\n          default:\n            if (!err.msg) {\n              err.msg = 'UNDEFINED';\n            }\n          }\n          Logger.error('Media access:', err.msg);\n          if (typeof onFailure === 'function') {\n            onFailure(err);\n          }\n        });\n\n        if (spec.screen && spec.audio) {\n          var theConfig = {video: false, audio: constraints.audio};\n          Logger.debug(theConfig);\n          GetUserMedia(theConfig, function (stream) {\n            Logger.info(\"User has granted access to auxiliary local media.\");\n            that.dispatchEvent({type: 'accessAllowed'});\n            that.aux_stream = stream;\n          }, function (error) {\n            var err = {type: 'error', msg: error.name || error};\n            switch (err.msg) {\n            // below - internally handled\n            case 'Starting video failed':       // firefox: camera possessed by other process?\n            case 'TrackStartError':             // chrome: probably resolution not supported\n              that.videoSize = undefined;\n              if (init_retry > 0) {\n                setTimeout(function () {\n                  that.init(onSuccess, onFailure, init_retry-1);\n                }, 1);\n                return;\n              } else {\n                err.msg = 'MEDIA_OPTION_INVALID';\n              }\n              break;\n              // below - exposed\n            case 'DevicesNotFoundError':        // chrome\n              err.msg = 'DEVICES_NOT_FOUND';\n              break;\n            case 'NotSupportedError':           // chrome\n              err.msg = 'NOT_SUPPORTED';\n              break;\n            case 'PermissionDeniedError':       // chrome\n              err.msg = 'PERMISSION_DENIED';\n              that.dispatchEvent({type: 'accessDenied'});\n              break;\n            case 'InvalidStateError':          // chrome\n              err.msg = 'PERMISSION_DENIED';\n              that.dispatchEvent({type: 'accessDenied'});\n              break;\n            case 'PERMISSION_DENIED':           // firefox\n              that.dispatchEvent({type: 'accessDenied'});\n              break;\n            case 'NotAllowedError':           // firefox\n              that.dispatchEvent({type: 'accessDenied'});\n              break;\n            case 'ConstraintNotSatisfiedError': // chrome\n              err.msg = 'CONSTRAINT_NOT_SATISFIED';\n              break;\n            default:\n              if (!err.msg) {\n                err.msg = 'UNDEFINED';\n              }\n            }\n            Logger.error('Media access:', err.msg);\n            if (typeof onFailure === 'function') {\n              onFailure(err);\n            }\n          });\n        }\n      } else {\n        if (typeof onFailure === 'function') {\n          onFailure({\n            type: 'warning',\n            msg: 'STREAM_HAS_NO_MEDIA_ATTRIBUTES'\n          })\n        }\n      }\n    } catch (e) {\n      Logger.error('Stream init:', e);\n      if (typeof onFailure === 'function') {\n        onFailure({\n          type: 'error',\n          msg: e.message || e\n        })\n      }\n    }\n  };\n\n  that.close = function () {\n    Logger.debug('Close stream with id', that.streamId);\n    if (that.stream !== undefined) {\n      var tracks = that.stream.getTracks();\n      for (var t in tracks) {\n        if (tracks.hasOwnProperty(t)) {\n          tracks[t].stop();\n        }\n      }\n      that.stream = undefined;\n    }\n\n    that.initialized = false;\n\n    that.unmuteAudio = undefined;\n    that.muteAudio = undefined;\n    that.unmuteVideo = undefined;\n    that.muteVideo = undefined;\n\n    if(that.lowStream) {\n      that.lowStream.close();\n    }\n  };\n\n  that.enableAudio = function () {\n    Logger.debug('Enable audio stream with id', that.streamId);\n    if (that.hasAudio() &&\n        that.initialized &&\n        that.stream !== undefined &&\n        that.stream.getAudioTracks()[0].enabled !== true) {\n      if (that.unmuteAudio !== undefined) {\n        that.unmuteAudio();\n      }\n      that.audioEnabled = true;\n      that.stream.getAudioTracks()[0].enabled = true;\n      return true;\n    }\n    return false;\n  };\n\n  that.disableAudio = function () {\n    Logger.debug('Disable audio stream with id', that.streamId);\n    if (that.hasAudio() &&\n        that.initialized &&\n        that.stream !== undefined &&\n        that.stream.getAudioTracks()[0].enabled) {\n      if (that.muteAudio !== undefined) {\n        that.muteAudio();\n      }\n      that.audioEnabled = false;\n      that.stream.getAudioTracks()[0].enabled = false;\n\n      // only loacl stream will have sid\n      if(that.sid) {\n        report.audioSendingStopped(that.sid, {\n          succ: true,\n          reason: 'muteAudio'\n        })\n      }\n      return true;\n    }\n    return false;\n  };\n\n  that.enableVideo = function () {\n    Logger.debug('Enable video stream with id', that.streamId);\n    if (that.initialized &&\n        that.stream !== undefined &&\n        that.stream.getVideoTracks().length &&\n        that.stream.getVideoTracks()[0].enabled !== true) {\n      if (that.unmuteVideo !== undefined) {\n        that.unmuteVideo();\n      }\n      that.videoEnabled = true;\n      that.stream.getVideoTracks()[0].enabled = true;\n      if(that.lowStream) {\n        that.lowStream.enableVideo();\n      }\n      return true;\n    }\n    return false;\n  };\n\n  that.disableVideo = function () {\n    Logger.debug('Disable video stream with id', that.streamId);\n    if (that.initialized &&\n        that.stream !== undefined &&\n        that.stream.getVideoTracks().length &&\n        that.stream.getVideoTracks()[0].enabled) {\n      if (that.muteVideo !== undefined) {\n        that.muteVideo();\n      }\n      that.videoEnabled = false;\n      that.stream.getVideoTracks()[0].enabled = false;\n      if(that.lowStream) {\n        that.lowStream.disableVideo();\n      }\n\n      // only loacl stream will have sid\n      if(that.sid) {\n        report.videoSendingStopped(that.sid, {\n          succ: true,\n          reason: 'muteVideo'\n        })\n      }\n      return true;\n    }\n    return false;\n  };\n\n  that.play = function (elementID, assetsURL) {\n    var options = undefined;\n    that.showing = false;\n    if (!that.local || that.video || that.screen) { //that.hasVideo() may be changed\n      if (elementID !== undefined) {\n        that.player = new VideoPlayer({id: that.getId(), stream: that, elementID: elementID, options: options, url: assetsURL});\n        that.showing = true;\n      }\n    } else if (that.hasAudio()) {\n      // local audio-only\n      that.player = new VideoPlayer({id: that.getId(), stream: that, elementID: elementID, options: options, url: assetsURL});\n      that.showing = true;\n    }\n  };\n\n  that.stop = function () {\n    Logger.debug('Stop stream player with id', that.streamId);\n    if (that.player !== undefined) {\n      that.player.destroy();\n    }\n  }\n\n\n  that.getStats = function(cb) {\n    if(that.pc && that.pc.getStats) {\n      that.pc.getStats(function(stats) {\n        if(that.pc.isSubscriber) {\n          var filterStats = subscribeStatsFilter(stats);\n          if(isFireFox()) {\n            filterStats.videoReceivedResolutionHeight = that.videoHeight + '';\n            filterStats.videoReceivedResolutionWidth = that.videoWidth + '';\n          }\n          cb && cb(subscribeStatsFilter(stats));\n        } else {\n          var filterStats = publishStatsFilter(stats);\n          if(!isChrome()) {\n            filterStats.videoSendResolutionHeight = that.videoHeight + '';\n            filterStats.videoSendResolutionWidth = that.videoWidth + '';\n          }\n          if(!isChrome() && that.uplinkStats) {\n            filterStats.videoSendBandwidth = that.uplinkStats.uplink_available_bandwidth + \"\";\n            filterStats.videoSendPacketsLost = that.uplinkStats.uplink_cumulative_lost + \"\";\n          }\n          cb && cb(filterStats);\n        }\n      })\n    } else {\n      Logger.warning(\"use getStats after peerConnection established\");\n    }\n  }  \n\n  that.getAudioLevel = function() {\n    if(that.audioLevelHelper) {\n      return that.audioLevelHelper.getAudioLevel();\n    } else {\n      if(that.stream) {\n        if(that.stream.getAudioTracks().length !== 0) {\n          that.audioLevelHelper = new audioLevelHelper(that.stream);\n          return that.audioLevelHelper.getAudioLevel();\n        } else {\n          Logger.warning(\"can't get audioLevel beacuse no audio trace in stream\");  \n        }\n      } else {\n        Logger.warning(\"can't get audioLevel beacuse no stream exist\");\n        return 0;\n      }\n    }\n  }\n\n  return that;\n};\n\nvar createStream = function(spec) {\n  Logger.debug('Create stream');\n  return Stream(spec);\n};\n\nvar getDevices = function(onSuccess, onFailure) {\n  if (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices) {\n    Logger.warning(\"enumerateDevices() not supported.\");\n    onFailure && onFailure(\"enumerateDevices() not supported\");\n  }\n\n  navigator.mediaDevices.enumerateDevices()\n  .then(devices => onSuccess(devices))\n  .catch(err => onFailure && onFailure(err.name + ': ' + err.message));\n}\n\nexport {Stream, createStream, getDevices}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Stream.js","const ErrorCodes = {\n    FAILED: 'FAILED',\n    INVALID_KEY: 'INVALID_KEY',\n    INVALID_OPERATION: 'INVALID_OPERATION',\n    INVALID_PARAMETER: 'INVALID_PARAMETER',\n    INVALID_LOCAL_STREAM: 'INVALID_LOCAL_STREAM',\n    INVALID_REMOTE_STREAM: 'INVALID_REMOTE_STREAM',\n    INVALID_DYNAMIC_KEY: 'INVALID_DYNAMIC_KEY',\n    DYNAMIC_KEY_TIMEOUT: 'DYNAMIC_KEY_TIMEOUT',\n    NO_VOCS_AVAILABLE: 'NO_VOCS_AVAILABLE',\n    NO_VOS_AVAILABLE: 'ERR_NO_VOS_AVAILABLE',\n    JOIN_CHANNEL_TIMEOUT: 'ERR_JOIN_CHANNEL_TIMEOUT',\n    NO_AVAILABLE_CHANNEL: 'NO_AVAILABLE_CHANNEL',\n    LOOKUP_CHANNEL_TIMEOUT: 'LOOKUP_CHANNEL_TIMEOUT',\n    LOOKUP_CHANNEL_REJECTED: 'LOOKUP_CHANNEL_REJECTED',\n    OPEN_CHANNEL_TIMEOUT: 'OPEN_CHANNEL_TIMEOUT',\n    OPEN_CHANNEL_REJECTED: 'OPEN_CHANNEL_REJECTED',\n    REQUEST_DEFERRED: 'REQUEST_DEFERRED',\n\n    SOCKET_ERROR: 'SOCKET_ERROR',\n    SOCKET_DISCONNECTED: 'SOCKET_DISCONNECTED',\n    PEERCONNECTION_FAILED: 'PEERCONNECTION_FAILED',\n    CONNECT_GATEWAY_ERROR: 'CONNECT_GATEWAY_ERROR',\n\n    SERVICE_NOT_AVAILABLE: 'SERVICE_NOT_AVAILABLE',\n    JOIN_CHANNEL_FAILED: 'JOIN_CHANNEL_FAILED',\n    PUBLISH_STREAM_FAILED: 'PUBLISH_STREAM_FAILED',\n    UNPUBLISH_STREAM_FAILED: 'UNPUBLISH_STREAM_FAILED',\n    SUBSCRIBE_STREAM_FAILED: 'SUBSCRIBE_STREAM_FAILED',\n    UNSUBSCRIBE_STREAM_FAILED: 'UNSUBSCRIBE_STREAM_FAILED',\n    NO_SUCH_REMOTE_STREAM: 'NO_SUCH_REMOTE_STREAM',\n\n    ERR_FAILED: '1',\n    ERR_INVALID_VENDOR_KEY: '101',\n    ERR_INVALID_CHANNEL_NAME: '102',\n    WARN_NO_AVAILABLE_CHANNEL: '103',\n    WARN_LOOKUP_CHANNEL_TIMEOUT: '104',\n    WARN_LOOKUP_CHANNEL_REJECTED: '105',\n    WARN_OPEN_CHANNEL_TIMEOUT: '106',\n    WARN_OPEN_CHANNEL_REJECTED: '107',\n    WARN_REQUEST_DEFERRED: '108',\n    ERR_DYNAMIC_KEY_TIMEOUT: '109',\n    ERR_INVALID_DYNAMIC_KEY: '110',\n    ERR_NO_VOCS_AVAILABLE: '2000',\n    ERR_NO_VOS_AVAILABLE: '2001',\n    ERR_JOIN_CHANNEL_TIMEOUT: '2002',\n\n    // for dualStream\n    IOS_NOT_SUPPORT: 'iOS not support dualStream',\n    SHARING_SCREEN_NOT_SUPPORT: 'sharing screen not support dualStream',\n    STILL_ON_PUBLISHING: 'Can\\'t open or close low-Stream when publishing or unpublish high-stream',\n\n    // other\n    ELECTRON_NOT_SUPPORT_SHARING_SCREEN: 'ELECTRON_NOT_SUPPORT_SHARING_SCREEN'\n};\n\nconst GatewayErrorCode = {\n    // internal  \n    '2000': 'ERR_NO_VOCS_AVAILABLE',\n    '2001': 'ERR_NO_VOS_AVAILABLE',\n    '2002': 'ERR_JOIN_CHANNEL_TIMEOUT',\n\n    // vocs\n    '101': 'ERR_INVALID_VENDOR_KEY',\n    '102': 'ERR_INVALID_CHANNEL_NAME',\n    '103': 'WARN_NO_AVAILABLE_CHANNEL',\n    '104': 'WARN_LOOKUP_CHANNEL_TIMEOUT',\n    '105': 'WARN_LOOKUP_CHANNEL_REJECTED',\n    '106': 'WARN_OPEN_CHANNEL_TIMEOUT',\n    '107': 'WARN_OPEN_CHANNEL_REJECTED',\n    '108': 'WARN_REQUEST_DEFERRED',\n    '109': 'ERR_DYNAMIC_KEY_TIMEOUT',\n    '110': 'ERR_NO_AUTHORIZED',\n    '111': 'ERR_VOM_SERVICE_UNAVAILABLE',\n    '112': 'ERR_NO_CHANNEL_AVAILABLE_CODE',\n    '113': 'ERR_TOO_MANY_USERS',\n    '114': 'ERR_MASTER_VOCS_UNAVAILABLE',\n    '115': 'ERR_INTERNAL_ERROR',\n    '116': 'ERR_NO_ACTIVE_STATUS',\n    '117': 'ERR_INVALID_UID',\n    '118': 'ERR_DYNAMIC_KEY_EXPIRED',\n    '119': 'ERR_STATIC_USE_DYANMIC_KE',\n    '120': 'ERR_DYNAMIC_USE_STATIC_KE',\n\n    //vos \n    '2': 'K_TIMESTAMP_EXPIRED',\n    '3': 'K_CHANNEL_PERMISSION_INVALID',\n    '4': 'K_CERTIFICATE_INVALID',\n    '5': 'K_CHANNEL_NAME_EMPTY',\n    '6': 'K_CHANNEL_NOT_FOUND',\n    '7': 'K_TICKET_INVALID',\n    '8': 'K_CHANNEL_CONFLICTED',\n    '9': 'K_SERVICE_NOT_READY', \n    '10': 'K_SERVICE_TOO_HEAVY',\n    '14': 'K_UID_BANNED',\n    '15': 'K_IP_BANNED',\n    '16': 'K_CHANNEL_BANNED'\n\n}\n\nexport default ErrorCodes\nexport {\n    GatewayErrorCode\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/ErrorCodes.js","/*global window, document, clearTimeout, setTimeout */\n\n/*\n * Bar represents the bottom menu bar of every mediaPlayer.\n * It contains a Speaker and an icon.\n * Every Bar is a View.\n * Ex.: var bar = Bar({elementID: element, id: id});\n */\nimport View from './View'\nimport Speaker from './Speaker'\n\nvar Bar = function (spec) {\n    \"use strict\";\n    var that = View({}),\n        waiting,\n        show;\n\n    // Variables\n\n    // DOM element in which the Bar will be appended\n    that.elementID = spec.elementID;\n\n    // Bar ID\n    that.id = spec.id;\n\n    // Assets URL\n    that.url = spec.url;\n\n    // Container\n    that.div = document.createElement('div');\n    that.div.setAttribute('id', 'bar_' + that.id);\n\n    // Bottom bar\n    that.bar = document.createElement('div');\n    that.bar.setAttribute('style', 'width: 100%; height: 15%; max-height: 30px; position: absolute; bottom: 0; right: 0; background-color: rgba(255,255,255,0.62)');\n    that.bar.setAttribute('id', 'subbar_' + that.id);\n\n    // Lynckia icon\n    that.link = document.createElement('a');\n    that.link.setAttribute('href', 'http://www.lynckia.com/');\n    that.link.setAttribute('target', '_blank');\n\n    that.logo = document.createElement('img');\n    that.logo.setAttribute('style', 'width: 100%; height: 100%; max-width: 30px; position: absolute; top: 0; left: 2px;');\n    that.logo.setAttribute('alt', 'Lynckia');\n    //that.logo.setAttribute('src', that.url + '/assets/star.svg');\n\n    // Private functions\n    show = function (displaying) {\n        if (displaying !== 'block') {\n            displaying = 'none';\n        } else {\n            clearTimeout(waiting);\n        }\n\n        that.div.setAttribute('style', 'width: 100%; height: 100%; position: absolute; bottom: 0; right: 0; display:' + displaying);\n    };\n\n    // Public functions\n\n    that.display = function () {\n        show('block');\n    };\n\n    that.hide = function () {\n        waiting = setTimeout(show, 1000);\n    };\n\n    document.getElementById(that.elementID).appendChild(that.div);\n    that.div.appendChild(that.bar);\n    // that.bar.appendChild(that.link);\n    // that.link.appendChild(that.logo);\n\n    // Speaker component\n    if (!spec.stream.screen && (spec.options === undefined || spec.options.speaker === undefined || spec.options.speaker === true)) {\n        that.speaker = new Speaker({elementID: 'subbar_' + that.id, id: that.id, stream: spec.stream, media: spec.media, url: that.url});\n    }\n\n    that.display();\n    that.hide();\n\n    return that;\n};\n\nexport default Bar\n\n\n\n// WEBPACK FOOTER //\n// ./src/views/Bar.js","import ChromeCanaryStack from './webrtc-stacks/ChromeCanaryStack'\nimport ChromeStableStack from './webrtc-stacks/ChromeStableStack'\nimport SafariStableStack from './webrtc-stacks/SafariStableStack'\nimport FcStack from './webrtc-stacks/FcStack'\nimport FirefoxStack from './webrtc-stacks/FirefoxStack'\nimport Logger from './utils/Logger'\nimport {ErrorCodes} from './utils/ErrorCodes';\n\nvar sessionId = 103;\n\nvar Connection = function (spec) {\n  \"use strict\";\n  var that = {};\n\n  spec.session_id = (sessionId += 1);\n\n  // Check which WebRTC Stack is installed.\n  if (typeof window == \"undefined\" || !window.navigator) {\n    Logger.error('Publish/subscribe video/audio streams not supported yet');\n    that = FcStack(spec);\n  } else if (window.navigator.userAgent.match(\"Firefox\") !== null) {\n    // Firefox\n    that.browser = \"mozilla\";\n    that = FirefoxStack(spec);\n  } else if (window.navigator.userAgent.indexOf(\"Safari\") > -1 && navigator.userAgent.indexOf(\"Chrome\") === -1) {\n    // Safari.\n    Logger.debug(\"Safari\");\n    that = SafariStableStack(spec);\n    that.browser = \"safari\";\n  } else if (window.navigator.userAgent.indexOf(\"MSIE \")) {\n    // Internet Explorer.\n    //Logger.debug(\"IE\");\n    that = ChromeStableStack(spec);\n    that.browser = \"ie\";\n  } else if (window.navigator.appVersion.match(/Chrome\\/([\\w\\W]*?)\\./)[1] >= 26) {\n    // Google Chrome Stable.\n    //Logger.debug(\"Stable\");\n    that = ChromeStableStack(spec);\n    that.browser = \"chrome-stable\";\n  } else if (window.navigator.userAgent.toLowerCase().indexOf(\"chrome\") >= 40) {\n    // Google Chrome Canary.\n    //Logger.debug(\"Canary!\");\n    that = ChromeCanaryStack(spec);\n    that.browser = \"chrome-canary\";\n  } else {\n    // None.\n    that.browser = \"none\";\n    throw \"WebRTC stack not available\";\n  }\n  return that;\n};\n\nvar electronUtil = function(config, callback, error) {\n  var that = {};\n  that.callback = callback;\n  that.config = config;\n  that.error = error;\n\n  that.selectSource = function(sources, callback, error) {\n    var dialog = document.createElement('div');\n    dialog.setAttribute('style', 'position: absolute; z-index: 99999999; width: 65%; height: 70%; top:50%; left:50%; -webkit-transform:translate(-50%,-50%); transform:translate(-50%,-50%); border: #333333 1px solid; background: #ffffff; overflow: scroll;'\n    + 'display: flex; justify-content: space-around; flex-wrap: wrap;'\n    + 'padding: 50px 20px 5px 20px;box-shadow: 10px #333333;'\n    );\n\n    document.body.appendChild(dialog);\n\n    \n\n    sources.map(source => { \n      if(source.id) {\n        var item = document.createElement('div');\n        item.setAttribute('style','width: 30%;text-align: center;');\n\n        var span = document.createElement('div');\n        span.innerHTML = source.name;\n        span.setAttribute('style','display: inline-block;width: 70%;word-break: keep-all;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;');\n\n        var imgContain = document.createElement('div');\n        imgContain.setAttribute('style','width: 100%;height: 70%');\n\n        var img = document.createElement('img');\n        img.setAttribute('style','height: 100%;');\n        img.src = source.thumbnail.toDataURL();\n\n        item.onclick = () => {\n          document.body.removeChild(dialog);\n          callback && callback(source.id)\n        }\n        imgContain.appendChild(img);\n        item.appendChild(imgContain);\n        item.appendChild(span);\n        dialog.appendChild(item);\n      }\n    })\n\n    var bottom = document.createElement('button');\n    bottom.innerHTML = 'Back';\n    bottom.setAttribute('style', ' width: 100%; padding:10px 0; background-color: #fff; font-size: 20px; color: #333;border: none;')\n    bottom.onclick = () => {\n      document.body.removeChild(dialog);\n      error && error('NotAllowedError');\n    }\n    dialog.appendChild(bottom);\n  \n  }\n\n  that.share = function(electron) {\n    electron.desktopCapturer.getSources({types: ['window', 'screen']}, (error, sources) => {\n      if (error) throw error;\n      that.selectSource(sources, function(sourceId) {\n\n        var mWidth = that.config.attributes.width;\n        var mHeight = that.config.attributes.height;\n        var maxFr = that.config.attributes.maxFr;\n        var minFr = that.config.attributes.minFr;\n\n        var config = {\n          audio: false,\n          video: {\n            mandatory: {\n              chromeMediaSource: 'desktop',\n              chromeMediaSourceId: sourceId,\n              maxHeight: mHeight, \n              maxWidth: mWidth, \n              maxFrameRate: maxFr, \n              minFrameRate: minFr\n            }\n          }\n        }\n\n        navigator.webkitGetUserMedia(config, that.callback, that.error)\n      }, that.error);\n    })\n  }\n  return that;\n}\n\nvar GetUserMedia = function (config, callback, error) {\n  \"use strict\";\n  \n  navigator.getMedia = (navigator.getUserMedia ||\n                        navigator.webkitGetUserMedia ||\n                        navigator.mozGetUserMedia ||\n                        navigator.msGetUserMedia);\n  if (config.screen) {\n\n    // for electron\n    var electron = null;\n    try {\n      electron = window.require('electron');\n    } catch (err) {}\n\n    if (electron) {\n      if(electron.desktopCapturer) {\n        var el = electronUtil(config, callback, error);\n        el.share(electron);\n      } else {\n        error(ErrorCodes.ELECTRON_NOT_SUPPORT_SHARING_SCREEN);\n      }\n      return;\n    }\n  \n    Logger.debug(\"Screen access requested\");\n    if (window.navigator.userAgent.match(\"Firefox\") !== null) {\n      //firefox\n      var mediaSource = ['screen', 'window', 'application'];\n      if(!~mediaSource.indexOf(config.mediaSource)) {\n        return error && error('Invalid mediaSource, mediaSource should be one of [screen, window, application]');\n      }\n\n      var theConfig = {};\n      if(config.video.mandatory != undefined){\n        theConfig.video = config.video;\n        theConfig.video.mediaSource = config.mediaSource;\n      } else {\n        theConfig = { video: { mediaSource: config.mediaSource }};\n      }\n      navigator.getMedia(theConfig,callback,error);\n    } else if (window.navigator.userAgent.match(\"Chrome\") !==null) {\n      //chrome\n      if (window.navigator.appVersion.match(/Chrome\\/([\\w\\W]*?)\\./)[1] < 34) {\n        error({code: \"This browser does not support screen sharing\"});\n        return;\n      }\n      var extensionId = \"okeephmleflklcdebijnponpabbmmgeo\";\n      if (config.extensionId){\n        Logger.debug(\"extensionId supplied, using \" + config.extensionId);\n        extensionId = config.extensionId;\n      }\n      Logger.debug(\"Screen access on chrome stable, looking for extension\");\n      try {\n        chrome.runtime.sendMessage(\n            extensionId,\n            { getStream: true },\n            function (response) {\n              if (response === undefined) {\n                Logger.debug(\"Access to screen denied\");\n                var theError = {code: \"Access to screen denied\"};\n                error(theError);\n                return;\n              }\n              var theId = response.streamId;\n              var mWidth = config.attributes.width;\n              var mHeight = config.attributes.height;\n              var maxFr = config.attributes.maxFr;\n              var minFr = config.attributes.minFr;\n              theConfig = {\n                video: { mandatory:\n                  { chromeMediaSource: 'desktop',  chromeMediaSourceId: theId, maxHeight: mHeight, maxWidth: mWidth, maxFrameRate: maxFr, minFrameRate: minFr}}};\n              navigator.getMedia(theConfig,callback,error);\n        });\n      } catch (e) {\n        Logger.debug(\"AgoraRTC screensharing plugin is not accessible\");\n        var theError = {code: \"no_plugin_present\"};\n        error(theError);\n        return;\n      }\n    } else {\n      Logger.debug(\"This browser does not support screenSharing\");\n    }\n  } else if (window.navigator.userAgent.indexOf(\"Safari\") > -1 && navigator.userAgent.indexOf(\"Chrome\") === -1) {\n    navigator.mediaDevices.getUserMedia(config).then(callback).catch(error);\n  } else {\n    if (typeof navigator == 'undefined' || !navigator.getMedia) {\n      Logger.error('Video/audio streams not supported yet');\n    } else {\n      navigator.getMedia(config, callback, error);\n    }\n  }\n};\n\nexport {Connection, GetUserMedia}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Connection.js","import * as config from '../Config';\n\nvar post = function (url, data, success, failure) {\n  var xhr = new XMLHttpRequest();\n  xhr.timeout = data.timeout || config.HTTP_CONNECT_TIMEOUT;\n  xhr.open(\"POST\", url, true);\n  xhr.setRequestHeader(\"Content-type\", \"application/json; charset=utf-8\");\n  xhr.onload = function (e) {\n    success && success(xhr.responseText);\n  };\n  xhr.onerror = function (e) {\n    failure && failure(e, url);\n  };\n  xhr.ontimeout = function (e) {\n    failure && failure(e, url);\n  }\n  xhr.send(JSON.stringify(data));\n};\n\nvar shouldUseHttps = function() {\n  return \"https:\" == document.location.protocol ? true : false;\n}\n\nexport { post, shouldUseHttps };\n\n\n// WEBPACK FOOTER //\n// ./src/utils/Request.js","var AgoraCall = function (callback) {\n    if (callback) {\n        callback.apply(this, [].slice.call(arguments,1));\n    }\n};\n\nexport default AgoraCall\n\n\n// WEBPACK FOOTER //\n// ./src/utils/AgoraCall.js","import * as config from './Config';\nimport Logger from \"./utils/Logger\";\nimport {post, shouldUseHttps} from './utils/Request';\nimport {report} from \"./Report2\";\nimport { CSCrashRecord } from './Helper';\n\nvar requestChooseServer = function(url, option, onSuccess, onFailure) {\n  var lts = new Date().getTime();\n\n  var csOption = {\n    key: option.appId,\n    cname: option.cname,\n    uid: option.uid\n  }\n\n  post(url, csOption, function (res) {\n    var response = JSON.parse(res);\n    var error = response.error;\n\n    if (error != undefined) {\n      report.joinChooseServer(option.sid, {\n        lts: lts,\n        succ: false,\n        csAddr: url,\n        serverList: null,\n        ec: error,\n      })\n      onFailure(\"Get server node failed [\" + error + \"]\", url);\n\n    } else {\n      onSuccess(response, url);\n    }\n  }, function (e, url) {\n    if(e.type === \"timeout\") {\n      report.joinChooseServer(option.sid, {\n        lts: lts,\n        succ: false,\n        csAddr: url,\n        serverList: null,\n        ec: \"timeout\",\n      })\n      onFailure(\"Connect choose server timeout\", url);\n\n    } else {\n      report.joinChooseServer(option.sid, {\n        lts: lts,\n        succ: false,\n        csAddr: url,\n        serverList: null,\n        ec: \"server_wrong\",\n      })\n      // onFailure(\"Connect choose server error\", url);\n    }\n  });\n}\n\nvar requestGatewayList = function(joinInfo, onSuccess, onFailure) {\n  var lts = new Date().getTime();\n  var connected = false;\n  CSCrashRecord.record(lts);\n\n  var success = function(response, url) {\n    if(!connected) {\n      clearTimeout(st);\n      connected = true;\n      Logger.debug(\"Get gateway address:\", response.gateway_addr);\n      onSuccess(response);\n\n      report.joinChooseServer(joinInfo.sid,{\n        lts: lts,\n        succ: true,\n        csAddr: url,\n        serverList: response.gateway_addr,\n        cid: response.cid + \"\",\n        uid: response.uid + \"\",\n        ec: null,\n      }, true);\n\n    } else {\n      report.joinChooseServer(joinInfo.sid,{\n        lts: lts,\n        succ: true,\n        csAddr: url,\n        serverList: response.gateway_addr,\n        cid: response.cid + \"\",\n        uid: response.uid + \"\",\n        ec: null,\n      }, false);\n    }\n  }\n\n  var failed = function(e, url) {\n    Logger.error(e, url);\n  }\n\n  var domainlist = config.WEBCS_DOMAIN\n  for (var i = 0; i < domainlist.length; ++i) { \n    var csURL;\n    csURL = shouldUseHttps() ? \n      \"https://\" + domainlist[i] + \":5668/getwebgw/jsonp\" :\n      \"http://\" + domainlist[i] + \":5669/getwebgw/jsonp\";\n    // Logger.debug(\"Connect to backup_choose_server:\", csURL);\n    requestChooseServer(csURL, joinInfo, success, failed);\n  }\n\n  var st = setTimeout(function() {\n    if(!connected) {\n      var backupList = config.WEBCS_DOMAIN_BACKUP_LIST;\n      for (var i = 0; i < backupList.length; ++i) { \n        var csURL;\n        csURL = shouldUseHttps() ? \n          \"https://\" + backupList[i] + \":5668/getwebgw/jsonp\" :\n          \"http://\" + backupList[i] + \":5669/getwebgw/jsonp\";\n        // Logger.debug(\"Connect to backup_choose_server:\", csURL);\n        requestChooseServer(csURL, joinInfo, success, failed);\n      }\n    }\n  }, 1000);\n  \n  setTimeout(function() {\n    if(!connected) {\n      onFailure();\n    }\n  }, config.WEBCS_BACKUP_CONNECT_TIMEOUT);\n}\n\n//TODO: put it in Controll layer\nvar getGatewayList = function(param, onSuccess, onFailure) {\n  var isSuccess = false;\n  var timer = null;\n  var times = 1;\n\n  var request = function() {\n    // To prevent so many request that make server crash.\n    if(CSCrashRecord.shouldBlock()) {\n      Logger.warning(\"CS connetion crash too many times in 10s\");\n      return onFailure && onFailure();\n    }\n\n    if(!isSuccess) {\n      requestGatewayList(param, function(gatewayAddr) {\n        isSuccess = true;\n        clearTimeout(timer);\n        onSuccess(gatewayAddr);\n      }, function() {\n        // Backoff mechanism is reconnecting after double previous time,like 1,2,4,8,16,32... until 3600.\n        Logger.debug(\"Request gateway list will be restart in \"+ times +\"s\");\n        timer = setTimeout(function() {\n          request();\n        }, times * 1000);  \n        times = times >= 3600 ? 3600 : times*2;\n      });    \n\n    }\n  }\n  request();\n}\n\nexport {getGatewayList}\n\n\n// WEBPACK FOOTER //\n// ./src/Server.js","// AUDIO_SAMPLE_RATE_TYPE\nconst AUDIO_SAMPLE_RATE_32000 = 32000;\nconst AUDIO_SAMPLE_RATE_44100 = 44100;\nconst AUDIO_SAMPLE_RATE_48000 = 48000;\n\n// VIDEO_CODEC_PROFILE_TYPE\nconst VIDEO_CODEC_PROFILE_BASELINE = 66;\nconst VIDEO_CODEC_PROFILE_MAIN = 77;\nconst VIDEO_CODEC_PROFILE_HIGH = 100;\n\n// REMOTE VIDEO STREAM TYPES\nconst REMOTE_VIDEO_STREAM_HIGH = 0;\nconst REMOTE_VIDEO_STREAM_LOW = 1;\nconst REMOTE_VIDEO_STREAM_MEDIUM = 2;\n\nexport {\n  AUDIO_SAMPLE_RATE_32000,\n  AUDIO_SAMPLE_RATE_44100,\n  AUDIO_SAMPLE_RATE_48000,\n\n  VIDEO_CODEC_PROFILE_BASELINE,\n  VIDEO_CODEC_PROFILE_MAIN,\n  VIDEO_CODEC_PROFILE_HIGH,\n\n  REMOTE_VIDEO_STREAM_HIGH,\n  REMOTE_VIDEO_STREAM_LOW,\n  REMOTE_VIDEO_STREAM_MEDIUM,\n}\n\n\n// WEBPACK FOOTER //\n// ./src/GlobalName.js","var getTimestamp = function() {\n\tvar date = new Date();\n\treturn  date.toTimeString().split(\" \")[0] + \":\" + date.getMilliseconds();\n}\n\nexport {\n\tgetTimestamp\n}\n\n\n// WEBPACK FOOTER //\n// ./src/utils/Time.js","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options == 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/uuid/v4.js\n// module id = 16\n// module chunks = 0 1","// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\nvar rng;\n\nvar crypto = global.crypto || global.msCrypto; // for IE 11\nif (crypto && crypto.getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16);\n  rng = function whatwgRNG() {\n    crypto.getRandomValues(rnds8);\n    return rnds8;\n  };\n}\n\nif (!rng) {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var  rnds = new Array(16);\n  rng = function() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n\nmodule.exports = rng;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/uuid/lib/rng-browser.js\n// module id = 17\n// module chunks = 0 1","var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// (webpack)/buildin/global.js\n// module id = 18\n// module chunks = 0 1","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  return  bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]];\n}\n\nmodule.exports = bytesToUuid;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../node_modules/uuid/lib/bytesToUuid.js\n// module id = 19\n// module chunks = 0 1","/*global window, console, document, webkitURL*/\n/*\n * VideoPlayer represents a Licode video component that shows either a local or a remote video.\n * Ex.: var player = VideoPlayer({id: id, stream: stream, elementID: elementID});\n * A VideoPlayer is also a View component.\n */\nimport View from './View'\nimport Bar from './Bar'\nimport ResizeSensor from 'css-element-queries/src/ResizeSensor'\nimport Logger from '../utils/Logger'\nimport {attachMediaStream} from '../vendor/adapter'\n\nvar VideoPlayer = function (spec) {\n    \"use strict\";\n\n    var that = View({}),\n        onmouseover,\n        onmouseout;\n\n    // Variables\n\n    // VideoPlayer ID\n    that.id = spec.id;\n\n    // Assets URL\n    that.url = spec.url;\n\n    // Stream that the VideoPlayer will play\n    that.stream = spec.stream.stream;\n\n    // DOM element in which the VideoPlayer will be appended\n    that.elementID = spec.elementID;\n\n    // Public functions\n\n    // It will stop the VideoPlayer and remove it from the HTML\n    that.destroy = function () {\n        // document.getElementById('video'+that.id).srcObject = null;\n        // document.getElementById('audio'+that.id).srcObject = null;\n        that.video.srcObject = null;\n        that.audio.srcObject = null;\n        that.video.pause();\n        delete that.resizer;\n        document.getElementById(that.div.id) && that.parentNode.removeChild(that.div);\n    };\n\n    that.resize = function () {\n\n        var width = that.container.offsetWidth,\n            height = that.container.offsetHeight;\n\n        if (spec.stream.screen) {\n\n            if (width * (3 / 4) < height) {\n\n                that.video.style.width = width + \"px\";\n                that.video.style.height = (3 / 4) * width + \"px\";\n\n                that.video.style.top = -((3 / 4) * width / 2 - height / 2) + \"px\";\n                that.video.style.left = \"0px\";\n\n            } else {\n\n                that.video.style.height = height + \"px\";\n                that.video.style.width = (4 / 3) * height + \"px\";\n\n                that.video.style.left = -((4 / 3) * height / 2 - width / 2) + \"px\";\n                that.video.style.top = \"0px\";\n\n            }\n        } else {\n            if (width !== that.containerWidth || height !== that.containerHeight) {\n\n                if (width * (3 / 4) > height) {\n\n                    that.video.style.width = width + \"px\";\n                    that.video.style.height = (3 / 4) * width + \"px\";\n\n                    that.video.style.top = -((3 / 4) * width / 2 - height / 2) + \"px\";\n                    that.video.style.left = \"0px\";\n\n                } else {\n\n                    that.video.style.height = height + \"px\";\n                    that.video.style.width = (4 / 3) * height + \"px\";\n\n                    that.video.style.left = -((4 / 3) * height / 2 - width / 2) + \"px\";\n                    that.video.style.top = \"0px\";\n\n                }\n            }\n        }\n\n        that.containerWidth = width;\n        that.containerHeight = height;\n\n    };\n\n    /*window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {\n        document.getElementById(key).value = unescape(value);\n    });*/\n\n    //Logger.debug('Creating URL from stream ' + that.stream);\n    //var myURL = window.URL || webkitURL;\n    //that.stream_url = myURL.createObjectURL(that.stream);\n\n    // Container\n    that.div = document.createElement('div');\n    that.div.setAttribute('id', 'player_' + that.id);\n    if (spec.stream.video) {\n      that.div.setAttribute('style', 'width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;');\n    } else {\n      that.div.setAttribute('style', 'width: 100%; height: 100%; position: relative; overflow: hidden;');\n    }\n\n    // Loader icon\n    //that.loader = document.createElement('img');\n    //that.loader.setAttribute('style', 'width: 16px; height: 16px; position: absolute; top: 50%; left: 50%; margin-top: -8px; margin-left: -8px');\n    //that.loader.setAttribute('id', 'back_' + that.id);\n    //that.loader.setAttribute('src', that.url + '/assets/loader.gif');\n\n    // Video tag\n    that.video = document.createElement('video');\n    that.video.setAttribute('id', 'video' + that.id);\n    if(spec.stream.local && !spec.stream.screen) {\n        if(spec.stream.mirror) {\n            that.video.setAttribute('style', 'width: 100%; height: 100%; position: absolute; transform: rotateY(180deg);');\n        } else {\n            that.video.setAttribute('style', 'width: 100%; height: 100%; position: absolute; ');\n        }\n    } else {\n\tif (spec.stream.video) {\n          that.video.setAttribute('style', 'width: 100%; height: 100%; position: absolute;');\n          if (window.navigator.userAgent.indexOf(\"Safari\") > -1 && navigator.userAgent.indexOf(\"Chrome\") === -1) {\n            that.video.setAttribute('controls', '');\n          }\n\t} else if (spec.stream.screen) {\n          that.video.setAttribute('style', 'width: 100%; height: 100%; position: absolute;');\n\t} else {\n          that.video.setAttribute('style', 'width: 100%; height: 100%; position: absolute; display: none;');\n\t}\n    }\n    that.video.setAttribute('autoplay', '');\n    that.video.setAttribute('muted', '');\n    that.video.setAttribute('playsinline', '');\n\n    if (spec.stream.local) {\n        that.video.volume = 0;\n        that.video.setAttribute('muted', '');\n    }\n\n    // Audio tag\n    that.audio = document.createElement('audio');\n    that.audio.setAttribute('id', 'audio' + that.id);\n    that.audio.setAttribute('autoplay', '');\n\n    if (spec.stream.local) {\n        that.audio.volume = 0;\n        that.audio.setAttribute('muted', '');\n    }\n\n    if (that.elementID !== undefined) {\n        document.getElementById(that.elementID).appendChild(that.div);\n        that.container = document.getElementById(that.elementID);\n    } else {\n        document.body.appendChild(that.div);\n        that.container = document.body;\n    }\n\n    that.parentNode = that.div.parentNode;\n\n    //that.div.appendChild(that.loader);\n    // that.div.appendChild(that.video);\n    // that.div.appendChild(that.audio);\n    that.video.addEventListener(\"playing\", function (evt) {\n        var display = function () {\n            if (that.video.videoWidth * that.video.videoHeight > 4) { // why remote video size initially is 2*2 in chrome?\n                Logger.debug('video dimensions:', that.video.videoWidth, that.video.videoHeight);\n                return;\n            }\n            setTimeout(display, 50);\n        };\n        display();\n    });\n\n    that.containerWidth = 0;\n    that.containerHeight = 0;\n\n    that.resizer = new ResizeSensor(that.container, that.resize);\n\n    that.resize();\n\n    if (spec.stream.hasVideo() ||  spec.stream.hasScreen()) {\n        that.div.appendChild(that.video);\n        that.div.appendChild(that.audio);\n\n        attachMediaStream(that.video, spec.stream.stream);\n        attachMediaStream(that.audio, spec.stream.stream);\n\n    } else {\n        // in audio-only mode\n        // local player should not be muted\n        !spec.stream.local && that.video.removeAttribute('muted');\n        that.div.appendChild(that.video);\n\n        var audioStream = new MediaStream(spec.stream.stream.getAudioTracks());\n        that.video.srcObject = audioStream;\n        // that.video.play();\n        \n    }    \n\n    return that;\n};\n\nexport default VideoPlayer\n\n\n\n// WEBPACK FOOTER //\n// ./src/views/VideoPlayer.js","/*global window, console, document */\n/*\n * Speaker represents the volume icon that will be shown in the mediaPlayer, for example.\n * It manages the volume level of the media tag given in the constructor.\n * Every Speaker is a View.\n * Ex.: var speaker = Speaker({elementID: element, media: mediaTag, id: id});\n */\nimport View from './View'\n\nvar Speaker = function (spec) {\n    \"use strict\";\n    var that = View({}),\n        show,\n        mute,\n        unmute,\n        lastVolume = 50;\n\n    // Variables\n\n    // DOM element in which the Speaker will be appended\n    that.elementID = spec.elementID;\n\n    // media tag\n    that.media = spec.media;\n\n    // Speaker id\n    that.id = spec.id;\n\n    // Assets URL\n    if (spec.url !== undefined) {\n      that.url = spec.url;\n    }\n\n    // MediaStream\n    that.stream = spec.stream;\n\n    // Container\n    that.div = document.createElement('div');\n    that.div.setAttribute('style', 'width: 40%; height: 100%; max-width: 32px; position: absolute; right: 0;z-index:0;');\n\n    // Volume icon\n    that.icon = document.createElement('img');\n    that.icon.setAttribute('id', 'volume_' + that.id);\n    that.icon.setAttribute('src', that.url + '/assets/sound48.png');\n    that.icon.setAttribute('style', 'width: 80%; height: 100%; position: absolute;');\n    that.div.appendChild(that.icon);\n\n\n    if (!that.stream.local) {\n\n        // Volume bar\n        that.picker = document.createElement('input');\n        that.picker.setAttribute('id', 'picker_' + that.id);\n        that.picker.type = \"range\";\n        that.picker.min = 0;\n        that.picker.max = 100;\n        that.picker.step = 10;\n        that.picker.value = lastVolume;\n        that.picker.setAttribute(\"orient\", \"vertical\"); //  FireFox supports range sliders as of version 23\n\n\tthat.div.appendChild(that.picker);\n        that.media.volume = that.picker.value / 100;\n        that.media.muted = false;\n\n        that.picker.oninput = function () {\n            if (that.picker.value > 0) {\n                that.media.muted = false;\n                that.icon.setAttribute('src', that.url + '/assets/sound48.png');\n            } else {\n                that.media.muted = true;\n                that.icon.setAttribute('src', that.url + '/assets/mute48.png');\n            }\n            that.media.volume = that.picker.value / 100;\n        };\n\n        // Private functions\n        show = function (displaying) {\n            that.picker.setAttribute('style', 'background: transparent; width: 32px; height: 100px; position: absolute; bottom: 90%; z-index: 1;' + that.div.offsetHeight + 'px; right: 0px; -webkit-appearance: slider-vertical; display: ' + displaying);\n        };\n\n        mute = function () {\n            that.icon.setAttribute('src', that.url + '/assets/mute48.png');\n            lastVolume = that.picker.value;\n            that.picker.value = 0;\n            that.media.volume = 0;\n            that.media.muted = true;\n        };\n\n        unmute = function () {\n            that.icon.setAttribute('src', that.url + '/assets/sound48.png');\n            that.picker.value = lastVolume;\n            that.media.volume = that.picker.value / 100;\n            that.media.muted = false;\n        };\n\n        that.icon.onclick = function () {\n            if (that.media.muted) {\n                unmute();\n            } else {\n                mute();\n            }\n        };\n\n        // Public functions\n        that.div.onmouseover = function () {\n            show('block');\n        };\n\n        that.div.onmouseout = function () {\n            show('none');\n        };\n\n        show('none');\n\n    } else {\n\n        mute = function () {\n            that.media.muted = true;\n            that.icon.setAttribute('src', that.url + '/assets/mute48.png');\n            //that.stream.stream.getAudioTracks()[0].enabled = false;\n        };\n\n        unmute = function () {\n            that.media.muted = false;\n            that.icon.setAttribute('src', that.url + '/assets/sound48.png');\n            //that.stream.stream.getAudioTracks()[0].enabled = true;\n        };\n\n        that.icon.onclick = function () {\n            if (that.media.muted) {\n                unmute();\n            } else {\n                mute();\n            }\n        };\n    }\n\n    document.getElementById(that.elementID).appendChild(that.div);\n    return that;\n};\n\nexport default Speaker\n\n\n\n// WEBPACK FOOTER //\n// ./src/views/Speaker.js","/**\n * Copyright Marc J. Schmidt. See the LICENSE file at the top-level\n * directory of this distribution and at\n * https://github.com/marcj/css-element-queries/blob/master/LICENSE.\n */\n;\n(function (root, factory) {\n    if (typeof define === \"function\" && define.amd) {\n        define(factory);\n    } else if (typeof exports === \"object\") {\n        module.exports = factory();\n    } else {\n        root.ResizeSensor = factory();\n    }\n}(this, function () {\n\n    //Make sure it does not throw in a SSR (Server Side Rendering) situation\n    if (typeof window === \"undefined\") {\n        return null;\n    }\n    // Only used for the dirty checking, so the event callback count is limted to max 1 call per fps per sensor.\n    // In combination with the event based resize sensor this saves cpu time, because the sensor is too fast and\n    // would generate too many unnecessary events.\n    var requestAnimationFrame = window.requestAnimationFrame ||\n        window.mozRequestAnimationFrame ||\n        window.webkitRequestAnimationFrame ||\n        function (fn) {\n            return window.setTimeout(fn, 20);\n        };\n\n    /**\n     * Iterate over each of the provided element(s).\n     *\n     * @param {HTMLElement|HTMLElement[]} elements\n     * @param {Function}                  callback\n     */\n    function forEachElement(elements, callback){\n        var elementsType = Object.prototype.toString.call(elements);\n        var isCollectionTyped = ('[object Array]' === elementsType\n            || ('[object NodeList]' === elementsType)\n            || ('[object HTMLCollection]' === elementsType)\n            || ('[object Object]' === elementsType)\n            || ('undefined' !== typeof jQuery && elements instanceof jQuery) //jquery\n            || ('undefined' !== typeof Elements && elements instanceof Elements) //mootools\n        );\n        var i = 0, j = elements.length;\n        if (isCollectionTyped) {\n            for (; i < j; i++) {\n                callback(elements[i]);\n            }\n        } else {\n            callback(elements);\n        }\n    }\n\n    /**\n     * Class for dimension change detection.\n     *\n     * @param {Element|Element[]|Elements|jQuery} element\n     * @param {Function} callback\n     *\n     * @constructor\n     */\n    var ResizeSensor = function(element, callback) {\n        /**\n         *\n         * @constructor\n         */\n        function EventQueue() {\n            var q = [];\n            this.add = function(ev) {\n                q.push(ev);\n            };\n\n            var i, j;\n            this.call = function() {\n                for (i = 0, j = q.length; i < j; i++) {\n                    q[i].call();\n                }\n            };\n\n            this.remove = function(ev) {\n                var newQueue = [];\n                for(i = 0, j = q.length; i < j; i++) {\n                    if(q[i] !== ev) newQueue.push(q[i]);\n                }\n                q = newQueue;\n            }\n\n            this.length = function() {\n                return q.length;\n            }\n        }\n\n        /**\n         * @param {HTMLElement} element\n         * @param {String}      prop\n         * @returns {String|Number}\n         */\n        function getComputedStyle(element, prop) {\n            if (element.currentStyle) {\n                return element.currentStyle[prop];\n            } else if (window.getComputedStyle) {\n                return window.getComputedStyle(element, null).getPropertyValue(prop);\n            } else {\n                return element.style[prop];\n            }\n        }\n\n        /**\n         *\n         * @param {HTMLElement} element\n         * @param {Function}    resized\n         */\n        function attachResizeEvent(element, resized) {\n            if (!element.resizedAttached) {\n                element.resizedAttached = new EventQueue();\n                element.resizedAttached.add(resized);\n            } else if (element.resizedAttached) {\n                element.resizedAttached.add(resized);\n                return;\n            }\n\n            element.resizeSensor = document.createElement('div');\n            element.resizeSensor.className = 'resize-sensor';\n            var style = 'position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;';\n            var styleChild = 'position: absolute; left: 0; top: 0; transition: 0s;';\n\n            element.resizeSensor.style.cssText = style;\n            element.resizeSensor.innerHTML =\n                '<div class=\"resize-sensor-expand\" style=\"' + style + '\">' +\n                    '<div style=\"' + styleChild + '\"></div>' +\n                '</div>' +\n                '<div class=\"resize-sensor-shrink\" style=\"' + style + '\">' +\n                    '<div style=\"' + styleChild + ' width: 200%; height: 200%\"></div>' +\n                '</div>';\n            element.appendChild(element.resizeSensor);\n\n            if (getComputedStyle(element, 'position') == 'static') {\n                element.style.position = 'relative';\n            }\n\n            var expand = element.resizeSensor.childNodes[0];\n            var expandChild = expand.childNodes[0];\n            var shrink = element.resizeSensor.childNodes[1];\n            var dirty, rafId, newWidth, newHeight;\n            var lastWidth = element.offsetWidth;\n            var lastHeight = element.offsetHeight;\n\n            var reset = function() {\n                expandChild.style.width = '100000px';\n                expandChild.style.height = '100000px';\n\n                expand.scrollLeft = 100000;\n                expand.scrollTop = 100000;\n\n                shrink.scrollLeft = 100000;\n                shrink.scrollTop = 100000;\n            };\n\n            reset();\n\n            var onResized = function() {\n                rafId = 0;\n\n                if (!dirty) return;\n\n                lastWidth = newWidth;\n                lastHeight = newHeight;\n\n                if (element.resizedAttached) {\n                    element.resizedAttached.call();\n                }\n            };\n\n            var onScroll = function() {\n                newWidth = element.offsetWidth;\n                newHeight = element.offsetHeight;\n                dirty = newWidth != lastWidth || newHeight != lastHeight;\n\n                if (dirty && !rafId) {\n                    rafId = requestAnimationFrame(onResized);\n                }\n\n                reset();\n            };\n\n            var addEvent = function(el, name, cb) {\n                if (el.attachEvent) {\n                    el.attachEvent('on' + name, cb);\n                } else {\n                    el.addEventListener(name, cb);\n                }\n            };\n\n            addEvent(expand, 'scroll', onScroll);\n            addEvent(shrink, 'scroll', onScroll);\n        }\n\n        forEachElement(element, function(elem){\n            attachResizeEvent(elem, callback);\n        });\n\n        this.detach = function(ev) {\n            ResizeSensor.detach(element, ev);\n        };\n    };\n\n    ResizeSensor.detach = function(element, ev) {\n        forEachElement(element, function(elem){\n            if(elem.resizedAttached && typeof ev == \"function\"){\n                elem.resizedAttached.remove(ev);\n                if(elem.resizedAttached.length()) return;\n            }\n            if (elem.resizeSensor) {\n                if (elem.contains(elem.resizeSensor)) {\n                    elem.removeChild(elem.resizeSensor);\n                }\n                delete elem.resizeSensor;\n                delete elem.resizedAttached;\n            }\n        });\n    };\n\n    return ResizeSensor;\n\n}));\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/css-element-queries/src/ResizeSensor.js\n// module id = 22\n// module chunks = 0 1","/*\n *  Copyright (c) 2014 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n\n/* More information about these options at jshint.com/docs/options */\n/* jshint browser: true, camelcase: true, curly: true, devel: true,\n eqeqeq: true, forin: false, globalstrict: true, node: true,\n quotmark: single, undef: true, unused: strict */\n/* global mozRTCIceCandidate, mozRTCPeerConnection, Promise,\n mozRTCSessionDescription, webkitRTCPeerConnection, MediaStreamTrack */\n/* exported trace,requestUserMedia */\n\n'use strict';\n\nvar getUserMedia = null;\nvar attachMediaStream = null;\nvar reattachMediaStream = null;\nvar webrtcDetectedBrowser = null;\nvar webrtcDetectedVersion = null;\nvar webrtcMinimumVersion = null;\nvar webrtcUtils = {\n    log: function() {\n        // suppress console.log output when being included as a module.\n        if (typeof module !== 'undefined' ||\n            typeof require === 'function' && typeof define === 'function') {\n            return;\n        }\n        console.log.apply(console, arguments);\n    },\n    extractVersion: function(uastring, expr, pos) {\n        var match = uastring.match(expr);\n        return match && match.length >= pos && parseInt(match[pos]);\n    }\n};\n\nfunction trace(text) {\n    // This function is used for logging.\n    if (text[text.length - 1] === '\\n') {\n        text = text.substring(0, text.length - 1);\n    }\n    if (window.performance) {\n        var now = (window.performance.now() / 1000).toFixed(3);\n        webrtcUtils.log(now + ': ' + text);\n    } else {\n        webrtcUtils.log(text);\n    }\n}\n\nif (typeof window === 'object') {\n    if (window.HTMLMediaElement &&\n        !('srcObject' in window.HTMLMediaElement.prototype)) {\n        // Shim the srcObject property, once, when HTMLMediaElement is found.\n        Object.defineProperty(window.HTMLMediaElement.prototype, 'srcObject', {\n            get: function() {\n                // If prefixed srcObject property exists, return it.\n                // Otherwise use the shimmed property, _srcObject\n                return 'mozSrcObject' in this ? this.mozSrcObject : this._srcObject;\n            },\n            set: function(stream) {\n                if ('mozSrcObject' in this) {\n                    this.mozSrcObject = stream;\n                } else {\n                    // Use _srcObject as a private property for this shim\n                    this._srcObject = stream;\n                    // TODO: revokeObjectUrl(this.src) when !stream to release resources?\n                    this.src = URL.createObjectURL(stream);\n                }\n            }\n        });\n    }\n    // Proxy existing globals\n    getUserMedia = window.navigator && window.navigator.getUserMedia;\n}\n\n// Attach a media stream to an element.\nattachMediaStream = function(element, stream) {\n    element.srcObject = stream;\n};\n\nreattachMediaStream = function(to, from) {\n    to.srcObject = from.srcObject;\n};\n\nif (typeof window === 'undefined' || !window.navigator) {\n    webrtcUtils.log('This does not appear to be a browser');\n    webrtcDetectedBrowser = 'not a browser';\n} else if (navigator.mozGetUserMedia && window.mozRTCPeerConnection) {\n    webrtcUtils.log('This appears to be Firefox');\n\n    webrtcDetectedBrowser = 'firefox';\n\n    // the detected firefox version.\n    webrtcDetectedVersion = webrtcUtils.extractVersion(navigator.userAgent,\n        /Firefox\\/([0-9]+)\\./, 1);\n\n    // the minimum firefox version still supported by adapter.\n    webrtcMinimumVersion = 31;\n\n    // The RTCPeerConnection object.\n    window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n        if (webrtcDetectedVersion < 38) {\n            // .urls is not supported in FF < 38.\n            // create RTCIceServers with a single url.\n            if (pcConfig && pcConfig.iceServers) {\n                var newIceServers = [];\n                for (var i = 0; i < pcConfig.iceServers.length; i++) {\n                    var server = pcConfig.iceServers[i];\n                    if (server.hasOwnProperty('urls')) {\n                        for (var j = 0; j < server.urls.length; j++) {\n                            var newServer = {\n                                url: server.urls[j]\n                            };\n                            if (server.urls[j].indexOf('turn') === 0) {\n                                newServer.username = server.username;\n                                newServer.credential = server.credential;\n                            }\n                            newIceServers.push(newServer);\n                        }\n                    } else {\n                        newIceServers.push(pcConfig.iceServers[i]);\n                    }\n                }\n                pcConfig.iceServers = newIceServers;\n            }\n        }\n        return new mozRTCPeerConnection(pcConfig, pcConstraints); // jscs:ignore requireCapitalizedConstructors\n    };\n\n    // The RTCSessionDescription object.\n    if (!window.RTCSessionDescription) {\n        window.RTCSessionDescription = mozRTCSessionDescription;\n    }\n\n    // The RTCIceCandidate object.\n    if (!window.RTCIceCandidate) {\n        window.RTCIceCandidate = mozRTCIceCandidate;\n    }\n\n    // getUserMedia constraints shim.\n    getUserMedia = function(constraints, onSuccess, onError) {\n        var constraintsToFF37 = function(c) {\n            if (typeof c !== 'object' || c.require) {\n                return c;\n            }\n            var require = [];\n            Object.keys(c).forEach(function(key) {\n                if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n                    return;\n                }\n                var r = c[key] = (typeof c[key] === 'object') ?\n                    c[key] : {ideal: c[key]};\n                if (r.min !== undefined ||\n                    r.max !== undefined || r.exact !== undefined) {\n                    require.push(key);\n                }\n                if (r.exact !== undefined) {\n                    if (typeof r.exact === 'number') {\n                        r.min = r.max = r.exact;\n                    } else {\n                        c[key] = r.exact;\n                    }\n                    delete r.exact;\n                }\n                if (r.ideal !== undefined) {\n                    c.advanced = c.advanced || [];\n                    var oc = {};\n                    if (typeof r.ideal === 'number') {\n                        oc[key] = {min: r.ideal, max: r.ideal};\n                    } else {\n                        oc[key] = r.ideal;\n                    }\n                    c.advanced.push(oc);\n                    delete r.ideal;\n                    if (!Object.keys(r).length) {\n                        delete c[key];\n                    }\n                }\n            });\n            if (require.length) {\n                c.require = require;\n            }\n            return c;\n        };\n        if (webrtcDetectedVersion < 38) {\n            webrtcUtils.log('spec: ' + JSON.stringify(constraints));\n            if (constraints.audio) {\n                constraints.audio = constraintsToFF37(constraints.audio);\n            }\n            if (constraints.video) {\n                constraints.video = constraintsToFF37(constraints.video);\n            }\n            webrtcUtils.log('ff37: ' + JSON.stringify(constraints));\n        }\n        return navigator.mozGetUserMedia(constraints, onSuccess, onError);\n    };\n\n    navigator.getUserMedia = getUserMedia;\n\n    // Shim for mediaDevices on older versions.\n    if (!navigator.mediaDevices) {\n        navigator.mediaDevices = {getUserMedia: requestUserMedia,\n            addEventListener: function() { },\n            removeEventListener: function() { }\n        };\n    }\n    navigator.mediaDevices.enumerateDevices =\n        navigator.mediaDevices.enumerateDevices || function() {\n            return new Promise(function(resolve) {\n                var infos = [\n                    {kind: 'audioinput', deviceId: 'default', label: '', groupId: ''},\n                    {kind: 'videoinput', deviceId: 'default', label: '', groupId: ''}\n                ];\n                resolve(infos);\n            });\n        };\n\n    if (webrtcDetectedVersion < 41) {\n        // Work around http://bugzil.la/1169665\n        var orgEnumerateDevices =\n            navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);\n        navigator.mediaDevices.enumerateDevices = function() {\n            return orgEnumerateDevices().then(undefined, function(e) {\n                if (e.name === 'NotFoundError') {\n                    return [];\n                }\n                throw e;\n            });\n        };\n    }\n} else if (navigator.webkitGetUserMedia && window.webkitRTCPeerConnection) {\n    webrtcUtils.log('This appears to be Chrome');\n\n    webrtcDetectedBrowser = 'chrome';\n\n    // the detected chrome version.\n    webrtcDetectedVersion = webrtcUtils.extractVersion(navigator.userAgent,\n        /Chrom(e|ium)\\/([0-9]+)\\./, 2);\n\n    // the minimum chrome version still supported by adapter.\n    webrtcMinimumVersion = 38;\n\n    // The RTCPeerConnection object.\n    window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n        // Translate iceTransportPolicy to iceTransports,\n        // see https://code.google.com/p/webrtc/issues/detail?id=4869\n        if (pcConfig && pcConfig.iceTransportPolicy) {\n            pcConfig.iceTransports = pcConfig.iceTransportPolicy;\n        }\n\n        var pc = new webkitRTCPeerConnection(pcConfig, pcConstraints); // jscs:ignore requireCapitalizedConstructors\n        var origGetStats = pc.getStats.bind(pc);\n        pc.getStats = function(selector, successCallback, errorCallback) { // jshint ignore: line\n            var self = this;\n            var args = arguments;\n\n            // If selector is a function then we are in the old style stats so just\n            // pass back the original getStats format to avoid breaking old users.\n            if (arguments.length > 0 && typeof selector === 'function') {\n                return origGetStats(selector, successCallback);\n            }\n\n            var fixChromeStats = function(response) {\n                var standardReport = {};\n                var reports = response.result();\n                reports.forEach(function(report) {\n                    var standardStats = {\n                        id: report.id,\n                        timestamp: report.timestamp,\n                        type: report.type\n                    };\n                    report.names().forEach(function(name) {\n                        standardStats[name] = report.stat(name);\n                    });\n                    standardReport[standardStats.id] = standardStats;\n                });\n\n                return standardReport;\n            };\n\n            if (arguments.length >= 2) {\n                var successCallbackWrapper = function(response) {\n                    args[1](fixChromeStats(response));\n                };\n\n                return origGetStats.apply(this, [successCallbackWrapper, arguments[0]]);\n            }\n\n            // promise-support\n            return new Promise(function(resolve, reject) {\n                if (args.length === 1 && selector === null) {\n                    origGetStats.apply(self, [\n                        function(response) {\n                            resolve.apply(null, [fixChromeStats(response)]);\n                        }, reject]);\n                } else {\n                    origGetStats.apply(self, [resolve, reject]);\n                }\n            });\n        };\n\n        return pc;\n    };\n\n    // add promise support\n    ['createOffer', 'createAnswer'].forEach(function(method) {\n        var nativeMethod = webkitRTCPeerConnection.prototype[method];\n        webkitRTCPeerConnection.prototype[method] = function() {\n            var self = this;\n            if (arguments.length < 1 || (arguments.length === 1 &&\n                typeof(arguments[0]) === 'object')) {\n                var opts = arguments.length === 1 ? arguments[0] : undefined;\n                return new Promise(function(resolve, reject) {\n                    nativeMethod.apply(self, [resolve, reject, opts]);\n                });\n            } else {\n                return nativeMethod.apply(this, arguments);\n            }\n        };\n    });\n\n    ['setLocalDescription', 'setRemoteDescription',\n        'addIceCandidate'].forEach(function(method) {\n        var nativeMethod = webkitRTCPeerConnection.prototype[method];\n        webkitRTCPeerConnection.prototype[method] = function() {\n            var args = arguments;\n            var self = this;\n            return new Promise(function(resolve, reject) {\n                nativeMethod.apply(self, [args[0],\n                    function() {\n                        resolve();\n                        if (args.length >= 2) {\n                            args[1].apply(null, []);\n                        }\n                    },\n                    function(err) {\n                        reject(err);\n                        if (args.length >= 3) {\n                            args[2].apply(null, [err]);\n                        }\n                    }]\n                );\n            });\n        };\n    });\n\n    // getUserMedia constraints shim.\n    var constraintsToChrome = function(c) {\n        if (typeof c !== 'object' || c.mandatory || c.optional) {\n            return c;\n        }\n        var cc = {};\n        Object.keys(c).forEach(function(key) {\n            if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n                return;\n            }\n            var r = (typeof c[key] === 'object') ? c[key] : {ideal: c[key]};\n            if (r.exact !== undefined && typeof r.exact === 'number') {\n                r.min = r.max = r.exact;\n            }\n            var oldname = function(prefix, name) {\n                if (prefix) {\n                    return prefix + name.charAt(0).toUpperCase() + name.slice(1);\n                }\n                return (name === 'deviceId') ? 'sourceId' : name;\n            };\n            if (r.ideal !== undefined) {\n                cc.optional = cc.optional || [];\n                var oc = {};\n                if (typeof r.ideal === 'number') {\n                    oc[oldname('min', key)] = r.ideal;\n                    cc.optional.push(oc);\n                    oc = {};\n                    oc[oldname('max', key)] = r.ideal;\n                    cc.optional.push(oc);\n                } else {\n                    oc[oldname('', key)] = r.ideal;\n                    cc.optional.push(oc);\n                }\n            }\n            if (r.exact !== undefined && typeof r.exact !== 'number') {\n                cc.mandatory = cc.mandatory || {};\n                cc.mandatory[oldname('', key)] = r.exact;\n            } else {\n                ['min', 'max'].forEach(function(mix) {\n                    if (r[mix] !== undefined) {\n                        cc.mandatory = cc.mandatory || {};\n                        cc.mandatory[oldname(mix, key)] = r[mix];\n                    }\n                });\n            }\n        });\n        if (c.advanced) {\n            cc.optional = (cc.optional || []).concat(c.advanced);\n        }\n        return cc;\n    };\n\n    getUserMedia = function(constraints, onSuccess, onError) {\n        if (constraints.audio) {\n            constraints.audio = constraintsToChrome(constraints.audio);\n        }\n        if (constraints.video) {\n            constraints.video = constraintsToChrome(constraints.video);\n        }\n        webrtcUtils.log('chrome: ' + JSON.stringify(constraints));\n        return navigator.webkitGetUserMedia(constraints, onSuccess, onError);\n    };\n    navigator.getUserMedia = getUserMedia;\n\n    if (!navigator.mediaDevices) {\n        navigator.mediaDevices = {getUserMedia: requestUserMedia,\n            enumerateDevices: function() {\n                return new Promise(function(resolve) {\n                    var kinds = {audio: 'audioinput', video: 'videoinput'};\n                    return MediaStreamTrack.getSources(function(devices) {\n                        resolve(devices.map(function(device) {\n                            return {label: device.label,\n                                kind: kinds[device.kind],\n                                deviceId: device.id,\n                                groupId: ''};\n                        }));\n                    });\n                });\n            }};\n    }\n\n    // A shim for getUserMedia method on the mediaDevices object.\n    // TODO(KaptenJansson) remove once implemented in Chrome stable.\n    if (!navigator.mediaDevices.getUserMedia) {\n        navigator.mediaDevices.getUserMedia = function(constraints) {\n            return requestUserMedia(constraints);\n        };\n    } else {\n        // Even though Chrome 45 has navigator.mediaDevices and a getUserMedia\n        // function which returns a Promise, it does not accept spec-style\n        // constraints.\n        var origGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n        navigator.mediaDevices.getUserMedia = function(c) {\n            webrtcUtils.log('spec:   ' + JSON.stringify(c)); // whitespace for alignment\n            c.audio = constraintsToChrome(c.audio);\n            c.video = constraintsToChrome(c.video);\n            webrtcUtils.log('chrome: ' + JSON.stringify(c));\n            return origGetUserMedia(c);\n        };\n    }\n\n    // Dummy devicechange event methods.\n    // TODO(KaptenJansson) remove once implemented in Chrome stable.\n    if (typeof navigator.mediaDevices.addEventListener === 'undefined') {\n        navigator.mediaDevices.addEventListener = function() {\n            webrtcUtils.log('Dummy mediaDevices.addEventListener called.');\n        };\n    }\n    if (typeof navigator.mediaDevices.removeEventListener === 'undefined') {\n        navigator.mediaDevices.removeEventListener = function() {\n            webrtcUtils.log('Dummy mediaDevices.removeEventListener called.');\n        };\n    }\n\n    // Attach a media stream to an element.\n    attachMediaStream = function(element, stream) {\n        if (webrtcDetectedVersion >= 43) {\n            element.srcObject = stream;\n        } else if (typeof element.src !== 'undefined') {\n            element.src = URL.createObjectURL(stream);\n        } else {\n            webrtcUtils.log('Error attaching stream to element.');\n        }\n    };\n    reattachMediaStream = function(to, from) {\n        if (webrtcDetectedVersion >= 43) {\n            to.srcObject = from.srcObject;\n        } else {\n            to.src = from.src;\n        }\n    };\n\n} else if (navigator.mediaDevices && navigator.userAgent.match(\n        /Edge\\/(\\d+).(\\d+)$/)) {\n    webrtcUtils.log('This appears to be Edge');\n    webrtcDetectedBrowser = 'edge';\n\n    webrtcDetectedVersion = webrtcUtils.extractVersion(navigator.userAgent,\n        /Edge\\/(\\d+).(\\d+)$/, 2);\n\n    // the minimum version still supported by adapter.\n    webrtcMinimumVersion = 12;\n} else {\n    webrtcUtils.log('Browser does not appear to be WebRTC-capable');\n}\n\n// Returns the result of getUserMedia as a Promise.\nfunction requestUserMedia(constraints) {\n    return new Promise(function(resolve, reject) {\n        getUserMedia(constraints, resolve, reject);\n    });\n}\n\nvar webrtcTesting = {};\ntry {\n    Object.defineProperty(webrtcTesting, 'version', {\n        set: function(version) {\n            webrtcDetectedVersion = version;\n        }\n    });\n} catch (e) {}\n\nif (typeof module !== 'undefined') {\n    var RTCPeerConnection;\n    if (typeof window !== 'undefined') {\n        RTCPeerConnection = window.RTCPeerConnection;\n    }\n    module.exports = {\n        RTCPeerConnection: RTCPeerConnection,\n        getUserMedia: getUserMedia,\n        attachMediaStream: attachMediaStream,\n        reattachMediaStream: reattachMediaStream,\n        webrtcDetectedBrowser: webrtcDetectedBrowser,\n        webrtcDetectedVersion: webrtcDetectedVersion,\n        webrtcMinimumVersion: webrtcMinimumVersion,\n        webrtcTesting: webrtcTesting,\n        webrtcUtils: webrtcUtils\n        //requestUserMedia: not exposed on purpose.\n        //trace: not exposed on purpose.\n    };\n} else if ((typeof require === 'function') && (typeof define === 'function')) {\n    // Expose objects and functions when RequireJS is doing the loading.\n    define([], function() {\n        return {\n            RTCPeerConnection: window.RTCPeerConnection,\n            getUserMedia: getUserMedia,\n            attachMediaStream: attachMediaStream,\n            reattachMediaStream: reattachMediaStream,\n            webrtcDetectedBrowser: webrtcDetectedBrowser,\n            webrtcDetectedVersion: webrtcDetectedVersion,\n            webrtcMinimumVersion: webrtcMinimumVersion,\n            webrtcTesting: webrtcTesting,\n            webrtcUtils: webrtcUtils\n            //requestUserMedia: not exposed on purpose.\n            //trace: not exposed on purpose.\n        };\n    });\n}\n\n\n// WEBPACK FOOTER //\n// ./src/vendor/adapter.js","/*global window, console, document, webkitURL*/\n/*\n * AudioPlayer represents a Licode Audio component that shows either a local or a remote Audio.\n * Ex.: var player = AudioPlayer({id: id, stream: stream, elementID: elementID});\n * A AudioPlayer is also a View component.\n */\nimport View from './View'\nimport Bar from './Bar'\nimport Logger from '../utils/Logger'\nimport { isSafari } from '../utils/Browser'\n\nvar AudioPlayer = function (spec) {\n    \"use strict\";\n\n    var that = View({}),\n        onmouseover,\n        onmouseout;\n\n    // Variables\n\n    // AudioPlayer ID\n    that.id = spec.id;\n\n    // Assets URL\n    that.url = spec.url;\n\n    // Stream that the AudioPlayer will play\n    that.stream = spec.stream.stream;\n\n    // DOM element in which the AudioPlayer will be appended\n    that.elementID = spec.elementID;\n\n    // Audio tag\n    that.audio = document.createElement('audio');\n    that.audio.setAttribute('id', 'stream' + that.id);\n    that.audio.setAttribute('style', 'width: 100%; height: 100%; position: absolute');\n    that.audio.setAttribute('autoplay', 'autoplay');\n\n    if(spec.stream.local) {\n        that.audio.volume = 0;\n    }\n\n    if(spec.stream.local) {\n        that.audio.volume = 0;\n    }\n\n\n    if (that.elementID !== undefined) {\n\n        // It will stop the AudioPlayer and remove it from the HTML\n        that.destroy = function () {\n            that.audio.pause();\n            //clearInterval(that.resize);\n            that.parentNode.removeChild(that.div);\n        };\n\n        onmouseover = function () {\n            that.bar.display();\n        };\n\n        onmouseout = function () {\n            that.bar.hide();\n        };\n\n        // Container\n        that.div = document.createElement('div');\n        that.div.setAttribute('id', 'player_' + that.id);\n        that.div.setAttribute('style', 'width: 100%; height: 100%; position: relative; overflow: hidden;');\n\n        document.getElementById(that.elementID).appendChild(that.div);\n        that.container = document.getElementById(that.elementID);\n\n        that.parentNode = that.div.parentNode;\n\n        that.div.appendChild(that.audio);\n\n        // Bottom Bar\n        that.bar = new Bar({elementID: 'player_' + that.id, id: that.id, stream: spec.stream, media: that.audio, options: spec.options, url: that.url});\n\n        if (spec.stream.local) {\n          that.div.onmouseover = onmouseout;\n        } else { \n          that.div.onmouseover = onmouseover;\n        }\n        that.div.onmouseout = onmouseout;\n\n    } else {\n        // It will stop the AudioPlayer and remove it from the HTML\n        that.destroy = function () {\n            that.audio.pause();\n            //clearInterval(that.resize);\n            that.parentNode.removeChild(that.audio);\n        };\n\n        document.body.appendChild(that.audio);\n        that.parentNode = document.body;\n    }\n\n    Logger.debug('Creating URL from stream ' + that.stream);\n    if(isSafari()) {\n        that.audio.srcObject = that.stream;\n    } else {\n        var myURL = window.URL || webkitURL;\n        that.stream_url = myURL.createObjectURL(that.stream);\n        that.audio.src = that.stream_url;    \n    }\n\n    return that;\n};\n\nexport default AudioPlayer\n\n\n\n// WEBPACK FOOTER //\n// ./src/views/AudioPlayer.js","import Logger from '../utils/Logger'\n\nvar ChromeCanaryStack = function (spec) {\n    \"use strict\";\n\n    var that = {},\n        WebkitRTCPeerConnection = webkitRTCPeerConnection;\n\n    that.pc_config = {\n        \"iceServers\": []\n    };\n\n    that.con = {'optional': [{'DtlsSrtpKeyAgreement': true}]};\n\n    if (spec.iceServers instanceof Array) {\n        that.pc_config.iceServers = spec.iceServers;\n    } else {\n        if (spec.stunServerUrl) {\n            if (spec.stunServerUrl instanceof Array) {\n                spec.stunServerUrl.map(function (url) {\n                    if (typeof url === 'string' && url !== '') {\n                        that.pc_config.iceServers.push({\"url\": url});\n                    }\n                });\n            } else if (typeof spec.stunServerUrl === 'string' && spec.stunServerUrl !== '') {\n                that.pc_config.iceServers.push({\"url\": spec.stunServerUrl});\n            }\n        }\n\n        if (spec.turnServer) {\n            if (spec.turnServer instanceof Array) {\n                spec.turnServer.map(function (turn) {\n                    if (typeof turn.url === 'string' && turn.url !== '') {\n                        that.pc_config.iceServers.push({\n                            \"username\": turn.username,\n                            \"credential\": turn.password,\n                            \"url\": turn.url\n                        });\n                    }\n                });\n            } else if (typeof spec.turnServer.url === 'string' && spec.turnServer.url !== '') {\n                that.pc_config.iceServers.push({\n                    \"username\": spec.turnServer.username,\n                    \"credential\": spec.turnServer.password,\n                    \"url\": spec.turnServer.url\n                });\n            }\n        }\n    }\n\n    if (spec.audio === undefined) {\n        spec.audio = true;\n    }\n\n    if (spec.video === undefined) {\n        spec.video = true;\n    }\n\n    that.mediaConstraints = {\n        'mandatory': {\n            'OfferToReceiveVideo': spec.video,\n            'OfferToReceiveAudio': spec.audio\n        }\n    };\n\n    that.roapSessionId = 103;\n\n    that.peerConnection = new WebkitRTCPeerConnection(that.pc_config, that.con);\n\n    that.peerConnection.onicecandidate = function (event) {\n        //Logger.debug(\"PeerConnection: \", spec.session_id);\n        if (!event.candidate) {\n            // At the moment, we do not renegotiate when new candidates\n            // show up after the more flag has been false once.\n            Logger.debug(\"PeerConnection State: \" + that.peerConnection.iceGatheringState);\n\n            if (that.ices === undefined) {\n                that.ices = 0;\n            }\n            that.ices = that.ices + 1;\n            if (that.ices >= 1 && that.moreIceComing) {\n                that.moreIceComing = false;\n                that.markActionNeeded();\n            }\n        } else {\n            that.iceCandidateCount += 1;\n        }\n    };\n\n    //Logger.debug(\"Created webkitRTCPeerConnnection with config \\\"\" + JSON.stringify(that.pc_config) + \"\\\".\");\n\n    var setMaxBW = function (sdp) {\n        var a, r;\n        if (spec.minVideoBW && spec.maxVideoBW) {\n            a = sdp.match(/m=video.*\\r\\n/);\n            r = a[0] + \"b=AS:\" + spec.maxVideoBW + \"\\r\\n\";\n            //if (spec.mode === 'live') { //h.264\n            //  r = a[0] + \"a=fmtp:107 x-google-min-bitrate=\" + spec.minVideoBW + \"; x-google-max-bitrate=\" + spec.maxVideoBW + \"\\r\\n\";\n            //} else { //vp8\n            //  r = a[0] + \"a=fmtp:100 x-google-min-bitrate=\" + spec.minVideoBW + \"; x-google-max-bitrate=\" + spec.maxVideoBW + \"\\r\\n\";\n            //}\n            sdp = sdp.replace(a[0], r);\n            Logger.debug('Set Video Bitrate - min:' + spec.minVideoBW + \" max:\" + spec.maxVideoBW);\n        }\n\n        if (spec.maxAudioBW) {\n            a = sdp.match(/m=audio.*\\r\\n/);\n            r = a[0] + \"b=AS:\" + spec.maxAudioBW + \"\\r\\n\";\n            sdp = sdp.replace(a[0], r);\n        }\n\n        return sdp;\n    };\n\n    /**\n     * This function processes signalling messages from the other side.\n     * @param {string} msgstring JSON-formatted string containing a ROAP message.\n     */\n    that.processSignalingMessage = function (msgstring) {\n        // Offer: Check for glare and resolve.\n        // Answer/OK: Remove retransmit for the msg this is an answer to.\n        // Send back \"OK\" if this was an Answer.\n        //Logger.debug('Activity on conn ' + that.sessionId);\n        var msg = JSON.parse(msgstring), sd;\n        that.incomingMessage = msg;\n\n        if (that.state === 'new') {\n            if (msg.messageType === 'OFFER') {\n                // Initial offer.\n                sd = {\n                    sdp: msg.sdp,\n                    type: 'offer'\n                };\n                that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd));\n\n                that.state = 'offer-received';\n                // Allow other stuff to happen, then reply.\n                that.markActionNeeded();\n            } else {\n                that.error('Illegal message for this state: ' + msg.messageType + ' in state ' + that.state);\n            }\n\n        } else if (that.state === 'offer-sent') {\n            if (msg.messageType === 'ANSWER') {\n\n                sd = {\n                    sdp: msg.sdp,\n                    type: 'answer'\n                };\n                //Logger.debug(\"Received ANSWER: \", sd.sdp);\n\n                sd.sdp = setMaxBW(sd.sdp);\n\n                that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd));\n                that.sendOK();\n                that.state = 'established';\n\n            } else if (msg.messageType === 'pr-answer') {\n                sd = {\n                    sdp: msg.sdp,\n                    type: 'pr-answer'\n                };\n                that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd));\n\n                // No change to state, and no response.\n            } else if (msg.messageType === 'offer') {\n                // Glare processing.\n                that.error('Not written yet');\n            } else {\n                that.error('Illegal message for this state: ' + msg.messageType + ' in state ' + that.state);\n            }\n\n        } else if (that.state === 'established') {\n            if (msg.messageType === 'OFFER') {\n                // Subsequent offer.\n                sd = {\n                    sdp: msg.sdp,\n                    type: 'offer'\n                };\n                that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd));\n\n                that.state = 'offer-received';\n                // Allow other stuff to happen, then reply.\n                that.markActionNeeded();\n            } else {\n                that.error('Illegal message for this state: ' + msg.messageType + ' in state ' + that.state);\n            }\n        }\n    };\n\n    /**\n     * Adds a stream - this causes signalling to happen, if needed.\n     * @param {MediaStream} stream The outgoing MediaStream to add.\n     */\n    that.addStream = function (stream) {\n        that.peerConnection.addStream(stream);\n        that.markActionNeeded();\n    };\n\n    /**\n     * Removes a stream.\n     * @param {MediaStream} stream The MediaStream to remove.\n     */\n    that.removeStream = function () {\n//        var i;\n//        for (i = 0; i < that.peerConnection.localStreams.length; ++i) {\n//            if (that.localStreams[i] === stream) {\n//                that.localStreams[i] = null;\n//            }\n//        }\n        that.markActionNeeded();\n    };\n\n    /**\n     * Closes the connection.\n     */\n    that.close = function () {\n        that.state = 'closed';\n        that.peerConnection.close();\n    };\n\n    /**\n     * Internal function: Mark that something happened.\n     */\n    that.markActionNeeded = function () {\n        that.actionNeeded = true;\n        that.doLater(function () {\n            that.onstablestate();\n        });\n    };\n\n    /**\n     * Internal function: Do something later (not on this stack).\n     * @param {function} what Callback to be executed later.\n     */\n    that.doLater = function (what) {\n        // Post an event to myself so that I get called a while later.\n        // (needs more JS/DOM info. Just call the processing function on a delay\n        // for now.)\n        window.setTimeout(what, 1);\n    };\n\n    /**\n     * Internal function called when a stable state\n     * is entered by the browser (to allow for multiple AddStream calls or\n     * other interesting actions).\n     * This function will generate an offer or answer, as needed, and send\n     * to the remote party using our onsignalingmessage function.\n     */\n    that.onstablestate = function () {\n        var mySDP;\n        if (that.actionNeeded) {\n            if (that.state === 'new' || that.state === 'established') {\n                // See if the current offer is the same as what we already sent.\n                // If not, no change is needed.\n\n                that.peerConnection.createOffer(function (sessionDescription) {\n\n                    //sessionDescription.sdp = newOffer.replace(/a=ice-options:google-ice\\r\\n/g, \"\");\n                    //sessionDescription.sdp = newOffer.replace(/a=crypto:0 AES_CM_128_HMAC_SHA1_80 inline:.*\\r\\n/g, \"a=crypto:0 AES_CM_128_HMAC_SHA1_80 inline:eUMxlV2Ib6U8qeZot/wEKHw9iMzfKUYpOPJrNnu3\\r\\n\");\n                    //sessionDescription.sdp = newOffer.replace(/a=crypto:1 AES_CM_128_HMAC_SHA1_80 inline:.*\\r\\n/g, \"a=crypto:1 AES_CM_128_HMAC_SHA1_80 inline:eUMxlV2Ib6U8qeZot/wEKHw9iMzfKUYpOPJrNnu3\\r\\n\");\n\n                    sessionDescription.sdp = setMaxBW(sessionDescription.sdp);\n                    Logger.debug(\"Changed\", sessionDescription.sdp);\n\n                    var newOffer = sessionDescription.sdp;\n\n                    if (newOffer !== that.prevOffer) {\n\n                        that.peerConnection.setLocalDescription(sessionDescription);\n\n                        that.state = 'preparing-offer';\n                        that.markActionNeeded();\n                        return;\n                    } else {\n                        Logger.debug('Not sending a new offer');\n                    }\n\n                }, function(err) {\n                    Logger.debug('peer connection create offer failed ', err);\n                }, that.mediaConstraints);\n\n\n            } else if (that.state === 'preparing-offer') {\n                // Don't do anything until we have the ICE candidates.\n                if (that.moreIceComing) {\n                    return;\n                }\n\n\n                // Now able to send the offer we've already prepared.\n                that.prevOffer = that.peerConnection.localDescription.sdp;\n                //Logger.debug(\"Sending OFFER: \" + that.prevOffer);\n                //Logger.debug('Sent SDP is ' + that.prevOffer);\n                that.sendMessage('OFFER', that.prevOffer);\n                // Not done: Retransmission on non-response.\n                that.state = 'offer-sent';\n\n            } else if (that.state === 'offer-received') {\n\n                that.peerConnection.createAnswer(function (sessionDescription) {\n                    that.peerConnection.setLocalDescription(sessionDescription);\n                    that.state = 'offer-received-preparing-answer';\n\n                    if (!that.iceStarted) {\n                        var now = new Date();\n                        Logger.debug(now.getTime() + ': Starting ICE in responder');\n                        that.iceStarted = true;\n                    } else {\n                        that.markActionNeeded();\n                        return;\n                    }\n\n                }, function(err) {\n                    Logger.debug('peer connection create answer failed ', err);\n                }, that.mediaConstraints);\n\n            } else if (that.state === 'offer-received-preparing-answer') {\n                if (that.moreIceComing) {\n                    return;\n                }\n\n                mySDP = that.peerConnection.localDescription.sdp;\n\n                that.sendMessage('ANSWER', mySDP);\n                that.state = 'established';\n            } else {\n                that.error('Dazed and confused in state ' + that.state + ', stopping here');\n            }\n            that.actionNeeded = false;\n        }\n    };\n\n    /**\n     * Internal function to send an \"OK\" message.\n     */\n    that.sendOK = function () {\n        that.sendMessage('OK');\n    };\n\n    /**\n     * Internal function to send a signalling message.\n     * @param {string} operation What operation to signal.\n     * @param {string} sdp SDP message body.\n     */\n    that.sendMessage = function (operation, sdp) {\n        var roapMessage = {};\n        roapMessage.messageType = operation;\n        roapMessage.sdp = sdp; // may be null or undefined\n        if (operation === 'OFFER') {\n            roapMessage.offererSessionId = that.sessionId;\n            roapMessage.answererSessionId = that.otherSessionId; // may be null\n            roapMessage.seq = (that.sequenceNumber += 1);\n            // The tiebreaker needs to be neither 0 nor 429496725.\n            roapMessage.tiebreaker = Math.floor(Math.random() * 429496723 + 1);\n        } else {\n            roapMessage.offererSessionId = that.incomingMessage.offererSessionId;\n            roapMessage.answererSessionId = that.sessionId;\n            roapMessage.seq = that.incomingMessage.seq;\n        }\n        that.onsignalingmessage(JSON.stringify(roapMessage));\n    };\n\n    /**\n     * Internal something-bad-happened function.\n     * @param {string} text What happened - suitable for logging.\n     */\n    that.error = function (text) {\n        throw 'Error in RoapOnJsep: ' + text;\n    };\n\n    that.sessionId = (that.roapSessionId += 1);\n    that.sequenceNumber = 0; // Number of last ROAP message sent. Starts at 1.\n    that.actionNeeded = false;\n    that.iceStarted = false;\n    that.moreIceComing = true;\n    that.iceCandidateCount = 0;\n    that.onsignalingmessage = spec.callback;\n\n    that.peerConnection.onopen = function () {\n        if (that.onopen) {\n            that.onopen();\n        }\n    };\n\n    that.peerConnection.onaddstream = function (stream) {\n        if (that.onaddstream) {\n            that.onaddstream(stream);\n        }\n    };\n\n    that.peerConnection.onremovestream = function (stream) {\n        if (that.onremovestream) {\n            that.onremovestream(stream);\n        }\n    };\n\n    that.peerConnection.oniceconnectionstatechange = function (e) {\n        if (that.oniceconnectionstatechange) {\n            that.oniceconnectionstatechange(e.currentTarget.iceConnectionState);\n        }\n    };\n\n    // Variables that are part of the public interface of PeerConnection\n    // in the 28 January 2012 version of the webrtc specification.\n    that.onaddstream = null;\n    that.onremovestream = null;\n    that.state = 'new';\n    // Auto-fire next events.\n    that.markActionNeeded();\n    return that;\n};\n\nexport default ChromeCanaryStack\n\n\n\n// WEBPACK FOOTER //\n// ./src/webrtc-stacks/ChromeCanaryStack.js","import Logger from '../utils/Logger'\n\nvar ChromeStableStack = function (spec) {\n    \"use strict\";\n\n    var that = {},\n        //WebkitRTCPeerConnection = webkitRTCPeerConnection;\n        WebkitRTCPeerConnection = RTCPeerConnection;\n    that.isSubscriber = spec.isSubscriber;\n    that.pc_config = {\n        \"iceServers\": []\n    };\n\n    that.con = {'optional': [{'DtlsSrtpKeyAgreement': true}]};\n\n    if (spec.iceServers instanceof Array) {\n        that.pc_config.iceServers = spec.iceServers;\n    } else {\n        if (spec.stunServerUrl) {\n            if (spec.stunServerUrl instanceof Array) {\n                spec.stunServerUrl.map(function (url) {\n                    if (typeof url === 'string' && url !== '') {\n                        that.pc_config.iceServers.push({\"url\": url});\n                    }\n                });\n            } else if (typeof spec.stunServerUrl === 'string' && spec.stunServerUrl !== '') {\n                that.pc_config.iceServers.push({\"url\": spec.stunServerUrl});\n            }\n        }\n\n        if (spec.turnServer) {\n            if (spec.turnServer instanceof Array) {\n                spec.turnServer.map(function (turn) {\n                    if (typeof turn.url === 'string' && turn.url !== '') {\n                        that.pc_config.iceServers.push({\n                            \"username\": turn.username,\n                            \"credential\": turn.password,\n                            \"url\": turn.url\n                        });\n                    }\n                });\n            } else if (typeof spec.turnServer.url === 'string' && spec.turnServer.url !== '') {\n                that.pc_config.iceServers.push({\n                    \"username\": spec.turnServer.username,\n                    \"credential\": spec.turnServer.password,\n                    \"url\": spec.turnServer.url\n                });\n            }\n        }\n    }\n\n    if (spec.audio === undefined) {\n        spec.audio = true;\n    }\n\n    if (spec.video === undefined) {\n        spec.video = true;\n    }\n\n    that.mediaConstraints = {\n        'mandatory': {\n            'OfferToReceiveVideo': spec.video,\n            'OfferToReceiveAudio': spec.audio\n        }\n    };\n\n    that.roapSessionId = 103;\n\n    that.peerConnection = new WebkitRTCPeerConnection({\"iceServers\": [{urls: [\"stun:webcs.agora.io:3478\"]}]}, that.con);\n\n    that.peerConnection.onicecandidate = function (event) {\n        //Logger.debug(\"PeerConnection: \", spec.session_id);\n        var localsdp, hassrflxcand, hashostcand;\n        localsdp = that.peerConnection.localDescription.sdp;\n        hassrflxcand = localsdp.match(/a=candidate:.+typ\\ssrflx.+\\r\\n/);\n        hashostcand = localsdp.match(/a=candidate:.+typ\\shost.+\\r\\n/);\n        if (that.iceCandidateCount === 0) {\n              that.timeout = setTimeout(function() {\n                if (that.moreIceComing) {\n                  that.moreIceComing = false;\n                  that.markActionNeeded();\n                }\n              }, 1000);\n        }\n\n        if ((hassrflxcand !== null || hashostcand !== null) && that.ice === undefined) {\n            Logger.debug(\"srflx candidate : \" + hassrflxcand + \" host candidate : \" + hashostcand);\n            clearTimeout(that.timeout);\n            that.ice = 0;\n            that.moreIceComing = false;\n            that.markActionNeeded();\n        }\n        that.iceCandidateCount = that.iceCandidateCount + 1;\n    };\n\n    //Logger.debug(\"Created webkitRTCPeerConnnection with config \\\"\" + JSON.stringify(that.pc_config) + \"\\\".\");\n\n    var filterSdp = function (sdp) {\n      var a, r;\n      if (spec.screen) {\n        sdp = sdp.replace(\"a=x-google-flag:conference\\r\\n\", '');\n      }\n      return sdp;\n    }\n\n    var setMaxBW = function (sdp) {\n        var a, r;\n        if (spec.minVideoBW && spec.maxVideoBW) {\n            a = sdp.match(/m=video.*\\r\\n/);\n            r = a[0] + \"b=AS:\" + spec.maxVideoBW + \"\\r\\n\";\n            //if (spec.mode === 'live') { //h.264\n            //  r = a[0] + \"a=fmtp:107 x-google-min-bitrate=\" + spec.minVideoBW + \"; x-google-max-bitrate=\" + spec.maxVideoBW + \"\\r\\n\";\n            //} else { //vp8\n            //  r = a[0] + \"a=fmtp:100 x-google-min-bitrate=\" + spec.minVideoBW + \"; x-google-max-bitrate=\" + spec.maxVideoBW + \"\\r\\n\";\n            //}\n            sdp = sdp.replace(a[0], r);\n            Logger.debug('Set Video Bitrate - min:' + spec.minVideoBW + \" max:\" + spec.maxVideoBW);\n        }\n\n        if (spec.maxAudioBW) {\n            a = sdp.match(/m=audio.*\\r\\n/);\n            r = a[0] + \"b=AS:\" + spec.maxAudioBW + \"\\r\\n\";\n            sdp = sdp.replace(a[0], r);\n        }\n\n        return sdp;\n    };\n\n    /**\n     * This function processes signalling messages from the other side.\n     * @param {string} msgstring JSON-formatted string containing a ROAP message.\n     */\n    that.processSignalingMessage = function (msgstring) {\n        // Offer: Check for glare and resolve.\n        // Answer/OK: Remove retransmit for the msg this is an answer to.\n        // Send back \"OK\" if this was an Answer.\n        //Logger.debug('Activity on conn ' + that.sessionId);\n        var msg = JSON.parse(msgstring), sd;\n        that.incomingMessage = msg;\n\n        if (that.state === 'new') {\n            if (msg.messageType === 'OFFER') {\n                // Initial offer.\n                sd = {\n                    sdp: msg.sdp,\n                    type: 'offer'\n                };\n                that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd));\n\n                that.state = 'offer-received';\n                // Allow other stuff to happen, then reply.\n                that.markActionNeeded();\n            } else {\n                that.error('Illegal message for this state: ' + msg.messageType + ' in state ' + that.state);\n            }\n\n        } else if (that.state === 'offer-sent') {\n            if (msg.messageType === 'ANSWER') {\n\n                sd = {\n                    sdp: msg.sdp,\n                    type: 'answer'\n                };\n                //Logger.debug(\"Received ANSWER: \", sd.sdp);\n                sd.sdp = filterSdp(sd.sdp);\n                sd.sdp = setMaxBW(sd.sdp);\n\n                that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd));\n                that.sendOK();\n                that.state = 'established';\n\n            } else if (msg.messageType === 'pr-answer') {\n                sd = {\n                    sdp: msg.sdp,\n                    type: 'pr-answer'\n                };\n                that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd));\n\n                // No change to state, and no response.\n            } else if (msg.messageType === 'offer') {\n                // Glare processing.\n                that.error('Not written yet');\n            } else {\n                that.error('Illegal message for this state: ' + msg.messageType + ' in state ' + that.state);\n            }\n\n        } else if (that.state === 'established') {\n            if (msg.messageType === 'OFFER') {\n                // Subsequent offer.\n                sd = {\n                    sdp: msg.sdp,\n                    type: 'offer'\n                };\n                that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd));\n\n                that.state = 'offer-received';\n                // Allow other stuff to happen, then reply.\n                that.markActionNeeded();\n            } else {\n                that.error('Illegal message for this state: ' + msg.messageType + ' in state ' + that.state);\n            }\n        }\n    };\n\n    that.getStatsRate = function(callback) {\n        that.getStats(function(stats) {\n            callback(stats);\n        });\n    }\n\n    that.getStats = function(callback) {\n      that.peerConnection.getStats(null, function(stats) {\n        var filterList = [];\n        var originList = [];\n        var timeStamp = null;\n        Object.keys(stats).forEach(function(stat) {\n          var report = stats[stat];\n          originList.push(report);\n          if (report.type === 'ssrc' || report.type === 'VideoBwe') {\n            timeStamp = report.timestamp;\n            filterList.push(report);\n          }\n        });\n        filterList.push({\n            id: \"time\",\n            startTime: that.connectedTime,\n            timestamp: timeStamp || new Date(),\n        })\n        callback(filterList, originList);\n      });\n    };\n\n    /**\n     * Adds a stream - this causes signalling to happen, if needed.\n     * @param {MediaStream} stream The outgoing MediaStream to add.\n     */\n    that.addStream = function (stream) {\n        that.peerConnection.addStream(stream);\n        that.markActionNeeded();\n    };\n\n    /**\n     * Removes a stream.\n     * @param {MediaStream} stream The MediaStream to remove.\n     */\n    that.removeStream = function () {\n//        var i;\n//        for (i = 0; i < that.peerConnection.localStreams.length; ++i) {\n//            if (that.localStreams[i] === stream) {\n//                that.localStreams[i] = null;\n//            }\n//        }\n        that.markActionNeeded();\n    };\n\n    /**\n     * Closes the connection.\n     */\n    that.close = function () {\n        that.state = 'closed';\n        that.peerConnection.close();\n    };\n\n    /**\n     * Internal function: Mark that something happened.\n     */\n    that.markActionNeeded = function () {\n        that.actionNeeded = true;\n        that.doLater(function () {\n            that.onstablestate();\n        });\n    };\n\n    /**\n     * Internal function: Do something later (not on this stack).\n     * @param {function} what Callback to be executed later.\n     */\n    that.doLater = function (what) {\n        // Post an event to myself so that I get called a while later.\n        // (needs more JS/DOM info. Just call the processing function on a delay\n        // for now.)\n        window.setTimeout(what, 1);\n    };\n\n    /**\n     * Internal function called when a stable state\n     * is entered by the browser (to allow for multiple AddStream calls or\n     * other interesting actions).\n     * This function will generate an offer or answer, as needed, and send\n     * to the remote party using our onsignalingmessage function.\n     */\n    that.onstablestate = function () {\n        var mySDP;\n        if (that.actionNeeded) {\n            if (that.state === 'new' || that.state === 'established') {\n                // See if the current offer is the same as what we already sent.\n                // If not, no change is needed.\n\n                that.peerConnection.createOffer(function (sessionDescription) {\n\n                    //sessionDescription.sdp = newOffer.replace(/a=ice-options:google-ice\\r\\n/g, \"\");\n                    //sessionDescription.sdp = newOffer.replace(/a=crypto:0 AES_CM_128_HMAC_SHA1_80 inline:.*\\r\\n/g, \"a=crypto:0 AES_CM_128_HMAC_SHA1_80 inline:eUMxlV2Ib6U8qeZot/wEKHw9iMzfKUYpOPJrNnu3\\r\\n\");\n                    //sessionDescription.sdp = newOffer.replace(/a=crypto:1 AES_CM_128_HMAC_SHA1_80 inline:.*\\r\\n/g, \"a=crypto:1 AES_CM_128_HMAC_SHA1_80 inline:eUMxlV2Ib6U8qeZot/wEKHw9iMzfKUYpOPJrNnu3\\r\\n\");\n\n                    sessionDescription.sdp = setMaxBW(sessionDescription.sdp);\n                    //Logger.debug(\"Changed\", sessionDescription.sdp);\n\n                    var newOffer = sessionDescription.sdp;\n\n                    if (newOffer !== that.prevOffer) {\n\n                        that.peerConnection.setLocalDescription(sessionDescription);\n\n                        that.state = 'preparing-offer';\n                        that.markActionNeeded();\n                        return;\n                    } else {\n                        Logger.debug('Not sending a new offer');\n                    }\n\n                }, function(err) {\n                    Logger.debug('peer connection create offer failed ', err);\n                }, that.mediaConstraints);\n\n\n            } else if (that.state === 'preparing-offer') {\n                // Don't do anything until we have the ICE candidates.\n                if (that.moreIceComing) {\n                    return;\n                }\n\n\n                // Now able to send the offer we've already prepared.\n                that.prevOffer = that.peerConnection.localDescription.sdp;\n\t\t that.prevOffer = that.prevOffer.replace(/a=candidate:.+typ\\shost.+\\r\\n/g, \"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\\r\\n\");\n                //Logger.debug(\"Sending OFFER: \" + that.prevOffer);\n                //Logger.debug('Sent SDP is ' + that.prevOffer);\n                that.sendMessage('OFFER', that.prevOffer);\n                // Not done: Retransmission on non-response.\n                that.state = 'offer-sent';\n\n            } else if (that.state === 'offer-received') {\n\n                that.peerConnection.createAnswer(function (sessionDescription) {\n                    that.peerConnection.setLocalDescription(sessionDescription);\n                    that.state = 'offer-received-preparing-answer';\n\n                    if (!that.iceStarted) {\n                        var now = new Date();\n                        Logger.debug(now.getTime() + ': Starting ICE in responder');\n                        that.iceStarted = true;\n                    } else {\n                        that.markActionNeeded();\n                        return;\n                    }\n\n                }, function(err) {\n                    Logger.debug('peer connection create answer failed ', err);\n                }, that.mediaConstraints);\n\n            } else if (that.state === 'offer-received-preparing-answer') {\n                if (that.moreIceComing) {\n                    return;\n                }\n\n                mySDP = that.peerConnection.localDescription.sdp;\n\n                that.sendMessage('ANSWER', mySDP);\n                that.state = 'established';\n            } else {\n                that.error('Dazed and confused in state ' + that.state + ', stopping here');\n            }\n            that.actionNeeded = false;\n        }\n    };\n\n    /**\n     * Internal function to send an \"OK\" message.\n     */\n    that.sendOK = function () {\n        that.sendMessage('OK');\n    };\n\n    /**\n     * Internal function to send a signalling message.\n     * @param {string} operation What operation to signal.\n     * @param {string} sdp SDP message body.\n     */\n    that.sendMessage = function (operation, sdp) {\n        var roapMessage = {};\n        roapMessage.messageType = operation;\n        roapMessage.sdp = sdp; // may be null or undefined\n        if (operation === 'OFFER') {\n            roapMessage.offererSessionId = that.sessionId;\n            roapMessage.answererSessionId = that.otherSessionId; // may be null\n            roapMessage.seq = (that.sequenceNumber += 1);\n            // The tiebreaker needs to be neither 0 nor 429496725.\n            roapMessage.tiebreaker = Math.floor(Math.random() * 429496723 + 1);\n        } else {\n            roapMessage.offererSessionId = that.incomingMessage.offererSessionId;\n            roapMessage.answererSessionId = that.sessionId;\n            roapMessage.seq = that.incomingMessage.seq;\n        }\n        that.onsignalingmessage(JSON.stringify(roapMessage));\n    };\n\n    /**\n     * Internal something-bad-happened function.\n     * @param {string} text What happened - suitable for logging.\n     */\n    that.error = function (text) {\n        throw 'Error in RoapOnJsep: ' + text;\n    };\n\n    that.sessionId = (that.roapSessionId += 1);\n    that.sequenceNumber = 0; // Number of last ROAP message sent. Starts at 1.\n    that.actionNeeded = false;\n    that.iceStarted = false;\n    that.moreIceComing = true;\n    that.iceCandidateCount = 0;\n    that.onsignalingmessage = spec.callback;\n\n    //that.peerConnection.onopen = function () {\n    //    if (that.onopen) {\n    //        that.onopen();\n    //    }\n    //};\n\n    that.peerConnection.ontrack = function (evt) {\n        if (that.onaddstream) {\n            that.onaddstream(evt, \"ontrack\");\n            that.peerConnection.onaddstream = null;\n        }\n    };\n\n    that.peerConnection.onaddstream = function (evt) {\n        if (that.onaddstream) {\n            that.onaddstream(evt, \"onaddstream\");\n            that.peerConnection.ontrack = null;\n        }\n    };\n\n    that.peerConnection.onremovestream = function (stream) {\n        if (that.onremovestream) {\n            that.onremovestream(stream);\n        }\n    };\n\n    that.peerConnection.oniceconnectionstatechange = function (e) {\n        if(e.currentTarget.iceConnectionState === \"connected\") {\n            that.connectedTime = new Date();\n        }\n\n        if (that.oniceconnectionstatechange) {\n            that.oniceconnectionstatechange(e.currentTarget.iceConnectionState);\n        }\n    };\n\n    // Variables that are part of the public interface of PeerConnection\n    // in the 28 January 2012 version of the webrtc specification.\n    that.onaddstream = null;\n    that.onremovestream = null;\n    that.state = 'new';\n    // Auto-fire next events.\n    that.markActionNeeded();\n    return that;\n};\n\nexport default ChromeStableStack\n\n\n\n// WEBPACK FOOTER //\n// ./src/webrtc-stacks/ChromeStableStack.js","import Logger from '../utils/Logger'\n\nvar SafariStableStack = function (spec) {\n    \"use strict\";\n\n    var that = {},\n        //WebkitRTCPeerConnection = webkitRTCPeerConnection;\n        WebkitRTCPeerConnection = RTCPeerConnection;\n\n    that.isSubscriber = spec.isSubscriber;\n    that.pc_config = {\n        \"iceServers\": [{urls: [\"stun:72.251.224.27:3478\"]}],\n        \"bundlePolicy\": \"max-bundle\"\n    };\n\n    that.con = {'optional': [{'DtlsSrtpKeyAgreement': true}]};\n\n    if (spec.iceServers instanceof Array) {\n        that.pc_config.iceServers = spec.iceServers;\n    } else {\n        if (spec.stunServerUrl) {\n            if (spec.stunServerUrl instanceof Array) {\n                spec.stunServerUrl.map(function (url) {\n                    if (typeof url === 'string' && url !== '') {\n                        that.pc_config.iceServers.push({\"url\": url});\n                    }\n                });\n            } else if (typeof spec.stunServerUrl === 'string' && spec.stunServerUrl !== '') {\n                that.pc_config.iceServers.push({\"url\": spec.stunServerUrl});\n            }\n        }\n\n        if (spec.turnServer) {\n            if (spec.turnServer instanceof Array) {\n                spec.turnServer.map(function (turn) {\n                    if (typeof turn.url === 'string' && turn.url !== '') {\n                        that.pc_config.iceServers.push({\n                            \"username\": turn.username,\n                            \"credential\": turn.password,\n                            \"url\": turn.url\n                        });\n                    }\n                });\n            } else if (typeof spec.turnServer.url === 'string' && spec.turnServer.url !== '') {\n                that.pc_config.iceServers.push({\n                    \"username\": spec.turnServer.username,\n                    \"credential\": spec.turnServer.password,\n                    \"url\": spec.turnServer.url\n                });\n            }\n        }\n    }\n\n    if (spec.audio === undefined) {\n        spec.audio = true;\n    }\n\n    if (spec.video === undefined) {\n        spec.video = true;\n    }\n\n    that.mediaConstraints = {\n        'mandatory': {\n            'OfferToReceiveVideo': spec.video,\n            'OfferToReceiveAudio': spec.audio\n        }\n    };\n\n    that.roapSessionId = 103;\n\n    that.peerConnection = new RTCPeerConnection({\"iceServers\": [{urls: [\"stun:webcs.agora.io:3478\", \"stun:stun.l.google.com:19302\"]}], \"bundlePolicy\": \"max-bundle\"});\n\n    that.peerConnection.onicecandidate = function (event) {\n        Logger.debug(\"PeerConnection: \", spec.session_id, event);\n        if (!event.candidate) {\n            // At the moment, we do not renegotiate when new candidates\n            // show up after the more flag has been false once.\n            Logger.debug(\"PeerConnection State: \" + that.peerConnection.iceGatheringState);\n\n\t    clearTimeout(that.timeout);\n            if (that.ices === undefined) {\n                that.ices = 0;\n            }\n            that.ices = that.ices + 1;\n            if (that.ices >= 1 && that.moreIceComing) {\n                that.moreIceComing = false;\n                that.markActionNeeded();\n            }\n        } else {\n\t    //Logger.debug(event.candidate);\n\t    if (that.iceCandidateCount === 0) {\n\t      that.timeout = setTimeout(function() {\n                if (that.moreIceComing) {\n                  that.moreIceComing = false;\n\t\t  that.markActionNeeded();\n\t        }\n\t      }, 1000);\n\t    }\n\t    that.iceCandidateCount = that.iceCandidateCount + 1;\n        }\n    };\n\n    //Logger.debug(\"Created webkitRTCPeerConnnection with config \\\"\" + JSON.stringify(that.pc_config) + \"\\\".\");\n\n    var filterSdp = function (sdp) {\n      var a, r;\n      if (spec.screen) {\n        sdp = sdp.replace(\"a=x-google-flag:conference\\r\\n\", '');\n      }\n      return sdp;\n    }\n\n    var setMaxBW = function (sdp) {\n        var a, r;\n        if (spec.minVideoBW && spec.maxVideoBW) {\n            a = sdp.match(/m=video.*\\r\\n/);\n            r = a[0] + \"b=AS:\" + spec.maxVideoBW + \"\\r\\n\";\n            //if (spec.mode === 'live') { //h.264\n            //  r = a[0] + \"a=fmtp:107 x-google-min-bitrate=\" + spec.minVideoBW + \"; x-google-max-bitrate=\" + spec.maxVideoBW + \"\\r\\n\";\n            //} else { //vp8\n            //  r = a[0] + \"a=fmtp:100 x-google-min-bitrate=\" + spec.minVideoBW + \"; x-google-max-bitrate=\" + spec.maxVideoBW + \"\\r\\n\";\n            //}\n            sdp = sdp.replace(a[0], r);\n            Logger.debug('Set Video Bitrate - min:' + spec.minVideoBW + \" max:\" + spec.maxVideoBW);\n        }\n\n        if (spec.maxAudioBW) {\n            a = sdp.match(/m=audio.*\\r\\n/);\n            r = a[0] + \"b=AS:\" + spec.maxAudioBW + \"\\r\\n\";\n            sdp = sdp.replace(a[0], r);\n        }\n\n        return sdp;\n    };\n\n    /**\n     * This function processes signalling messages from the other side.\n     * @param {string} msgstring JSON-formatted string containing a ROAP message.\n     */\n    that.processSignalingMessage = function (msgstring) {\n        // Offer: Check for glare and resolve.\n        // Answer/OK: Remove retransmit for the msg this is an answer to.\n        // Send back \"OK\" if this was an Answer.\n        //Logger.debug('Activity on conn ' + that.sessionId);\n        var msg = JSON.parse(msgstring), sd;\n        that.incomingMessage = msg;\n\n        if (that.state === 'new') {\n            if (msg.messageType === 'OFFER') {\n                // Initial offer.\n                sd = {\n                    sdp: msg.sdp,\n                    type: 'offer'\n                };\n                that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd));\n\n                that.state = 'offer-received';\n                // Allow other stuff to happen, then reply.\n                that.markActionNeeded();\n            } else {\n                that.error('Illegal message for this state: ' + msg.messageType + ' in state ' + that.state);\n            }\n\n        } else if (that.state === 'offer-sent') {\n            if (msg.messageType === 'ANSWER') {\n\n                sd = {\n                    sdp: msg.sdp,\n                    type: 'answer'\n                };\n\n                //Logger.debug(\"Received ANSWER: \", sd.sdp);\n                sd.sdp = filterSdp(sd.sdp);\n                sd.sdp = setMaxBW(sd.sdp);\n                sd.sdp = sd.sdp.replace(/a=x-google-flag:conference\\r\\n/g, \"\");\n\n                that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd));\n                that.sendOK();\n                that.state = 'established';\n\n            } else if (msg.messageType === 'pr-answer') {\n                sd = {\n                    sdp: msg.sdp,\n                    type: 'pr-answer'\n                };\n                that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd));\n\n                // No change to state, and no response.\n            } else if (msg.messageType === 'offer') {\n                // Glare processing.\n                that.error('Not written yet');\n            } else {\n                that.error('Illegal message for this state: ' + msg.messageType + ' in state ' + that.state);\n            }\n\n        } else if (that.state === 'established') {\n            if (msg.messageType === 'OFFER') {\n                // Subsequent offer.\n                sd = {\n                    sdp: msg.sdp,\n                    type: 'offer'\n                };\n                that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd));\n\n                that.state = 'offer-received';\n                // Allow other stuff to happen, then reply.\n                that.markActionNeeded();\n            } else {\n                that.error('Illegal message for this state: ' + msg.messageType + ' in state ' + that.state);\n            }\n        }\n    };\n\n    var outbound_rtp_audio = {\n      id: \"\",\n      type: \"\",\n      mediaType: \"\",\n      googCodecName: \"opus\",\n      aecDivergentFilterFraction: \"0\",\n      audioInputLevel: \"0\",\n      bytesSent: \"0\",\n      packetsSent: \"0\",\n      googEchoCancellationReturnLoss: \"0\",\n      googEchoCancellationReturnLossEnhancement: \"0\"\n    };\n\n    var outbound_rtp_video = {\n      id: \"\",\n      type: \"\",\n      mediaType: \"\",\n      googCodecName: spec.codec === \"h264\" ? \"H264\" : \"VP8\",\n      bytesSent: \"0\",\n      packetsLost: \"0\",\n      packetsSent: \"0\",\n      googAdaptationChanges: \"0\",\n      googAvgEncodeMs: \"0\",\n      googEncodeUsagePercent: \"0\",\n      googFirsReceived: \"0\",\n      googFrameHeightSent: \"0\",\n      googFrameHeightInput: \"0\",\n      googFrameRateInput: \"0\",\n      googFrameRateSent: \"0\",\n      googFrameWidthSent: \"0\",\n      googFrameWidthInput: \"0\",\n      googNacksReceived: \"0\",\n      googPlisReceived: \"0\",\n      googRtt: \"0\",\n      googFramesEncoded: \"0\",\n    };\n\n    var inbound_rtp_audio = {\n      id: \"\",\n      type: \"\",\n      mediaType: \"\",\n      audioOutputLevel: \"0\",\n      bytesReceived: \"0\",\n      packetsLost: \"0\",\n      packetsReceived: \"0\",\n      googAccelerateRate: \"0\",\n      googCurrentDelayMs: \"0\",\n      googDecodingCNG: \"0\",\n      googDecodingCTN: \"0\",\n      googDecodingCTSG: \"0\",\n      googDecodingNormal: \"0\",\n      googDecodingPLC: \"0\",\n      googDecodingPLCCNG: \"0\",\n      googExpandRate: \"0\",\n      googJitterBufferMs: \"0\",\n      googJitterReceived: \"0\",\n      googPreemptiveExpandRate: \"0\",\n      googPreferredJitterBufferMs: \"0\",\n      googSecondaryDecodedRate: \"0\",\n      googSpeechExpandRate: \"0\"\n    };\n\n    var inbound_rtp_video = {\n      id: \"\",\n      type: \"\",\n      mediaType: \"\",\n      googTargetDelayMs: \"0\",\n      packetsLost: \"0\",\n      googDecodeMs: \"0\",\n      googMaxDecodeMs: \"0\",\n      googRenderDelayMs: \"0\",\n      googFrameWidthReceived: \"0\",\n      googFrameHeightReceived: \"0\",\n      googFrameRateReceived: \"0\",\n      googFrameRateDecoded: \"0\",\n      googFrameRateOutput: \"0\",\n      googFramesDecoded: \"0\",\n      googFrameReceived: \"0\",\n\n      googJitterBufferMs: \"0\",\n      googCurrentDelayMs: \"0\",\n      googMinPlayoutDelayMs: \"0\",\n      googNacksSent: \"0\",\n      googPlisSent: \"0\",\n      googFirsSent: \"0\",\n      bytesReceived: \"0\",\n      packetsReceived: \"0\",\n    };\n\n    var bweforvideo = {\n      id: \"bweforvideo\",\n      type: \"VideoBwe\",\n      googAvailableSendBandwidth: \"0\",\n      googAvailableReceiveBandwidth: \"0\",\n      googActualEncBitrate: \"0\",\n      googRetransmitBitrate: \"0\",\n      googTargetEncBitrate: \"0\",\n      googBucketDelay: \"0\",\n      googTransmitBitrate: \"0\",\n    }\n\n    var lastFramesEncoded = 0;\n    var lastFramesDecoded = 0;\n    var lastFramesReceived = 0;\n\n\n    that.getStatsRate = function(callback) {\n      that.getStats(function(stats) {\n        stats.forEach(function(report) {\n            if (report.type === 'outbound-rtp' && report.mediaType === 'video') {\n                if(report.googFramesEncoded) {\n                    report.googFrameRateSent = ((report.googFramesEncoded - lastFramesEncoded) / 3).toString();\n                    lastFramesEncoded = report.googFramesEncoded;\n                }\n            }\n            if (report.type === 'inbound-rtp' && report.id.indexOf(\"55543\") != -1) {\n                // if googFrameRateReceived or googFrameRateDecoded is \"null\" or \"undefined\", it will sent \"NAN\" to server and make server crash\n                if(report.googFrameRateReceived) {\n                    report.googFrameRateReceived = ((report.googFrameReceived - lastFramesReceived) / 3).toString();\n                    lastFramesReceived = report.googFrameReceived;\n                }\n                if(report.googFrameRateDecoded) {\n                    report.googFrameRateDecoded = ((report.googFramesDecoded - lastFramesDecoded) / 3).toString();\n                    lastFramesDecoded = report.googFramesDecoded;\n                }\n            }\n        })\n        callback(stats);\n      });\n    }\n\n    that.getStats = function(callback) {\n        var originList = [];\n      that.peerConnection.getStats().then(function (stats) {\n        var list = [];\n        stats.forEach(report => {\n            originList.push(report);\n            if (report.type === 'outbound-rtp' && report.mediaType === 'audio') {\n                outbound_rtp_audio.id = report.id;\n                outbound_rtp_audio.type = report.type;\n                outbound_rtp_audio.mediaType = report.mediaType;\n                outbound_rtp_audio.bytesSent = report.bytesSent ? report.bytesSent + '' : '0';\n                outbound_rtp_audio.packetsSent = report.packetsSent ? report.packetsSent + '' : '0';\n            }\n            if (report.type === 'outbound-rtp' && report.mediaType === 'video') {\n                outbound_rtp_video.id = report.id;\n                outbound_rtp_video.type = report.type;\n                outbound_rtp_video.mediaType = report.mediaType;\n                outbound_rtp_video.bytesSent = report.bytesSent ? report.bytesSent + '' : '0';\n                outbound_rtp_video.packetsSent = report.packetsSent ? report.packetsSent + '' : '0';\n                outbound_rtp_video.googPlisReceived = report.pliCount ? report.pliCount + '' : '0';\n                outbound_rtp_video.googNacksReceived = report.nackCount ? report.nackCount + '' : '0';\n                outbound_rtp_video.googFirsReceived = report.firCount ? report.firCount + '' : '0';\n                outbound_rtp_video.googFramesEncoded = report.framesEncoded ? report.framesEncoded + '' : '0';\n            }\n            if (report.type === 'inbound-rtp' && report.id.indexOf(\"44444\") != -1) {\n                inbound_rtp_audio.id = report.id;\n                inbound_rtp_audio.type = report.type;\n                inbound_rtp_audio.mediaType = \"audio\";\n                inbound_rtp_audio.packetsReceived = report.packetsReceived ? report.packetsReceived + '' : '0';\n                inbound_rtp_audio.bytesReceived = report.bytesReceived ? report.bytesReceived + '' : '0';\n                inbound_rtp_audio.packetsLost = report.packetsLost ? report.packetsLost + '' : '0';\n                inbound_rtp_audio.packetsReceived = report.packetsReceived ? report.packetsReceived + '' : '0';\n                inbound_rtp_audio.googJitterReceived = report.jitter ? report.jitter + '' : '0';\n            }\n            if (report.type === 'inbound-rtp' && report.id.indexOf(\"55543\") != -1) {\n                inbound_rtp_video.id = report.id;\n                inbound_rtp_video.type = report.type;\n                inbound_rtp_video.mediaType = \"video\";\n                inbound_rtp_video.packetsReceived = report.packetsReceived ? report.packetsReceived + '' : '0';\n                inbound_rtp_video.bytesReceived = report.bytesReceived ? report.bytesReceived + '' : '0';\n                inbound_rtp_video.packetsLost = report.packetsLost ? report.packetsLost + '' : '0';\n                inbound_rtp_video.googJitterBufferMs = report.jitter ? report.jitter + '' : '0';\n                inbound_rtp_video.googNacksSent = report.nackCount ? report.nackCount + '' : '0';\n                inbound_rtp_video.googPlisSent = report.pliCount ? report.pliCount + '' : '0';\n                inbound_rtp_video.googFirsSent = report.firCount ? report.firCount + '' : '0';\n            }\n            if (report.type === 'track' && report.id.indexOf(\"55543\") != -1) {\n                inbound_rtp_video.googFrameWidthReceived = report.frameWidth ? report.frameWidth + '' : '0';\n                inbound_rtp_video.googFrameHeightReceived = report.frameHeight ? report.frameHeight + '' : '0';\n                inbound_rtp_video.googFrameReceived = report.framesReceived ? report.framesReceived + '' : '0';\n                inbound_rtp_video.googFramesDecoded = report.framesDecoded ? report.framesDecoded + '' : '0';                \n            } \n            if (report.type === 'track' && report.id.indexOf(\"44444\") != -1) {\n                inbound_rtp_audio.audioOutputLevel = report.audioLevel + \"\";\n                outbound_rtp_audio.audioInputLevel = report.audioLevel + \"\";\n            }\n            if (report.type === 'candidate-pair') {\n                if(report.availableIncomingBitrate == 0) {\n                    bweforvideo.googAvailableSendBandwidth = report.availableOutgoingBitrate + \"\";\n                } else {\n                    bweforvideo.googAvailableReceiveBandwidth = report.availableIncomingBitrate + \"\";\n                }\n            }\n        });\n        var filterList = [bweforvideo, outbound_rtp_audio, outbound_rtp_video, inbound_rtp_audio, inbound_rtp_video];\n        filterList.push({\n            id: \"time\",\n            startTime: that.connectedTime,\n            timestamp: new Date(),\n        })\n        callback(filterList, originList);\n      }).catch(function (error) {\n          console.error(error);\n      });\n    };\n\n    /**\n     * Adds a stream - this causes signalling to happen, if needed.\n     * @param {MediaStream} stream The outgoing MediaStream to add.\n     */\n    that.addStream = function (stream) {\n        if (window.navigator.userAgent.indexOf(\"Safari\") > -1 && navigator.userAgent.indexOf(\"Chrome\") === -1) {\n          stream.getTracks().forEach(track => that.peerConnection.addTrack(track, stream));\n        } else {\n          that.peerConnection.addStream(stream);\n        }\n        that.markActionNeeded();\n    };\n\n    /**\n     * Removes a stream.\n     * @param {MediaStream} stream The MediaStream to remove.\n     */\n    that.removeStream = function () {\n//        var i;\n//        for (i = 0; i < that.peerConnection.localStreams.length; ++i) {\n//            if (that.localStreams[i] === stream) {\n//                that.localStreams[i] = null;\n//            }\n//        }\n        that.markActionNeeded();\n    };\n\n    /**\n     * Closes the connection.\n     */\n    that.close = function () {\n        that.state = 'closed';\n        that.peerConnection.close();\n    };\n\n    /**\n     * Internal function: Mark that something happened.\n     */\n    that.markActionNeeded = function () {\n        that.actionNeeded = true;\n        that.doLater(function () {\n            that.onstablestate();\n        });\n    };\n\n    /**\n     * Internal function: Do something later (not on this stack).\n     * @param {function} what Callback to be executed later.\n     */\n    that.doLater = function (what) {\n        // Post an event to myself so that I get called a while later.\n        // (needs more JS/DOM info. Just call the processing function on a delay\n        // for now.)\n        window.setTimeout(what, 1);\n    };\n\n    /**\n     * Internal function called when a stable state\n     * is entered by the browser (to allow for multiple AddStream calls or\n     * other interesting actions).\n     * This function will generate an offer or answer, as needed, and send\n     * to the remote party using our onsignalingmessage function.\n     */\n    that.onstablestate = function () {\n        var mySDP;\n        if (that.actionNeeded) {\n            if (that.state === 'new' || that.state === 'established') {\n                // See if the current offer is the same as what we already sent.\n                // If not, no change is needed.\n\n                if (spec.isSubscriber && window.navigator.userAgent.indexOf(\"Safari\") > -1 && navigator.userAgent.indexOf(\"Chrome\") === -1) {\n                    var audioReceiver = that.peerConnection.addTransceiver(\"audio\");\n                    var videoReceiver = that.peerConnection.addTransceiver(\"video\");\n                    audioReceiver.setDirection(\"recvonly\");\n                    videoReceiver.setDirection(\"recvonly\");\n                }\n                that.peerConnection.createOffer(that.mediaConstraints).then(function (sessionDescription) {\n                    sessionDescription.sdp = setMaxBW(sessionDescription.sdp);\n\n                    if(!spec.isSubscriber) {\n                        // Solve the video orientation issue between iOS Safari and Firefox.\n                        sessionDescription.sdp = sessionDescription.sdp.replace(/a=extmap:4 urn:3gpp:video-orientation\\r\\n/g, \"\");\n                    }\n                    \n                    //Logger.debug(\"Offer\", sessionDescription.sdp);\n\n                    var newOffer = sessionDescription.sdp;\n\n                    if (newOffer !== that.prevOffer) {\n\n                        that.peerConnection.setLocalDescription(sessionDescription);\n\n                        that.state = 'preparing-offer';\n                        that.markActionNeeded();\n                        return;\n                    } else {\n                        Logger.debug('Not sending a new offer');\n                    }\n\n                }).catch(function(err) {\n                    Logger.debug('peer connection create offer failed ', err);\n                });\n\n\n            } else if (that.state === 'preparing-offer') {\n                // Don't do anything until we have the ICE candidates.\n                if (that.moreIceComing) {\n                    return;\n                }\n\n\n                // Now able to send the offer we've already prepared.\n                that.prevOffer = that.peerConnection.localDescription.sdp;\n                //Logger.debug(\"Sending OFFER: \" + that.prevOffer);\n                that.sendMessage('OFFER', that.prevOffer);\n                // Not done: Retransmission on non-response.\n                that.state = 'offer-sent';\n\n            } else if (that.state === 'offer-received') {\n\n                that.peerConnection.createAnswer(function (sessionDescription) {\n                    that.peerConnection.setLocalDescription(sessionDescription);\n                    that.state = 'offer-received-preparing-answer';\n\n                    if (!that.iceStarted) {\n                        var now = new Date();\n                        Logger.debug(now.getTime() + ': Starting ICE in responder');\n                        that.iceStarted = true;\n                    } else {\n                        that.markActionNeeded();\n                        return;\n                    }\n\n                }, function(err) {\n                    Logger.debug('peer connection create answer failed ', err);\n                }, that.mediaConstraints);\n\n            } else if (that.state === 'offer-received-preparing-answer') {\n                if (that.moreIceComing) {\n                    return;\n                }\n\n                mySDP = that.peerConnection.localDescription.sdp;\n\n                that.sendMessage('ANSWER', mySDP);\n                that.state = 'established';\n            } else {\n                that.error('Dazed and confused in state ' + that.state + ', stopping here');\n            }\n            that.actionNeeded = false;\n        }\n    };\n\n    /**\n     * Internal function to send an \"OK\" message.\n     */\n    that.sendOK = function () {\n        that.sendMessage('OK');\n    };\n\n    /**\n     * Internal function to send a signalling message.\n     * @param {string} operation What operation to signal.\n     * @param {string} sdp SDP message body.\n     */\n    that.sendMessage = function (operation, sdp) {\n        var roapMessage = {};\n        roapMessage.messageType = operation;\n        roapMessage.sdp = sdp; // may be null or undefined\n        if (operation === 'OFFER') {\n            roapMessage.offererSessionId = that.sessionId;\n            roapMessage.answererSessionId = that.otherSessionId; // may be null\n            roapMessage.seq = (that.sequenceNumber += 1);\n            // The tiebreaker needs to be neither 0 nor 429496725.\n            roapMessage.tiebreaker = Math.floor(Math.random() * 429496723 + 1);\n        } else {\n            roapMessage.offererSessionId = that.incomingMessage.offererSessionId;\n            roapMessage.answererSessionId = that.sessionId;\n            roapMessage.seq = that.incomingMessage.seq;\n        }\n        that.onsignalingmessage(JSON.stringify(roapMessage));\n    };\n\n    /**\n     * Internal something-bad-happened function.\n     * @param {string} text What happened - suitable for logging.\n     */\n    that.error = function (text) {\n        throw 'Error in RoapOnJsep: ' + text;\n    };\n\n    that.sessionId = (that.roapSessionId += 1);\n    that.sequenceNumber = 0; // Number of last ROAP message sent. Starts at 1.\n    that.actionNeeded = false;\n    that.iceStarted = false;\n    that.moreIceComing = true;\n    that.iceCandidateCount = 0;\n    that.onsignalingmessage = spec.callback;\n\n    that.peerConnection.ontrack = function (evt) {\n        if (that.onaddstream) {\n            that.onaddstream(evt, \"ontrack\");\n        }\n    };\n\n    that.peerConnection.onremovestream = function (stream) {\n        if (that.onremovestream) {\n            that.onremovestream(stream);\n        }\n    };\n\n    that.peerConnection.oniceconnectionstatechange = function (e) {\n        if(e.currentTarget.iceConnectionState === \"connected\") {\n            that.connectedTime = new Date();\n        }\n\n        if (that.oniceconnectionstatechange) {\n            that.oniceconnectionstatechange(e.currentTarget.iceConnectionState);\n        }\n    };\n\n    // Variables that are part of the public interface of PeerConnection\n    // in the 28 January 2012 version of the webrtc specification.\n    that.onaddstream = null;\n    that.onremovestream = null;\n    that.state = 'new';\n    // Auto-fire next events.\n    that.markActionNeeded();\n    return that;\n};\n\nexport default SafariStableStack\n\n\n\n// WEBPACK FOOTER //\n// ./src/webrtc-stacks/SafariStableStack.js","var FcStack = function () {\n  \"use strict\";\n\n  var that = {};\n  that.addStream = function () {};\n\n  return that;\n};\n\nexport default FcStack\n\n\n\n// WEBPACK FOOTER //\n// ./src/webrtc-stacks/FcStack.js","import Logger from '../utils/Logger'\n\nvar FirefoxStack = function (spec) {\n  \"use strict\";\n\n  var that = {},\n      WebkitRTCPeerConnection = mozRTCPeerConnection,\n      RTCSessionDescription = mozRTCSessionDescription;\n  var hasStream = false;\n  that.isSubscriber = spec.isSubscriber;\n  that.pc_config = {\n    \"iceServers\": []\n  };\n\n  // currently firefox does not support turn\n  if (spec.iceServers instanceof Array) {\n    spec.iceServers.map(function (server) {\n      if (server.url.indexOf('stun:') === 0) {\n        that.pc_config.iceServers.push({\"url\": server.url});\n      }\n    });\n  } else {\n    if (spec.stunServerUrl) {\n      if (spec.stunServerUrl instanceof Array) {\n        spec.stunServerUrl.map(function (url) {\n          if (typeof url === 'string' && url !== '') {\n            that.pc_config.iceServers.push({\"url\": url});\n          }\n        });\n      } else if (typeof spec.stunServerUrl === 'string' && spec.stunServerUrl !== '') {\n        that.pc_config.iceServers.push({\"url\": spec.stunServerUrl});\n      }\n    }\n  }\n\n  if (spec.audio === undefined) {\n    spec.audio = true;\n  }\n\n  if (spec.video === undefined) {\n    spec.video = true;\n  }\n\n  that.mediaConstraints = {\n    offerToReceiveAudio: spec.audio,\n    offerToReceiveVideo: spec.video,\n    mozDontOfferDataChannel: true\n  };\n\n  that.roapSessionId = 103;\n\n  that.peerConnection = new RTCPeerConnection(that.pc_config);\n\n  that.peerConnection.onicecandidate = function (event) {\n    if (!event.candidate) {\n      // At the moment, we do not renegotiate when new candidates\n      // show up after the more flag has been false once.\n      Logger.debug(\"PeerConnection State: \" + that.peerConnection.iceGatheringState);\n\n      if (that.ices === undefined) {\n        that.ices = 0;\n      }\n      that.ices = that.ices + 1;\n      if (that.ices >= 1 && that.moreIceComing) {\n        that.moreIceComing = false;\n        that.markActionNeeded();\n      }\n    } else {\n      that.iceCandidateCount += 1;\n    }\n  };\n\n  that.processSignalingMessage = function (msgstring) {\n    // Offer: Check for glare and resolve.\n    // Answer/OK: Remove retransmit for the msg this is an answer to.\n    // Send back \"OK\" if this was an Answer.\n    //Logger.debug('Activity on conn ' + that.sessionId);\n    var msg = JSON.parse(msgstring), sd;\n    that.incomingMessage = msg;\n\n    if (that.state === 'new') {\n      if (msg.messageType === 'OFFER') {\n        // Initial offer.\n        msg.sdp = setMaxBW(msg.sdp);\n        sd = { sdp: msg.sdp, type: 'offer' };\n        that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd), function() {\n          Logger.debug(\"setRemoteDescription succeeded\");\n        }, function(error) {\n          Logger.info(\"setRemoteDescription failed: \" + error.name);\n        });\n\n        that.state = 'offer-received';\n        // Allow other stuff to happen, then reply.\n        that.markActionNeeded();\n      } else {\n        that.error('Illegal message for this state: ' + msg.messageType + ' in state ' + that.state);\n      }\n    } else if (that.state === 'offer-sent') {\n      if (msg.messageType === 'ANSWER') {\n        msg.sdp = setMaxBW(msg.sdp);\n        msg.sdp = msg.sdp.replace(/ generation 0/g, \"\");\n        msg.sdp = msg.sdp.replace(/ udp /g, \" UDP \");\n        msg.sdp = msg.sdp.replace(/a=group:BUNDLE audio video/, \"a=group:BUNDLE sdparta_0 sdparta_1\");\n        msg.sdp = msg.sdp.replace(/a=mid:audio/, \"a=mid:sdparta_0\");\n        msg.sdp = msg.sdp.replace(/a=mid:video/, \"a=mid:sdparta_1\");\n\n\t    sd = { sdp: msg.sdp, type: 'answer' };\n        //Logger.debug(\"Received ANSWER: \", sd.sdp);\n        that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd), function() {\n          Logger.debug(\"setRemoteDescription succeeded\");\n        }, function(error) {\n          Logger.info(\"setRemoteDescription failed: \" + error);\n        });\n        that.sendOK();\n        that.state = 'established';\n      } else if (msg.messageType === 'pr-answer') {\n        sd = { sdp: msg.sdp, type: 'pr-answer' };\n        that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd), function() {\n          Logger.debug(\"setRemoteDescription succeeded\");\n        }, function(error) {\n          Logger.info(\"setRemoteDescription failed: \" + error.name);\n        });\n\n      // No change to state, and no response.\n      } else if (msg.messageType === 'offer') {\n        // Glare processing.\n        that.error('Not written yet');\n      } else {\n        that.error('Illegal message for this state: ' + msg.messageType + ' in state ' + that.state);\n      }\n    } else if (that.state === 'established') {\n      if (msg.messageType === 'OFFER') {\n        // Subsequent offer.\n        sd = { sdp: msg.sdp, type: 'offer' };\n        that.peerConnection.setRemoteDescription(new RTCSessionDescription(sd), function() {\n          Logger.debug(\"setRemoteDescription succeeded\");\n        }, function(error) {\n          Logger.info(\"setRemoteDescription failed: \" + error.name);\n        });\n\n        that.state = 'offer-received';\n        // Allow other stuff to happen, then reply.\n        that.markActionNeeded();\n      } else {\n        that.error('Illegal message for this state: ' + msg.messageType + ' in state ' + that.state);\n      }\n    }\n  };\n\n  var outbound_rtp_audio = {\n    id: \"\",\n    type: \"\",\n    mediaType: \"opus\",\n    googCodecName: \"opus\",\n    aecDivergentFilterFraction: \"0\",\n    audioInputLevel: \"0\",\n    bytesSent: \"0\",\n    packetsSent: \"0\",\n    googEchoCancellationReturnLoss: \"0\",\n    googEchoCancellationReturnLossEnhancement: \"0\"\n  };\n\n  var outbound_rtp_video = {\n    id: \"\",\n    type: \"\",\n    mediaType: \"\",\n    googCodecName: spec.codec === \"h264\" ? \"H264\" : \"VP8\",\n    bytesSent: \"0\",\n    packetsLost: \"0\",\n    packetsSent: \"0\",\n    googAdaptationChanges: \"0\",\n    googAvgEncodeMs: \"0\",\n    googEncodeUsagePercent: \"0\",\n    googFirsReceived: \"0\",\n    googFrameHeightSent: \"0\",\n    googFrameHeightInput: \"0\",\n    googFrameRateInput: \"0\",\n    googFrameRateSent: \"0\",\n    googFrameWidthSent: \"0\",\n    googFrameWidthInput: \"0\",\n    googNacksReceived: \"0\",\n    googPlisReceived: \"0\",\n    googRtt: \"0\"\n  };\n\n  var inbound_rtp_audio = {\n    id: \"\",\n    type: \"\",\n    mediaType: \"\",\n    audioOutputLevel: \"0\",\n    bytesReceived: \"0\",\n    packetsLost: \"0\",\n    packetsReceived: \"0\",\n    googAccelerateRate: \"0\",\n    googCurrentDelayMs: \"0\",\n    googDecodingCNG: \"0\",\n    googDecodingCTN: \"0\",\n    googDecodingCTSG: \"0\",\n    googDecodingNormal: \"0\",\n    googDecodingPLC: \"0\",\n    googDecodingPLCCNG: \"0\",\n    googExpandRate: \"0\",\n    googJitterBufferMs: \"0\",\n    googJitterReceived: \"0\",\n    googPreemptiveExpandRate: \"0\",\n    googPreferredJitterBufferMs: \"0\",\n    googSecondaryDecodedRate: \"0\",\n    googSpeechExpandRate: \"0\"\n  };\n\n  var inbound_rtp_video = {\n    id: \"\",\n    type: \"\",\n    mediaType: \"\",\n    googTargetDelayMs: \"0\",\n    packetsLost: \"0\",\n    googDecodeMs: \"0\",\n    googMaxDecodeMs: \"0\",\n    googRenderDelayMs: \"0\",\n    googFrameWidthReceived: \"0\",\n    googFrameHeightReceived: \"0\",\n    googFrameRateReceived: \"0\",\n    googFrameRateDecoded: \"0\",\n    googFrameRateOutput: \"0\",\n    googJitterBufferMs: \"0\",\n    googCurrentDelayMs: \"0\",\n    googMinPlayoutDelayMs: \"0\",\n    googNacksSent: \"0\",\n    googPlisSent: \"0\",\n    googFirsSent: \"0\",\n    bytesReceived: \"0\",\n    packetsReceived: \"0\",\n    googFramesDecoded: \"0\",\n  };\n\n  var lastFramesDecoded = 0;\n\n  that.getStatsRate = function(callback) {\n    that.getStats(function(stats) {\n      stats.forEach(function(report) {\n          if (report.type === 'inboundrtp' && report.mediaType === 'video') {\n              if(report.googFrameRateDecoded) {\n                  report.googFrameRateDecoded = ((report.googFramesDecoded - lastFramesDecoded) / 3).toString();\n                  lastFramesDecoded = report.googFramesDecoded;\n              }\n          }\n      })\n      callback(stats);\n    });\n  }\n\n  that.getStats = function(callback) {\n    that.peerConnection.getStats().then(function(stats) {\n      var originList = [];\n      Object.keys(stats).forEach(function(stat) {\n        var report = stats[stat];\n        originList.push(report); \n        if (report.type === 'outboundrtp' && report.mediaType === 'video') {\n          outbound_rtp_video.id = report.id;\n          outbound_rtp_video.type = report.type;\n          outbound_rtp_video.mediaType = report.mediaType;\n          outbound_rtp_video.bytesSent = report.bytesSent ? report.bytesSent + '' : '0';\n          outbound_rtp_video.packetsSent = report.packetsSent ? report.packetsSent + '' : '0';\n          outbound_rtp_video.googPlisReceived = report.pliCount ? report.pliCount + '' : '0';\n          outbound_rtp_video.googNacksReceived = report.nackCount ? report.nackCount + '' : '0';\n          outbound_rtp_video.googFirsReceived = report.firCount ? report.firCount + '' : '0';\n          outbound_rtp_video.googFrameRateSent = report.framerateMean ? report.framerateMean + '' : '0';\n        }\n        if (report.type === 'outboundrtp' && report.mediaType === 'audio') {\n          outbound_rtp_audio.id = report.id;\n          outbound_rtp_audio.type = report.type;\n          outbound_rtp_audio.mediaType = report.mediaType;\n          outbound_rtp_audio.bytesSent = report.bytesSent ? report.bytesSent + '' : '0';\n          outbound_rtp_audio.packetsSent = report.packetsSent ? report.packetsSent + '' : '0';\n        }\n        if (report.type === 'inboundrtp' && report.mediaType === 'audio' && !report.isRemote) {\n          inbound_rtp_audio.id = report.id;\n          inbound_rtp_audio.type = report.type;\n          inbound_rtp_audio.mediaType = report.mediaType;\n          inbound_rtp_audio.bytesReceived = report.bytesReceived ? report.bytesReceived + '' : '0';\n          inbound_rtp_audio.packetsLost = report.packetsLost ? report.packetsLost + '' : '0';\n          inbound_rtp_audio.packetsReceived = report.packetsReceived ? report.packetsReceived + '' : '0';\n          inbound_rtp_audio.googJitterReceived = report.jitter ? report.jitter + '' : '0';\n        }\n        if (report.type === 'inboundrtp' && report.mediaType === 'video' && !report.isRemote) {\n          inbound_rtp_video.id = report.id;\n          inbound_rtp_video.type = report.type;\n          inbound_rtp_video.mediaType = report.mediaType;\n          inbound_rtp_video.bytesReceived = report.bytesReceived ? report.bytesReceived + '' : '0';\n          inbound_rtp_video.googFrameRateReceived = report.framerateMean ? report.framerateMean + '' : '0';\n          inbound_rtp_video.googFramesDecoded = report.framesDecoded ? report.framesDecoded + '' : '0';\n          inbound_rtp_video.packetsLost = report.packetsLost ? report.packetsLost + '' : '0';\n          inbound_rtp_video.packetsReceived = report.packetsReceived ? report.packetsReceived + '' : '0';\n          inbound_rtp_video.googJitterBufferMs = report.jitter ? report.jitter + '' : '0';\n          inbound_rtp_video.googNacksSent = report.nackCount ? report.nackCount + '' : '0';\n          inbound_rtp_video.googPlisSent = report.pliCount ? report.pliCount + '' : '0';\n          inbound_rtp_video.googFirsSent = report.firCount ? report.firCount + '' : '0';\n        }\n        if (report.id.indexOf('outbound_rtcp_video') !== -1) {\n          outbound_rtp_video.packetsLost = report.packetsLost ? report.packetsLost + '' : '0';\n        }\n      });\n      var filterList = [outbound_rtp_video, outbound_rtp_audio, inbound_rtp_audio, inbound_rtp_video];\n      filterList.push({\n        id: \"time\",\n        startTime: that.connectedTime,\n        timestamp: new Date(),\n      })\n      callback(filterList, originList);\n    }, function (error) {\n      Logger.error(error);\n    });\n  };\n\n  that.addStream = function (stream) {\n    hasStream = true;\n    that.peerConnection.addStream(stream);\n    that.markActionNeeded();\n  };\n\n  that.removeStream = function () {\n    that.markActionNeeded();\n  };\n\n  that.close = function () {\n    that.state = 'closed';\n    that.peerConnection.close();\n  };\n\n  that.markActionNeeded = function () {\n    that.actionNeeded = true;\n    that.doLater(function () {\n      that.onstablestate();\n    });\n  };\n\n  that.doLater = function (what) {\n    // Post an event to myself so that I get called a while later.\n    // (needs more JS/DOM info. Just call the processing function on a delay\n    // for now.)\n    window.setTimeout(what, 1);\n  };\n\n  /**\n   * Internal function called when a stable state\n   * is entered by the browser (to allow for multiple AddStream calls or\n   * other interesting actions).\n   * This function will generate an offer or answer, as needed, and send\n   * to the remote party using our onsignalingmessage function.\n   */\n  that.onstablestate = function () {\n    if (that.actionNeeded) {\n      if (that.state === 'new' || that.state === 'established') {\n        var onSuccess = function() {\n          that.peerConnection.createOffer(function (sessionDescription) {\n            sessionDescription.sdp = setMaxBW(sessionDescription.sdp);\n            sessionDescription.sdp = sessionDescription.sdp.replace(/a=extmap:1 http:\\/\\/www.webrtc.org\\/experiments\\/rtp-hdrext\\/abs-send-time/, \"a=extmap:3 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\");\n            var newOffer = sessionDescription.sdp;\n            if (newOffer !== that.prevOffer) {\n              that.peerConnection.setLocalDescription(sessionDescription);\n\n              that.state = 'preparing-offer';\n              that.markActionNeeded();\n              return;\n            } else {\n              Logger.debug('Not sending a new offer');\n            }\n          }, function(error) {\n              Logger.debug(\"Ups! create offer failed \", error);\n          }, that.mediaConstraints);\n        };\n\n        if (hasStream) {\n          that.mediaConstraints = undefined;\n        }\n\n        onSuccess();\n      } else if (that.state === 'preparing-offer') {\n        // Don't do anything until we have the ICE candidates.\n        if (that.moreIceComing) {\n          return;\n        }\n\n        // Now able to send the offer we've already prepared.\n        that.prevOffer = that.peerConnection.localDescription.sdp;\n        //Logger.debug(\"Sending OFFER: \", that.prevOffer);\n        that.sendMessage('OFFER', that.prevOffer);\n        // Not done: Retransmission on non-response.\n        that.state = 'offer-sent';\n      } else if (that.state === 'offer-received') {\n        that.peerConnection.createAnswer(function (sessionDescription) {\n          that.peerConnection.setLocalDescription(sessionDescription);\n          that.state = 'offer-received-preparing-answer';\n\n          if (!that.iceStarted) {\n            var now = new Date();\n            Logger.debug(now.getTime() + ': Starting ICE in responder');\n            that.iceStarted = true;\n          } else {\n            that.markActionNeeded();\n            return;\n          }\n        }, function() {\n          Logger.debug(\"Ups! Something went wrong\");\n        });\n      } else if (that.state === 'offer-received-preparing-answer') {\n        if (that.moreIceComing) {\n          return;\n        }\n\n        var mySDP = that.peerConnection.localDescription.sdp;\n        that.sendMessage('ANSWER', mySDP);\n        that.state = 'established';\n      } else {\n        that.error('Dazed and confused in state ' + that.state + ', stopping here');\n      }\n      that.actionNeeded = false;\n    }\n  };\n\n  that.sendOK = function () {\n    that.sendMessage('OK');\n  };\n\n  /**\n   * Internal function to send a signalling message.\n   * @param {string} operation What operation to signal.\n   * @param {string} sdp SDP message body.\n   */\n  that.sendMessage = function (operation, sdp) {\n    var roapMessage = {};\n    roapMessage.messageType = operation;\n    roapMessage.sdp = sdp; // may be null or undefined\n    if (operation === 'OFFER') {\n      roapMessage.offererSessionId = that.sessionId;\n      roapMessage.answererSessionId = that.otherSessionId; // may be null\n      roapMessage.seq = (that.sequenceNumber += 1);\n      // The tiebreaker needs to be neither 0 nor 429496725.\n      roapMessage.tiebreaker = Math.floor(Math.random() * 429496723 + 1);\n    } else {\n      roapMessage.offererSessionId = that.incomingMessage.offererSessionId;\n      roapMessage.answererSessionId = that.sessionId;\n      roapMessage.seq = that.incomingMessage.seq;\n    }\n    that.onsignalingmessage(JSON.stringify(roapMessage));\n  };\n\n  that.error = function (text) {\n    throw 'Error in RoapOnJsep: ' + text;\n  };\n\n  that.sessionId = (that.roapSessionId += 1);\n  that.sequenceNumber = 0; // Number of last ROAP message sent. Starts at 1.\n  that.actionNeeded = false;\n  that.iceStarted = false;\n  that.moreIceComing = true;\n  that.iceCandidateCount = 0;\n  that.onsignalingmessage = spec.callback;\n\n  that.peerConnection.ontrack = function (stream) {\n    if (that.onaddstream) {\n      that.onaddstream(stream, \"ontrack\");\n    }\n  };\n\n  that.peerConnection.onremovestream = function (stream) {\n    if (that.onremovestream) {\n      that.onremovestream(stream);\n    }\n  };\n\n  that.peerConnection.oniceconnectionstatechange = function (e) {\n    if(e.currentTarget.iceConnectionState === \"connected\") {\n      that.connectedTime = new Date();\n    }\n\n    if (that.oniceconnectionstatechange) {\n      that.oniceconnectionstatechange(e.currentTarget.iceConnectionState);\n    }\n  };\n\n  var setMaxBW = function (sdp) {\n    if (spec.video && spec.maxVideoBW) {\n      var a = sdp.match(/m=video.*\\r\\n/);\n      if (a == null) {\n        a = sdp.match(/m=video.*\\n/);\n      }\n      if (a && (a.length > 0)) {\n        var r = a[0] + \"b=TIAS:\" + spec.maxVideoBW * 1000 + \"\\r\\n\";\n        sdp = sdp.replace(a[0], r);\n      }\n    }\n\n    if (spec.audio && spec.maxAudioBW) {\n      var a = sdp.match(/m=audio.*\\r\\n/);\n      if (a == null) {\n        a = sdp.match(/m=audio.*\\n/);\n      }\n      if (a && (a.length > 0)) {\n        var r = a[0] + \"b=TIAS:\" + spec.maxAudioBW * 1000 + \"\\r\\n\";\n        sdp = sdp.replace(a[0], r);\n      }\n    }\n\n    return sdp;\n  };\n\n  that.onaddstream = null;\n  that.onremovestream = null;\n  that.state = 'new';\n  // Auto-fire next events.\n  that.markActionNeeded();\n  return that;\n};\n\nexport default FirefoxStack\n\n\n\n// WEBPACK FOOTER //\n// ./src/webrtc-stacks/FirefoxStack.js","var publishStatsFilter = function(stats) {\n  var detection = {\n    audioSendBytes: \"0\",\n    audioSendPackets: \"0\",\n\n    videoSendBytes: \"0\",\n    videoSendPackets: \"0\",\n    videoSendPacketsLost: \"0\",\n    videoSendFrameRate: \"0\",\n    videoSendBandwidth: \"0\",\n    videoSendResolutionWidth: \"0\",\n    videoSendResolutionHeight: \"0\",\n\n    audioCodecName:\"\",\n    videoCodecName:\"\",\n\n    timestamp: \"\",\n    startTime: \"\",\n    duration: \"0\",\n  }\n\n  stats.forEach(function(stat) {\n    if(stat.type === \"VideoBwe\") {\n      detection.videoSendBandwidth = stat.googAvailableSendBandwidth;\n\n    } else if(stat.id.indexOf(\"send\") !== -1 || \n      stat.id.indexOf(\"outbound_rtp\") !== -1 ||\n      stat.id.indexOf(\"OutboundRTP\") !== -1 ) {\n\n      if(stat.mediaType === \"audio\") {\n        detection.audioSendBytes = stat.bytesSent;\n        detection.audioSendPackets = stat.packetsSent;\n        detection.audioCodecName = stat.googCodecName;\n      } else {\n        detection.videoSendBytes = stat.bytesSent;\n        detection.videoSendPackets = stat.packetsSent;\n        detection.videoSendPacketsLost = stat.packetsLost;\n        detection.videoSendFrameRate = stat.googFrameRateSent;\n        detection.videoSendResolutionWidth = stat.googFrameWidthSent;\n        detection.videoSendResolutionHeight = stat.googFrameHeightSent;\n        detection.videoCodecName = stat.googCodecName;\n      }\n\n    } else if(stat.id === \"time\") {\n      detection.timestamp = stat.timestamp;\n      detection.startTime = stat.startTime;\n    }\n  });\n  \n  if(detection.timestamp instanceof Date && detection.startTime instanceof Date) {\n    detection.duration = Math.floor((detection.timestamp.getTime() - detection.startTime.getTime()) / 1000) + \"\";\n  }\n\n  return detection;\n}\n\nvar subscribeStatsFilter = function(stats) {\n  var detection = {\n    audioReceiveBytes: \"0\",\n    audioReceivePackets: \"0\",\n    audioReceivePacketsLost: \"0\",\n\n    videoReceiveBytes: \"0\",\n    videoReceivePackets: \"0\",\n    videoReceivePacketsLost: \"0\",\n    videoReceiveFrameRate: \"0\",\n    videoReceiveDecodeFrameRate: \"0\",\n    videoReceiveBandwidth: \"0\",\n    videoReceivedResolutionWidth: \"0\",\n    videoReceivedResolutionHeight: \"0\",\n\n    timestamp: \"\",\n    startTime: \"\",\n    duration: \"0\",\n  }\n\n  stats.forEach(function(stat) {\n    if(stat.type === \"VideoBwe\") {\n      detection.videoReceiveBandwidth = stat.googAvailableReceiveBandwidth;\n\n    } else if(stat.id.indexOf(\"recv\") !== -1 || \n      stat.id.indexOf(\"inbound_rtp\") !== -1 ||\n      stat.id.indexOf(\"InboundRTP\") !== -1) {\n\n      if(stat.mediaType === \"audio\") {\n        detection.audioReceiveBytes = stat.bytesReceived;\n        detection.audioReceivePackets = stat.packetsReceived;\n        detection.audioReceivePacketsLost = stat.packetsLost;\n      } else {  \n        detection.videoReceiveBytes = stat.bytesReceived;\n        detection.videoReceivePacketsLost = stat.packetsLost;\n        detection.videoReceivePackets = stat.packetsReceived;\n        detection.videoReceiveFrameRate = stat.googFrameRateReceived;\n        detection.videoReceiveDecodeFrameRate = stat.googFrameRateDecoded;\n        detection.videoReceivedResolutionWidth = stat.googFrameWidthReceived;\n        detection.videoReceivedResolutionHeight = stat.googFrameHeightReceived;\n      }\n\n    } else if(stat.id === \"time\"){\n      detection.timestamp = stat.timestamp;\n      detection.startTime = stat.startTime;\n    }\n  });\n  if(detection.timestamp instanceof Date && detection.startTime instanceof Date) {\n    detection.duration = Math.floor((detection.timestamp.getTime() - detection.startTime.getTime()) / 1000) + \"\";\n  }\n\n  return detection;  \n}\n\nexport {\n  publishStatsFilter,\n  subscribeStatsFilter\n}\n\n\n// WEBPACK FOOTER //\n// ./src/Stats.js","import GatewayClient from \"./GatewayClient\"\nimport Logger from \"./utils/Logger\"\nimport ErrorCodes from \"./utils/ErrorCodes\"\nimport {safeCall, generateSessionId, is32Uint} from \"./Helper\"\nimport {getGatewayList} from \"./Server\"\nimport {report} from \"./Report2\"\nimport {getBrowserOS, isSafari} from \"./utils/Browser\"\nimport {simMap} from \"./SimMap\"\nimport {Stream, getDevices} from \"./Stream\"\nimport {AUDIO_SAMPLE_RATE_48000, VIDEO_CODEC_PROFILE_HIGH} from \"./GlobalName\"\nimport * as config from \"./Config\"\n\nconst PUBLISHED = 0;\nconst PUBLISHING = 1;\nconst UNPUBLISHED = 2;\n\nvar Client = function (spec) {\n  \"use strict\";\n\n  var that = {};\n  that.key = undefined;\n\n  that.highStream = null;\n  that.lowStream = null;\n  that.lowStreamParameter = null;\n  that.isDualStream = false;\n  that.highStreamState = UNPUBLISHED;\n  that.lowStreamState = UNPUBLISHED;\n\n  that.setLowStreamParameter = function(lowStreamParameter) {\n    that.lowStreamParameter = lowStreamParameter;\n  }\n\n  that._getVideoCameraIdByLabel = function(label, onSuccess, onFailure) {\n    getDevices((devices) => {\n      for(let device of devices) {\n        if(device.label === label && device.kind === 'videoinput') {\n          return onSuccess(device.deviceId);\n        }\n      }\n      return onFailure();\n    }, onFailure);\n  } \n\n  that.init = function (appId, onSuccess, onFailure) {\n    if(typeof appId !== 'string') {\n      throw new Error('Param appId should be string');\n    }\n\n    Logger.info(\"Initializing AgoraRTC client\");\n    spec.appId = appId;\n    spec.sessionId = generateSessionId();\n    onSuccess && onSuccess();\n  };\n\n  that.configPublisher = function(config) {\n    that.gatewayClient.configPublisher(config);\n  };\n\n  that.enableDualStream = function(onSuccess, onFailure) {\n    if(getBrowserOS() === \"iOS\") {\n      report.streamSwitch(spec.sessionId, {\n        lts: new Date().getTime(),\n        isdual: true,\n        succ: false,\n      })\n      return onFailure && onFailure(ErrorCodes.IOS_NOT_SUPPORT);\n    }\n\n    report.streamSwitch(spec.sessionId, {\n      lts: new Date().getTime(),\n      isdual: true,\n      succ: true,\n    })\n\n    that.isDualStream = true;\n    if(that.highStreamState === PUBLISHED) {\n      that._publishLowStream(onSuccess, onFailure);\n    } else if(that.highStreamState === PUBLISHING) {\n      onFailure && onFailure(ErrorCodes.STILL_ON_PUBLISHING);\n    } else {\n      onSuccess && onSuccess();\n    }\n  }\n\n  that.disableDualStream = function(onSuccess, onFailure) {\n    report.streamSwitch(spec.sessionId, {\n      lts: new Date().getTime(),\n      isdual: false,\n      succ: true,\n    });\n\n    that.isDualStream = false;\n    if(that.highStreamState === PUBLISHED) {\n      that._unpublishLowStream(onSuccess, onFailure);\n    } else if(that.highStreamState === PUBLISHING) {\n      onFailure && onFailure(ErrorCodes.STILL_ON_PUBLISHING);\n    } else {\n      onSuccess && onSuccess();\n    }\n  }\n\n  that._createLowStream = function(onSuccess, onFailure) {\n    if(!that.highStream || !that.highStream.stream) {\n      return Logger.warning(\"Can't create low-stream without highStream\");\n    }\n\n    var spec = Object.assign({}, that.highStream.params);\n    spec.streamID += 1;\n    spec.audio = false;\n\n    if(!spec.video) {\n      return;\n    }\n    \n    var videoTrack = that.highStream.stream.getVideoTracks()[0];\n    if(!videoTrack) {\n      onFailure('can not get hight-stream video track');\n    }\n\n    that._getVideoCameraIdByLabel(videoTrack.label ,function(deviceId) {\n      spec.cameraId = deviceId;\n      var lowStream = new Stream(spec);\n      lowStream.streamId = that.highStream.getId() + 1;\n      if(that.lowStreamParameter) {\n        var parameter = Object.assign({}, that.lowStreamParameter);\n        if(!parameter.width || !parameter.height) {\n          var sim = simMap(that.highStream.profile)\n          var res = config.SUPPORT_RESOLUTION_LIST[sim[0]];\n          parameter.width = res[0];\n          parameter.height = res[1];\n        }\n        parameter.framerate = parameter.framerate || 5;\n        parameter.bitrate = parameter.bitrate || 50;\n\n        if(isSafari()) {\n          var res = config.SUPPORT_RESOLUTION_LIST[that.highStream.profile];\n          parameter.width = res[0];\n          parameter.height = res[1];\n        }\n        lowStream.setVideoProfileCustomPlus(parameter);\n      } else {\n        lowStream.setVideoProfileCustom(simMap(that.highStream.profile));\n      }\n      lowStream.init(() => {\n        that.highStream.lowStream = lowStream;\n        if(!videoTrack.enabled) {\n          lowStream.disableVideo();\n        }\n        onSuccess && onSuccess(lowStream);\n      }, () => onFailure('can not get hight-stream video track'));\n    }) \n  }\n\n  that._getLowStream = function(onSuccess, onFailure) {\n    if(that.lowStream) {\n      onSuccess(that.lowStream)\n    } else {\n      that._createLowStream(lowStream => {\n        that.lowStream = lowStream;\n        onSuccess(that.lowStream)\n      }, onFailure);\n    }\n  }\n\n  that._publishLowStream = function(onSuccess, onFailure) {\n    if(that.lowStreamState !== UNPUBLISHED) {\n      Logger.warning(\"Can't publish low-stream when low-stream already publish\");\n      return onFailure && onFailure();\n    }\n\n    if(that.highStream && that.highStream.hasScreen()) {\n      return onFailure && onFailure(ErrorCodes.SHARING_SCREEN_NOT_SUPPORT);\n    }\n\n    that._getLowStream(lowStream => {\n      that.lowStreamState = PUBLISHING;\n      that.gatewayClient.publish(lowStream, () => {\n        that.lowStreamState = PUBLISHED;\n        onSuccess && onSuccess();\n      }, (e) => {\n        Logger.debug(\"publish low stream failed\");\n        onFailure && onFailure(e);\n      });\n    }, onFailure)\n    \n  }\n\n  that._unpublishLowStream = function(onSuccess, onFailure) {\n    if(that.lowStreamState !== PUBLISHED) {\n      Logger.warning(\"Can't unpublish low-stream when low-stream not ever publish\");\n      return onFailure && onFailure();\n    }\n\n    if(that.lowStream) {\n      that.gatewayClient.unpublish(that.lowStream, () => {}, (e) => {\n          Logger.debug(\"unpublish low stream failed\");\n          onFailure && onFailure(e);\n        }\n      );\n      that.lowStream.close();\n      that.lowStream = null;\n      that.lowStreamState = UNPUBLISHED;\n      onSuccess && onSuccess();\n    }\n\n  }\n\n  that.join = function(channelKey, channel, uid, onSuccess, onFailure) {\n    if(channelKey && typeof channelKey !== 'string') {\n      return onFailure && onFailure('Param channelKey should be string');\n    }\n\n    if(typeof channel !== 'string') {\n      return onFailure && onFailure('Param channel should be string');\n    }\n\n    if(uid && (typeof uid !== 'number' || !is32Uint(uid))) {\n      return onFailure && onFailure('Param uid should be number');\n    }\n\n    that.highStream = null;\n    that.lowStream = null;\n    that.lowStreamParameter = null;\n    that.isDualStream = false;\n    that.highStreamState = UNPUBLISHED;\n    that.lowStreamState = UNPUBLISHED;\n\n    var joinInfo = {\n      appId: spec.appId,\n      sid: spec.sessionId,\n      cname: channel,\n      uid: uid\n    }\n\n    // sessionInit event report\n    report.sessionInit(spec.sessionId, {\n      lts: new Date().getTime(),\n      cname: channel,\n      appid: spec.appId,\n      mode: spec.mode,\n      succ: true,\n    })\n    \n    getGatewayList(joinInfo, function(res) {\n      Logger.info(\"Joining channel: \" + channel);\n    \n      // TODO delete if useless\n      if (channelKey) {\n        that.key = channelKey;\n      } else {\n        that.key = spec.appId;\n      }\n\n      joinInfo.cid = res.cid;\n      joinInfo.uid = res.uid;\n      joinInfo.gatewayAddr = res.gateway_addr; \n      that.joinInfo = joinInfo;\n\n      that.gatewayClient.join(joinInfo, that.key, function(uid) {\n        Logger.info(\"Join channal \" + channel + \" success\");\n        onSuccess(uid);\n      }, onFailure);\n    }, onFailure);\n  };\n\n  that.renewChannelKey = function(channelKey, onSuccess, onFailure) {\n    if (that.key === undefined) {\n      Logger.error(\"renewChannelKey should not be called before user join\");\n      safeCall(onFailure, ErrorCodes.INVALID_OPERATION);\n    }\n    that.key = channelKey;\n    safeCall(onSuccess);\n  };\n\n  that.leave = function(onSuccess, onFailure) {\n    Logger.info(\"Leaving channel\");\n    that.gatewayClient.leave(onSuccess, onFailure);\n  };\n\n  that._publish = function (stream,  onSuccess, onFailure) {\n    if(that.highStreamState !== UNPUBLISHED) {\n      Logger.warning(\"Can't publish stream when stream already publish\", stream.getId());\n      return onFailure && onFailure(\"stream already publish\");\n    }\n\n    Logger.info(\"Publishing stream, uid: \" , stream.getId());\n    that.highStream = stream;\n    that.highStreamState = PUBLISHING;\n    that.highStream.streamId = that.joinInfo.uid;\n\n    that.gatewayClient.publish(stream, function() {\n      stream.sid = spec.sessionId;\n      that.highStreamState = PUBLISHED;\n      Logger.info(\"Publish success, uid:\", stream.getId());\n      if(that.isDualStream) {\n        that._publishLowStream(() => {\n          onSuccess && onSuccess();\n        }, onFailure);\n      } else {\n        onSuccess && onSuccess()\n      }\n    }, onFailure); \n    \n  };\n\n  that._unpublish = function (stream, onSuccess, onFailure) {\n    if(that.highStreamState !== PUBLISHED) {\n      Logger.warning(\"Can't unpublish stream when stream not publish\");\n      return onFailure && onFailure(\"stream not publish\");\n    }\n\n    Logger.info(\"Unpublish stream, uid: \" , stream.getId());\n\n    if(that.isDualStream && that.lowStream) {\n      that._unpublishLowStream(null, onFailure)\n      that.gatewayClient.unpublish(stream, null, onFailure)\n      that.highStreamState = UNPUBLISHED;\n      Logger.info(\"Unpublish stream success, uid:\", stream.getId());\n\n    } else {\n      that.gatewayClient.unpublish(stream, null, onFailure);\n      that.highStreamState = UNPUBLISHED;\n      Logger.info(\"Unpublish stream success, uid:\", stream.getId());\n    }\n    onSuccess && onSuccess();\n  };\n\n  that.publish = function (stream, onFailure) {\n    if(that.highStreamState !== UNPUBLISHED) {\n      onFailure && onFailure('stream already published');\n    }\n    that._publish(stream, null, onFailure);\n  }\n\n  that.unpublish = function (stream, onFailure) {\n    if(that.highStreamState !== PUBLISHED) {\n      onFailure && onFailure('stream not yet published');\n    }\n    that._unpublish(stream, null, onFailure);\n  }\n\n  that.subscribe = function (stream, onFailure) {\n    Logger.info(\"Subscribe stream, uid: \" , stream.getId());\n    that.gatewayClient.subscribe(stream, null, onFailure);\n  };\n\n  that.unsubscribe = function (stream, onFailure) {\n    Logger.info(\"Unsubscribe stream, uid: \" , stream.getId());\n    that.gatewayClient.unsubscribe(stream, null, onFailure);\n  };\n  \n  that.setRemoteVideoStreamType = function (stream, streamType) {\n    that.gatewayClient.setRemoteVideoStreamType(stream, streamType);\n  };\n\n  that.startLiveStreaming = function (url, transcodingEnabled) {\n    that.gatewayClient.startLiveStreaming(url, transcodingEnabled);\n  };\n\n  that.stopLiveStreaming = function (url) {\n    that.gatewayClient.stopLiveStreaming(url);\n  };\n\n  that.setLiveTranscoding = function (transcoding) {\n    Object.assign(LiveTranscoding, transcoding);\n    that.gatewayClient.setLiveTranscoding(LiveTranscoding);\n  };\n\n  that.gatewayClient = GatewayClient(spec);\n  that.on = that.gatewayClient.on;\n\n  that.on(\"rejoin\", () => {\n    // won't republish if preState = UNPUBLISHED, and PUBLISHING as PUBLISHED;\n    let preState = that.highStreamState === UNPUBLISHED ? UNPUBLISHED : PUBLISHED;\n    \n    if(that.highStream && preState === PUBLISHED) {\n      Logger.info(\"publish after rejoin\");\n      that.highStreamState = UNPUBLISHED;\n      that.lowStreamState = UNPUBLISHED;\n\n      that.publish(that.highStream, e => {\n        e && Logger.info(e);\n      });\n    }\n  })\n\n  that.on(\"pubP2PLost\", evt => {\n    Logger.debug('Start reconnect local peerConnection :', that.highStream.getId());\n    that.gatewayClient.dispatchEvent({type: \"stream-reconnect-start\", id: that.highStream.getId()});\n    that._unpublish(that.highStream, () => {\n      that._publish(that.highStream, () => {\n        Logger.debug('Reconnect local peerConnection success:', that.highStream.getId());\n        that.gatewayClient.dispatchEvent({type: \"stream-reconnect-end\", id: that.highStream.getId()});\n      }, err => {\n        Logger.debug('Reconnect local peerConnection failed:' + err);\n        that.gatewayClient.dispatchEvent({type: \"stream-reconnect-end\", id: that.highStream.getId()});\n      });\n    }, err => {\n      Logger.debug('Reconnect local peerConnection failed:' + err);\n      that.gatewayClient.dispatchEvent({type: \"stream-reconnect-end\", id: that.highStream.getId()});\n    });\n  });\n\n  that.on(\"subP2PLost\", evt => {\n    Logger.debug('Start reconnect remote peerConnection :', evt.stream.getId());\n    that.gatewayClient.dispatchEvent({type: \"stream-reconnect-start\", id: evt.stream.getId()});\n    that.gatewayClient.unsubscribe(evt.stream, () => {\n      that.gatewayClient.subscribe(evt.stream, () => {\n        Logger.debug('Reconnect remote peerConnection success:', evt.stream.getId());\n        that.gatewayClient.dispatchEvent({type: \"stream-reconnect-end\", id: evt.stream.getId()});\n      }, err => {\n        Logger.debug('Reconnect remote peerConnection failed:' + err);\n        that.gatewayClient.dispatchEvent({type: \"stream-reconnect-end\", id: evt.stream.getId()});\n      });\n    }, err => {\n      Logger.debug('Reconnect remote peerConnection failed:' + err);\n      that.gatewayClient.dispatchEvent({type: \"stream-reconnect-end\", id: evt.stream.getId()});\n    });\n  });\n\n  return that;\n};\n\nvar TranscodingUser = {\n  uid: 0,\n  x: 0,\n  y: 0,\n  width: 0,\n  height: 0,\n  zOrder: 0,\n  alpha: 1.0,\n};\n\nvar LiveTranscoding = {\n  width: 640,\n  height: 360,\n  videoBitrate: 400,\n  videoFramerate: 15,\n  lowLatency: false,\n  audioSampleRate: AUDIO_SAMPLE_RATE_48000,\n  audioBitrate: 48,\n  audioChannels: 1,\n  videoGop: 30,\n  videoCodecProfile: VIDEO_CODEC_PROFILE_HIGH,\n  userCount: 0,\n  userConfigExtraInfo: {},\n  backgroundColor: 0x000000,\n  transcodingUsers: [],\n};\n\nvar createClient = function(options) {\n  if (options && options.mode === \"interop\") {\n    Logger.info(\"Creating client , MODE : Interop\");\n    return Client({mode: \"live\"});\n  } else if (options && options.mode === \"h264_interop\") {\n    Logger.info(\"Creating client , MODE : h264_interop\");\n    return Client({mode: \"live\", codec: \"h264\"});\n  } else if (options && options.mode === \"web-only\") {\n    Logger.info(\"Creating client , MODE : web-only\");\n    return Client({mode: \"rtc\"});\n  } else {\n    throw new Error('Invalid mode');\n  }\n};\n\nvar createRtcClient = function() {\n  Logger.info(\"Creating client , MODE : rtc\");\n  Logger.warning(\"createRtcClient is deprecated.\");\n  return Client({mode: \"rtc\"});\n};\n\nvar createLiveClient = function(spec) {\n  var id = \"host\";\n  if (spec && spec.role === \"audience\") {\n    id = spec.role;\n  }\n  Logger.info(\"Creating client , MODE : live\");\n  Logger.warning(\"createLiveClient is deprecated.\");\n  return Client({mode: \"live\", role: id});\n};\n\nexport {\n  createClient,\n  createRtcClient,\n  createLiveClient,\n\n  TranscodingUser,\n  LiveTranscoding\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Client.js","import {Stream} from \"./Stream\"\nimport Socket from \"./Websocket\"\nimport {Connection} from \"./Connection\"\nimport {EventDispatcher, StreamEvent, ClientEvent, LiveStreamingEvent} from \"./Events\"\nimport Logger from \"./utils/Logger\"\nimport ErrorCodes from \"./utils/ErrorCodes\"\nimport {GatewayErrorCode} from \"./utils/ErrorCodes\"\nimport AgoraCall from \"./utils/AgoraCall\"\nimport {getGatewayList} from \"./Server\"\nimport {VERSION} from \"./Config\"\nimport {report} from \"./Report2\"\nimport {vsResHack, isLiveTranscodingValid, random} from \"./Helper\"\nimport { isFireFox } from \"./utils/Browser\";\n\nvar GatewayClient = function (spec) {\n    \"use strict\";\n\n    var isBanned = false;\n    var Ping = function () {\n        return {\"_type\":\"ping\"};\n    };\n    var Join = function() {\n      var join = {\n        \"key\": that.key,  // type: string\n        \"channel\":that.joinInfo.cname,  // type: string\n        \"uid\": that.uid,  // type: uint32\n        \"version\": VERSION, // type: string\n        \"browser\": navigator.userAgent, // type: string\n        \"mode\": spec.mode,  // type: string, check value in (\"live\", ...)\n        \"role\": spec.role,  // type: string, check value in (\"audience\", ...)\n        \"config\": that.config  // type: object\n      };\n      return {\"_type\":\"join1\",\"message\":join};\n    };\n    var Leave = function () {\n      return {\"_type\":\"leave\"};\n    };\n    var Control = function (options) {\n      return {\"_type\":\"control\",\"message\":options};\n    };\n    var Token = function (spec) {\n      // \"spec\":{\"mode\":\"live\",\"version\":\"1.12.0\",\"host\":\"webgw-washington-na-1.agora.io:5866\"}\n      return {\"_type\":\"token\",\"message\":spec};\n    };\n    var P2PLost = function () {\n      return {\"_type\":\"p2p_lost\",\"message\":null};\n    };\n    var Unpublish = function (streamId) {\n      return {\n        \"_type\":\"unpublish\"\n        ,\"message\":streamId  // type: uint32\n      };\n    };\n    var Unsubscribe = function (streamId) {\n      return {\n        \"_type\":\"unsubscribe\"\n        ,\"message\":streamId  // type: uint32\n      };\n    };\n    var SwitchVideoStream = function (streamId, streamType) {\n      return {\n        \"_type\":\"switchVideoStream\"\n        ,\"message\":{\n          id: streamId // type: uint32\n          , type: streamType  // type: int32\n        }};\n    };\n    var Publish = function (options, sdp, p2pid) {\n      return {\"_type\":\"publish\",\"options\":options,\"sdp\":sdp, \"p2pid\": p2pid};\n    };\n    var PublishStats = function (stats) {\n      return {\"_type\":\"publish_stats\",\"options\":{\"stats\":stats},\"sdp\":null};\n    };\n    var PublishStatsLow = function (stats) {\n      return {\"_type\":\"publish_stats_low\",\"options\":{\"stats\":stats},\"sdp\":null};\n    };\n    var Subscribe = function (options, sdp, p2pid) {\n      return {\"_type\":\"subscribe\",\"options\":options,\"sdp\":sdp, \"p2pid\": p2pid};\n    };\n    var SubscribeStats = function (streamId, stats) {\n      return {\"_type\":\"subscribe_stats\",\"options\":{id: streamId, stats: stats},\"sdp\":null};\n    };\n    var StartLiveStreaming = function (url, transcodingEnabled) {\n      return {\"_type\": \"start_live_streaming\", \"message\": {url: url, transcodingEnabled: transcodingEnabled}};\n    };\n    var StopLiveStreaming = function (url) {\n      return {\"_type\": \"stop_live_streaming\", \"message\": {url: url}};\n    };\n    var SetLiveTranscoding = function (transcoding) {\n      return {\"_type\": \"set_live_transcoding\", \"message\": {transcoding: transcoding}};\n    };\n\n    var DISCONNECTED = 0;\n    var CONNECTING = 1;\n    var CONNECTED = 2;\n\n    var that = EventDispatcher(spec);\n    that.socket = undefined;\n    that.state = DISCONNECTED;\n    that.mode = spec.mode;\n    that.role = spec.role;\n    that.codec = spec.codec;\n    that.config = {};\n    that.timers = {};\n    that.timer_counter = {};\n    that.localStreams = {};\n    that.remoteStreams = {};\n    that.attemps = 1;\n    that.p2p_attemps = 1;\n    that.audioLevel = {};\n    that.activeSpeaker = undefined;\n    \n    that.p2ps = new Map();\n    that.firstFrameTimer = new Map();\n\n    that.liveStreams = new Map();\n\n    var safeCall = AgoraCall;\n    that.p2pCounter = random(100000);\n    that.generateP2PId = function() {\n      return ++that.p2pCounter;\n    }\n\n    that.remoteVideoStreamTypes = {\n        REMOTE_VIDEO_STREAM_HIGH: 0,\n        REMOTE_VIDEO_STREAM_LOW: 1,\n        REMOTE_VIDEO_STREAM_MEDIUM: 2\n    };\n\n    that.configPublisher = function (config) {\n      that.config = config;\n    };\n\n    that.join = function(joinInfo, channelKey, onSuccess, onFailure) {\n        var lts = new Date().getTime();\n        var uid = joinInfo.uid;\n\n        if (that.state !== DISCONNECTED) {\n          Logger.error(\"Server already in connecting/connected state\");\n          onFailure && onFailure(ErrorCodes.INVALID_OPERATION);\n          report.joinGateway(joinInfo.sid, {\n            lts: lts,\n            succ: false,\n            ec: ErrorCodes.INVALID_OPERATION,\n            addr: null,\n          });\n          return;\n        }\n\n        if (uid !== null && uid !== undefined && parseInt(uid) !== uid) { //user specified uid MUST be integer\n          Logger.error(\"Input uid is invalid\");\n          onFailure && onFailure(ErrorCodes.INVALID_PARAMETER);\n          report.joinGateway(joinInfo.sid, {\n            lts: lts,\n            succ: false,\n            ec: ErrorCodes.INVALID_PARAMETER,\n            addr: null,\n          });\n          return;\n        }\n\n        that.joinInfo = joinInfo;\n        that.uid = uid;\n        that.key = channelKey;\n        // Connect to VosGateway\n        that.state = CONNECTING;\n        connectSocket(\n          joinInfo\n          , function (response) {\n            that.stunServerUrl = response.stunServerUrl;\n            that.turnServer = response.turnServer;\n            that.state = CONNECTED;\n            Logger.debug(\"Connected to gateway server\");\n\n            that.pingTimer = setInterval(\n              function() {\n                  sendMessage(\n                    Ping()\n                    , function () {}\n                    , function (e) {}\n                  );\n              }\n              , 3000);\n\n            sendMessage(\n              Join()\n              , function (message) {\n                report.joinGateway(joinInfo.sid, {\n                  lts: lts,\n                  succ: true,\n                  ec: null,\n                  vid: message.vid,\n                  addr: that.socket.getURL(),\n                })\n                onSuccess(that.uid);\n              }\n              , function (err) {\n                Logger.error(\"User join failed [\" + err + \"]\");\n                onFailure && onFailure(err);\n                report.joinGateway(joinInfo.sid, {\n                  lts: lts,\n                  succ: false,\n                  ec: err,\n                  addr: that.socket.getURL(),\n                });\n              });\n            }\n          , function (error) {\n            // error = JSON.stringify(error);\n            Logger.error(\"User join failed [\" + error + \"]\");\n            onFailure && onFailure(error);\n            report.joinGateway(joinInfo.sid, {\n              lts: lts,\n              succ: false,\n              ec: error,\n              addr: that.socket.getURL(),\n            });\n        });\n    };\n\n  that.leave = function(onSuccess, onFailure) {\n    // Logger.debug(\"Leaving channel ts\", new Date().getTime());\n    if (that.state != CONNECTED) {\n      safeCall(onSuccess);\n      return ;\n    }\n\n    clearInterval(that.pingTimer);\n    for (var i in that.timers) {\n      if (that.timers.hasOwnProperty(i)) {\n        clearInterval(that.timers[i]);\n      }\n    }\n\n    sendMessage(Leave(), function (message) {\n      that.socket.close();\n      that.socket = undefined;\n      Logger.info(\"Leave channal success\");\n      onSuccess && onSuccess(message);\n    }, onFailure);\n\n    // Remove local streams\n    for (var i in that.localStreams) {\n      if (that.localStreams.hasOwnProperty(i)) {\n        var stream = that.localStreams[i];\n        delete that.localStreams[i];\n        if (stream.pc !== undefined) {\n          stream.pc.close();\n          stream.pc = undefined;\n        }\n      }\n    }\n\n    removeRemoteStreams();\n\n    that.state = DISCONNECTED;\n  };\n  \n  // It publishes the stream provided as argument.\n  that.publish = function (stream, onSuccess, onFailure) {\n    var lts = new Date().getTime();\n    //TODO rwrite - for the dtls failed can not raise event to report\n    stream.publishLTS = lts;\n\n    if (typeof stream !== \"object\" || stream === null) {\n      Logger.error(\"Invalid local stream\");\n      onFailure && onFailure(ErrorCodes.INVALID_LOCAL_STREAM);\n      report.publish(that.joinInfo.sid, {\n        lts: lts,\n        succ: false,\n        ec: ErrorCodes.INVALID_LOCAL_STREAM,\n      });\n      return;\n    }\n    if (stream.stream === null && stream.url === undefined) {\n      Logger.error(\"Invalid local media stream\");\n      onFailure && onFailure(ErrorCodes.INVALID_LOCAL_STREAM);\n      report.publish(that.joinInfo.sid, {\n        lts: lts,\n        succ: false,\n        ec: ErrorCodes.INVALID_LOCAL_STREAM,\n      });\n      return;\n    }\n    if (that.state !== CONNECTED) {\n      Logger.error(\"User is not in the session\");\n      onFailure && onFailure(ErrorCodes.INVALID_OPERATION);\n      report.publish(that.joinInfo.sid, {\n        lts: lts,\n        succ: false,\n        ec: ErrorCodes.INVALID_OPERATION,\n      });\n      return;\n    }\n    var options = stream.getAttributes() || {};\n    // If the stream is not local we do nothing\n    if (stream.local && that.localStreams[stream.getId()] === undefined) {\n      // Publish media stream to VoS gateway\n      if (stream.hasAudio() || stream.hasVideo() || stream.hasScreen()) {\n\n        var p2pId = that.generateP2PId();\n\n        if (stream.url !== undefined) {\n          // TODO:   --\n          sendSimpleSdp(\n            Publish({\n              state: \"url\", \n              audio: stream.hasAudio(), \n              video: stream.hasVideo(), \n              attributes: stream.getAttributes(), \n              mode: that.mode\n            }, stream.url), \n            function (answer, id) {\n              if (answer === \"success\") {\n                stream.getUserId = function () {\n                  return id;\n                };\n                that.localStreams[id] = stream;\n                stream.onClose = function () {\n                  that.unpublish(stream);\n                };\n              } else {\n                Logger.error(\"Publish local stream failed\", answer);\n              }\n            }\n          );\n        } else {\n          // Keep record of the local stream before sending publish message.\n          // We rely on this record to recover when reconnecting.\n          that.localStreams[stream.getId()] = stream;\n          stream.pc = Connection({\n            callback: function (offer) {\n              Logger.debug(\"SDP exchange in publish : send offer --  \", JSON.parse(offer));\n              sendSimpleSdp(\n                Publish({\n                  state: \"offer\", \n                  id: stream.getId(), \n                  audio: stream.hasAudio(), \n                  video: stream.hasVideo() || stream.hasScreen(), \n                  attributes: stream.getAttributes(), \n                  mode: that.mode, \n                  codec: that.codec,\n                  p2pid: p2pId\n                }, offer), \n                function (answer, info) {\n                  if (answer === \"error\") {\n                    Logger.error(\"Publish local stream failed\");\n                    onFailure && onFailure(ErrorCodes.PUBLISH_STREAM_FAILED);\n                    report.publish(that.joinInfo.sid, {\n                      lts: lts,\n                      succ: false,\n                      localSDP: offer,\n                      ec: ErrorCodes.PUBLISH_STREAM_FAILED,\n                    });\n                    return;\n                  }\n\n                  stream.pc.onsignalingmessage = function (ok) {\n                    stream.pc.onsignalingmessage = function () {};\n                    sendSimpleSdp(\n                      Publish({\n                        state: \"ok\", \n                        id: stream.getId(), \n                        audio: stream.hasAudio(), \n                        video: stream.hasVideo(), \n                        screen: stream.hasScreen(), \n                        attributes: stream.getAttributes(), \n                        mode: that.mode\n                      }, ok)\n                    );\n\n                    stream.getUserId = function () {\n                      return info.id;\n                    }\n                    Logger.info(\"Local stream published with uid\", info.id);\n                    stream.onClose = function () {\n                      that.unpublish(stream);\n                    }\n                    stream.unmuteAudio = function() {\n                      sendMessage(Control({\"action\": \"audio-out-on\", \"streamId\": stream.getId()}), function(){}, function(){});\n                    };\n                    stream.unmuteVideo = function() {\n                      sendMessage(Control({\"action\": \"video-out-on\", \"streamId\": stream.getId()}), function(){}, function(){});\n                    };\n                    stream.muteAudio = function() {\n                      sendMessage(Control({\"action\": \"audio-out-off\", \"streamId\": stream.getId()}), function(){}, function(){});\n                    };\n                    stream.muteVideo = function() {\n                      sendMessage(Control({\"action\": \"video-out-off\", \"streamId\": stream.getId()}), function(){}, function(){});\n                    };\n                  };\n\n                  stream.pc.oniceconnectionstatechange = function (state) {\n                    if (state === \"failed\") {\n                      if (that.timers[stream.getId()] != undefined) {\n                        clearInterval(that.timers[stream.getId()]);\n                      }\n                      \n                      Logger.error(\"Publisher connection is lost\");\n                      onFailure && onFailure(ErrorCodes.PEERCONNECTION_FAILED);\n                      that.p2ps.delete(p2pId);\n                      that.dispatchEvent(ClientEvent({type: \"pubP2PLost\", stream: stream}));\n                      report.publish(that.joinInfo.sid, {\n                        lts: lts,\n                        succ: false,\n                        ec: ErrorCodes.PEERCONNECTION_FAILED,\n                      });\n\n                    } else if (state === \"connected\") {\n                      that.p2ps.set(p2pId, stream);\n                      stream.p2pId = p2pId;\n                      onSuccess && onSuccess();\n                      // Logger.info(\"Publish success, uid:\", stream.getId());\n                      report.publish(that.joinInfo.sid, {\n                        lts: lts,\n                        succ: true,\n                        ec: null,\n                      });\n                    }\n                  };\n\n                  Logger.debug(\"SDP exchange in publish : receive answer --  \", JSON.parse(answer));\n                  stream.pc.processSignalingMessage(answer);\n                });\n            }, audio: stream.hasAudio(), \n            video: stream.hasVideo(), \n            screen: stream.hasScreen(), \n            isSubscriber: false, \n            iceServers: [], \n            stunServerUrl: that.stunServerUrl,\n            turnServer: that.turnServer, \n            maxAudioBW: options.maxAudioBW, \n            minVideoBW: options.minVideoBW, \n            maxVideoBW: options.maxVideoBW, \n            mode:that.mode, \n            codec:that.codec\n          });\n\n          stream.pc.addStream(stream.stream);\n          Logger.debug(\"PeerConnection add stream :\", stream.stream);\n          that.timers[stream.getId()] = setInterval(function() {\n            if (stream && stream.pc && stream.pc.getStats) {\n              stream.pc.getStatsRate(function(stats) {\n                stats.forEach(function(stat) {\n                  // Firefox and Safari get resolution from stream\n                  if ((stat.id.indexOf(\"outbound_rtp\") !== -1 ||\n                    stat.id.indexOf(\"OutboundRTP\") !== -1) && \n                    stat.mediaType === \"video\") {\n                      stat.googFrameWidthSent = stream.videoWidth + '';\n                      stat.googFrameHeightSent = stream.videoHeight + '';\n                  }\n\n                  // stream.getUserId wiil be undefined if pc dtls failed\n                  if(!stream.getUserId) return;\n                  \n                  if(stream.getId() === stream.getUserId()) {\n                    sendMessage(PublishStats(stat), null, null);\n                  } else {\n                    sendMessage(PublishStatsLow(stat), null, null);\n                  }\n                  \n                });\n              });\n            }\n          }, 3000);\n\n          if (stream.aux_stream !== undefined) {\n            stream.pc.addStream(stream.aux_stream);\n            Logger.debug(\"PeerConnection add stream :\", stream.aux_stream);\n          }\n        }\n      }\n    }\n  };\n\n  // It unpublishes the local stream,\n  // dispatching a StreamEvent(\"stream-removed\")\n  that.unpublish = function (stream, onSuccess, onFailure) {\n    // Logger.debug(\"Start unpublishing local stream\");\n    if (typeof stream !== \"object\" || stream === null) {\n      Logger.error(\"Invalid local stream\");\n      safeCall(onFailure, ErrorCodes.INVALID_LOCAL_STREAM);\n      return;\n    }\n    if (that.state !== CONNECTED) {\n      Logger.error(\"User not in the session\");\n      safeCall(onFailure, ErrorCodes.INVALID_OPERATION);\n      return;\n    }\n    if (that.timers[stream.getId()] != undefined) {\n      clearInterval(that.timers[stream.getId()]);\n    }\n    if (that.socket !== undefined) {\n      // Unpublish stream from VoS gateway\n      if (stream.local && that.localStreams[stream.getId()] !== undefined) {\n        delete that.localStreams[stream.getId()];\n        sendMessage(Unpublish(stream.getUserId()), function (answer) {\n          if (answer === \"error\") {\n            Logger.error(\"Unpublish stream failed\");\n            safeCall(onFailure, ErrorCodes.UNPUBLISH_STREAM_FAILED);\n            return;\n          }\n          if ((stream.hasAudio() || stream.hasVideo() || stream.hasScreen()) && stream.url === undefined) {\n            if (stream.pc !== undefined) {\n              stream.pc.close();\n              stream.pc = undefined;\n            }\n          }\n          stream.onClose = undefined;\n          stream.unmuteAudio = undefined;\n          stream.muteAudio = undefined;\n          stream.unmuteVideo = undefined;\n          stream.muteVideo = undefined;\n          that.p2ps.delete(stream.p2pId);\n          onSuccess && onSuccess();\n          // Logger.info(\"Unpublish stream success, uid:\", stream.getId());\n        }, onFailure);\n      } else {\n        Logger.error(\"Invalid local stream\");\n        safeCall(onFailure, ErrorCodes.INVALID_LOCAL_STREAM);\n      }\n    } else {\n      Logger.error(\"User not in the session\");\n      safeCall(onFailure, ErrorCodes.INVALID_OPERATION);\n    }\n  };\n\n  // It subscribes to a remote stream and draws it inside the HTML tag given\n  // by the ID=\"elementID\"\n  that.subscribe = function (stream, onSuccess, onFailure) {\n    var lts = new Date().getTime();\n    //TODO rwrite - for the dtls failed can not raise event to report\n    stream.subscribeLTS = lts;\n\n    if (typeof stream !== \"object\" || stream === null) {\n      Logger.error(\"Invalid remote stream\");\n      onFailure && onFailure(ErrorCodes.INVALID_REMOTE_STREAM);\n      report.subscribe(that.joinInfo.sid, {\n        lts: lts,\n        succ: false,\n        peerid: stream.getId() + \"\",\n        ec: ErrorCodes.INVALID_REMOTE_STREAM,\n      });\n      return;\n    }\n    if (that.state !== CONNECTED) {\n      Logger.error(\"User is not in the session\");\n      onFailure && onFailure(ErrorCodes.INVALID_OPERATION);\n      report.subscribe(that.joinInfo.sid, {\n        lts: lts,\n        succ: false,\n        peerid: stream.getId() + \"\",\n        ec: ErrorCodes.INVALID_OPERATION,\n      });\n      return;\n    }\n    if (!stream.local && that.remoteStreams.hasOwnProperty(stream.getId())) {\n      if (stream.hasAudio() || stream.hasVideo() || stream.hasScreen()) {\n        var p2pId = that.generateP2PId();\n        stream.pc = Connection({\n          callback: function (offer) {\n            Logger.debug(\"SDP exchange in subscribe : send offer --  \", JSON.parse(offer) );\n            sendSimpleSdp(Subscribe({\n              streamId: stream.getId(), \n              audio: true, video: true, \n              mode: that.mode, \n              codec: that.codec,\n              p2pid: p2pId\n            }, offer), \n            function (answer) {\n              if (answer === \"error\") {\n                Logger.error(\"Subscribe remote stream failed, closing stream \", stream.getId())\n                stream.close();\n                onFailure && onFailure(ErrorCodes.SUBSCRIBE_STREAM_FAILED);\n                report.subscribe(that.joinInfo.sid, {\n                  lts: lts,\n                  succ: false,\n                  peerid: stream.getId() + \"\",\n                  ec: ErrorCodes.SUBSCRIBE_STREAM_FAILED,\n                });\n                return;\n              }\n              Logger.debug(\"SDP exchange in subscribe : receive answer --  \", JSON.parse(answer));\n              stream.pc.processSignalingMessage(answer);\n            });\n          }, \n          nop2p: true, \n          audio: true, \n          video: true, \n          screen: stream.hasScreen(), \n          isSubscriber: true,\n          iceServers: [], \n          stunServerUrl: that.stunServerUrl, \n          turnServer: that.turnServer\n        });\n\n        stream.pc.onaddstream = function (evt, type) {\n          // Draw on html\n          if ((type === \"ontrack\" && evt.track.kind === \"video\") || type === \"onaddstream\") {\n            Logger.info(\"Remote stream subscribed with uid \" , stream.getId());\n            if (type === \"onaddstream\") {\n              that.remoteStreams[stream.getId()].stream = evt.stream;\n            } else {\n              that.remoteStreams[stream.getId()].stream = evt.streams[0];\n            }\n            if (!that.remoteStreams[stream.getId()].hasVideo()) {\n              that.remoteStreams[stream.getId()].disableVideo();\n            } else {\n              if(isFireFox()) {\n                let st = that.remoteStreams[stream.getId()].stream;\n                vsResHack(st, (videoWidth, videoHeight) => {\n                  stream.videoWidth = videoWidth;\n                  stream.videoHeight = videoHeight;\n                }, e => Logger.warning('vsResHack failed:' + e));\n              }\n            }\n            var subscribeEvt = StreamEvent({\n              type: \"stream-subscribed\", stream: that.remoteStreams[stream.getId()]});\n            that.dispatchEvent(subscribeEvt);\n          }\n          stream.unmuteAudio = function () {\n            sendMessage(Control({\"action\": \"audio-in-on\", \"streamId\": stream.getId()}), function(){}, function(){});\n          };\n          stream.muteAudio = function () {\n            sendMessage(Control({\"action\": \"audio-in-off\", \"streamId\": stream.getId()}), function(){}, function(){});\n          };\n          stream.unmuteVideo = function () {\n            sendMessage(Control({\"action\": \"video-in-on\", \"streamId\": stream.getId()}), function(){}, function(){});\n          };\n          stream.muteVideo = function () {\n            sendMessage(Control({\"action\": \"video-in-off\", \"streamId\": stream.getId()}), function(){}, function(){});\n          };\n        };\n\n        // for argus\n        that.timers[stream.getId()] = setInterval(function() {\n          if (stream && stream.pc && stream.pc.getStats) {\n            stream.pc.getStatsRate(function(stats) {\n              stats.forEach(function(stat) {\n                // Firefox get resolution from stream\n                if(stat.id.indexOf(\"inbound_rtp\") !== -1 &&\n                  stat.mediaType === \"video\" ) {\n                    stat.googFrameWidthReceived = stream.videoWidth + '';\n                    stat.googFrameHeightReceived = stream.videoHeight + '';\n                }\n                sendSimpleSdp(SubscribeStats(stream.getId(), stat), null, null);\n              })\n            });\n          }\n        }, 3000);\n        \n        // find active-speaker\n        that.audioLevel[stream.getId()] = 0;\n        that.timers[stream.getId()+\"audio\"] = setInterval(function() {\n          if (stream && stream.pc && stream.pc.getStats) {\n            stream.pc.getStats(function(stats) {\n              stats.forEach(function(stat) {\n                if (stat.mediaType === \"audio\") {\n                  //Logger.info(\"[zzz] uid:\"+stream.getId()+\" output level\"+stat.audioOutputLevel);\n                  if (stat.audioOutputLevel > 5000) {\n                    if (that.audioLevel[stream.getId()] < 20) {\n                      that.audioLevel[stream.getId()] += 1;\n                      //Logger.info(\"[xxx] user:\"+stream.getId()+\" counter:\"+that.audioLevel[stream.getId()]);\n                    }\n                    for (var i in that.audioLevel) {\n                      if (parseInt(i) !== stream.getId() && that.audioLevel[i] > 0) {\n                        that.audioLevel[i] -= 1;\n                        //Logger.info(\"[yyy] user:\"+i+\" counter:\"+that.audioLevel[i]+\" stream:\"+stream.getId());\n                      }\n                    }\n                  }\n                  var unsortedKeys = Object.keys(that.audioLevel);\n                  var sortedUids = unsortedKeys.sort(function(uid1, uid2) {\n                    return that.audioLevel[uid2] - that.audioLevel[uid1];\n                  });\n                  if (that.activeSpeaker !== sortedUids[0]) {\n                    var evt = ClientEvent({type: \"active-speaker\", uid: sortedUids[0]});\n                    that.dispatchEvent(evt);\n                    that.activeSpeaker = sortedUids[0];\n                    Logger.debug(\"Update active speaker:\" + that.activeSpeaker);\n                  }\n                }\n              });\n            });\n          }\n        }, 50);\n        \n        stream.pc.oniceconnectionstatechange = function (state) {\n          if (state === \"failed\") {\n            if (that.timers[stream.getId()] != undefined) {\n              clearInterval(that.timers[stream.getId()]);\n              clearInterval(that.timers[stream.getId()]+\"audio\");\n            }\n            that.p2ps.delete(p2pId);\n            Logger.error(\"Subscriber connection is lost\", stream.getId());\n            onFailure && onFailure(ErrorCodes.PEERCONNECTION_FAILED);\n            if(that.remoteStreams[stream.getId()]) {\n              that.dispatchEvent(ClientEvent({type: \"subP2PLost\", stream: stream}));\n            }\n            report.subscribe(that.joinInfo.sid, {\n              lts: lts,\n              succ: false,\n              peerid: stream.getId() + \"\",\n              ec: ErrorCodes.PEERCONNECTION_FAILED,\n            });\n            \n          } else if (state === \"connected\") {\n            that.p2ps.set(p2pId, stream);\n            stream.p2pId = p2pId;\n            onSuccess && onSuccess();\n            report.subscribe(that.joinInfo.sid, {\n              lts: lts,\n              succ: true,\n              peerid: stream.getId() + \"\",\n              ec: null,\n            });\n            // Report first frame\n            that.firstFrameTimer.set(stream.getId(), setInterval(function() {\n              if(stream.pc) {\n                stream.pc.getStats(function(stats) {\n                  stats.forEach(function(stat) {\n                    if(stat.id.indexOf(\"recv\") !== -1 || \n                    stat.id.indexOf(\"inbound_rtp\") !== -1 ||\n                    stat.id.indexOf(\"InboundRTP\") !== -1) {\n                      if(stat.mediaType === \"video\") {\n                        if(stat.framesDecoded > 0 || stat.googFramesDecoded > 0) {\n                          clearInterval(that.firstFrameTimer.get(stream.getId()));\n                          that.firstFrameTimer.delete(stream.getId());\n                          report.firstRemoteFrame(that.joinInfo.sid, {\n                            lts: new Date().getTime(),\n                            peerid: stream.getId() + \"\",\n                            succ: true,\n                            width: +stat.googFrameWidthReceived,\n                            height: +stat.googFrameHeightReceived\n                          });\n                        }\n                      }\n                    }\n                  })\n                });\n              } else {\n                clearInterval(that.firstFrameTimer.get(stream.getId()));\n                that.firstFrameTimer.delete(stream.getId());\n              }\n            }, 100));\n\n          }\n        };\n      } else {\n        Logger.error(\"Invalid remote stream\");\n        onFailure && onFailure(ErrorCodes.INVALID_REMOTE_STREAM);\n        report.subscribe(that.joinInfo.sid, {\n          lts: lts,\n          succ: false,\n          peerid: stream.getId() + \"\",\n          ec: ErrorCodes.INVALID_REMOTE_STREAM,\n        });\n      }\n    } else {\n      Logger.error(\"Invalid remote stream\");\n      onFailure && onFailure(ErrorCodes.INVALID_REMOTE_STREAM);\n      report.subscribe(that.joinInfo.sid, {\n        lts: lts,\n        succ: false,\n        peerid: stream.getId() + \"\",\n        ec: ErrorCodes.INVALID_REMOTE_STREAM,\n      });\n    }\n  };\n\n  // It unsubscribes from the stream, removing the HTML element\n  that.unsubscribe = function (stream, onSuccess, onFailure) {\n    // Logger.debug(\"Start unsubscribing remote stream with uid\", stream.getId());\n    if (typeof stream !== \"object\" || stream === null) {\n      Logger.error(\"Invalid remote stream\");\n      safeCall(onFailure, ErrorCodes.INVALID_REMOTE_STREAM);\n      return;\n    }\n\n    if (that.state !== CONNECTED) {\n      Logger.error(\"User is not in the session\");\n      safeCall(onFailure, ErrorCodes.INVALID_OPERATION);\n      return;\n    }\n\n    if (that.timers[stream.getId()] != undefined) {\n        clearInterval(that.timers[stream.getId()]);\n        clearInterval(that.timers[stream.getId()] + \"audio\");\n    }\n\n    if (that.audioLevel[stream.getId()] != undefined) {\n      delete(that.audioLevel[stream.getId()]);\n    }\n\n    if (that.timer_counter[stream.getId()] != undefined) {\n      delete(that.timer_counter[stream.getId()]);\n    }\n\n    if (! that.remoteStreams.hasOwnProperty(stream.getId())) {\n      safeCall(onFailure, ErrorCodes.NO_SUCH_REMOTE_STREAM);\n      return;\n    }\n    if (!that.socket) {\n      Logger.error(\"User is not in the session\");\n      safeCall(onFailure, ErrorCodes.INVALID_OPERATION);\n      return;\n    }\n\n    if (stream.local) {\n      Logger.error(\"Invalid remote stream\");      \n      safeCall(onFailure, ErrorCodes.INVALID_REMOTE_STREAM);\n      return ;\n    }\n\n    stream.close();\n    // delete that.remoteStreams[stream.getId()];\n\n    sendMessage(Unsubscribe(stream.getId()), function (answer) {\n      if (answer === \"error\") {\n        Logger.error(\"Unsubscribe remote stream failed\", stream.getId());\n        safeCall(onFailure, ErrorCodes.UNSUBSCRIBE_STREAM_FAILED);\n        return;\n      }\n      if (stream.pc !== undefined) {\n        stream.pc.close();\n        stream.pc = undefined;\n      }\n      stream.onClose = undefined;\n      stream.unmuteAudio = undefined;\n      stream.muteAudio = undefined;\n      stream.unmuteVideo = undefined;\n      stream.muteVideo = undefined;\n      \n      that.p2ps.delete(stream.p2pId);\n      Logger.info(\"Unsubscribe stream success\");\n      that.dispatchEvent(ClientEvent({type: \"stream-removed\", uid: stream.getId(), stream: stream}));\n      onSuccess && onSuccess();\n    }, onFailure);\n  };\n\n  that.setRemoteVideoStreamType = function (stream, streamType) {\n    Logger.debug(\"Switching remote video stream \" + stream.getId() + \" to \" + streamType);\n    if (typeof stream !== \"object\" || stream === null) {\n      Logger.error(\"Invalid remote stream\");\n      return;\n    }\n    if (that.state !== CONNECTED) {\n      Logger.error(\"User is not in the session\");\n      return;\n    }\n    if (!stream.local) {\n      switch (streamType) {\n      case that.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_HIGH:\n      case that.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_LOW:\n      case that.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_MEDIUM:\n        break;\n      default:\n        //safeCall(onFailure, ErrorCodes.INVALID_OPERATION);\n        return;\n      }\n      sendMessage(SwitchVideoStream(stream.getId(), streamType), null, null);\n    } else {\n      //safeCall(onFailure, ErrorCodes.INVALID_REMOTE_STREAM);\n    }\n  };\n\n  that.startLiveStreaming = function (url, transcodingEnabled) {\n    that.liveStreams.set(url, transcodingEnabled);\n    Logger.debug(\"Start live streaming \" + url + \" transcodingEnabled \" + transcodingEnabled);\n    if (that.state !== CONNECTED) {\n      Logger.error(\"User is not in the session\");\n      return;\n    }\n    sendMessage(StartLiveStreaming(url, transcodingEnabled), null, null);\n  };\n\n  that.stopLiveStreaming = function (url) {\n    Logger.debug(\"Stop live streaming \" + url);\n    if (that.state !== CONNECTED) {\n      Logger.error(\"User is not in the session\");\n      return;\n    }\n    that.liveStreams.delete(url);\n    sendMessage(StopLiveStreaming(url), null, null);\n  };\n\n  that.setLiveTranscoding = function (transcoding) {\n    if(!isLiveTranscodingValid(transcoding)) {\n      return ;\n    }\n    that.transcoding = transcoding;\n    Logger.debug(\"Set live transcoding \",transcoding);\n    if (that.state !== CONNECTED) {\n      Logger.error(\"User is not in the session\");\n      return;\n    }\n    sendMessage(SetLiveTranscoding(transcoding), null, null);\n  };\n\n  var generateInterval = function(k) {\n    return Math.min(30, (Math.pow(2, k) - 1)) * 1000;\n  };\n\n  var recover = function() {\n    if (that.key) {\n      Logger.info(\"Re-joining to channel \" + that.joinInfo.cname);\n      that.join(that.joinInfo, that.key, function (uid) {\n        Logger.info(\"User \" + uid + \" is re-joined to \" + that.joinInfo.cname);\n        //TODO rewrite\n        for (var streamId in that.localStreams) {\n          if (that.localStreams[streamId] !== undefined) {\n            var stream = that.localStreams[streamId];\n            delete that.localStreams[streamId];\n            if (stream.pc !== undefined) {\n              stream.pc.close();\n              stream.pc = undefined;\n            }\n          }\n        }\n        that.dispatchEvent(ClientEvent({type: \"rejoin\"}));\n        // Logger.info(\"Publish the old local stream again\");\n        // that.publish(stream, function (err) {\n        //   Logger.error(\"Publish the old stream failed\");\n        // });\n        if(that.liveStreams && that.liveStreams.size) {\n          that.liveStreams.forEach((value, key) => {\n            if(value) {\n              that.setLiveTranscoding(that.transcoding);\n            }\n            that.startLiveStreaming(key, value);\n          });\n        }\n\n      }, function (err) {\n        Logger.error(\"Re-join to channel failed [\" + err + \"]\");\n        if (err === 'ERR_DYNAMIC_KEY_TIMEOUT') {\n          var evt = StreamEvent({type: \"error\", reason: ErrorCodes.DYNAMIC_KEY_TIMEOUT});\n          that.dispatchEvent(evt);\n          var time = generateInterval(that.attemps);\n          Logger.error(\"Connect to server failed [Channel key timeout], attempt to recover [#\" + that.attemps + \"] after \" + time / 1000 + \" seconds\");\n          var timer = setTimeout(function () {\n            that.attemps++;\n            if (that.socket !== undefined) {\n              that.socket.disconnect();\n            }\n          }, time);\n        } else {\n          that.dispatchEvent(StreamEvent({type: \"error\", reason: err}));\n        }\n      });\n    } else {\n      Logger.error(\"Connection recover failed [Invalid channel key]\");\n    }\n  };\n\n  var createSocket = function (host) {\n    that.socket = Socket(host, {sid: that.joinInfo.sid});\n  };\n\n    var connectSocket = function (joinInfo, callback, error) {\n      // Once we have connected\n      var max_connect_attempts = 10;\n      var connect_timeout_attempt = 0;\n      // Deal with transport close\n      // Sometimes socket.io will disconnect immediately after connected,\n      // we need some strategy to deal with this case.\n\n      // This handles reconnection.\n      // If we try to re-initialize \"that.socket\" each time when connecting,\n      // reconnecting after disconnected from gateway could not result in sucess.\n      // However, we could simply reuse previous created \"that.socket\" to\n      // re-establish the connection between client and gateway, by calling\n      // \"that.socket.socket.connect()\". And we don\"t delete \"that.socket\"\n      // when \"client-disconnect\" event triggered.\n      if (that.socket !== undefined) {\n        that.socket.socket.connect();\n      } else {\n        // Create socket connection.\n        createSocket(joinInfo.gatewayAddr);\n\n        that.socket.on(\"onUplinkStats\", function (args) {\n          if(that.localStreams[that.uid]) {\n            that.localStreams[that.uid].uplinkStats = args;\n          }\n        });\n\n        // Add connect event listener.\n        that.socket.on(\"connect\", function () {\n          that.attemps = 1;\n          sendMessage(Token(joinInfo), callback, error);\n        });\n\n        that.socket.on(\"reconnect\", function () {\n          Logger.debug(\"Try to reconnect choose server and get gateway list again \");\n          getGatewayList(that.joinInfo, function(res) {\n            that.socket.reconnect(res.gateway_addr);\n          })\n        });\n\n        // Add connect_error event listener.\n        that.socket.on(\"connect_error\", function (err) {\n          // Clear peer connection stats timers\n          for (var i in that.timers) {\n            if (that.timers.hasOwnProperty(i)) {\n              clearInterval(that.timers[i]);\n            }\n          }\n\n          for (var i in that.remoteStreams) {\n            if (that.remoteStreams.hasOwnProperty(i)) {\n              var stream = that.remoteStreams[i];\n              // Dispatch peer leave event\n              var evt = ClientEvent({type: \"stream-removed\", uid: stream.getId(), stream: stream});\n              that.dispatchEvent(evt);\n            }\n          }\n\n          removeRemoteStreams();\n          if(isBanned == true) return;\n\n          clearInterval(that.pingTimer);\n          that.state = DISCONNECTED;\n          that.socket = undefined;\n          var evt = StreamEvent({type: \"error\", reason: ErrorCodes.SOCKET_ERROR});\n          that.dispatchEvent(evt);\n\n          var time = generateInterval(that.attemps);\n          Logger.error(\"Connect to server error [\" + JSON.stringify(err) + \"], attempt to recover [#\" + that.attemps + \"] after \" + time / 1000 + \" seconds\");\n          var timer = setTimeout(function () {\n            // We\"ve tried to reconnect so increase the attempts by 1\n            that.attemps++;\n            recover();\n          }, time);\n        });\n\n        that.socket.on(\"disconnect\", function (reason) {\n          if (that.state === DISCONNECTED) return;\n          that.state = DISCONNECTED;\n\n          // Clear peer connection stats timers\n          for (var i in that.timers) {\n            if (that.timers.hasOwnProperty(i)) {\n              clearInterval(that.timers[i]);\n            }\n          }\n\n          for (var i in that.remoteStreams) {\n            if (that.remoteStreams.hasOwnProperty(i)) {\n              var stream = that.remoteStreams[i];\n              // Dispatch peer leave event\n              var evt = ClientEvent({type: \"stream-removed\", uid: stream.getId(), stream: stream});\n              that.dispatchEvent(evt);\n            }\n          }\n\n          that.p2ps.clear()\n          removeRemoteStreams();\n          if(isBanned == true) return;\n          clearInterval(that.pingTimer);\n          that.socket = undefined;\n          //safeCall(error, ErrorCodes.SOCKET_DISCONNECTED);\n          var evt = StreamEvent({type: \"error\", reason: ErrorCodes.SOCKET_DISCONNECTED});\n          that.dispatchEvent(evt);\n\n          var time = generateInterval(that.attemps);\n          Logger.error(\"Disconnect from server [\" + reason + \"], attempt to recover [#\" + that.attemps + \"] after \" + time / 1000 + \" seconds\");\n          var timer = setTimeout(function () {\n            // We\"ve tried to reconnect so increment the attempts by 1\n            that.attemps++;\n            recover();\n          }, time);\n        });\n\n        // We receive an event with a new stream.\n        // type can be \"media\" or \"data\"\n        that.socket.on(\"onAddAudioStream\", function (arg) {\n          Logger.info(\"Newly added audio stream with uid\", arg.id);\n          if (that.remoteStreams[arg.id] === undefined) {\n            var stream = Stream({\n              streamID: arg.id, local: false, audio: arg.audio, video: arg.video,\n              screen: arg.screen, attributes: arg.attributes});\n            that.remoteStreams[arg.id] = stream;\n            var evt = StreamEvent({type: \"stream-added\", stream: stream});\n            that.dispatchEvent(evt);\n          }\n        });\n\n        that.socket.on(\"onAddVideoStream\", function (arg) {\n          Logger.info(\"Newly added remote stream with uid\", arg.id);\n          if (that.remoteStreams[arg.id] === undefined) {\n            var stream = Stream({\n              streamID: arg.id, local: false, audio: arg.audio, video: arg.video,\n              screen: arg.screen, attributes: arg.attributes});\n            that.remoteStreams[arg.id] = stream;\n            var evt = StreamEvent({type: \"stream-added\", stream: stream});\n            that.dispatchEvent(evt);\n          } else {\n            if (that.remoteStreams[arg.id].stream !== undefined) {\n              that.remoteStreams[arg.id].video = true;\n              that.remoteStreams[arg.id].enableVideo();\n              Logger.info(\"Stream changed: enable video \" + arg.id);\n              var st = that.remoteStreams[arg.id];\n              var element = st.player.elementID;\n              st.stop();\n              st.play(element);\n            } else {\n              var stream = Stream({\n                streamID: arg.id, local: false, audio: true, video: true,\n                screen: false, attributes: arg.attributes});\n              that.remoteStreams[arg.id] = stream;\n              Logger.info(\"Stream changed: modify video \" + arg.id);\n            }\n          }\n        });\n\n        // We receive an event of a stream removed\n        that.socket.on(\"onRemoveStream\", function (arg) {\n          var stream = that.remoteStreams[arg.id];\n          if (!stream) {\n            console.log(\"ERROR stream \", arg.id, \" not found onRemoveStream \", arg);\n            return;\n          }\n          delete that.remoteStreams[arg.id];\n          var evt = StreamEvent({type: \"stream-removed\", stream: stream});\n          that.dispatchEvent(evt);\n          stream.close();\n          if (stream.pc !== undefined) {\n            stream.pc.close();\n            stream.pc = undefined;\n          }\n        });\n\n        // We receive an event of local stream published\n        that.socket.on(\"onPublishStream\", function (arg) {\n          var stream = that.localStreams[arg.id];\n          var evt = StreamEvent({type: \"stream-published\", stream: stream});\n          that.dispatchEvent(evt);\n        });\n\n        that.socket.on(\"mute_audio\", function (arg) {\n          Logger.info(\"rcv peer mute audio\");     \n          var evt = ClientEvent({type: \"mute-audio\", uid: arg.peerid});\n          that.dispatchEvent(evt);\n        });\n\n        that.socket.on(\"unmute_audio\", function (arg) {\n          Logger.info(\"rcv peer unmute audio\");  \n          var evt = ClientEvent({type: \"unmute-audio\", uid: arg.peerid});\n          that.dispatchEvent(evt);\n        });\n\n        that.socket.on(\"mute_video\", function (arg) {\n          Logger.info(\"rcv peer mute video\");   \n          var evt = ClientEvent({type: \"mute-video\", uid: arg.peerid});\n          that.dispatchEvent(evt);\n        });\n\n        that.socket.on(\"unmute_video\", function (arg) {\n          Logger.info(\"rcv peer unmute video\");   \n          var evt = ClientEvent({type: \"unmute-video\", uid: arg.peerid});\n          that.dispatchEvent(evt);\n        }); \n\n        that.socket.on(\"user_banned\", function (arg) {\n          Logger.info(\"user banned uid:\"+ arg.id+\"error:\"+arg.errcode); \n          var evt = ClientEvent({type: \"client-banned\", uid: arg.id, attr:arg.errcode});\n          that.dispatchEvent(evt);\n          isBanned = true;\n          leave();\n        });\n\n        that.socket.on(\"onP2PLost\", function (arg) {\n          Logger.debug(\"p2plost:\", arg);\n          if(arg.event === 'publish') {\n            let stream = that.localStreams[arg.uid];\n            stream && report.publish(that.joinInfo.sid, {\n              lts: stream.publishLTS,\n              succ: false,\n              ec: 'DTLS failed',\n            });\n          }\n\n          if(arg.event === 'subscribe') {\n            let stream = that.remoteStreams[arg.uid];\n            stream && report.subscribe(that.joinInfo.sid, {\n              lts: stream.subscribeLTS,\n              succ: false,\n              peerid: arg.uid + '',\n              ec: 'DTLS failed',\n            });\n          }\n\n\n          Logger.debug('p2plost:', arg.p2pid);\n          var stream = that.p2ps.get(arg.p2pid);\n          if(stream) {\n            that.p2ps.delete(arg.p2pid);\n            if(stream.local) {\n              that.dispatchEvent(ClientEvent({type: \"pubP2PLost\", stream: stream}));\n            } else {\n              if(that.remoteStreams[stream.getId()]) {\n                that.dispatchEvent(ClientEvent({type: \"subP2PLost\", stream: stream}));\n              }\n            }\n          }\n\n        });\n\n        // We receive an event of a client leaved\n        that.socket.on(\"onPeerLeave\", function (arg) {\n          var evt = ClientEvent({type: \"peer-leave\", uid: arg.id});\n          if (that.remoteStreams.hasOwnProperty(arg.id)) {\n            evt.stream = that.remoteStreams[arg.id];\n          }\n          that.dispatchEvent(evt);\n\n          if (that.remoteStreams.hasOwnProperty(arg.id)) {\n            Logger.info(\"closing stream on peer leave\", arg.id);\n            var stream = that.remoteStreams[arg.id];\n            stream.close();\n            delete that.remoteStreams[arg.id];\n            if (stream.pc !== undefined) {\n              stream.pc.close();\n              stream.pc = undefined;\n            }\n          }\n\n          if (that.timers.hasOwnProperty(arg.id)) {\n            clearInterval(that.timers[arg.id]);\n            delete that.timers[arg.id];\n          }\n\n          if (that.audioLevel[arg.id] != undefined) {\n            delete(that.audioLevel[arg.id]);\n          }\n\n          if (that.timer_counter[arg.id] != undefined) {\n            delete(that.timer_counter[arg.id]);\n          }\n        });\n\n        that.socket.on(\"onUplinkStats\", function (args) {\n        });\n\n        that.socket.on(\"liveStreamingStarted\", function (args) {\n          var evt = LiveStreamingEvent({type: \"liveStreamingStarted\", url: args.url});\n          that.dispatchEvent(evt);\n        });\n\n        that.socket.on(\"liveStreamingFailed\", function (args) {\n          var evt = LiveStreamingEvent({type: \"liveStreamingFailed\", url: args.url});\n          that.dispatchEvent(evt);\n        });\n\n        that.socket.on(\"liveStreamingStopped\", function (args) {\n          var evt = LiveStreamingEvent({type: \"liveStreamingStopped\", url: args.url});\n          that.dispatchEvent(evt);\n        });\n        that.socket.on(\"liveTranscodingUpdated\", function (args) {\n          var evt = LiveStreamingEvent({type: \"liveTranscodingUpdated\", reason: args.reason});\n          that.dispatchEvent(evt);\n        });\n      }\n    };\n\n    var sendMessage = function (message, callback, error) {\n      if (that.socket === undefined) {\n        Logger.error(\"No socket available\");\n        safeCall(error, ErrorCodes.INVALID_OPERATION);\n        return;\n      }\n      try {\n        that.socket.emitSimpleMessage(message, function (respType, result) {\n          if (respType === \"success\") {\n            if (typeof callback === \"function\") {\n              callback(result);\n            }\n          } else {\n            if (typeof error === \"function\") {\n              error(GatewayErrorCode[result] || result);\n            }\n          }\n        });\n      } catch (err) {\n        Logger.error(\"Socket emit message failed\" + JSON.stringify(message));\n        Logger.error(err);\n        safeCall(error, ErrorCodes.SOCKET_ERROR);\n      }\n    };\n\n    // It sends a SDP message to the server using socket.io\n    var sendSimpleSdp = function (message, callback) {\n      if (that.socket === undefined) {\n        Logger.error(\"Error in sendSimpleSdp [socket not ready]\");\n        return;\n      }\n      try {\n        that.socket.emitSimpleMessage(message, function (response, respCallback) {\n          callback && callback(response, respCallback);\n        });\n      } catch (err) {\n        Logger.error(\"Error in sendSimpleSdp [\" + err + \"]\");\n      }\n    };\n\n    function removeRemoteStreams() {\n      for (var i in that.remoteStreams) {\n        if (that.remoteStreams.hasOwnProperty(i)) {\n          var stream = that.remoteStreams[i];\n          stream.stop();\n          stream.close();\n          delete that.remoteStreams[i];\n          if (stream.pc !== undefined) {\n            stream.pc.close();\n            stream.pc = undefined;\n          }\n        }\n      }\n    }\n\n    return that;\n};\n\nexport default GatewayClient\n\n\n\n// WEBPACK FOOTER //\n// ./src/GatewayClient.js","/*\n\nAPI used in Client.js\n\nthat.socket = io.connect(host, {timeout: 10000, reconnection: false, secure: true, transports:['websocket'], upgrade: false});\nthat.socket = io.connect(host, {timeout: 10000, reconnection: false, secure: false, transports:['websocket'], upgrade: false});\n\nthat.socket.connect();          // --> that.socket.socket.connect();\nthat.socket.disconnect();\nthat.socket.disconnect();\n\nthat.socket.on('connect', function () {                         \nthat.socket.on('connect_error', function (err) {\nthat.socket.on('disconnect', function (reason) {\nthat.socket.on('onAddAudioStream', function (arg) {\nthat.socket.on('onAddVideoStream', function (arg) {\nthat.socket.on('onRemoveStream', function (arg) {\nthat.socket.on('onPublishStream', function (arg) {\nthat.socket.on('onP2PLost', function (arg) {\nthat.socket.on('onPeerLeave', function (arg) {\n\nthat.socket.emit(type, msg, function (respType, msg) {\n    //      sendMessageSocket('token', token, callback, error);\n            sendMessageSocket = function (type, msg, callback, error) {\n            sendMessageSocket('customMessage', msg, function (uid) {\n            sendMessageSocket('customMessage', {\"type\": \"leave\"}, onSuccess, onFailure);\n            sendMessageSocket(\n            sendMessageSocket(\n            sendMessageSocket(\n            sendMessageSocket(\n            sendMessageSocket('p2p_lost', undefined, function () {}, function () {});\n            sendMessageSocket('unpublish', stream.getId(), function (answer) {\n            sendMessageSocket(\n            sendMessageSocket(\n            sendMessageSocket(\n            sendMessageSocket(\n            sendMessageSocket('p2p_lost', undefined, function () {}, function () {});\n            sendMessageSocket('unsubscribe', stream.getId(), function (answer) {\n            sendMessageSocket('switchVideoStream', {id: stream.getId(), type: streamType}, null, null);\n\n\nthat.socket.emit(type, options, sdp, function (response, respCallback) {\n    //      sendSDPSocket('publish', {...}, stream.url, function (answer, id) {\n            sendSDPSocket('publish', {...}, offer, function (answer, info) {\n            sendSDPSocket('publish', {...}, ok);\n            sendSDPSocket('publish_stats', {stats: stats}, null, null);\n            sendSDPSocket('subscribe', {...}, offer, function (answer) {\n            sendSDPSocket('subscribe_stats', {...}, null, null);\n\n\n*/\nimport Signal from './Signal'\nimport {MediaEvent} from './Events'\n\nvar Socket = function (host, spec) {\n\n    var that = {};\n\n    that.connect = function() {\n        spec.host = host;\n        that.signal = Signal(spec);\n        that.on = that.signal.on;\n        that.dispatchEvent = that.signal.dispatchEvent;\n\n        that.signal.on('onopen', function (e) {\n            that.signal.onEvent = function (e) {\n                that.dispatchEvent(MediaEvent({type: e.event, msg: e}));\n            };\n\n            that.dispatchEvent(MediaEvent({type: 'connect', msg: e}));\n        });\n\n        that.signal.on('onError', function (ev) {\n            var m = ev.msg;\n            onError(m.code, 'error');\n        });\n    };\n\n    that.disconnect = function() {\n        that.signal.disconnect();\n    };\n\n    that.close = function() {\n        that.signal.close();\n    };\n\n    that.getURL = function() {\n        return that.signal.getURL();\n    };\n\n    that.reconnect = function(host) {\n        that.signal.creatConnection(host);\n    };\n\n    that.emitSimpleMessage = function(message, callback) {\n        that.signal.sendSignalCommand(message, callback);\n    };\n\n    that.connect();\n    return that;\n};\n\nexport default Socket\n\n\n\n// WEBPACK FOOTER //\n// ./src/Websocket.js","import {EventDispatcher, MediaEvent} from './Events'\nimport AgoraCall from './utils/AgoraCall'\nimport Logger from \"./utils/Logger\"\nimport { report } from './Report2';\n\nvar Signal = function (spec) {\n  var that = EventDispatcher(spec);\n  that.needReconnect = true;\n  that.isTimeout = false;\n  that.isInit = true;\n\n  // test\n  // spec.host = [\n  //   \"webgw-shaoxing-cucc-1111.agora.io:5867\",\n  //   \"gw.agora.io:5688\",\n  //   \"webgw-shaoxing-cucc-1.agora.io:5867\"\n  // ];\n\n  that.hostIndex = 0;\n  that.requestID = 0;\n  if(spec.host instanceof Array) {\n    that.host = spec.host;\n  } else {\n    that.host = [spec.host];\n  }\n\n  that.Reconnection = function(host) {\n    that.host = host || that.host;\n    that.hostIndex = 0;\n    that.creatConnection();\n  }\n\n  that.getURL = function(){\n    return that.connection.url;\n  }\n\n  that.creatConnection = function() {\n    if(that.hostIndex >= that.host.length) {\n      that.hostIndex = 0;\n      that.dispatchEvent(MediaEvent({type: \"reconnect\"}));\n      return; \n    }\n    Logger.debug(\"start connect:\" +that.host[that.hostIndex]);\n    that.lts =  new Date().getTime();\n\n    //agora daily build\n    that.connection = new WebSocket(\"wss://\" + that.host[that.hostIndex++]);\n\n    //onopen\n    that.connection.onopen = function (e) {\n      Logger.debug(\"websockect opened\");\n      that.isTimeout = false;\n      that.isInit = false;\n      clearTimeout(that.timeoutCheck);\n      that.dispatchEvent(MediaEvent({type: 'onopen', event: e, socket: that}));\n    };\n\n    //onmessage\n    that.connection.onmessage = function (e) {\n      // Logger.debug(\"websockect onmessage:\", e);\n      var m = JSON.parse(e.data);\n      if (m.hasOwnProperty(\"_id\")) {\n        that.dispatchEvent(MediaEvent({type: m._id, msg: m}));\n      } else if (m.hasOwnProperty(\"_type\")) {\n        that.dispatchSocketEvent(MediaEvent({type: m._type, msg: m.message}));\n      }\n    };\n\n    //onclose\n    that.connection.onclose = function (e) { \n      if (!that.needReconnect) {\n          Logger.debug(\"websockect closeed\");\n          AgoraCall(spec.onFailure, e);\n          clearTimeout(that.timeoutCheck);\n          that.dispatchEvent(MediaEvent({type: 'close', event: e}));\n          that.connection.onopen = undefined;\n          that.connection.onclose = undefined;\n          that.connection.onerror = undefined;\n          that.connection.onmessage = undefined;\n          that.connection = undefined;\n      } else {\n        if(!that.isTimeout && !that.isInit) {\n          that.dispatchEvent(MediaEvent({type: 'disconnect', event: e}));\n        } else {\n          Logger.debug(\"websockect connect timeout\");\n          report.joinGateway(spec.sid, {\n            lts: that.lts,\n            succ: false,\n            ec: \"timeout\",\n            addr: that.connection.url,\n          });\n          that.creatConnection();\n        }\n      }\n    };\n  \n    //onerror : \n    // it's very weird that invoke socket.close will triger onerror, \n    // and this callback just return \"error\" but nothing useful details.\n    that.connection.onerror = function (e) {\n      // if (!that.needReconnect) {\n      //   console.log(e);\n      //   AgoraCall(spec.onFailure, e);\n      //   that.dispatchEvent(MediaEvent({type: 'connect_error', event: e}));\n      //   that.connection.onopen = undefined;\n      //   that.connection.onclose = undefined;\n      //   that.connection.onerror = undefined;\n      //   that.connection.onmessage = undefined;\n      //   that.connection = undefined;\n      // }\n    };\n\n    // timeout check\n    var timeoutCheck = setTimeout(function() {\n      if(that.connection && that.connection.readyState != WebSocket.OPEN) {\n        that.isTimeout = true;\n        that.connection.close();\n      }\n    }, 5000); \n  }\n  that.creatConnection();\n  \n  that.sendMessage = function (obj, onError) {\n    if (that.connection && that.connection.readyState == WebSocket.OPEN) {\n      that.connection.send(JSON.stringify(obj));\n    } else {\n      // console.log('Connection to gateway lost while sending ' + obj);\n      // console.log('signal connection state ' + that.connection.readyState);\n      onError({error: 'Gateway not connected'});\n    }\n  };\n\n  that.disconnect = function () {\n    that.needReconnect = true;\n    that.connection.close();\n  };\n\n  that.close = function () {\n    that.needReconnect = false;\n    that.connection.close();\n  };\n\n  that.sendSignalCommand = function (message, callback) {\n      message._id = \"_request_\" + that.requestID;\n      that.requestID += 1;\n      if (!(message._type === 'publish_stats' || message._type === 'subscribe_stats' || message._type === 'publish_stats_low')) {\n        that.on(message._id, function (e) {\n            e.msg && callback && callback(e.msg._result, e.msg.message);\n            delete that.dispatcher.eventListeners[message._id];\n        });\n      }\n      that.sendMessage(message, function (e) {\n        e.reason = 'NOT_CONNECTED';\n        callback && callback(e.reason, e);\n      });\n  };\n\n  return that;\n};\n\nexport default Signal\n\n\n\n// WEBPACK FOOTER //\n// ./src/Signal.js","import {isChrome, isFireFox, isSafari} from './utils/Browser'\n\nvar simMap = function(profile) {\n  var resolution;\n\n  switch (profile) {\n    case \"120p\":\n    case \"120p_1\":\n      resolution = [\"120p_1\", \"120p_1\", \"120p_1\"];\n      break;\n\n    case \"120p_3\":\n      resolution = [\"120p_3\", \"120p_3\", \"120p_3\"];\n      break;\n\n    case \"180p\":\n    case \"180p_1\":\n      resolution = [\"90p_1\", \"90p_1\", \"180p_1\"];\n      break;\n\n    case \"180p_3\":\n      resolution = [\"120p_3\", \"120p_3\", \"180p_3\"];\n      break;\n\n    case \"180p_4\":\n      resolution = [\"120p_1\", \"120p_1\", \"180p_4\"];\n      break;\n\n    case \"240p\":\n    case \"240p_1\":\n      resolution = [\"120p_1\", \"120p_1\", \"240p_1\"];\n      break;\n    \n    case \"240p_3\":\n      resolution = [\"120p_3\", \"120p_3\", \"240p_3\"];\n      break;\n\n    case \"240p_4\":\n      resolution = [\"120p_4\", \"120p_4\", \"240p_4\"];\n      break;\n\n    case \"360p\":\n    case \"360p_1\":\n    case \"360p_4\":\n    case \"360p_9\":\n    case \"360p_10\":\n    case \"360p_11\":\n      resolution = [\"90p_1\", \"90p_1\", \"360p_1\"];\n      break;\n\n    case \"360p_3\":\n    case \"360p_6\":\n      resolution = [\"120p_3\", \"120p_3\", \"360p_3\"];\n      break;\n    \n    case \"360p_7\":\n    case \"360p_8\":\n      resolution = [\"120p_1\", \"120p_1\", \"360p_7\"];\n      break;\n\n    case \"480p\":\n    case \"480p_1\":\n    case \"480p_2\":\n    case \"480p_4\":\n    case \"480p_10\":\n      resolution = [\"120p_1\", \"120p_1\", \"480p_1\"];\n      break;\n\n    case \"480p_3\":\n    case \"480p_6\":\n      resolution = [\"120p_3\", \"120p_3\", \"480p_3\"];\n      break;\n\n    case \"480p_8\":\n    case \"480p_9\":\n      resolution = [\"120p_4\", \"120p_4\", \"480p_8\"]; \n      break;\n      \n    case \"720p\":\n    case \"720p_1\":\n    case \"720p_2\":\n    case \"720p_3\":\n      resolution = [\"90p_1\", \"90p_1\", \"720p_1\"]; \n      break;\n\n    case \"720p_5\":\n    case \"720p_6\":\n      resolution = [\"120p_1\", \"120p_1\", \"720p_5\"]; \n      break;\n\n    case \"1080p\":\n    case \"1080p_1\":\n    case \"1080p_2\":\n    case \"1080p_3\":\n    case \"1080p_5\":\n      resolution = [\"90p_1\", \"90p_1\", \"1080p_1\"]; \n      break;\n\n    case \"1440p\":\n    case \"1440p_1\":\n    case \"1440p_2\":\n      resolution = [\"90p_1\", \"90p_1\", \"1440p_1\"]; \n      break;\n    \n    case \"4k\":\n    case \"4k_1\":\n    case \"4k_3\":\n      resolution = [\"90p_1\", \"90p_1\", \"4k_1\"];\n      break;\n\n    default:\n      resolution = [\"120p_1\", \"120p_1\", \"360p_7\"];\n  }\n  \n  if(isFireFox()) {\n    // FF: adaptive frame rate, normally 30fps\n    // H264 - get resolution same as high stream\n    // VP8 - adaptive resolution close to the setting \n    return [resolution[1], 15, 50];\n  } else if(isSafari()) {\n    // adaptive frame rate close to the setting\n    // H264 - low stream resolution must be same as high stream \n    return [resolution[2], 15, 50];\n  } else {\n    // adaptive frame rate close to the setting\n    // adaptive resolution close to the setting\n    return [resolution[0], 15, 50];\n  }\n}\n\nexport {\n  simMap\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/SimMap.js","import {VERSION} from './Config'\nimport Logger from './utils/Logger'\nimport {checkSystemRequirements} from './Helper'\nimport {createStream, getDevices} from './Stream'\n\nimport {\n  AUDIO_SAMPLE_RATE_32000,\n  AUDIO_SAMPLE_RATE_44100,\n  AUDIO_SAMPLE_RATE_48000,\n\n  VIDEO_CODEC_PROFILE_BASELINE,\n  VIDEO_CODEC_PROFILE_MAIN,\n  VIDEO_CODEC_PROFILE_HIGH,\n\n  REMOTE_VIDEO_STREAM_HIGH,\n  REMOTE_VIDEO_STREAM_LOW,\n  REMOTE_VIDEO_STREAM_MEDIUM\n} from './GlobalName'\n\nimport {\n  createClient,\n  TranscodingUser,\n  LiveTranscoding\n} from './Client'\n\nexport {\n  TranscodingUser,\n  LiveTranscoding,\n\n  createClient,\n  createStream,\n\n  Logger,\n  getDevices,\n  checkSystemRequirements,\n\n  VERSION,\n\n  AUDIO_SAMPLE_RATE_32000,\n  AUDIO_SAMPLE_RATE_44100,\n  AUDIO_SAMPLE_RATE_48000,\n\n  VIDEO_CODEC_PROFILE_BASELINE,\n  VIDEO_CODEC_PROFILE_MAIN,\n  VIDEO_CODEC_PROFILE_HIGH,\n\n  REMOTE_VIDEO_STREAM_HIGH,\n  REMOTE_VIDEO_STREAM_LOW,\n  REMOTE_VIDEO_STREAM_MEDIUM\n}\n\n\n// WEBPACK FOOTER //\n// ./src/Entry.production.js"],"sourceRoot":""}